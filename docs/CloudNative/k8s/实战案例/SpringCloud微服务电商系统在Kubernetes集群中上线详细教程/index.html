<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-CloudNative/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">SpringCloud微服务电商系统在Kubernetes集群中上线详细教程 | AGou&#x27;s Docsv4</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.agou-ops.cn/docs/CloudNative/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SpringCloud微服务电商系统在Kubernetes集群中上线详细教程 | AGou&#x27;s Docsv4"><meta data-rh="true" name="description" content="该文章来自：https://jiangxl.blog.csdn.net/article/details/121740024"><meta data-rh="true" property="og:description" content="该文章来自：https://jiangxl.blog.csdn.net/article/details/121740024"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-KQED41RW95","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.916b7a43.css">
<link rel="preload" href="/assets/js/runtime~main.5d4589e6.js" as="script">
<link rel="preload" href="/assets/js/main.28f9d1a7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">AGou&#x27;s Docsv4</b></a><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">✨ 我的博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"> 📖 目录</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs">🌲 目录树</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/category/云原生相关">☁️ 云原生相关</a></li><li><a class="dropdown__link" href="/docs/category/linux基础">😊 Linux基础</a></li><li><a class="dropdown__link" href="/docs/category/编程语言">♨️ 编程语言</a></li><li><a class="dropdown__link" href="/docs/category/脚本相关">🕹️ 脚本相关</a></li><li><a class="dropdown__link" href="/docs/Interview/">👨‍⚖️ 面试相关</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">版本</a><ul class="dropdown__menu"><li><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver1.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver2.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver3.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub 仓库"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"><b>AGou&#x27;s Docsv4</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/云原生相关">云原生相关</a><button aria-label="Toggle the collapsible sidebar category &#x27;云原生相关&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cicd">CICD</a><button aria-label="Toggle the collapsible sidebar category &#x27;CICD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cloudcomptering">CloudComptering</a><button aria-label="Toggle the collapsible sidebar category &#x27;CloudComptering&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/docker">Docker</a><button aria-label="Toggle the collapsible sidebar category &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elfk">ELFK</a><button aria-label="Toggle the collapsible sidebar category &#x27;ELFK&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/prometheus">Prometheus</a><button aria-label="Toggle the collapsible sidebar category &#x27;Prometheus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/k8s">k8s</a><button aria-label="Toggle the collapsible sidebar category &#x27;k8s&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/helm">Helm</a><button aria-label="Toggle the collapsible sidebar category &#x27;Helm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/installation">Installation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/quicklystart">Quicklystart</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quicklystart&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/实战案例">实战案例</a><button aria-label="Toggle the collapsible sidebar category &#x27;实战案例&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/实战案例/RBAC 实战案例">（一）通过用户账号的方式分配单独Namespace的权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/CloudNative/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程">SpringCloud微服务电商系统在Kubernetes集群中上线详细教程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/实战案例/其他实战案例">其他实战案例</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubeadm 快速部署k8s集群">Kubeadm 快速部署k8s集群</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes REST API">Kubernetes REST API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes Yaml quicklystart">Kubernetes YAML file quicklystart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes with Jenkins CICD">基于kubernetes平台的CICD持续集成</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Minikube Basic">Minikube Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Prometheus-Grafana全方位监控Kubernetes集群">Prometheus+Grafana全方位监控Kubernetes集群</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Remote access k8s">kubectl远程连接k8s</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k3d">k3d</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s command">Kubernetes CLI command -- kubectl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s 图解大全">k8s图解大全</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s 网络相关">k8s 网络相关</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s概念及原理相关">k8s 概念及原理相关</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/kompose Basic">Kompose Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/kubenetes远程调试工具">kubenetes远程调试工具</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Consul 入门">Consul 入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Dubbo Basic">Dubbo Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Grafana Loki Basic">Grafana Loki</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Istio Basic">Istio Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/">CloudNative.</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/云原生相关"><span itemprop="name">云原生相关</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/k8s"><span itemprop="name">k8s</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/实战案例"><span itemprop="name">实战案例</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">SpringCloud微服务电商系统在Kubernetes集群中上线详细教程</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>SpringCloud微服务电商系统在Kubernetes集群中上线详细教程</h1><blockquote><p>该文章来自：<a href="https://jiangxl.blog.csdn.net/article/details/121740024" target="_blank" rel="noopener noreferrer">https://jiangxl.blog.csdn.net/article/details/121740024</a></p><p>仅做个人备份学习使用。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1微服务架构及理论概述">1.<a href="https://so.csdn.net/so/search?q=%E5%BE%AE%E6%9C%8D%E5%8A%A1&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">微服务</a>架构及理论概述<a href="#1微服务架构及理论概述" class="hash-link" aria-label="Direct link to 1微服务架构及理论概述" title="Direct link to 1微服务架构及理论概述">​</a></h2><p> 程序<a href="https://so.csdn.net/so/search?q=%E6%9E%B6%E6%9E%84&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">架构</a>一共经历了3个阶段：单体架构、SOA架构、微服务架构。</p><p> 微服务系统应用由原来的单体变成几十到几百个不同的工程，会产生例如包括服务间的依赖，服务如何拆封，内部接口规范，数据传递等等问题，尤其是服务拆分，需要团队熟悉业务流程，懂得取舍，要保证拆分的粒度服务既符合“高内聚，低耦合”的基本原则，还要兼顾业务的发展以及公司的愿景，要还要说服团队成员为之努力，并且积极投入，在多方中间取得平衡。</p><p> 微服务从概念上讲就是将一个大的平台拆分成几个独立的小模块，这些模块有自己专门的数据库服务，即使这个单独模块出现了故障，也不会影响整个平台的使用，例如一个平台中有订单模块、新闻模块、咨询模块，即使新闻模块宕机了，订单模块、新闻模块依然工作正常，也不会造成整个网站的瘫痪。</p><p> 对于微服务版本迭代而言，只需要针对特定功能所在的子项目上线即可，版本迭代更加灵活，而单体程序版本迭代，哪怕只是一个小小的功能也需要对整个系统进行更新。</p><p> 目前主流的程序架构就是微服务系统，运用的技术栈更加丰富，例如kubernetes、CI/CD、Devops等等。</p><p> 微服务项目在kubernetes环境部署主要有两种实现方式：无状态的部署、istio微服务网格部署。</p><p> 可以把微服务理解为是一个大的框架，在这个框架里面内嵌各个子系统。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11单体架构与微服务架构的区别">1.1.单体架构与微服务架构的区别<a href="#11单体架构与微服务架构的区别" class="hash-link" aria-label="Direct link to 1.1.单体架构与微服务架构的区别" title="Direct link to 1.1.单体架构与微服务架构的区别">​</a></h3><p><strong>微服务的特点：</strong></p><ul><li>系统服务独立化<ul><li>每个子项目系统都会独立开发、部署，有效的避免一个服务的bug影响整个系统的使用</li></ul></li><li>技术栈灵活<ul><li>每个子系统之间约定一个通信方式，例如MQ、API等，不再像单体服务那么的局限性</li></ul></li><li>独立部署<ul><li>每个微服务系统都独立部署，都有单独的war包，即使其中一个服务异常宕机，也不会对整个平台产生影响</li></ul></li><li>扩展性强<ul><li>每个微服务都可以部署多套，配合注册中心实现负载均衡能力</li></ul></li><li>独立数据<ul><li>每个微服务都有独立的存储组件，比如数据库、缓存等，互不影响</li></ul></li></ul><p><strong>单体服务的特点</strong></p><ul><li>易于部署<ul><li>单体服务只有一个程序包，只需要部署一个服务即可完成整个系统的建设</li></ul></li><li>易于测试<ul><li>测试用例也只需要设计一个即可</li></ul></li></ul><p><strong>单体服务的不足</strong></p><ul><li>代码量级巨大，难以维护，如果系统中存在bug，修复起来牵扯功能太多，故障百出</li><li>构建、部署的成本巨大，服务都集成在一起，启动的时间也会非常缓慢</li><li>新人上手较难，如果整个服务也没有注释的情况下，新的开发人员上手会非常难</li></ul><p><strong>微服务与单体服务架构上的不同</strong></p><blockquote><p>单体服务：程序包只有一个，开发团队可能有一群人，用户之间访问程序包即可获取系统信息，后端对应一个数据库</p><p>微服务：程序包有多个，每个程序包都是不同的功能结合，且每个微服务程序都有自己的单独数据库存储数据，所有的微服务信息都会存储到注册中心，网关程序在最前面，当用户有请求进来后，首先发送给网关服务，然后网关根据注册中心的数据，将不同功能的请求转发给不同的微服务程序</p></blockquote><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/caf1d3f6f0f4405ea879f6408a54faf5.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12微服务组件架构图">1.2.微服务组件架构图<a href="#12微服务组件架构图" class="hash-link" aria-label="Direct link to 1.2.微服务组件架构图" title="Direct link to 1.2.微服务组件架构图">​</a></h3><p>以电商平台为例，描述一个购买商品的微服务之间调用流程</p><p> 用户首先访问到平台的静态首页，发送一个搜索请求从前端页面提交给微服务的网关服务，网关服务是对外的，也就是不管用户要操作什么请求，都需要由网关服务转发给具体的微服务，因为网关服务是入口，因此网关服务一般都是多台做成的负载均衡，搜索请求到达网关服务后，网关服务会根据请求的功能转发到搜索服务的程序上，搜索出来商品后，会调用商品服务程序，查看商品的详细情况，用户选择完商品后，商品服务再调用订单服务，完成订单的创建，再由订单服务调用支付服务，完成商品的购买。</p><p> 所有的微服务接口信息都会注册到注册中心，当程序启动成功就会自动注册到注册中心，注册中心也会起到一个负载均衡的作用，根据网关的API请求，在注册中心上找到特定的微服务程序进行转发。</p><p> 微服务程序还有自己的一套配置中心，保存着各个微服务的配置文件，所有的微服务程序可能都有自己独立的后端组件，比如MySQL、Redis、MQ、分布式存储。</p><p>微服务之间的通信可以采用接口API、MQ、RPAC等机制</p><p>微服务在kubernetes集群中部署时可以采用无状态服务的部署，对于数据库、Redis、MQ、存储还是建议部署在k8s集群之外。</p><p>注册中心与微服务之间的联系：发现微服务—&gt;微服务注册到注册中心—&gt;进行心跳监测，异常的节点会踢出</p><p>微服务程序的门户网站会配置Gateway网关服务的地址，由门户网站用户请求的微服务信息，转发给Gateway网关程序，所有的微服务都会注册在Eureka注册中心中，Gateway网关会将请求通过注册中心转发给对应的微服务程序。
<img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/0225cafb98dd43d98ddd102cf1203791.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13微服务注册中心">1.3.微服务注册中心<a href="#13微服务注册中心" class="hash-link" aria-label="Direct link to 1.3.微服务注册中心" title="Direct link to 1.3.微服务注册中心">​</a></h3><p>微服务面对着很多问题：</p><ul><li>如何记录一个微服务副本的接口地址，如何对多个微服务节点组成的集群做负载均衡</li><li>符合判断集群中某一个微服务是否可用</li></ul><p>微服务面临的这些问题都可以通过注册中心去解决，在注册中心中可用记录某一个微服务的所有副本节点，当一个副本节点挂掉了，注册中心也会将其踢出集群，注册中心会将一个微服务的所有副本节点自动形成一个负载均衡</p><p>在微服务中配合注册中心地址之后，程序一旦启动，无需配置注册中心，且能够自动注册到注册中心</p><p>微服务接入注册中心流程：微服务程序----&gt;注册----&gt;注册中心服务器</p><p>注册中心调用微服务流程：微服务网关程序----&gt;注册/查询微服务（调用微服务）----&gt;注册中心----&gt;微服务程序</p><p>当然也可以不适用注册中心，k8s自身的功能就有服务发现自动形成负载均衡，也可以用健康检查监控服务的运行状况</p><p>目前主流的注册中心：Eureka、Nacos</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="14不同的部署环境对于程序配置文件如何管理">1.4.不同的部署环境对于程序配置文件如何管理<a href="#14不同的部署环境对于程序配置文件如何管理" class="hash-link" aria-label="Direct link to 1.4.不同的部署环境对于程序配置文件如何管理" title="Direct link to 1.4.不同的部署环境对于程序配置文件如何管理">​</a></h3><p>可以通过以下四种方式来管理不同环境使用不同的配置文件</p><ul><li>kubernetes configmap资源<ul><li>可以根据线上、预发布、测试环境编写不同的configmap资源，然后将其挂载到对应的deployment资源上</li></ul></li><li>docker 容器启动脚本entrypoint.sh<ul><li>根据环境的不同在entrypoint.sh声明环境变量，运行特定的配置文件</li></ul></li><li>java启动命令控制<ul><li>java程序可以同时存在多个程序配置文件，可以在配置文件中声明各自的变量，然后使用<code>java --spring.profiles.active=xxx xxx.jar</code>的方式来指定不同环境的配置文件</li></ul></li><li>使用开源的统一配置中心程序，比如市面上主流的Apollo以及Disconf，这两款程序都有自己的图形化管理系统，配置可视化</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2微服务迁移至kubernetes平台流程">2.微服务迁移至kubernetes平台流程<a href="#2微服务迁移至kubernetes平台流程" class="hash-link" aria-label="Direct link to 2.微服务迁移至kubernetes平台流程" title="Direct link to 2.微服务迁移至kubernetes平台流程">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21项目迁移到k8s平台流程">2.1.项目迁移到K8S平台流程<a href="#21项目迁移到k8s平台流程" class="hash-link" aria-label="Direct link to 2.1.项目迁移到K8S平台流程" title="Direct link to 2.1.项目迁移到K8S平台流程">​</a></h3><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/47633ea793f24a4b8727059870501e50.png" alt="在这里插入图片描述" class="img_ev3q">
项目迁移到K8S平台大致流程分为以下几个阶段：</p><ul><li>制作程序镜像<ul><li>在K8s环境，所有的程序都是以Docker镜像来运行的，一个镜像包含了文件系统、程序的运行环境、程序本身，可以通过Dockerfile的形式制作镜像</li></ul></li><li>使用资源控制器管理Pod资源<ul><li>程序镜像运行需要依靠Pod资源，需要有Pod控制器去管理Pod资源</li><li>常见的Pod控制器：Deployment（无状态程序部署）、Statefulset（有状态程序部署）、Job/CronJob（批量处理）</li></ul></li><li>将Pod资源使用服务发现对外进行暴露<ul><li>Services资源注意通过label标签与Pod进行关联，实现对一组Pod的自动负载均衡以及服务发现</li><li>Services资源支持Cluster、Nodeport、LoadBalancer三种类型</li></ul></li><li>对外发布应用程序<ul><li>可以使用单独的nginx容器去反向代理Cordns解析的services名称将Pod应用对外发布</li><li>也可以使用ingress+services的方式将应用程序对外发布，使用ingress的前提是必须可以通过域名访问应用</li><li>架构图如下
<img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/4450dd7d3c994bb78ca36b43af66e28a.png" alt="在这里插入图片描述" class="img_ev3q"></li></ul></li><li>后期的日志收集与监控<ul><li>当应用在K8s程序运行后，对于程序的日志比如nginx、tomcat这些日志文件都不会做持久化，因此就需要考虑对日志进行收集，可以采用Filebeat+ELK方式对程序日志进行收集</li><li>使用Prometheus+Grafana对整个K8s平台进行全方面监控</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22传统部署与k8s部署的区别">2.2.传统部署与K8S部署的区别<a href="#22传统部署与k8s部署的区别" class="hash-link" aria-label="Direct link to 2.2.传统部署与K8S部署的区别" title="Direct link to 2.2.传统部署与K8S部署的区别">​</a></h3><blockquote><p><strong>传统方式部署项目方式：</strong></p><p>首先由开发人员提交代码到Gitlab代码仓库，Jenkins触发更新从Gitlab上获取最新代码，通过maven将代码编译成war包或者jar包，再由Jenkins通过写好的自动化部署脚本或者Ansible自动化程序将war包部署到程序所在的云主机，云主机一定会是多台组成的负载均衡集群，将负载均衡VIP与域名进行绑定，用户通过访问域名由负载均衡转发至对应的后台主机。</p><p>传统架构运维环境一般由zabbix监控系统进行监控，日志采集会使用ELK平台。</p></blockquote><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/e34c94fc97e0416cb21cd00879244103.png" alt="在这里插入图片描述" class="img_ev3q"></p><blockquote><p><strong>Kubernetes平台部署项目方式：</strong></p><p>首先由开发人员提交代码到Gitlab代码仓库，Jenkins触发更新从Gitlab上获取最新代码，通过写好流水线将程序打包成Docker镜像并推送至Harbor仓库，再由Jenkins调用K8s的Master Api将程序的镜像采用Deployment控制器部署到K8s集群，再由service资源暴露pod资源，最后由ingress或者nginx资源将程序发布到互联网。</p></blockquote><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/3ca0d364bdc24690a04d4ca95eb1cb05.png" alt="在这里插入图片描述" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3微服务程序前期环境准备配置编译制作镜像">3.微服务程序前期环境准备（配置、编译、制作镜像）<a href="#3微服务程序前期环境准备配置编译制作镜像" class="hash-link" aria-label="Direct link to 3.微服务程序前期环境准备（配置、编译、制作镜像）" title="Direct link to 3.微服务程序前期环境准备（配置、编译、制作镜像）">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31simple-microservice微服务项目介绍">3.1.simple-microservice微服务项目介绍<a href="#31simple-microservice微服务项目介绍" class="hash-link" aria-label="Direct link to 3.1.simple-microservice微服务项目介绍" title="Direct link to 3.1.simple-microservice微服务项目介绍">​</a></h3><p>本次使用的微服务为spring cloud的电商平台项目</p><p>项目名称：simple-microservice</p><p>simple-microservice微服务的各个程序：</p><ul><li>eureka-service（注册中心）</li><li>gateway-service（网管服务）</li><li>order-service（订单服务）</li><li>product-service（商品服务）</li><li>portal-service（门户网站）</li><li>stock-service（库存服务）</li></ul><p>用户请求首先到Protal前端页面，也就是程序的首页，在首页的各项功能操作都会由Gateway网关服务转发到各自的微服务程序上，比如请求一个订单服务，订单服务会事先注册到Eureka中，由Gateway将请求发送给Eureka，再由Eureka转发给具体的微服务程序，这些微服务程序都有自己单独的数据库服务。</p><p>微服务程序的门户网站会配置Gateway网关服务的地址，由门户网站用户请求的微服务信息，转发给Gateway网关程序，所有的微服务都会注册在Eureka注册中心中，Gateway网关会将请求通过注册中心转发给对应的微服务程序。
<img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/b89c6c882bbe4a2d9ab53f97d5fe1f35.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>该微服务程序代码可以托管在gitlab代码仓库中，我们可以建立多个分支模拟从开发到上线的流程，理念：分别创建5个分支，在每个分支中增加对应的代码，最后合并到master分支，也可以直接就在master分支上新增配置文件，我是直接拉取dev1分支，只有程序代码的分支，然后新增一系列配置，最后上线。</p><p>拉取dev1分支，进行一系列配置的话，首先要把master分支里的protal程序代码同步到dev1分支里，因为dev1的protal程序代码有点bug，整个微服务运行完毕后，order订单服务会报错。</p><p>分别有五个分支：</p><ul><li>dev1：交付代码</li><li>dev2：新增程序打包的Dockerfile文件</li><li>dev3：新增K8s资源编排Yaml文件</li><li>dev4：微服务链路监控</li><li>dev5：新功能代码更新上线</li><li>master：上线版本</li></ul><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/258d6fe2cd114cd58843209bdf1f85de.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32simple微服务部署到k8s逻辑架构">3.2.simple微服务部署到K8S逻辑架构<a href="#32simple微服务部署到k8s逻辑架构" class="hash-link" aria-label="Direct link to 3.2.simple微服务部署到K8S逻辑架构" title="Direct link to 3.2.simple微服务部署到K8S逻辑架构">​</a></h3><p><strong>simple-microservice微服务部署到k8s平台主要分为如下几个步骤：</strong></p><ul><li>修改程序配置文件，将数据库等各组件地址修改为当前环境</li><li>将各个微服务程序使用Maven编译成可部署的jar包</li><li>编写Dockerfile将程序做成docker镜像</li></ul><p><strong>对K8S环境的要求：</strong></p><p>一套完整的K8S集群、有cordns可以解析Service地址、Harbor镜像仓库、Nginx容器将项目发布到互联网或者INgress资源将项目发布到互联网。</p><p><strong>微服务部署到K8S环境之后架构是怎样的</strong></p><blockquote><p>首先用户访问网站的域名，请求达到前端页面，点击前端页面中的功能跳转到不同的微服务，比如商品服务，将商品服务的请求交个Gateway网关服务，由网关服务转发给商品的微服务程序Product，各个微服务之间的调用，都从Eureka注册中心读取各个微服务的信息完成调度，Product（商品）、Order（订单）、Stock（库存）都有单独的数据库，MySQL数据部署在K8S集群之外。</p><p>服务发布到互联网采用Nginx而不采用Ingress，Nginx可以配置更多的参数，将Nginx容器运行在每一个Node主机上，映射Node主机的80/443端口，通过在hosts文件里绑定node主机ip+程序域名的方式访问微服务。</p></blockquote><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/60f3e04a6fb3410cbdc1f54eee6a7c4e.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="33准备微服务各程序的配置文件">3.3.准备微服务各程序的配置文件<a href="#33准备微服务各程序的配置文件" class="hash-link" aria-label="Direct link to 3.3.准备微服务各程序的配置文件" title="Direct link to 3.3.准备微服务各程序的配置文件">​</a></h3><p>在使用Maven之前，首先将程序的配置文件进行修改，编译成功之后再想修改配置文件内容，就需要重新编译了，将每个微服务的环境地址都修改成自己环境的地址。</p><p>拉取dev1分支展开全新配置</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="331创建微服务各个程序的prod配置文件">3.3.1.创建微服务各个程序的prod配置文件<a href="#331创建微服务各个程序的prod配置文件" class="hash-link" aria-label="Direct link to 3.3.1.创建微服务各个程序的prod配置文件" title="Direct link to 3.3.1.创建微服务各个程序的prod配置文件">​</a></h4><p>eureka（注册中心）、gateway（网关）、order（订单）、portal（首页）、product（商品）、stock（库存）这几个微服务程序都需要配置，新建一个prod的配置文件，用于线上生产环境</p><p>order（订单）、product（商品）、stock（库存）这些微服务有两个包，分别是xxx-biz和xxx-api，只需要部署biz目录下的jar包即可，api的目录只是存在一些依赖</p><p>order（订单）、product（商品）、stock（库存）这些微服务都有自己单独的数据库</p><p>先将prod的配置文件创建出来，待eureka项目部署完成后，再进行进一步的修改，最后将程序编译</p><p><strong>1.eureka-service配置文件</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.创建一个prod的配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1]\# cd eureka-service/src/main/resources/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/eureka-service/src/main/resources]\# cp application-fat.yml application-prod.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.程序使用prod的配置文件运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/eureka-service/src/main/resources]\# vim application.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 8080        #eureka的端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: legendshop-basic-eureka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active: prod    #将这里修改为prod就会调用prod配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.配置eureka服务的配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/eureka-service/src/main/resources]\# vim application-prod.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    renewal-percent-threshold: 0.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable-self-preservation: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eviction-interval-timer-in-ms: 40000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefer-ip-address: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    register-with-eureka: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serviceUrl:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      defaultZone: http://127.0.0.1:${server.port}/eureka/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fetch-registry: false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2.gateway-service配置文件</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.创建一个prod的配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1]\# cd gateway-service/src/main/resources/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/gateway-service/src/main/resources]\# cp application-fat.yml application-prod.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.程序使用prod的配置文件运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/gateway-service/src/main/resources]\# cat application.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active: prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: @artifactId@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.配置程序配置文件    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/gateway-service/src/main/resources]\# vim application-prod.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">······</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefer-ip-address: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    register-with-eureka: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fetch-registry: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service-url:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      defaultZone: http://eureka-0.eureka-service:8080/eureka/      #修改eureka地址</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>3.order-service配置文件</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.创建一个prod的配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1]\# cd order-service/order-service-biz/src/main/resources/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/order-service/order-service-biz/src/main/resources]\# cp application-fat.yml application-prod.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.程序使用prod的配置文件运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/order-service/order-service-biz/src/main/resources]\# vim application.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active: prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: order-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.配置程序配置文件    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/order-service/order-service-biz/src/main/resources]\# vim application-prod.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  datasource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url: jdbc:mysql://192.168.20.11:3306/tb_order?characterEncoding=utf-8     #mysql数据库地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username: root  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password: 123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    driver-class-name: com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefer-ip-address: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    register-with-eureka: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fetch-registry: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service-url:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      defaultZone: http://eureka-0.eureka-service:8080/eureka/      #eureka地址</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>5.product-service配置文件</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.创建一个prod的配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1]\# cd product-service/product-service-biz/src/main/resources/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/product-service/product-service-biz/src/main/resources]\# cp application-fat.yml application-prod.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.程序使用prod的配置文件运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/product-service/product-service-biz/src/main/resources]\# vim application.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active: prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: product-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.配置程序配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/product-service/product-service-biz/src/main/resources]\# vim application-prod.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  datasource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url: jdbc:mysql://192.168.20.11:3306/tb_product?characterEncoding=utf-8     #数据库地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username: root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password: 123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    driver-class-name: com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefer-ip-address: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    register-with-eureka: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fetch-registry: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service-url:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      defaultZone: http://eureka-0.eureka-service:8080/eureka/      #eureka地址</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>6.stock-service配置文件</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.创建一个prod的配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1]\# cd stock-service/stock-service-biz/src/main/resources/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/stock-service/stock-service-biz/src/main/resources]\# cp application-fat.yml application-prod.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.程序使用prod的配置文件运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/stock-service/stock-service-biz/src/main/resources]\# vim application.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active: prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: stock-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.配置程序配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/stock-service/stock-service-biz/src/main/resources]\# vim application-prod.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  datasource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url: jdbc:mysql://192.168.20.11:3306/tb_stock?characterEncoding=utf-8   #数据库地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username: root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password: 123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    driver-class-name: com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefer-ip-address: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    register-with-eureka: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fetch-registry: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service-url:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      defaultZone: http://eureka-service.eureka:8080/eureka/      #eureka地址                            </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>4.portal-service配置文件</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.创建一个prod的配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1]\# cd portal-service/src/main/resources/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/portal-service/src/main/resources]\# cp application-fat.yml application-prod.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.程序使用prod的配置文件运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/portal-service/src/main/resources]\# vim application.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  undertow:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    io-threads: 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    worker-threads: 256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffer-size: 1024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    direct-buffers: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: portal-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active: prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.配置程序配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/portal-service/src/main/resources]\# vim application-prod.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefer-ip-address: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service-url:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      defaultZone: http://eureka-0.eureka-service:8080/eureka/      #指定eureka地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    register-with-eureka: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fetch-registry: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">······</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="332调整每个微服务的pom文件增加prod环境">3.3.2.调整每个微服务的pom文件增加prod环境<a href="#332调整每个微服务的pom文件增加prod环境" class="hash-link" aria-label="Direct link to 3.3.2.调整每个微服务的pom文件增加prod环境" title="Direct link to 3.3.2.调整每个微服务的pom文件增加prod环境">​</a></h4><p>由于我们新加了一个prod线上环境的配置文件，因此也需要在pom.xml中配置，配置完成后可以编译一下，看看是否可以做成可部署的程序包</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.安装maven</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# yum -y install java-1.8.0-openjdk maven</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.调整pom.xml增加prod环境配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 simple-microservice-dev1]\# vim pom.xml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">······      #65行左右</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;profile&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;id&gt;prod&lt;/id&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;profileActive&gt;prod&lt;/profileActive&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/profile&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/profiles&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">······</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.编译程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1]\# mvn clean package -D maven.test.skip=true -P prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.查看编译成功的war包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1]\# find . -name &quot;*.jar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./basic-common/basic-common-core/target/basic-common-core.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./eureka-service/target/eureka-service.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./gateway-service/target/gateway-service.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./order-service/order-service-api/target/order-service-api.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./order-service/order-service-biz/target/order-service-biz.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./portal-service/target/portal-service.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./product-service/product-service-api/target/product-service-api.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./product-service/product-service-biz/target/product-service-biz.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./stock-service/stock-service-api/target/stock-service-api.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./stock-service/stock-service-biz/target/stock-service-biz.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="34制作微服务程序所使用的的底层系统镜像">3.4.制作微服务程序所使用的的底层系统镜像<a href="#34制作微服务程序所使用的的底层系统镜像" class="hash-link" aria-label="Direct link to 3.4.制作微服务程序所使用的的底层系统镜像" title="Direct link to 3.4.制作微服务程序所使用的的底层系统镜像">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="341为程序环境构建底层系统镜像">3.4.1.为程序环境构建底层系统镜像<a href="#341为程序环境构建底层系统镜像" class="hash-link" aria-label="Direct link to 3.4.1.为程序环境构建底层系统镜像" title="Direct link to 3.4.1.为程序环境构建底层系统镜像">​</a></h4><p>由于是SpringCloud微服务系统，SpringCloud属于JAVA语言开发的项目，因此要有JAVA启动环境。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.拉取centos7.5作为底层容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# docker pull centos:7.5.1804</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.启动容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# docker run -itd centos:7.5.1804</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.进入系统容器进行环境配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# docker exec -it 462237f9a0a bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#安装java环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@2fcfb51f04e0 /]\# yum -y install java-1.8.0-openjdk net-tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@2fcfb51f04e0 /]\# java  -version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openjdk version &quot;1.8.0_302&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OpenJDK Runtime Environment (build 1.8.0_302-b08)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OpenJDK 64-Bit Server VM (build 25.302-b08, mixed mode)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@2fcfb51f04e0 /]\# mkdir /data/simple-microservice -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#调整系统时区</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@2fcfb51f04e0 /]\# yum -y intall tzdata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@2fcfb51f04e0 /]\# ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.将容器提交为镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# docker commit 2fcfb51f04e0 centos-java:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5.配置Harbor镜像仓库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# vim /etc/docker/daemon.json </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;registry-mirrors&quot;: [&quot;https://9wn5tbfh.mirror.aliyuncs.com&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;insecure-registries&quot;: [&quot;192.168.20.10&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# systemctl restart docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6.提交镜像到Harbor仓库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# docker login -u admin -p Harbor12345 192.168.20.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# docker tag centos-java:v1 192.168.20.11/base/centos-java:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# docker push 192.168.20.11/base/centos-java:v1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="342为每个微服务程序编写dockerfile">3.4.2.为每个微服务程序编写Dockerfile<a href="#342为每个微服务程序编写dockerfile" class="hash-link" aria-label="Direct link to 3.4.2.为每个微服务程序编写Dockerfile" title="Direct link to 3.4.2.为每个微服务程序编写Dockerfile">​</a></h4><p><strong>设计概念：</strong></p><p>采用3.3.1中制作的底层镜像</p><p>第一步：在镜像里面创建<code>/data/simple-microservice/微服务名称</code>这样的目录用于存放程序的jar包</p><p>第二步：将程序的jar包拷贝至镜像中</p><p>第三步：生成一个启动脚本，由于服务名称都不一样也就是每个程序的路径都不同，想要做到一个底层镜像多个程序复用，那么就需要在启动脚本里手动指定程序的路径，在脚本中指定程序的部署路径以及日志路径</p><p>第四步：暴露8080端口</p><p>将Dockerfile放到程序编译的目录也就是与src在同一目录</p><p><strong>1.eureka-service服务</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">在4.2.2.会写</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2.gateway-service服务</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/gateway-service]\# vim Dockerfile </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM 192.168.20.11/base/centos-java:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN mkdir /data/simple-microservice/gateway-service -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./target/gateway-service.jar /data/simple-microservice/gateway-service/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo -e &quot;#!/bin/bash \njava -jar /data/simple-microservice/gateway-service/gateway-service.jar &gt; /data/simple-microservice/gateway-service/gateway-service.log &amp; \ntail -f /data/simple-microservice/gateway-service/gateway-service.log&quot; &gt; /data/entrypoint.sh &amp;&amp; chmod a+x /data/entrypoint.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT /data/entrypoint.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>3.order-service服务</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/order-service/order-service-biz]\# vim Dockerfile </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM 192.168.20.11/base/centos-java:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN mkdir /data/simple-microservice/order-service -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./target/order-service-biz.jar /data/simple-microservice/order-service/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo -e &quot;#!/bin/bash \njava -jar /data/simple-microservice/order-service/order-service-biz.jar &gt; /data/simple-microservice/order-service/order-service-biz.log &amp; \ntail -f /data/simple-microservice/order-service/order-service-biz.log&quot; &gt; /data/entrypoint.sh &amp;&amp; chmod a+x /data/entrypoint.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT /data/entrypoint.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>4.portal-service服务</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/portal-service]\# vim Dockerfile </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM 192.168.20.11/base/centos-java:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN mkdir /data/simple-microservice/portal-service -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./target/portal-service.jar /data/simple-microservice/portal-service/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo -e &quot;#!/bin/bash \njava -jar /data/simple-microservice/portal-service/portal-service.jar &gt; /data/simple-microservice/portal-service/portal-service.log &amp; \ntail -f /data/simple-microservice/portal-service/portal-service.log&quot; &gt; /data/entrypoint.sh &amp;&amp; chmod a+x /data/entrypoint.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT /data/entrypoint.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>5.product-service服务</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/product-service/product-service-biz]\# vim Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM 192.168.20.11/base/centos-java:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN mkdir /data/simple-microservice/product-service -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./target/product-service-biz.jar /data/simple-microservice/product-service/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo -e &quot;#!/bin/bash \njava -jar /data/simple-microservice/product-service/product-service-biz.jar &gt; /data/simple-microservice/product-service/product-service-biz.log &amp; \ntail -f /data/simple-microservice/product-service/product-service-biz.log&quot; &gt; /data/entrypoint.sh &amp;&amp; chmod a+x /data/entrypoint.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT /data/entrypoint.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>6.stock-service服务</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/stock-service/stock-service-biz]\# cat Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM 192.168.20.11/base/centos-java:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN mkdir /data/simple-microservice/stock-service -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./target/stock-service-biz.jar /data/simple-microservice/stock-service/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo -e &quot;#!/bin/bash \njava -jar /data/simple-microservice/stock-service/stock-service-biz.jar &gt; /data/simple-microservice/stock-service/stock-service-biz.log &amp; \ntail -f /data/simple-microservice/stock-service/stock-service-biz.log&quot; &gt; /data/entrypoint.sh &amp;&amp; chmod a+x /data/entrypoint.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT /data/entrypoint.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="35调整protal微服务中连接gateway网关的地址">3.5.调整Protal微服务中连接Gateway网关的地址<a href="#35调整protal微服务中连接gateway网关的地址" class="hash-link" aria-label="Direct link to 3.5.调整Protal微服务中连接Gateway网关的地址" title="Direct link to 3.5.调整Protal微服务中连接Gateway网关的地址">​</a></h3><p>Protal是我们电商平台的门户网站，也就是前端首页，在Protal微服务中会填写好其他微服务程序的地址，Gateway网关程序的地址就是写死在Protal项目的js里，在我们定义好Gateway网关服务的域名后，就要将域名写入到对应的js文件里，否则当项目启动之后是无法调通的。</p><p>需要修改下列这四个文件</p><p>portal-service/src/main/resources/static/js/orderList.js</p><p>portal-service/src/main/resources/static/js/productList.js
<img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/d0e207db0cb54e6296ca185728e5ed1c.png" alt="在这里插入图片描述" class="img_ev3q"></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">打开这四个文件，将里面的gateway.ctnrs.com域名修改为gateway.jiangxl.com域名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim修改命令：%s/gateway.ctnrs.com/gateway.jiangxl.com/g</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="36部署ingress用于将微服务程序发布到互联网">3.6.部署Ingress用于将微服务程序发布到互联网<a href="#36部署ingress用于将微服务程序发布到互联网" class="hash-link" aria-label="Direct link to 3.6.部署Ingress用于将微服务程序发布到互联网" title="Direct link to 3.6.部署Ingress用于将微服务程序发布到互联网">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.下载ingress部署的yaml文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.调整ingress nodeport端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/ingress]\# vim service-nodeport.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">······</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      port: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      targetPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nodePort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: https</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      port: 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      targetPort: 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nodePort: 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">······</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.部署ingress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~/springcloud/ingress]\# kubectl apply -f mandatory.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.查看ingress部署的结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# kubectl get all -n ingress-nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                            READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/nginx-ingress-controller-766867958b-n7dwj   1/1     Running   0          49m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                    TYPE       CLUSTER-IP   EXTERNAL-IP   PORT(S)                 AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/ingress-nginx   NodePort   10.0.0.107   &lt;none&gt;        80:80/TCP,443:443/TCP   49m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/nginx-ingress-controller   1/1     1            1           49m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                  DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replicaset.apps/nginx-ingress-controller-766867958b   1         1         1       49m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4在kubernetes集群部署simple微服务项目">4.在kubernetes集群部署simple微服务项目<a href="#4在kubernetes集群部署simple微服务项目" class="hash-link" aria-label="Direct link to 4.在kubernetes集群部署simple微服务项目" title="Direct link to 4.在kubernetes集群部署simple微服务项目">​</a></h2><p>simple微服务项目在K8S集群中部署，只有eureka服务采用statefulset控制器部署，其余所有微服务均采用deployment控制器部署，所有的微服务通过ingress发布在互联网。</p><p><strong>simple微服务电商项目在K8S集群部署流程</strong></p><p>1）部署simple电商微服务项目的数据库环境</p><p>2）在K8S中部署Eureka注册中心</p><p>3）修改每个微服务的配置文件，指定eureka注册中心集群的地址</p><p>4）使用maven将每个微服务构建成可部署的jar包</p><p>5）部署Gateway关服务</p><p>6）部署protal、order、product、stock服务</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41部署simple微服务程序的mysql数据库环境">4.1.部署simple微服务程序的mysql数据库环境<a href="#41部署simple微服务程序的mysql数据库环境" class="hash-link" aria-label="Direct link to 4.1.部署simple微服务程序的mysql数据库环境" title="Direct link to 4.1.部署simple微服务程序的mysql数据库环境">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.安装MySQL数据库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@harbor-mysql ~]\# rpm -ivh http://repo.mysql.com/yum/mysql-5.6-community/el/7/x86_64/mysql-community-release-el7-5.noarch.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@harbor-mysql ~]\#  yum install mysql-community-server </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.启动MySQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@harbor-mysql ~]\# systemctl start mysqld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@harbor-mysql ~]\# systemctl enable mysqld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.设置数据库密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@harbor-mysql ~]\# mysqladmin -u root password &#x27;123456&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.创建order（订单）、product（商品）、stock（库存）微服务的数据库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@harbor-mysql ~]\# mysql -uroot -p123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; create database tb_order;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row affected (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; create database tb_product;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row affected (0.01 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; create database tb_stock;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row affected (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5.导入数据库数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#将数据库文件传到数据库服务器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 simple-microservice-dev1]\# scp -r db root@192.168.20.11:/root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#导入order数据库的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; use tb_order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; source /root/db/order.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#导入product数据库的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; use tb_product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; source /root/db/product.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#导入stock数据库的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; use tb_stock;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; source /root/db/stock.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6.允许数据库远程访问</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; grant all privileges on *.* to &#x27;root&#x27;@&#x27;%&#x27; identified by &#x27;123456&#x27; with grant option;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42部署eureka微服务注册中心">4.2.部署eureka微服务注册中心<a href="#42部署eureka微服务注册中心" class="hash-link" aria-label="Direct link to 4.2.部署eureka微服务注册中心" title="Direct link to 4.2.部署eureka微服务注册中心">​</a></h3><p>Eureka在整个微服务架构中起到至关重要的的作用，必须保证Eureka服务高可用。</p><p>Eureka服务采用statefulset有状态应用部署方式再K8S集群中进行部署。</p><p>Eureka本身就可以利用自身的服务发现来实现集群的高可用，只需要在Eureka配置文件中指定各个Eureka节点的地址就可以实现。</p><p>将程序部署在K8S之后，如何能够保证每个Eureka Pod的地址唯一不变，就需要用到Statefulset控制器采用有状态的应用部署，使用Statefulset控制器之后，每个Pod的名称都是唯一不变的，并且每个Pod都有一个DNS服务发现地址，通过这个DNS地址就可以请求到Pod中的服务，主要是coredns组件来实现的，因此集群还需要安装有coredns服务，我们可以将每一个Eureka Pod的DNS服务发现地址写入到Eureka的配置文件中，每个Eureka节点相互注册，最终形成高可用集群。</p><p>Statefulset+Headless部署的程序DNS名格式：<code>&lt;statefulsetName-index&gt;.&lt;service-name&gt;.&lt;namespace-name&gt;.svc.cluster.local</code>后面的.svc.cluster.local可以去掉，K8S默认就是.svc.cluster.local。</p><p><code>&lt;statefulsetName-index&gt;</code>就是Pod的名称，-index是每一个Pod名称后面的数字编号，Statefulset控制器部署好的Pod，会在每一个Pod名称后面加上一个数字编号，从0开始，一次累加，保证所有的Pod都有一个独立的访问入口</p><p><code>&lt;service-name&gt;</code>是程序的service资源的名称</p><p><code>&lt;namespace-name&gt;</code>是程序所在的namespace名称</p><p>我们的Eureka规定的节点数为3个，也就是最终statefulset会启动3个Pod副本组成Eureka集群。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="421修改eureka配置文件增加各节点地址">4.2.1.修改Eureka配置文件增加各节点地址<a href="#421修改eureka配置文件增加各节点地址" class="hash-link" aria-label="Direct link to 4.2.1.修改Eureka配置文件增加各节点地址" title="Direct link to 4.2.1.修改Eureka配置文件增加各节点地址">​</a></h4><p>Eureka集群节点每个Pod副本服务发现地址如下，需要将其配置在eureka中</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://eureka-0.eureka-service.simple-ms`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`http://eureka-0.eureka-service.simple-ms`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`http://eureka-0.eureka-service.simple-ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改Eureka的配置文件，采用Dns服务发现地址的形式将每个节点的地址都写在配置文件中，当Eureka启动之后，每个节点都会相互发现最终形成高可用集群。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.修改Eureka配置文件中的节点地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 eureka-service]\# vim src/main/resources/application-prod.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    renewal-percent-threshold: 0.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable-self-preservation: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eviction-interval-timer-in-simple-ms: 40000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefer-ip-address: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    register-with-eureka: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serviceUrl:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      defaultZone: http://eureka-0.eureka.simple-ms:${server.port}/eureka/,http://eureka-1.eureka.simple-ms:${server.port}/eureka/,http://eureka-2.eureka.simple-ms:${server.port}/eureka/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fetch-registry: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.使用maven将最新的Eureka编译</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 simple-microservice-dev1]\# mvn clean package -D maven.test.skip=true -P prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">注意：只能在项目最外层的目录中执行mvn clean package</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="422调整eureka的dockerfile">4.2.2.调整Eureka的Dockerfile<a href="#422调整eureka的dockerfile" class="hash-link" aria-label="Direct link to 4.2.2.调整Eureka的Dockerfile" title="Direct link to 4.2.2.调整Eureka的Dockerfile">​</a></h4><p>由于我们在Eureka配置文件中配置的是以dns名称来互相发现对方，并不是以IP地址形式发现，因此我们需要配置Dockerfile，在启动程序时将配置文件中的hostname字段值修改为当前Pod的dns名称。</p><p>因为我们的Eureka是多Pod组成的高可用集群，因此不能将dns名称写死在配置文件中，不然每个Pod都是同样的地址，集群是组件不成功的，所以就需要在Dockerfile中定义程序启动命令时，将dns名称地址设置成变量，由Pod资源将变量值传入到启动命令中，程序启动时就会用Pod的dns名称地址替换掉配置文件中的IP地址。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.修改DOckerfile文件内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 eureka-service]\# vim Dockerfile </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM 192.168.20.11/base/centos-java:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN mkdir /data/simple-microservice/eureka-service -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./target/eureka-service.jar /data/simple-microservice/eureka-service/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo -e &quot;#!/bin/bash \njava -jar -Deureka.instance.hostname=${MY_POD_NAME}.eureka.simple-ms /data/simple-microservice/eureka-service/eureka-service.jar &gt; /data/simple-microservice/eureka-service/eureka-service.log &amp; \ntail -f /data/simple-microservice/eureka-service/eureka-service.log&quot; &gt; /data/entrypoint.sh &amp;&amp; chmod a+x /data/entrypoint.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT /data/entrypoint.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动命令单独拉出来看一下，<code>-Deureka.instance.hostname</code>这个参数表示修改配置文件中hostname参数的值，<code>${MY_POD_NAME}</code>这个变量使从deployment资源文件中定义的env变量，将Pod的名称赋给MY_POD_NAME变量，最后引入到启动命令中，最后在配置文件中hostname字段的值应该是<code>eureka-0.eureka-service.simple-ms</code></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java -jar -Deureka.instance.hostname=${MY_POD_NAME}.eureka-service.simple-ms /data/simple-microservice/eureka-service/eureka-service.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="423构建eureka服务的docker镜像">4.2.3.构建Eureka服务的Docker镜像<a href="#423构建eureka服务的docker镜像" class="hash-link" aria-label="Direct link to 4.2.3.构建Eureka服务的Docker镜像" title="Direct link to 4.2.3.构建Eureka服务的Docker镜像">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 eureka-service]\# docker build -t  192.168.20.11/simple-microservice/eureka-service:v1 .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 eureka-service]\# docker images | grep eureka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.20.11/simp-microservice/eureka-service        v1                  1dc64fc9ba09        About a minute ago   800MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 eureka-service]\# docker push 192.168.20.11/simple-microservice/eureka-service:v1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="424编写eureka部署yaml资源文件">4.2.4.编写Eureka部署YAML资源文件<a href="#424编写eureka部署yaml资源文件" class="hash-link" aria-label="Direct link to 4.2.4.编写Eureka部署YAML资源文件" title="Direct link to 4.2.4.编写Eureka部署YAML资源文件">​</a></h4><p><strong>1）创建命名空间</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.创建命名空间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># kubectl create ns simple-ms</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace/simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.创建资源编排YAML文件存放路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@binary</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># mkdir springcloud/simple-microservice-dev1/k8s/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2）登录Harbor</strong></p><p>可以不在每一个Node节点使用docker login登陆Harbor仓库，可以将Harbor仓库的认证信息做成secret，通过使用secret的方式连接Harbor。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# kubectl create secret docker-registry registry-pull-secret --docker-server=192.168.20.11 --docker-username=admin --docker-password=Harbor12345 --docker-email=admin@ctnrs.com -n simple-ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>3）编写资源YAML文件</strong></p><p>eureka要做成集群式的服务，所以要采用statefulset控制器部署，并采用headless service保证statefulset创建的pod名称唯一性，最后通过ingress将eureka服务发布在互联网环境。</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@binary</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 k8s</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim eureka-deploy.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#ingress资源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> extensions/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ingress           </span><span class="token comment" style="color:#999988;font-style:italic">#类型为ingress</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">#定义元数据信息：资源名称、资源所在的命名空间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eureka </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">#定义ingress规则</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eureka.jiangxl.com          </span><span class="token comment" style="color:#999988;font-style:italic">#定义eureka使用的域名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">#采用http类型的访问方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">#定义程序的url路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">#针对定义的程序路径关于对应的后端service资源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eureka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">servicePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#headless service资源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eureka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">clusterIP</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> None       </span><span class="token comment" style="color:#999988;font-style:italic">#ClusterIP资源设置为Node就代表headless类型的service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">#定义暴露的eureka端口号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eureka </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">#标签选择器，关联后端pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eureka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#statefulset资源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eureka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic">#副本数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                 </span><span class="token comment" style="color:#999988;font-style:italic">#标签选择器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eureka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eureka&quot;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">#service的名称，也就是将来的pod名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eureka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">imagePullSecrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">#harbor镜像仓库的凭据信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pull</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eureka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.20.11/simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservice/eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic">#增加一个环境变量，变量名为MY_POD_NAME，值为pod的名称，这个变量信息会传入dockerfile中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MY_POD_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">valueFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">fieldRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">fieldPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">#资源配额</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">#最小资源限制，cpu为0.5，内存为256M</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 256Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">#最大资源限制，cpu为1，内存为1G</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">readinessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#就绪性健康检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">#以tcp 8080端口作为健康检查的机制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">#容器启动60秒后进行检测</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#探测的频率</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">#存活性健康检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">#以tcp 8080端口作为健康检查的机制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">#容器启动60秒后进行检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">#探测的频率为10秒一次</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="425在k8s集群中部署eureka注册中心">4.2.5.在K8S集群中部署Eureka注册中心<a href="#425在k8s集群中部署eureka注册中心" class="hash-link" aria-label="Direct link to 4.2.5.在K8S集群中部署Eureka注册中心" title="Direct link to 4.2.5.在K8S集群中部署Eureka注册中心">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.部署eureka服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl apply -f eureka-deploy.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.查看部署的资源状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get all -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME           READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/eureka-0   1/1     Running   1          12h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/eureka-1   1/1     Running   0          12h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/eureka-2   1/1     Running   0          12h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/eureka   ClusterIP   None         &lt;none&gt;        8080/TCP   13h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                      READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/eureka   3/3     13h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.查看eureka的ingress状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get ingress -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME     CLASS    HOSTS                ADDRESS      PORTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka   &lt;none&gt;   eureka.jiangxl.com   10.0.0.107   80      13h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>首先在本地hosts文件中绑定eureka域名解析，然后在浏览器中输入eureka.jiangxl.com访问eureka服务。</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/dac8c49c10904c4591acb933a094c0d7.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43配置各个微服务程序连接eureka集群的地址">4.3.配置各个微服务程序连接Eureka集群的地址<a href="#43配置各个微服务程序连接eureka集群的地址" class="hash-link" aria-label="Direct link to 4.3.配置各个微服务程序连接Eureka集群的地址" title="Direct link to 4.3.配置各个微服务程序连接Eureka集群的地址">​</a></h3><p>在程序的配置文件中填写eureka集群所有节点的服务发现地址</p><p><strong>1.gateway-service配置文件</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vim gateway-service/src/main/resources/application-prod.yml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">······</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">eureka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prefer-ip-address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">client</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">register-with-eureka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fetch-registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">defaultZone</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">0.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2.order-service配置文件</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vim order-service/order-service-biz/src/main/resources/application-prod.yml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//192.168.20.11</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306/tb_order</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">characterEncoding=utf</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">eureka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prefer-ip-address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">client</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">register-with-eureka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fetch-registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">defaultZone</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">0.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>3.product-service配置文件</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vim product-service/product-service-biz/src/main/resources/application-prod.yml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//192.168.20.11</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306/tb_product</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">characterEncoding=utf</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">eureka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prefer-ip-address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">client</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">register-with-eureka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fetch-registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">defaultZone</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">0.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>4.stock-service配置文件</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vim stock-service/stock-service-biz/src/main/resources/application-prod.yml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//192.168.20.11</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306/tb_stock</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">characterEncoding=utf</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">eureka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prefer-ip-address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">client</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">register-with-eureka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fetch-registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">defaultZone</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">0.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>5.portal-service配置文件</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vim portal-service/src/main/resources/application-prod.yml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">eureka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prefer-ip-address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">client</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">defaultZone</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">0.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2.eureka.simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/eureka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">register-with-eureka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fetch-registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">······</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="44将各个程序代码编译成可部署的程序">4.4.将各个程序代码编译成可部署的程序<a href="#44将各个程序代码编译成可部署的程序" class="hash-link" aria-label="Direct link to 4.4.将各个程序代码编译成可部署的程序" title="Direct link to 4.4.将各个程序代码编译成可部署的程序">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 simple-microservice-dev1]\# mvn clean package -D maven.test.skip=true -P prod</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43中部署gateway网关服务">4.3.中部署Gateway网关服务<a href="#43中部署gateway网关服务" class="hash-link" aria-label="Direct link to 4.3.中部署Gateway网关服务" title="Direct link to 4.3.中部署Gateway网关服务">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="431将gateway程序打包成docker镜像">4.3.1.将Gateway程序打包成docker镜像<a href="#431将gateway程序打包成docker镜像" class="hash-link" aria-label="Direct link to 4.3.1.将Gateway程序打包成docker镜像" title="Direct link to 4.3.1.将Gateway程序打包成docker镜像">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 gateway-service]\# docker build -t 192.168.20.11/simple-microservice/gateway-service:v1 .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="432在k8s集群中部署gateway网关服务">4.3.2.在K8S集群中部署Gateway网关服务<a href="#432在k8s集群中部署gateway网关服务" class="hash-link" aria-label="Direct link to 4.3.2.在K8S集群中部署Gateway网关服务" title="Direct link to 4.3.2.在K8S集群中部署Gateway网关服务">​</a></h4><p>所有程序的资源YAML文件都存放在/root/springcloud/simple-microservice-dev1/k8s路径。</p><p>微服务程序的话就不需要有状态应用部署了，直接采用deployment无状态应用部署的控制器，字段配置和eureka服务的statefulset配置参数几乎是一样的，微服务的各个程序也都采用有deployment控制器去部署，每个程序的yaml文件也只有名字、使用的镜像不同，其余所有参数均一致。</p><p>gateway是网关服务，需要配置一个ingress和service资源，将其发布在集群之外。</p><p>字段配置和statefulset的一致，不再做注释信息</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vim gateway-deploy.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#ingress资源YAML</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> extensions/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway.jiangxl.com </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">servicePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#service资源YAML</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#deployment资源YAML</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#副本数设置1个，后续再加</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">imagePullSecrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pull</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.20.11/simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservice/gateway</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 256Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">readinessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="433在k8s集群中部署gateway网关服务">4.3.3.在K8S集群中部署Gateway网关服务<a href="#433在k8s集群中部署gateway网关服务" class="hash-link" aria-label="Direct link to 4.3.3.在K8S集群中部署Gateway网关服务" title="Direct link to 4.3.3.在K8S集群中部署Gateway网关服务">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.部署网关服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl apply -f gateway-deploy.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.查看gateway pod资源的状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get pod -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-0                   1/1     Running   1          2d12h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-1                   1/1     Running   0          2d12h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-2                   1/1     Running   0          2d12h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway-7c687f6c45-mcwpf   1/1     Running   0          2m2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.查看deployment和svc的资源状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get deploy,svc -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                      READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/gateway   1/1     1            1           17h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME              TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/eureka    ClusterIP   None         &lt;none&gt;        8080/TCP   2d13h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/gateway   ClusterIP   10.0.0.188   &lt;none&gt;        8080/TCP   17h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.查看gateway ingress资源状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get ingress -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME      CLASS    HOSTS                 ADDRESS      PORTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka    &lt;none&gt;   eureka.jiangxl.com    10.0.0.107   80      2d13h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway   &lt;none&gt;   gateway.jiangxl.com   10.0.0.107   80      17h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="44编写快速部署微服务到k8s集群的脚本">4.4.编写快速部署微服务到K8S集群的脚本<a href="#44编写快速部署微服务到k8s集群的脚本" class="hash-link" aria-label="Direct link to 4.4.编写快速部署微服务到K8S集群的脚本" title="Direct link to 4.4.编写快速部署微服务到K8S集群的脚本">​</a></h3><p>由于微服务程序众多，并且每个程序在K8S集群部署的流程也基本一样，因此我们编写一个部署脚本，只要准备好程序的jar包以及资源YAML文件就可以将其一键部署到K8S集群，当前也可以通过Helm来实现。</p><p><strong>1.脚本内容</strong></p><p>实现逻辑：</p><p>1.将harbor仓库的地址、所有微服务的名称、k8s yaml文件的路径、微服务代码所在的路径都定义成环境变量。</p><p>2.如果只想部署其中一个微服务的话，通过位置传参的方式来实现，也就是再定义一个微服务名称的变量，变量值为KaTeX parse error: Expected &#x27;}&#x27;, got &#x27;EOF&#x27; at end of input: {1:-{service_list}}，将要部署的微服务名称通过位置传参的方式，将值传入到service_list变量名里，覆盖原service_list变量值，实现单个微服务的部署，如果没有使用位置参数，那么默认部署全部的微服务。</p><p>3.进入微服务代码所在的路径。然后通过for循环的方式，遍历service_list变量中的各个微服务，然后本次循环的微服务代码路径，判断是否有包含biz的目录，如果有biz目录则切入到biz目录，然后通过变量的形式定义镜像名称，构建镜像、推送至镜像仓库。</p><p>4.将最新打包好的docker进在yaml文件中通过sed命令替换，最后在k8s集群中部署这个微服务。</p><p><code>${1:-${service_list}}</code>：这个的意思就是如果<code>$1</code>位置参数没有传入值，那么service_list变量的值就是<code>$service_list</code>变量的值，相当于一个判断。</p><p>本脚本可以自动化完成微服务到K8S集群的一个部署，包括程序的编译、打包成docker镜像、推荐镜像到Harbor仓库，最后将程序部署到K8S集群</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">registry_addr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.20.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">service_list</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;eureka-service gateway-service order-service product-service stock-service portal-service&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">service_list</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${1</span><span class="token variable operator" style="color:#393A34">:-</span><span class="token variable" style="color:#36acaa">${service_list}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">current_dir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/root/springcloud/simple-microservice-dev1/k8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">service_dir</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">dirname</span><span class="token variable" style="color:#36acaa"> $current_dir</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$service_dir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#mvn clean package -Dmaven.test.skip=true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">service</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$service_list</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$service_dir</span><span class="token plain">/</span><span class="token variable" style="color:#36acaa">$service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token assign-left variable" style="color:#36acaa">biz_count</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">ls</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> biz </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">wc</span><span class="token variable" style="color:#36acaa"> -l</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$biz_count</span><span class="token plain"> -eq </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${service}</span><span class="token plain">-biz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token assign-left variable" style="color:#36acaa">service_name</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable" style="color:#36acaa"> $service </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F- </span><span class="token variable string" style="color:#e3116c">&#x27;{print $1}&#x27;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token assign-left variable" style="color:#36acaa">image_name</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${registry_addr}</span><span class="token plain">/simple-microservice/</span><span class="token variable" style="color:#36acaa">${service}</span><span class="token plain">:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token assign-left variable" style="color:#36acaa">yaml_name</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${service_name}</span><span class="token plain">-deploy.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build -t </span><span class="token variable" style="color:#36acaa">${image_name}</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> push </span><span class="token variable" style="color:#36acaa">${image_name}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i -r </span><span class="token string" style="color:#e3116c">&quot;s#(image: )(.*)#</span><span class="token string entity" style="color:#36acaa">\1</span><span class="token string variable" style="color:#36acaa">$image_name</span><span class="token string" style="color:#e3116c">#&quot;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${current_dir}</span><span class="token plain">/</span><span class="token variable" style="color:#36acaa">${yaml_name}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   kubectl apply -f </span><span class="token variable" style="color:#36acaa">${current_dir}</span><span class="token plain">/</span><span class="token variable" style="color:#36acaa">${yaml_name}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2.脚本使用方式</strong></p><p>执行本脚本前提是必须先将程序部署的YAML文件准备好，放在/root/springcloud/simple-microservice-dev1/k8s路径</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">脚本的用法：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh deploy_k8s.sh 微服务名称</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="45使用脚本部署order订单服务">4.5.使用脚本部署Order订单服务<a href="#45使用脚本部署order订单服务" class="hash-link" aria-label="Direct link to 4.5.使用脚本部署Order订单服务" title="Direct link to 4.5.使用脚本部署Order订单服务">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="451编写资源部署yaml文件">4.5.1.编写资源部署YAML文件<a href="#451编写资源部署yaml文件" class="hash-link" aria-label="Direct link to 4.5.1.编写资源部署YAML文件" title="Direct link to 4.5.1.编写资源部署YAML文件">​</a></h4><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vim order-deploy.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">imagePullSecrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pull</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.20.11/simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservice/order</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 256Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">readinessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="452在k8s集群中部署order订单服务">4.5.2在K8S集群中部署Order订单服务<a href="#452在k8s集群中部署order订单服务" class="hash-link" aria-label="Direct link to 4.5.2在K8S集群中部署Order订单服务" title="Direct link to 4.5.2在K8S集群中部署Order订单服务">​</a></h4><p><strong>1.使用脚本将Order服务部署到K8S集群</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# sh deploy_k8s.sh order-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">执行完脚本，order程序的docker镜像已经制作好并且推送到了harbor仓库，已经使用sed命令将镜像的名称在yaml中替换成了最新的镜像，部署到了K8S集群</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/be81d4ca75f14ea1afd933b7e4f34ea5.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>2.查看程序资源的状态</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.查看pod的状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get all -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                          READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/eureka-0                  1/1     Running   1          2d15h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/eureka-1                  1/1     Running   0          2d15h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/eureka-2                  1/1     Running   0          2d15h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/gateway-8665d5d56-tx2m8   1/1     Running   0          39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/order-6694f4c474-cp5d6    1/1     Running   0          35m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.查看deployment资源的状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get deploy -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME      READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway   1/1     1            1           21h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order     1/1     1            1           36m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="46使用脚本部署product商品服务">4.6.使用脚本部署Product商品服务<a href="#46使用脚本部署product商品服务" class="hash-link" aria-label="Direct link to 4.6.使用脚本部署Product商品服务" title="Direct link to 4.6.使用脚本部署Product商品服务">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="461编写资源部署yaml文件">4.6.1.编写资源部署YAML文件<a href="#461编写资源部署yaml文件" class="hash-link" aria-label="Direct link to 4.6.1.编写资源部署YAML文件" title="Direct link to 4.6.1.编写资源部署YAML文件">​</a></h4><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vim product-deploy.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">imagePullSecrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pull</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.20.11/simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservice/product</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 256Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">readinessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="462在k8s集群中熟不熟product商品服务">4.6.2.在K8S集群中熟不熟Product商品服务<a href="#462在k8s集群中熟不熟product商品服务" class="hash-link" aria-label="Direct link to 4.6.2.在K8S集群中熟不熟Product商品服务" title="Direct link to 4.6.2.在K8S集群中熟不熟Product商品服务">​</a></h4><p><strong>1.使用脚本在K8S集群中部署product服务</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# sh deploy_k8s.sh product-service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/72e772fd74a1497188734a6e1fd3d28e.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>2.查看程序资源的状态</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.查看pod的状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get pod -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-1                   1/1     Running   3          2d16h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-2                   1/1     Running   2          2d16h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway-8665d5d56-tx2m8    1/1     Running   2          74m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order-6694f4c474-cp5d6     1/1     Running   4          69m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">product-77c8bb6847-vbxnr   1/1     Running   2          21m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.查看deployment资源的状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get deploy -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME      READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway   1/1     1            1           21h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order     1/1     1            1           72m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">product   1/1     1            1           24m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="47使用脚本部署stock库存服务">4.7.使用脚本部署Stock库存服务<a href="#47使用脚本部署stock库存服务" class="hash-link" aria-label="Direct link to 4.7.使用脚本部署Stock库存服务" title="Direct link to 4.7.使用脚本部署Stock库存服务">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="471编写资源部署yaml文件">4.7.1.编写资源部署YAML文件<a href="#471编写资源部署yaml文件" class="hash-link" aria-label="Direct link to 4.7.1.编写资源部署YAML文件" title="Direct link to 4.7.1.编写资源部署YAML文件">​</a></h4><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vim product-deploy.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">imagePullSecrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pull</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.20.11/simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservice/product</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 256Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">readinessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="472在k8s集群中部署stock库存服务">4.7.2.在K8S集群中部署Stock库存服务<a href="#472在k8s集群中部署stock库存服务" class="hash-link" aria-label="Direct link to 4.7.2.在K8S集群中部署Stock库存服务" title="Direct link to 4.7.2.在K8S集群中部署Stock库存服务">​</a></h4><p><strong>1.使用脚本在K8S集群中部署stock服务</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# sh deploy_k8s.sh stock-service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/34720b14a59e4d8e97e5d887beff8a9d.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>2.查看程序资源的状态</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.查看pod的状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# kubectl get pod -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-0                   1/1     Running   5          2d16h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-1                   1/1     Running   3          2d16h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-2                   1/1     Running   2          2d16h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway-8665d5d56-tx2m8    1/1     Running   2          112m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order-6694f4c474-cp5d6     1/1     Running   4          107m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">product-77c8bb6847-vbxnr   1/1     Running   2          59m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stock-6cf98bb445-mxf7b     1/1     Running   0          30m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.查看deployment资源的状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# kubectl get deploy -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME      READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway   1/1     1            1           22h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order     1/1     1            1           108m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">product   1/1     1            1           60m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stock     2/2     2            2           31m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="48使用脚本部署portal前端首页">4.8.使用脚本部署Portal前端首页<a href="#48使用脚本部署portal前端首页" class="hash-link" aria-label="Direct link to 4.8.使用脚本部署Portal前端首页" title="Direct link to 4.8.使用脚本部署Portal前端首页">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="481编写资源部署yaml文件">4.8.1.编写资源部署YAML文件<a href="#481编写资源部署yaml文件" class="hash-link" aria-label="Direct link to 4.8.1.编写资源部署YAML文件" title="Direct link to 4.8.1.编写资源部署YAML文件">​</a></h4><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># vim portal-deploy.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> extensions/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portal </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portal.jiangxl.com </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portal </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">servicePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portal </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simple </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">imagePullSecrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pull</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.20.11/simple</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservice/portal</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 256Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">readinessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tcpSocket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="482在k8s集群中熟不熟portal存服务">4.8.2.在K8S集群中熟不熟Portal存服务<a href="#482在k8s集群中熟不熟portal存服务" class="hash-link" aria-label="Direct link to 4.8.2.在K8S集群中熟不熟Portal存服务" title="Direct link to 4.8.2.在K8S集群中熟不熟Portal存服务">​</a></h4><p><strong>1.使用脚本在K8S集群中部署portal服务</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# sh deploy_k8s.sh portal-service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/c452fabffdb24a97b0ec5dbfc8dbe6b5.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>2.查看程序资源的状态</strong></p><p>到此为止，所有的simple电商平台的微服务程序以及全部部署完毕。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.查看所有微服务的程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get all -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                           READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/eureka-0                   1/1     Running   5          2d16h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/eureka-1                   1/1     Running   3          2d16h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/eureka-2                   1/1     Running   2          2d16h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/gateway-8665d5d56-tx2m8    1/1     Running   2          117m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/order-6694f4c474-cp5d6     1/1     Running   4          112m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/portal-d5d55b784-7kntp     1/1     Running   0          2m53s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/product-77c8bb6847-vbxnr   1/1     Running   2          64m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/stock-6cf98bb445-mxf7b     1/1     Running   0          35m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME              TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/eureka    ClusterIP   None         &lt;none&gt;        8080/TCP   2d18h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/gateway   ClusterIP   10.0.0.188   &lt;none&gt;        8080/TCP   22h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/portal    ClusterIP   10.0.0.190   &lt;none&gt;        8080/TCP   2m53s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                      READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/gateway   1/1     1            1           22h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/order     1/1     1            1           112m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/portal    1/1     1            1           2m53s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/product   1/1     1            1           65m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/stock     1/1     1            1           35m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                 DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replicaset.apps/gateway-8665d5d56    1         1         1       117m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replicaset.apps/order-6694f4c474     1         1         1       112m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replicaset.apps/portal-d5d55b784     1         1         1       2m53s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replicaset.apps/product-77c8bb6847   1         1         1       64m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replicaset.apps/stock-6cf98bb445     1         1         1       35m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                      READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/eureka   3/3     2d18h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.查看所有微服务的ingress资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl get ingress -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME      CLASS    HOSTS                 ADDRESS      PORTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka    &lt;none&gt;   eureka.jiangxl.com    10.0.0.107   80      2d18h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway   &lt;none&gt;   gateway.jiangxl.com   10.0.0.107   80      22h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">portal    &lt;none&gt;   portal.jiangxl.com    10.0.0.107   80      3m16s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="49查看eureka注册中心中各个微服务的信息">4.9.查看Eureka注册中心中各个微服务的信息<a href="#49查看eureka注册中心中各个微服务的信息" class="hash-link" aria-label="Direct link to 4.9.查看Eureka注册中心中各个微服务的信息" title="Direct link to 4.9.查看Eureka注册中心中各个微服务的信息">​</a></h3><p>每个微服务程序均在Eureka注册中心中注册完成。</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/feae01f050a440ed92aa5f948efd875f.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="410使用simple微服务电商平台">4.10.使用simple微服务电商平台<a href="#410使用simple微服务电商平台" class="hash-link" aria-label="Direct link to 4.10.使用simple微服务电商平台" title="Direct link to 4.10.使用simple微服务电商平台">​</a></h3><p>到4.8步骤之后，我们的simple微服务电商平台已经全部部署在K8S集群了，可以在本机hosts里绑定simple微服务的域名，操作电商平台。</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/11d0320836a54e1b96d6e6801bdb9f8b.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>这个微服务平台的背景图其实是京东的一张图而已，是不可以点的。</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/5de80a8717554409af8d9a14b6462e30.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>只能在商品服务中查询能购买的商品，然后进行购买，最后在订单服务中查询。</p><p>搜索商品时会调用product商品微服务，下单后，查询订单服务时会调用order订单服务。</p><p>点击查询商品服务，我们来下单一个美女观察一下效果，下单后会提示下单成功。</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/2776324a762543f5a9df8fc3fc0f6e19.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>点击查询订单服务就可以看到我吗下的订单了</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/91eee91044a3497986b5f0f788a95738.png" alt="在这里插入图片描述" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5基于k8s集群的微服务的扩容与升级">5.基于K8S集群的微服务的扩容与升级<a href="#5基于k8s集群的微服务的扩容与升级" class="hash-link" aria-label="Direct link to 5.基于K8S集群的微服务的扩容与升级" title="Direct link to 5.基于K8S集群的微服务的扩容与升级">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51微服务的扩容">5.1.微服务的扩容<a href="#51微服务的扩容" class="hash-link" aria-label="Direct link to 5.1.微服务的扩容" title="Direct link to 5.1.微服务的扩容">​</a></h3><p>微服务在物理机环境运行时，网站并发量高的情况下，扩容只能去购买云服务器，然后搭建一套一模一样的服务，手动组成负载均衡集群，增加一台其实还好，如果要增加几十台，太费人工成本了。</p><p>当微服务迁移到K8S集群之后，扩容其实变得非常简单，只需要增加程序Pod的副本数就可以完成程序的扩容。</p><p>命令如下，以扩展order商品微服务为例。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">将order商品服务的副本数调整为3个，原本是1个，现在扩容到3个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl scale deploy order --replicas=3 -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/order scaled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">可以看到order订单服务目前已经有3个pod副本了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# kubectl get pod -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-0                   1/1     Running   1          6m15s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-1                   1/1     Running   0          7m59s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-2                   1/1     Running   1          9m40s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway-848874fc9d-pwp9w   1/1     Running   0          48m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order-6694f4c474-cp5d6     1/1     Running   4          3h29m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order-6694f4c474-kh8hm     1/1     Running   0          96s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order-6694f4c474-rg7kw     1/1     Running   0          96s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">portal-6fdcd765bd-mtq68    1/1     Running   1          24m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">product-784d9f77b5-rxsf2   1/1     Running   0          64m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stock-6cf98bb445-l8gxb     1/1     Running   0          133m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">缩容也很简单，将order的副本数缩减成1个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl scale deploy order --replicas=1 -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/order scaled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">成功缩减到1个副本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 ~]\# kubectl get pod -n simple-ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-0                   1/1     Running   1          9m24s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-1                   1/1     Running   0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka-2                   1/1     Running   1          12m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway-848874fc9d-pwp9w   1/1     Running   0          51m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order-6694f4c474-rg7kw     1/1     Running   0          4m45s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">portal-6fdcd765bd-mtq68    1/1     Running   1          27m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">product-784d9f77b5-rxsf2   1/1     Running   0          67m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stock-6cf98bb445-l8gxb     1/1     Running   0          136m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52微服务的升级">5.2.微服务的升级<a href="#52微服务的升级" class="hash-link" aria-label="Direct link to 5.2.微服务的升级" title="Direct link to 5.2.微服务的升级">​</a></h3><p>微服务在物理机环境更新时只需要拉取最新的代码，编译成jar包，在服务器上部署就可以了，但是微服务迁移到K8S集群之后，更新过程就变得比较复杂了，首先更新的代码，然后编译成jar包，再通过Dockerfile将jar包做成docker镜像，然后在k8s集群中部署，当然这些流程可以通过Jenkins实现自动化上线。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="521微调portal前端首页的代码">5.2.1.微调Portal前端首页的代码<a href="#521微调portal前端首页的代码" class="hash-link" aria-label="Direct link to 5.2.1.微调Portal前端首页的代码" title="Direct link to 5.2.1.微调Portal前端首页的代码">​</a></h4><p>将平台的这些文件修改成jiangxl.com的内容完成一次portal前端首页的升级</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/6fff8cf3680744d9bd8f4340015acf60.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>首先找到记录这些文字的文件</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/c8b660cdf01f4e92aed03aa0005f48a4.png" alt="在这里插入图片描述" class="img_ev3q"></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># vim templates/index.ftl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># vim templates/orderList.ftl </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># vim templates/productList.ftl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">进入文件后在末行模式输入：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%s/容器学院 www.ctnrs.com/jiangxl.com/g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%s/www.ctnrs.com/jiangxl.com/g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">然后将所有的容器学院的文字删除</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="522编译最新代码">5.2.2.编译最新代码<a href="#522编译最新代码" class="hash-link" aria-label="Direct link to 5.2.2.编译最新代码" title="Direct link to 5.2.2.编译最新代码">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 simple-microservice-dev1]\# mvn clean package -D maven.test.skip=true -P prod</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="523通过脚本将protal最新代码打包成镜像">5.2.3.通过脚本将Protal最新代码打包成镜像<a href="#523通过脚本将protal最新代码打包成镜像" class="hash-link" aria-label="Direct link to 5.2.3.通过脚本将Protal最新代码打包成镜像" title="Direct link to 5.2.3.通过脚本将Protal最新代码打包成镜像">​</a></h4><p>直接使用前面部署程序的脚本即可</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# sh deploy_k8s.sh portal-service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="524升级k8s集群中的protal微服务">5.2.4.升级K8S集群中的Protal微服务<a href="#524升级k8s集群中的protal微服务" class="hash-link" aria-label="Direct link to 5.2.4.升级K8S集群中的Protal微服务" title="Direct link to 5.2.4.升级K8S集群中的Protal微服务">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@binary-k8s-master1 k8s]\# kubectl -n simple-ms set image deployment portal portal=192.168.20.11/simple-microservice/portal-service:v1 --record</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>程序更新完成后刷新页面就可以看到我们更新的页面内容</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASmlhbmd4bH4=,size_20,color_FFFFFF,t_70,g_se,x_16.png" alt="在这里插入图片描述" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CloudNative/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/CloudNative/k8s/实战案例/RBAC 实战案例"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">（一）通过用户账号的方式分配单独Namespace的权限</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/CloudNative/k8s/实战案例/其他实战案例"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">其他实战案例</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1微服务架构及理论概述" class="table-of-contents__link toc-highlight">1.微服务架构及理论概述</a><ul><li><a href="#11单体架构与微服务架构的区别" class="table-of-contents__link toc-highlight">1.1.单体架构与微服务架构的区别</a></li><li><a href="#12微服务组件架构图" class="table-of-contents__link toc-highlight">1.2.微服务组件架构图</a></li><li><a href="#13微服务注册中心" class="table-of-contents__link toc-highlight">1.3.微服务注册中心</a></li><li><a href="#14不同的部署环境对于程序配置文件如何管理" class="table-of-contents__link toc-highlight">1.4.不同的部署环境对于程序配置文件如何管理</a></li></ul></li><li><a href="#2微服务迁移至kubernetes平台流程" class="table-of-contents__link toc-highlight">2.微服务迁移至kubernetes平台流程</a><ul><li><a href="#21项目迁移到k8s平台流程" class="table-of-contents__link toc-highlight">2.1.项目迁移到K8S平台流程</a></li><li><a href="#22传统部署与k8s部署的区别" class="table-of-contents__link toc-highlight">2.2.传统部署与K8S部署的区别</a></li></ul></li><li><a href="#3微服务程序前期环境准备配置编译制作镜像" class="table-of-contents__link toc-highlight">3.微服务程序前期环境准备（配置、编译、制作镜像）</a><ul><li><a href="#31simple-microservice微服务项目介绍" class="table-of-contents__link toc-highlight">3.1.simple-microservice微服务项目介绍</a></li><li><a href="#32simple微服务部署到k8s逻辑架构" class="table-of-contents__link toc-highlight">3.2.simple微服务部署到K8S逻辑架构</a></li><li><a href="#33准备微服务各程序的配置文件" class="table-of-contents__link toc-highlight">3.3.准备微服务各程序的配置文件</a></li><li><a href="#34制作微服务程序所使用的的底层系统镜像" class="table-of-contents__link toc-highlight">3.4.制作微服务程序所使用的的底层系统镜像</a></li><li><a href="#35调整protal微服务中连接gateway网关的地址" class="table-of-contents__link toc-highlight">3.5.调整Protal微服务中连接Gateway网关的地址</a></li><li><a href="#36部署ingress用于将微服务程序发布到互联网" class="table-of-contents__link toc-highlight">3.6.部署Ingress用于将微服务程序发布到互联网</a></li></ul></li><li><a href="#4在kubernetes集群部署simple微服务项目" class="table-of-contents__link toc-highlight">4.在kubernetes集群部署simple微服务项目</a><ul><li><a href="#41部署simple微服务程序的mysql数据库环境" class="table-of-contents__link toc-highlight">4.1.部署simple微服务程序的mysql数据库环境</a></li><li><a href="#42部署eureka微服务注册中心" class="table-of-contents__link toc-highlight">4.2.部署eureka微服务注册中心</a></li><li><a href="#43配置各个微服务程序连接eureka集群的地址" class="table-of-contents__link toc-highlight">4.3.配置各个微服务程序连接Eureka集群的地址</a></li><li><a href="#44将各个程序代码编译成可部署的程序" class="table-of-contents__link toc-highlight">4.4.将各个程序代码编译成可部署的程序</a></li><li><a href="#43中部署gateway网关服务" class="table-of-contents__link toc-highlight">4.3.中部署Gateway网关服务</a></li><li><a href="#44编写快速部署微服务到k8s集群的脚本" class="table-of-contents__link toc-highlight">4.4.编写快速部署微服务到K8S集群的脚本</a></li><li><a href="#45使用脚本部署order订单服务" class="table-of-contents__link toc-highlight">4.5.使用脚本部署Order订单服务</a></li><li><a href="#46使用脚本部署product商品服务" class="table-of-contents__link toc-highlight">4.6.使用脚本部署Product商品服务</a></li><li><a href="#47使用脚本部署stock库存服务" class="table-of-contents__link toc-highlight">4.7.使用脚本部署Stock库存服务</a></li><li><a href="#48使用脚本部署portal前端首页" class="table-of-contents__link toc-highlight">4.8.使用脚本部署Portal前端首页</a></li><li><a href="#49查看eureka注册中心中各个微服务的信息" class="table-of-contents__link toc-highlight">4.9.查看Eureka注册中心中各个微服务的信息</a></li><li><a href="#410使用simple微服务电商平台" class="table-of-contents__link toc-highlight">4.10.使用simple微服务电商平台</a></li></ul></li><li><a href="#5基于k8s集群的微服务的扩容与升级" class="table-of-contents__link toc-highlight">5.基于K8S集群的微服务的扩容与升级</a><ul><li><a href="#51微服务的扩容" class="table-of-contents__link toc-highlight">5.1.微服务的扩容</a></li><li><a href="#52微服务的升级" class="table-of-contents__link toc-highlight">5.2.微服务的升级</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs Releases</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 1.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 2.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 3.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv4" target="_blank" rel="noopener noreferrer" class="footer__link-item">⭐️Version 4.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">⭐️我的博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 AGou-ops' Documetation v4.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5d4589e6.js"></script>
<script src="/assets/js/main.28f9d1a7.js"></script>
</body>
</html>