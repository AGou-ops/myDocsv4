<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-CloudNative/k8s/Kubernetes with Jenkins CICD">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">基于kubernetes平台的CICD持续集成 | AGou&#x27;s Docsv4</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.agou-ops.cn/docs/CloudNative/k8s/Kubernetes with Jenkins CICD"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="基于kubernetes平台的CICD持续集成 | AGou&#x27;s Docsv4"><meta data-rh="true" name="description" content="文章目录"><meta data-rh="true" property="og:description" content="文章目录"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Kubernetes with Jenkins CICD"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Kubernetes with Jenkins CICD" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Kubernetes with Jenkins CICD" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-KQED41RW95","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.6908ad1e.css">
<link rel="preload" href="/assets/js/runtime~main.d3f82a4d.js" as="script">
<link rel="preload" href="/assets/js/main.7273c711.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">AGou&#x27;s Docsv4</b></a><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">✨ 我的博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"> 📖 目录</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs">🌲 目录树</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/category/云原生相关">☁️ 云原生相关</a></li><li><a class="dropdown__link" href="/docs/category/linux基础">😊 Linux基础</a></li><li><a class="dropdown__link" href="/docs/category/编程语言">♨️ 编程语言</a></li><li><a class="dropdown__link" href="/docs/category/脚本相关">🕹️ 脚本相关</a></li><li><a class="dropdown__link" href="/docs/category/面试相关">👨‍⚖️ 面试相关</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">版本</a><ul class="dropdown__menu"><li><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver1.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver2.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver3.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub 仓库"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"><b>AGou&#x27;s Docsv4</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/云原生相关">云原生相关</a><button aria-label="Toggle the collapsible sidebar category &#x27;云原生相关&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cicd">CICD</a><button aria-label="Toggle the collapsible sidebar category &#x27;CICD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cloudcomptering">CloudComptering</a><button aria-label="Toggle the collapsible sidebar category &#x27;CloudComptering&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/docker">Docker</a><button aria-label="Toggle the collapsible sidebar category &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elfk">ELFK</a><button aria-label="Toggle the collapsible sidebar category &#x27;ELFK&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/prometheus">Prometheus</a><button aria-label="Toggle the collapsible sidebar category &#x27;Prometheus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/k8s">k8s</a><button aria-label="Toggle the collapsible sidebar category &#x27;k8s&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/helm">Helm</a><button aria-label="Toggle the collapsible sidebar category &#x27;Helm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/installation">Installation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/quicklystart">Quicklystart</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quicklystart&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/实战案例">实战案例</a><button aria-label="Toggle the collapsible sidebar category &#x27;实战案例&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubeadm 快速部署k8s集群">Kubeadm 快速部署k8s集群</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes REST API">Kubernetes REST API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes Yaml quicklystart">Kubernetes YAML file quicklystart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes with Jenkins CICD">基于kubernetes平台的CICD持续集成</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Minikube Basic">Minikube Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Prometheus-Grafana全方位监控Kubernetes集群">Prometheus+Grafana全方位监控Kubernetes集群</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Remote access k8s">kubectl远程连接k8s</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k3d">k3d</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s command">Kubernetes CLI command -- kubectl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s 图解大全">k8s图解大全</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s 网络相关">k8s 网络相关</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s概念及原理相关">k8s 概念及原理相关</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/kompose Basic">Kompose Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/kubenetes远程调试工具">kubenetes远程调试工具</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/CloudNative/k8s/小技巧/使用curl访问k8s的REST API">小技巧</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Consul 入门">Consul 入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Dubbo Basic">Dubbo Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Grafana Loki Basic">Grafana Loki</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Istio Basic">Istio Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/">CloudNative.</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/云原生相关"><span itemprop="name">云原生相关</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/k8s"><span itemprop="name">k8s</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">基于kubernetes平台的CICD持续集成</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>基于kubernetes平台的CICD持续集成</h1><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="文章目录">文章目录<a href="#文章目录" class="hash-link" aria-label="Direct link to 文章目录" title="Direct link to 文章目录">​</a></h3><p>[toc]</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1基于k8s集群的jenkins持续集成">1.基于k8s集群的Jenkins持续集成<a href="#1基于k8s集群的jenkins持续集成" class="hash-link" aria-label="Direct link to 1.基于k8s集群的Jenkins持续集成" title="Direct link to 1.基于k8s集群的Jenkins持续集成">​</a></h2><p>Jenkins更新传统LNMT项目流程很简单，Jenkins也只需要部署在物理服务器即可实现项目版本的持续更新迭代</p><p>如果项目是部署在k8s集群，Jenkins还在物理机上部署的话，项目更新流程将会变得繁琐，大致流程：首先Jenkins将项目编译成war包，然后将war在一台物理机上运行，如果运行成功，再调用另一个Jenkins任务，这个Jenkins任务主要的作用就是将war包和ROOT目录copy到初始镜像中，当镜像构建完毕后，将镜像推送至harbor平台，再由运维拿着镜像版本放在k8s里去升级。</p><p>如果Jenkins只是单单部署在一台物理机上，某台Jenkins挂掉后，整个CI/CD平台将无法更新迭代，这是一个很严重的后果，如果将Jenkins部署在k8s平台，借助k8s pod自愈功能，Jenkins挂掉的情况几乎不会发生。</p><p>Jenkins部署在k8s环境之后，通过建立RBAC授权机制，可以实现Jenkins一键更新迭代到k8s环境，无需在使用物理机环境那么繁琐的步骤</p><blockquote><p>当Jenkins与kubernetes集成后的更新流程：</p><p>1）Jenkins从gitlab上拉取开发提交的代码</p><p>2）Jenkins调用maven进行编译项目</p><p>3）Jenkins调用docker将写好dockerfile构建成镜像</p><p>4）将镜像推送至harbor仓库</p><p>5）Jenkins调用k8s将镜像部署在k8s环境</p></blockquote><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/fcebc6a2b3f3211c4481fe783597dce6.png" alt="img" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2将jenkins部署在k8s集群">2.将Jenkins部署在k8s集群<a href="#2将jenkins部署在k8s集群" class="hash-link" aria-label="Direct link to 2.将Jenkins部署在k8s集群" title="Direct link to 2.将Jenkins部署在k8s集群">​</a></h2><blockquote><p><strong>部署思路：</strong></p><p>1.由于Jenkins要更新项目到各个namespace，因此需要做RBAC授权，准备一个ServiceAccount，直接将ServiceAccount绑定到cluster-admin集群角色上，使Jenkins拥有对所有namespace下的项目有操作权限。</p><p>2.Jenkins部署采用statefulset控制器，并配合StorageClass动态将Jenkins数据进行持久化。</p><p>3.准备svc资源，将Jenkins的8080/50000端口进行暴露。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21编写jenkins-namespace文件">2.1.编写Jenkins namespace文件<a href="#21编写jenkins-namespace文件" class="hash-link" aria-label="Direct link to 2.1.编写Jenkins namespace文件" title="Direct link to 2.1.编写Jenkins namespace文件">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 jenkins</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat jenkins-namespace.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Namespace </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22编写jenkins-rbac授权文件">2.2.编写Jenkins rbac授权文件<a href="#22编写jenkins-rbac授权文件" class="hash-link" aria-label="Direct link to 2.2.编写Jenkins rbac授权文件" title="Direct link to 2.2.编写Jenkins rbac授权文件">​</a></h3><p>创建一个serviceaccount账号Jenkins，直接将sa账号与cluster-admin集群角色进行绑定</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 jenkins</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat jenkins-rbac.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rbac.authorization.k8s.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">crb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">roleRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">apiGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cluster</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">subjects</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23编写jenkins-statefulset资源文件">2.3.编写Jenkins statefulset资源文件<a href="#23编写jenkins-statefulset资源文件" class="hash-link" aria-label="Direct link to 2.3.编写Jenkins statefulset资源文件" title="Direct link to 2.3.编写Jenkins statefulset资源文件">​</a></h3><p>Jenkins也会产生数据，因此采用statefulset部署有状态的服务，并配合StorageClass动态创建存储系统</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 jenkins</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat jenkins-statefulset.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">serviceAccount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">initContainers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">chown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 1000:1000 /var/jenkins_home&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/jenkins_home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/jenkinsci</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">blueocean</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.24.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> JAVA_OPTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-Xms4096m -Xmx5120m -Duser.timezone=Asia/Shanghai -Dhudson.model.DirectoryBrowserSupport.CSP=&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> slave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/jenkins_home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumeClaimTemplates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="24编写jenkins-storageclass资源文件">2.4.编写Jenkins StorageClass资源文件<a href="#24编写jenkins-storageclass资源文件" class="hash-link" aria-label="Direct link to 2.4.编写Jenkins StorageClass资源文件" title="Direct link to 2.4.编写Jenkins StorageClass资源文件">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 jenkins</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat jenkins-storageclass.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nfs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">reclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Retain</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="25编写jenkins-svc资源文件">2.5.编写Jenkins svc资源文件<a href="#25编写jenkins-svc资源文件" class="hash-link" aria-label="Direct link to 2.5.编写Jenkins svc资源文件" title="Direct link to 2.5.编写Jenkins svc资源文件">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 jenkins</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat jenkins-svc.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">38080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> slave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="26准备jenkins镜像并推送至harbor">2.6.准备Jenkins镜像并推送至harbor<a href="#26准备jenkins镜像并推送至harbor" class="hash-link" aria-label="Direct link to 2.6.准备Jenkins镜像并推送至harbor" title="Direct link to 2.6.准备Jenkins镜像并推送至harbor">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# docker pull jenkinsci/blueocean:1.24.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# docker tag jenkinsci/blueocean:1.24.6 harbor.jiangxl.com/jenkins/jenkinsci-blueocean:1.24.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# docker push harbor.jiangxl.com/jenkins/jenkinsci-blueocean:1.24.6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="27创建所有资源并查看资源的状态">2.7.创建所有资源并查看资源的状态<a href="#27创建所有资源并查看资源的状态" class="hash-link" aria-label="Direct link to 2.7.创建所有资源并查看资源的状态" title="Direct link to 2.7.创建所有资源并查看资源的状态">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.创建所有资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# kubectl apply -f ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace/jenkins created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/jenkins created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/jenkins-crb created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/jenkins-master created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageclass.storage.k8s.io/jenkins-storageclass created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/jenkins-svc created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.查看资源状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# kubectl get pod,statefulset,svc,storageclass,sa -n jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                   READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/jenkins-master-0   1/1     Running   0          31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                              READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/jenkins-master   1/1     31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                  TYPE       CLUSTER-IP   EXTERNAL-IP   PORT(S)                         AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/jenkins-svc   NodePort   10.101.2.5   &lt;none&gt;        8080:38080/TCP,50000:50000/TCP   31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                               PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageclass.storage.k8s.io/jenkins-storageclass   nfs-storage-01   Retain          Immediate           false                  31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                     SECRETS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/jenkins   1         31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.查看pvc，已经动态创建</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# kubectl get pvc -n jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS           AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jenkins-data-jenkins-master-0   Bound    pvc-3f49831b-7faa-456e-9a2f-65b6085933de   10Gi       RWX            jenkins-storageclass   32m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="28页面安装jenkins">2.8.页面安装Jenkins<a href="#28页面安装jenkins" class="hash-link" aria-label="Direct link to 2.8.页面安装Jenkins" title="Direct link to 2.8.页面安装Jenkins">​</a></h3><blockquote><p>访问集群节点任意ip+38080端口</p><p>访问看到如下页面说明Jenkins还在启动中，当日志输出到下图样子时，刷新Jenkins即可进入系统，复制日志中password解锁Jenkins</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/5072a83139484c61860f966035834408.png" alt="请添加图片描述" class="img_ev3q"></p></blockquote><p><strong>1）解锁Jenkins</strong></p><p>可以在日志中复制password，也可以查看/var/jenkins_home/secrets/initialAdminPassword这个文件</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/fd63e40a9e9f4cc8b62736a8f95e13fd.png" alt="请添加图片描述" class="img_ev3q"></p><p><strong>2）选择插件来安装</strong></p><p>把所有的插件都勾选上，避免后期出现软件依赖</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/a5dc04c56dc34f3098980e8a45329ad3.png" class="img_ev3q"></p><p>点击全部即可全部勾选
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20a43cdcdaf04446a9e34d3910cf3720.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>3）等待插件安装完</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/a192f76b08cf490d924b8c07e2fca199.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>4）创建Jenkins账号</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/6da90fc978394f78a6973653aa2d9b40.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>5）设置实例地址</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/b7698c5a282d4fd7805a01ea7e0d7785.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>6）重启Jenkins</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/0147db61d00345bb9bb5c89f20fb3f91.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="29登陆jenkins">2.9.登陆Jenkins<a href="#29登陆jenkins" class="hash-link" aria-label="Direct link to 2.9.登陆Jenkins" title="Direct link to 2.9.登陆Jenkins">​</a></h3><p>账号admin密码admin
<img loading="lazy" src="https://cdn.agou-ops.cn/others/ad1325a8e3a347d3bc795029cb401a12.png" alt="在这里插入图片描述" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3使用docker部署gitlab">3.使用docker部署gitlab<a href="#3使用docker部署gitlab" class="hash-link" aria-label="Direct link to 3.使用docker部署gitlab" title="Direct link to 3.使用docker部署gitlab">​</a></h2><blockquote><p>这里只是扩展一下如何用docker部署gitlab，建议采用4中的k8s部署gitlab</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31部署gitlab">3.1.部署gitlab<a href="#31部署gitlab" class="hash-link" aria-label="Direct link to 3.1.部署gitlab" title="Direct link to 3.1.部署gitlab">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master2 ~]\# docker run -d --hostname 192.168.16.105 -p 8443:443 -p 8080:80 -p 8022:22 --name gitlab --restart always -v /data2/k8s/gitlab-data/config/:/etc/gitlab -v /data2/k8s/gitlab-data/logs/:/var/log/gitlab -v /data2/k8s/gitlab-data/data/:/var/opt/gitlab gitlab/gitlab-ce:13.11.4-ce.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master2 ~]\# docker ps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS                   PORTS                                                               NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">33d868fe0369        gitlab/gitlab-ce:13.11.4-ce.0   &quot;/assets/wrapper&quot;        14 minutes ago      Up 4 minutes (healthy)   0.0.0.0:8022-&gt;22/tcp, 0.0.0.0:8080-&gt;80/tcp, 0.0.0.0:8443-&gt;443/tcp   gitlab</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当出现以下页面表示gitlab启动完成
<img loading="lazy" src="https://cdn.agou-ops.cn/others/8aecebfb08ed4dce8db08a824c33bdb1.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32访问gitlab">3.2.访问gitlab<a href="#32访问gitlab" class="hash-link" aria-label="Direct link to 3.2.访问gitlab" title="Direct link to 3.2.访问gitlab">​</a></h3><p>访问<a href="http://192.168.16.105:8080/" target="_blank" rel="noopener noreferrer">http://192.168.16.105:8080/</a></p><p>第一次登陆需要设置root密码
<img loading="lazy" src="https://cdn.agou-ops.cn/others/31be9f25fca64dd699b78ef9bbeaf6c4.png" alt="在这里插入图片描述" class="img_ev3q">
设置完密码即可登陆系统
<img loading="lazy" src="https://cdn.agou-ops.cn/others/cb47d2b998d940dd897ce6c253a29f20.png" alt="在这里插入图片描述" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4将gitlab部署在k8s集群">4.将gitlab部署在k8s集群<a href="#4将gitlab部署在k8s集群" class="hash-link" aria-label="Direct link to 4.将gitlab部署在k8s集群" title="Direct link to 4.将gitlab部署在k8s集群">​</a></h2><p><strong>部署分析：</strong></p><ul><li>gitlab采用statefulset控制器部署，通过StorageClass将gitlab的配置文件、gitlab的数据文件进行持久化存储</li><li>由于gitlab镜像集成了很多组件，每个组件在gitlab数据目录所使用的用户属组不同，因此都需要针对每个组件去修改对应的所属用户，否则无权限启动相关组件，首先用docker运行gitlab镜像，查询出gitlab数据目录中不同组件对应的不用所属用户，然后在初始化容器中进行赋权</li><li>修改gitlab的配置文件，确定对外提供访问的url</li><li>gitlab的80端口通过svc资源进行暴露</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41将gitlab镜像推送至harbor仓库">4.1.将gitlab镜像推送至harbor仓库<a href="#41将gitlab镜像推送至harbor仓库" class="hash-link" aria-label="Direct link to 4.1.将gitlab镜像推送至harbor仓库" title="Direct link to 4.1.将gitlab镜像推送至harbor仓库">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 ~]\# docker tag gitlab/gitlab-ce:13.11.4-ce.0 harbor.jiangxl.com/jenkins/gitlab-ce:13.11.4-ce.0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 ~]\# docker push  harbor.jiangxl.com/jenkins/gitlab-ce:13.11.4-ce.0 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42使用docker运行gitlab查询用户的id号">4.2.使用docker运行gitlab查询用户的id号<a href="#42使用docker运行gitlab查询用户的id号" class="hash-link" aria-label="Direct link to 4.2.使用docker运行gitlab查询用户的id号" title="Direct link to 4.2.使用docker运行gitlab查询用户的id号">​</a></h3><p>gitlab每个组件都是不同的所属用户来管理，我们不明确每个用户的uid、gid是多少，因此需要先用docker启动查询一下</p><p>需要记好这些组件的用户uid、gid，一会在statfulset资源中定义初始化容器时会用到</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.使用docker运行gitlab容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 ~]\# docker run -d harbor.jiangxl.com/jenkins/gitlab-ce:13.11.4-ce.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.进入容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 ~]\# docker exec -it 33d868fe0369 bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.查看gitlab数据路径下各组件使用的所属用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# ll /var/opt/gitlab/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 20 root              root       4096 May 20 09:12 ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  1 root              root         20 May 14 15:17 ../</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  2 git               git           6 May 20 09:01 .bundle/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--  1 git               git         363 May 20 09:01 .gitconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  2 git               git          29 May 20 09:01 .ssh/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---&gt;  3 gitlab-prometheus root         42 May 20 09:11 alertmanager/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  2 git               root          6 May 20 09:01 backups/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw---&gt;---&gt;-  1 root              root         38 May 20 09:06 bootstrapped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  3 git               git          26 May 20 09:01 git-data/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  3 git               root        123 May 20 09:11 gitaly/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  3 git               root         20 May 20 09:01 gitlab-ci/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  2 git               root         53 May 20 09:11 gitlab-exporter/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  9 git               root        160 May 20 09:11 gitlab-rails/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  2 git               root         24 May 20 09:10 gitlab-shell/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---&gt;  3 git               gitlab-www   55 May 20 09:11 gitlab-workhorse/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  4 gitlab-prometheus root         83 May 20 09:12 grafana/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  3 root              root         71 May 21 02:21 logrotate/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---&gt;  9 root              gitlab-www  163 May 20 09:05 nginx/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  2 gitlab-psql       root         26 May 20 09:11 postgres-exporter/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  3 gitlab-psql       root         81 May 20 09:11 postgresql/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---&gt;  4 gitlab-prometheus root         53 May 20 09:11 prometheus/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--  1 root              root        226 May 20 09:12 public_attributes.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---&gt;  2 gitlab-redis      git          60 May 21 02:29 redis/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--  1 root              root         40 May 20 09:01 trusted-certs-directory-hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.只需要看postgresql、reids、gitlab-data、prometheus目录的用户即可，主要这四个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#可以看到gitlab-data的用户是git、postgresql的用户是gitlab-psql、redis的是gitlab-redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# id git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uid=998(git) gid=998(git) groups=998(git)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# id gitlab-psql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uid=996(gitlab-psql) gid=996(gitlab-psql) groups=996(gitlab-psql)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# id gitlab-redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uid=997(gitlab-redis) gid=997(gitlab-redis) groups=997(gitlab-redis)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# id gitlab-prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uid=992(gitlab-prometheus) gid=992(gitlab-prometheus) groups=992(gitlab-prometheus)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43编写gitlab-storageclass-资源文件">4.3.编写gitlab StorageClass 资源文件<a href="#43编写gitlab-storageclass-资源文件" class="hash-link" aria-label="Direct link to 4.3.编写gitlab StorageClass 资源文件" title="Direct link to 4.3.编写gitlab StorageClass 资源文件">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 gitlab</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim gitlab-storageclass.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nfs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">reclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Retain</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="44编写gitlab-statefulset-资源文件">4.4.编写gitlab statefulset 资源文件<a href="#44编写gitlab-statefulset-资源文件" class="hash-link" aria-label="Direct link to 4.4.编写gitlab statefulset 资源文件" title="Direct link to 4.4.编写gitlab statefulset 资源文件">​</a></h3><p>StorageClass pvc模板定义两个，一个存储gitlab数据，一个存储gitlab配置文件</p><p>将刚刚查到的用户uid、gid，通过初始化容器分别赋权限给每个组件目录</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 gitlab</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim gitlab-statefulset.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">initContainers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">#定义初始化容器，将每个组件路径赋予对应的用户权限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 998:998 /var/opt/gitlab&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">#git用户授权整个gitlab数据目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#开启特权模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">#将数据持久化的pvc进行挂载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">psql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 996:996 /var/opt/gitlab/postgresql*&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">#gitlab-psql授权postgresql目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 997:997 /var/opt/gitlab/redis&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">#gitlab-redis授权redis目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prome                 </span><span class="token comment" style="color:#999988;font-style:italic">#gitlab-prometheus用户授权prometheus目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 992:992 /var/opt/gitlab/alertmanager /var/opt/gitlab/grafana /var/opt/gitlab/prometheus&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">chown         </span><span class="token comment" style="color:#999988;font-style:italic">#这个初始化容器主要就是把配置目录进行授权，可做可不做，因为这个目录的所属用户就是root，而nfs创建的存储路径默认也是root的所属</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 998:998 /etc/gitlab&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">#授权给gitlab用户</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">#定义主容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ce</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">13.11.4</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ce.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">#挂载持久化数据卷到容器的路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumeClaimTemplates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">#定义pvc模板</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic">#metadata是数组形式，因此可以定义多个，一个metadata就是一个pvc模板</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data         </span><span class="token comment" style="color:#999988;font-style:italic">#pvc名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storageclass     </span><span class="token comment" style="color:#999988;font-style:italic">#使用的StorageClass名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteMany           </span><span class="token comment" style="color:#999988;font-style:italic">#访问模式为多主机可读写</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="45编写gitlab-service-资源文件">4.5.编写gitlab service 资源文件<a href="#45编写gitlab-service-资源文件" class="hash-link" aria-label="Direct link to 4.5.编写gitlab service 资源文件" title="Direct link to 4.5.编写gitlab service 资源文件">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 gitlab</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim gitlab-svc.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="46创建所有资源并查看状态">4.6.创建所有资源并查看状态<a href="#46创建所有资源并查看状态" class="hash-link" aria-label="Direct link to 4.6.创建所有资源并查看状态" title="Direct link to 4.6.创建所有资源并查看状态">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.创建所有资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 gitlab]\# kubectl apply -f ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/gitlab created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageclass.storage.k8s.io/gitlab-storageclass created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/gitlab-svc created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.查看资源的状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 gitlab]\# kubectl get all -n jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                   READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/gitlab-0           1/1     Running   0          4m21s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/jenkins-master-0   1/1     Running   0          18h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                  TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)                          AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/gitlab-svc    NodePort   10.101.97.95    &lt;none&gt;        80:30080/TCP                     57m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/jenkins-svc   NodePort   10.99.113.179   &lt;none&gt;        8080:38080/TCP,50000:50000/TCP   23h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                              READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/gitlab           1/1     57m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/jenkins-master   1/1     23h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.查看pvc资源的状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 gitlab]\# kubectl get pvc -n jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS           AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gitlab-config-gitlab-0          Bound    pvc-91e63538-e07d-4196-82e8-4195b29d9352   1Gi        RWX            gitlab-storageclass    64m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gitlab-data-gitlab-0            Bound    pvc-2a300c8d-49e6-4035-99f1-81c3e190fe3e   10Gi       RWX            gitlab-storageclass    57m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jenkins-data-jenkins-master-0   Bound    pvc-9efb572b-d566-418d-bb6e-b225b43de4a5   10Gi       RWX            jenkins-storageclass   23h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="47修改gitlab配置">4.7.修改gitlab配置<a href="#47修改gitlab配置" class="hash-link" aria-label="Direct link to 4.7.修改gitlab配置" title="Direct link to 4.7.修改gitlab配置">​</a></h3><p>当gitlab服务启动之后，配置文件和数据目录就会存储在pvc上，我们需要修改gitlab的配置文件明确访问地址</p><p>主要：这里只写地址，不要加端口，如果加了除80以外的端口，那么容器里gitlab的80就会改成你指定的端口，那么做得svc将会失效，无法暴露gitlab</p><p>这一步也可以不做，因为对于k8s而言都是通过集群任意节点ip去映射的</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master2 ~]\# vim /data2/k8s/storageclass/jenkins-gitlab-config-gitlab-0-pvc-91e63538-e07d-4196-82e8-4195b29d9352/gitlab.rb </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">external_url &#x27;http://192.168.16.106&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改完重新部署一下gitlab即可</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 gitlab]\# kubectl replace -f gitlab-statefulset.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/gitlab replaced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="48访问gitlab">4.8.访问gitlab<a href="#48访问gitlab" class="hash-link" aria-label="Direct link to 4.8.访问gitlab" title="Direct link to 4.8.访问gitlab">​</a></h3><p>访问http://集群任意节点ip:30080端口</p><blockquote><p>gitlab启动缓慢，进入容器查看gitlab状态，都是run后即可访问</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/3cb3db85c0a44853bb427cc3f739f8ef.png" alt="在这里插入图片描述" class="img_ev3q"></p></blockquote><p><strong>1）设置用户密码</strong></p><p>最少8位，这里设置admin123
<img loading="lazy" src="https://cdn.agou-ops.cn/others/f272c0ffc079443199a81e55f95fba69.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>2）进入gitlab</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/207da6d0e57b43008394ab964311a6f2.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>3）设置语言为中文</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/b1c0dfdc00c24d8588f29c1ef4664fae.png" alt="在这里插入图片描述" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5提交程序代码到gitlab上">5.提交程序代码到gitlab上<a href="#5提交程序代码到gitlab上" class="hash-link" aria-label="Direct link to 5.提交程序代码到gitlab上" title="Direct link to 5.提交程序代码到gitlab上">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51新建一个项目">5.1.新建一个项目<a href="#51新建一个项目" class="hash-link" aria-label="Direct link to 5.1.新建一个项目" title="Direct link to 5.1.新建一个项目">​</a></h3><p><strong>1）点击新建项目</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/77ce6e59d41d4ec1b016f50bd766ef68.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>2）创建空白项目</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/bf036a4f46f84a9e94d1d137ee7d310f.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>3）填写项目信息</strong></p><p>可见级别设置为公开
<img loading="lazy" src="https://cdn.agou-ops.cn/others/101cb12d291e489abf69647313fecc9d.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>4）创建完成</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/c1de124f7b624b2b95efcf335767eecb.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52将程序代码提交到gitlab">5.2.将程序代码提交到gitlab<a href="#52将程序代码提交到gitlab" class="hash-link" aria-label="Direct link to 5.2.将程序代码提交到gitlab" title="Direct link to 5.2.将程序代码提交到gitlab">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 python-demo]\# git init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">初始化空的 Git 版本库于 /root/gitlab_project/python-demo/.git/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 python-demo]\# git remote add origin http://192.168.16.106:30080/root/blog_project.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 python-demo]\# git add .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 python-demo]\# git commit -m &quot;Initial commit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 python-demo]\# git push -u origin master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username for &#x27;http://192.168.16.106:30080&#x27;: root        #输入用户名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password for &#x27;http://root@192.168.16.106:30080&#x27;:        #输入密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Counting objects: 48, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Delta compression using up to 4 threads.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Compressing objects: 100% (44/44), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Writing objects: 100% (48/48), 978.49 KiB | 0 bytes/s, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total 48 (delta 4), reused 0 (delta 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To http://192.168.16.106:30080/root/blog_project.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new branch]      master -&gt; master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">分支 master 设置为跟踪来自 origin 的远程分支 master。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/d4306e08735645e5ae24a93123b7a064.png" alt="在这里插入图片描述" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6jenkins集成gitlab">6.Jenkins集成gitlab<a href="#6jenkins集成gitlab" class="hash-link" aria-label="Direct link to 6.Jenkins集成gitlab" title="Direct link to 6.Jenkins集成gitlab">​</a></h2><p>必须在jenkins配置gitlab地址，否则pipeline找不到git地址</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61在jenkins上安装gitlab插件">6.1.在Jenkins上安装gitlab插件<a href="#61在jenkins上安装gitlab插件" class="hash-link" aria-label="Direct link to 6.1.在Jenkins上安装gitlab插件" title="Direct link to 6.1.在Jenkins上安装gitlab插件">​</a></h3><p>修改Jenkins默认源为清华源</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.修改源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /data2/k8s/storageclassjenkins-jenkins-data-jenkins-master-0-pvc-9efb572b-d566-418d-bb6e-b225b43de4a5/updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &#x27;s/http:\/\/updates.jenkins- ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g&#x27; default.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &#x27;s/http:\/\/www.google.com/https:\/\/www.baidu.com/g&#x27; default.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.重启Jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 ~]\# kubectl replace -f /root/k8s1.19/jenkins/jenkins-statefulset.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/jenkins-master replaced</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>系统管理—&gt;插件管理—&gt;可选插件—&gt;搜索gitlab—&gt;安装
<img loading="lazy" src="https://cdn.agou-ops.cn/others/07defd42b2a5485ba30659d6d4d775af.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62在gitlab上生成token">6.2.在gitlab上生成token<a href="#62在gitlab上生成token" class="hash-link" aria-label="Direct link to 6.2.在gitlab上生成token" title="Direct link to 6.2.在gitlab上生成token">​</a></h3><p>edit profile—&gt;&gt;访问令牌—&gt;&gt;填写token名称—&gt;&gt;勾选权限范围
<img loading="lazy" src="https://cdn.agou-ops.cn/others/63547133425548b5a3e5e3a902cf90b3.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>token只显示一次，妥善保管：F4N8_LrfC7BdNWXXyJA2</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/41554f761e5742c9af47c519ceedaf51.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="63在jenkins添加gitlab-api-token">6.3.在Jenkins添加gitlab api token<a href="#63在jenkins添加gitlab-api-token" class="hash-link" aria-label="Direct link to 6.3.在Jenkins添加gitlab api token" title="Direct link to 6.3.在Jenkins添加gitlab api token">​</a></h3><p>系统管理—&gt;找到gitlab—&gt;进行配置即可</p><p>Connection name：gitlab-token</p><p>Gitlab host URL：<a href="http://192.168.16.104:30080/" target="_blank" rel="noopener noreferrer">http://192.168.16.104:30080/</a></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/04b27f6631e648c0a81627335fdab789.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>填写完基本信息后点击添加gitlab token，类型只能选择gitlab api token，将token粘进去即可</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/3a3cf1606a7b45c6b02a3132aab80ac0.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>添加完token之后，下拉选择刚刚添加的token，不再变红说明连接gitlab成功</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/6af8522a35b843e7a3da53e2a3179bd4.png" alt="在这里插入图片描述" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7jenkins分布式master-slave模式">7.Jenkins分布式master-slave模式<a href="#7jenkins分布式master-slave模式" class="hash-link" aria-label="Direct link to 7.Jenkins分布式master-slave模式" title="Direct link to 7.Jenkins分布式master-slave模式">​</a></h2><p>jenkins分布式就是有多个slave节点，当需要构建的项目非常多时，master的性能会有影响，slave会承担master的工作量，在slave在上创建项目。slave节点与master的区别就在于slave不需要安装Jenkins</p><p>slave节点有很多方式部署，我们采用</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="71新增jenkins节点">7.1.新增Jenkins节点<a href="#71新增jenkins节点" class="hash-link" aria-label="Direct link to 7.1.新增Jenkins节点" title="Direct link to 7.1.新增Jenkins节点">​</a></h3><p><strong>1）系统管理—&gt;节点管理—&gt;新建节点—&gt;填写节点名称—&gt;固定节点—&gt;确定</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/95f634c391aa41359aba7c928eb3e693.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>2）添加节点详细信息</strong></p><p>名字：Jenkins-slave1-107</p><p>执行器数量：3</p><p>远程工作目录：/data/jenkins_jobs</p><p>标签：Jenkins-slave1-107 #用于让Jenkins某个任务运行在某个节点上</p><p>用法：尽可能的使用这个节点</p><p>启动方式：通过java web启动代理</p><p>自定义工作目录：/data/jenkins_jobs
<img loading="lazy" src="https://cdn.agou-ops.cn/others/24e8095eed63443f90c3b86db984ec93.jpg" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>3）添加完节点发现节点是红的，这说明代理程序还没有启动，Jenkins不知道节点是谁</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/3dccdb73b2834db791fb00270d95d0e5.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>点击节点，进去后会看到如何启动agent，右键复制agent.jar拿到链接地址，去对应的服务器上下载jar包，然后启动即可成功添加节点
<img loading="lazy" src="https://cdn.agou-ops.cn/others/747440af22584bf5867db7b32b7fa9dc.png" alt="在这里插入图片描述" class="img_ev3q"></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.创建节点工作目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node2 ~]\# mkdir /data/jenkins_jobs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node2 ~]\# cd /data/jenkins_jobs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.下载agent程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node2 /data/jenkins_jobs]\# wget http://192.168.16.104:38080/jnlpJars/agent.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.启动agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node2 /data/jenkins_jobs]\# nohup java -jar agent.jar -jnlpUrl http://192.168.16.104:38080/computer/Jenkins-slave1-107/jenkins-agent.jnlp -secret efbde6c51590ca2c9097e6866de9f2d18520bfc05440a1872135e78b47283721 -workDir &quot;/data/jenkins_jobs&quot; &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令解释：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> java -jar agent.jar \      #启动jar包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -jnlpUrl http://192.168.16.104:38080/computer/Jenkins-slave1-107/jenkins-agent.jnlp \  #这个路径就是我们在Jenkins上新建节点之后的节点所在路径，如果不指定，Jenkins根本不知道这个节点对应哪台服务器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -secret efbde6c51590ca2c9097e6866de9f2d18520bfc05440a1872135e78b47283721 \   #认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -workDir &quot;/data/jenkins_obs&quot; &amp;     #工作目录</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>agent启动后在Jenkins页面上观察节点，发现已经是可用状态
<img loading="lazy" src="https://cdn.agou-ops.cn/others/5199668c5f564bb78b30223cc63d465d.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="72新建一个任务运行在slave1节点上">7.2.新建一个任务运行在slave1节点上<a href="#72新建一个任务运行在slave1节点上" class="hash-link" aria-label="Direct link to 7.2.新建一个任务运行在slave1节点上" title="Direct link to 7.2.新建一个任务运行在slave1节点上">​</a></h3><p><strong>1）配置任务—&gt;general—&gt;限制项目的运行节点—&gt;填写节点设置的标签即可</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/385087446afa435da77418de3cebfdf5.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>2）运行任务观察运行在哪个节点</strong></p><p>选择master分支，开始构建
<img loading="lazy" src="https://cdn.agou-ops.cn/others/11026daa09754df8892cc7c42d434b32.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>任务已经运行到了Jenkins-slave1-107节点上</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/f4003605156e44fc994c7a9da3f63b69.png" alt="在这里插入图片描述" class="img_ev3q"></p><p>钉钉已经收到信息并且在节点工作目录已经产生数据</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/2b0b214b6069439c837821a44b043a74.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="73观察节点关联的执行任务">7.3.观察节点关联的执行任务<a href="#73观察节点关联的执行任务" class="hash-link" aria-label="Direct link to 7.3.观察节点关联的执行任务" title="Direct link to 7.3.观察节点关联的执行任务">​</a></h3><blockquote><p>到这一步CI/CD平台已经部署完成，我们可以新建一个流程，更新程序到kubernetes平台
<img loading="lazy" src="https://cdn.agou-ops.cn/others/37216cf5a5824c899d172e8f4137e2c0.png" class="img_ev3q"></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8使用pipeline流水线将know-system项目更新到kubernetes环境">8.使用pipeline流水线将know-system项目更新到kubernetes环境<a href="#8使用pipeline流水线将know-system项目更新到kubernetes环境" class="hash-link" aria-label="Direct link to 8.使用pipeline流水线将know-system项目更新到kubernetes环境" title="Direct link to 8.使用pipeline流水线将know-system项目更新到kubernetes环境">​</a></h2><p><strong>k8s更新可以采用两种方式</strong></p><p> 1.将资源yaml文件也上传到代码仓库，项目打完镜像后，可以通过替换deployment资源我们指定image的字符串，把最新版本的镜 像替换到deployment资源中，最后执行kubectl apply ./完成更新</p><p> 2.执行kubectl 命令更新deployment资源的镜像</p><p><strong>由于我们构建任务都是通过agent去运行的，agent部署在k8s node节点，继承了docker、kubectl命令，因此不必担心kubectl命令不能用</strong></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="81实现思路">8.1.实现思路<a href="#81实现思路" class="hash-link" aria-label="Direct link to 8.1.实现思路" title="Direct link to 8.1.实现思路">​</a></h3><p>1.首先将know-system在k8s中进行部署，实现可以访问的状态</p><p>2.将部署know-system的yaml文件复制到代码目录中，并将deployment资源中容器image对应的镜像改成一个字符串，这样pipeline更新时可以通过更换这个字符串，把最新的镜像版本替换到deployment资源中完成更新，最后将代码及部署文件推送到gitlab</p><p>3.优化pipeline脚本，增加k8s部署步骤</p><p>4.更新代码，使用流水线更新项目到k8s</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="82将know-system部署在k8s中">8.2.将know-system部署在k8s中<a href="#82将know-system部署在k8s中" class="hash-link" aria-label="Direct link to 8.2.将know-system部署在k8s中" title="Direct link to 8.2.将know-system部署在k8s中">​</a></h3><p><strong>1）准备项目yaml文件</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.准备deployment资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat nginx-depoly.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/project/nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data/code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data/nginx/conf/conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">configMap</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">configmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">persistentVolumeClaim</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">claimName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pvc</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">know</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.准备configmap资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat nginx-configmap.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">configmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">know.jiangxl.com.conf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      server_name know.jiangxl.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        root /data/code/know_system;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        index index.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.准备svc资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat nginx-svc.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2）创建所有资源</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know-system]\# kubectl apply -f ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/nginx-configmap unchanged</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/know-system configured</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/nginx-service configured</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>3）查看项目首页</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/5c579af45d324e1c857e235d62ca72f1.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="83将k8s资源文件提交至gitlab">8.3.将k8s资源文件提交至gitlab<a href="#83将k8s资源文件提交至gitlab" class="hash-link" aria-label="Direct link to 8.3.将k8s资源文件提交至gitlab" title="Direct link to 8.3.将k8s资源文件提交至gitlab">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.将部署文件复制到代码目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# mkdir deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# cp /root/k8s1.19/know-system/* deploy/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.修改deployment资源中的image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#将image对应的镜像改成一个字符串，pipeline更新时可以通过更换这个字符串把最新的镜像替换到deployment资源中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# vim deploy/nginx-depoly.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: {{updateimage}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.提交至gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# git add .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# git commit -m &quot;deploy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# git push origin master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="84编写jenkins-pipeline将项目更新到k8s">8.4.编写Jenkins pipeline将项目更新到k8s<a href="#84编写jenkins-pipeline将项目更新到k8s" class="hash-link" aria-label="Direct link to 8.4.编写Jenkins pipeline将项目更新到k8s" title="Direct link to 8.4.编写Jenkins pipeline将项目更新到k8s">​</a></h3><blockquote><p>当前pipeline脚本主要是更新用yaml文件创建的项目pod现</p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> label </span><span class="token string" style="color:#e3116c">&#x27;Jenkins-slave1-107&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">                //让该pipeline始终运行在Jenkins-slave1-107 Jenkins agent节点上，因为这个节点所在的服务器可以运行k8s集群的docker、kubelet命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                                   //environment主要用于定义环境变量，可以把一些常用到的值做成环境变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token assign-left variable" style="color:#36acaa">IMAGE_REPO</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;harbor.jiangxl.com/project&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parameters </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                               //定义参数化构建流程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gitParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name: </span><span class="token string" style="color:#e3116c">&#x27;VERSION&#x27;</span><span class="token plain">,defaultValue: </span><span class="token string" style="color:#e3116c">&#x27;master&#x27;</span><span class="token plain">,type: </span><span class="token string" style="color:#e3116c">&#x27;BRANCH&#x27;</span><span class="token plain">,description: </span><span class="token string" style="color:#e3116c">&#x27;选择要更新的分支&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             //定义一个gitparamters参数化构建过程，用于选择更新的代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name: </span><span class="token string" style="color:#e3116c">&#x27;project&#x27;</span><span class="token plain">,defaultValue: </span><span class="token string" style="color:#e3116c">&#x27;know-system&#x27;</span><span class="token plain">,description: </span><span class="token string" style="color:#e3116c">&#x27;项目名称&#x27;</span><span class="token plain">,trim: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                  //定义一个空白字符串，声明项目名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                        //定义pipeline执行阶段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;运维确认信息&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                                 //阶段1，使用一个交互式，让运行确认更新信息，如果有误可直接退出更新，避免更新错误</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                input message: </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                jobname: </span><span class="token variable" style="color:#36acaa">${project}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                branch: </span><span class="token variable" style="color:#36acaa">${VERSION}</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;, ok: </span><span class="token string" style="color:#e3116c">&quot;更新&quot;</span><span class="token plain">                       //交互式输出一个更新的项目和分支号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;拉取项目代码&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                                  //阶段2，用于拉取git上对应的项目代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        checkout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token variable" style="color:#36acaa">$class</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GitSCM&#x27;</span><span class="token plain">, branches: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name: </span><span class="token string" style="color:#e3116c">&#x27;$VERSION&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, extensions: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, userRemoteConfigs: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">credentialsId: </span><span class="token string" style="color:#e3116c">&#x27;gitlab-root&#x27;</span><span class="token plain">, url: </span><span class="token string" style="color:#e3116c">&#x27;http://192.168.16.106:30080/root/know_system.git&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;构建项目镜像&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                             //阶段3.用于将项目代码更新到docker初始镜像中，主要步骤就是生产一个dockerfile，将代码复制到镜像中，最后根据Dockerfile构建出镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin class-name">pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">FROM harbor.jiangxl.com/project/nginx-project:v1-code</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">RUN mkdir /data/code/know_system</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">COPY  ./* /data/code/know_system/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EXPOSE 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;                             //编写一个Dockerfile，定义初始镜像，并将更新的代码复制到容器的指定路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;docker build -t ${IMAGE_REPO}/${project}:master-v${BUILD_ID} .&#x27;</span><span class="token plain">   //最终镜像的名称就是harbor.jiangxl.com/project/know-system:master-v1                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;推送镜像到harbor仓库&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">             //阶段4，将构建好的镜像推送至harbor仓库中，便于k8s拉取更新程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;docker push ${IMAGE_REPO}/${project}:master-v${BUILD_ID}&#x27;</span><span class="token plain">   //推送镜像到harbor仓库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;将项目更新到k8s&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                     //阶段5，主要是更新k8s中项目使用的容器，将最新构建的镜像替换到项目pod中，然后更新pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                                     //使用kubectl命令更新项目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sed -i &#x27;s#{{updateimage}}#</span><span class="token string variable" style="color:#36acaa">${IMAGE_REPO}</span><span class="token string" style="color:#e3116c">/</span><span class="token string variable" style="color:#36acaa">${project}</span><span class="token string" style="color:#e3116c">:master-v</span><span class="token string variable" style="color:#36acaa">${BUILD_ID}</span><span class="token string" style="color:#e3116c">#g&#x27; deploy/*&quot;</span><span class="token plain">       //将deployment资源中我们写死的镜像版本字符串，替换成刚刚推送至harbor仓库的镜像版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;kubectl apply -f deploy/&#x27;</span><span class="token plain">                   //当镜像版本替换后，更新资源的yaml文件即可完成项目更新</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      success </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">       //构建成功了发送一个构成成功的消息到钉钉</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;构建成功，发送消息到钉钉&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://oapi.dingtalk.com/robot/send?access_token=6719ac958daf4f31114cb0c1289837c9aca45d111d8653b04c3d6ae164f25146&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">&#x27;{&quot;msgtype&quot;: &quot;text&quot;,&quot;text&quot;: {&quot;content&quot;:&quot;😄👍构建成功👍😄\n 关键字：jenkins\n 项目 名称: ${JOB_BASE_NAME}\n 更新的分支号: ${VERSION}\n 本次构建的镜像版本：${IMAGE_REPO}/${project}:master-v${BUILD_ID}\n 构建地址：${RUN_DISPLAY_URL} &quot;}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      failure </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">       //构建失败了发送一个构成成功的消息到钉钉</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;构建失败，发送消息到钉钉&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://oapi.dingtalk.com/robot/send?access_token=6719ac958daf4f31114cb0c1289837c9aca45d111d8653b04c3d6ae164f25146&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">&#x27;{&quot;msgtype&quot;: &quot;text&quot;,&quot;text&quot;: {&quot;content&quot;:&quot;😖❌构建失败❌😖\n 关键字：jenkins\n 项目 名称: ${JOB_BASE_NAME}\n 更新的分支号: ${VERSION}\n 本次构建的镜像版本：${IMAGE_REPO}/${project}:master-v${BUILD_ID}\n 构建地址：${RUN_DISPLAY_URL} &quot;}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      always </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">          //无论成功还是失败都执行此步骤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;构建流程结束&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="85将pipeline粘贴到流水线任务中">8.5.将pipeline粘贴到流水线任务中<a href="#85将pipeline粘贴到流水线任务中" class="hash-link" aria-label="Direct link to 8.5.将pipeline粘贴到流水线任务中" title="Direct link to 8.5.将pipeline粘贴到流水线任务中">​</a></h3><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/6b567d43deb0474e8b57f717070c1e95.png" alt="在这里插入图片描述" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="86构建master分支完成项目更新">8.6.构建master分支完成项目更新<a href="#86构建master分支完成项目更新" class="hash-link" aria-label="Direct link to 8.6.构建master分支完成项目更新" title="Direct link to 8.6.构建master分支完成项目更新">​</a></h3><p><strong>1）选择更新信息</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/cebe0301954b46e0a696ebe6e2d05e93.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>2）运维确认信息</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/e14279c1a0824528a12931943441b2ab.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>3）pipeline任务更新成功</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/b322ccd2bf6e48f5a5609660bc537d55.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>4）在blue ocean查看此次更新的镜像版本</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/0e471501cd6c4617b630b6bebb53f41c.png" alt="在这里插入图片描述" class="img_ev3q"></p><p><strong>5）在rancher上观察项目是否更新成最新的镜像版本</strong></p><p>更新流程顺利完成！
<img loading="lazy" src="https://cdn.agou-ops.cn/others/b261c18ee6c646a2848342ae64dda144.png" alt="在这里插入图片描述" class="img_ev3q"></p><blockquote><p>该文章为转载内容，仅做备份私人学习使用，原文：<a href="https://jiangxl.blog.csdn.net/article/details/119828244" target="_blank" rel="noopener noreferrer">https://jiangxl.blog.csdn.net/article/details/119828244</a></p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/AGou-ops/myDocsv4/edit/main/docs/CloudNative/k8s/Kubernetes with Jenkins CICD.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/CloudNative/k8s/Kubernetes Yaml quicklystart"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Kubernetes YAML file quicklystart</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/CloudNative/k8s/Minikube Basic"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Minikube Basic</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#文章目录" class="table-of-contents__link toc-highlight">文章目录</a></li><li><a href="#1基于k8s集群的jenkins持续集成" class="table-of-contents__link toc-highlight">1.基于k8s集群的Jenkins持续集成</a></li><li><a href="#2将jenkins部署在k8s集群" class="table-of-contents__link toc-highlight">2.将Jenkins部署在k8s集群</a><ul><li><a href="#21编写jenkins-namespace文件" class="table-of-contents__link toc-highlight">2.1.编写Jenkins namespace文件</a></li><li><a href="#22编写jenkins-rbac授权文件" class="table-of-contents__link toc-highlight">2.2.编写Jenkins rbac授权文件</a></li><li><a href="#23编写jenkins-statefulset资源文件" class="table-of-contents__link toc-highlight">2.3.编写Jenkins statefulset资源文件</a></li><li><a href="#24编写jenkins-storageclass资源文件" class="table-of-contents__link toc-highlight">2.4.编写Jenkins StorageClass资源文件</a></li><li><a href="#25编写jenkins-svc资源文件" class="table-of-contents__link toc-highlight">2.5.编写Jenkins svc资源文件</a></li><li><a href="#26准备jenkins镜像并推送至harbor" class="table-of-contents__link toc-highlight">2.6.准备Jenkins镜像并推送至harbor</a></li><li><a href="#27创建所有资源并查看资源的状态" class="table-of-contents__link toc-highlight">2.7.创建所有资源并查看资源的状态</a></li><li><a href="#28页面安装jenkins" class="table-of-contents__link toc-highlight">2.8.页面安装Jenkins</a></li><li><a href="#29登陆jenkins" class="table-of-contents__link toc-highlight">2.9.登陆Jenkins</a></li></ul></li><li><a href="#3使用docker部署gitlab" class="table-of-contents__link toc-highlight">3.使用docker部署gitlab</a><ul><li><a href="#31部署gitlab" class="table-of-contents__link toc-highlight">3.1.部署gitlab</a></li><li><a href="#32访问gitlab" class="table-of-contents__link toc-highlight">3.2.访问gitlab</a></li></ul></li><li><a href="#4将gitlab部署在k8s集群" class="table-of-contents__link toc-highlight">4.将gitlab部署在k8s集群</a><ul><li><a href="#41将gitlab镜像推送至harbor仓库" class="table-of-contents__link toc-highlight">4.1.将gitlab镜像推送至harbor仓库</a></li><li><a href="#42使用docker运行gitlab查询用户的id号" class="table-of-contents__link toc-highlight">4.2.使用docker运行gitlab查询用户的id号</a></li><li><a href="#43编写gitlab-storageclass-资源文件" class="table-of-contents__link toc-highlight">4.3.编写gitlab StorageClass 资源文件</a></li><li><a href="#44编写gitlab-statefulset-资源文件" class="table-of-contents__link toc-highlight">4.4.编写gitlab statefulset 资源文件</a></li><li><a href="#45编写gitlab-service-资源文件" class="table-of-contents__link toc-highlight">4.5.编写gitlab service 资源文件</a></li><li><a href="#46创建所有资源并查看状态" class="table-of-contents__link toc-highlight">4.6.创建所有资源并查看状态</a></li><li><a href="#47修改gitlab配置" class="table-of-contents__link toc-highlight">4.7.修改gitlab配置</a></li><li><a href="#48访问gitlab" class="table-of-contents__link toc-highlight">4.8.访问gitlab</a></li></ul></li><li><a href="#5提交程序代码到gitlab上" class="table-of-contents__link toc-highlight">5.提交程序代码到gitlab上</a><ul><li><a href="#51新建一个项目" class="table-of-contents__link toc-highlight">5.1.新建一个项目</a></li><li><a href="#52将程序代码提交到gitlab" class="table-of-contents__link toc-highlight">5.2.将程序代码提交到gitlab</a></li></ul></li><li><a href="#6jenkins集成gitlab" class="table-of-contents__link toc-highlight">6.Jenkins集成gitlab</a><ul><li><a href="#61在jenkins上安装gitlab插件" class="table-of-contents__link toc-highlight">6.1.在Jenkins上安装gitlab插件</a></li><li><a href="#62在gitlab上生成token" class="table-of-contents__link toc-highlight">6.2.在gitlab上生成token</a></li><li><a href="#63在jenkins添加gitlab-api-token" class="table-of-contents__link toc-highlight">6.3.在Jenkins添加gitlab api token</a></li></ul></li><li><a href="#7jenkins分布式master-slave模式" class="table-of-contents__link toc-highlight">7.Jenkins分布式master-slave模式</a><ul><li><a href="#71新增jenkins节点" class="table-of-contents__link toc-highlight">7.1.新增Jenkins节点</a></li><li><a href="#72新建一个任务运行在slave1节点上" class="table-of-contents__link toc-highlight">7.2.新建一个任务运行在slave1节点上</a></li><li><a href="#73观察节点关联的执行任务" class="table-of-contents__link toc-highlight">7.3.观察节点关联的执行任务</a></li></ul></li><li><a href="#8使用pipeline流水线将know-system项目更新到kubernetes环境" class="table-of-contents__link toc-highlight">8.使用pipeline流水线将know-system项目更新到kubernetes环境</a><ul><li><a href="#81实现思路" class="table-of-contents__link toc-highlight">8.1.实现思路</a></li><li><a href="#82将know-system部署在k8s中" class="table-of-contents__link toc-highlight">8.2.将know-system部署在k8s中</a></li><li><a href="#83将k8s资源文件提交至gitlab" class="table-of-contents__link toc-highlight">8.3.将k8s资源文件提交至gitlab</a></li><li><a href="#84编写jenkins-pipeline将项目更新到k8s" class="table-of-contents__link toc-highlight">8.4.编写Jenkins pipeline将项目更新到k8s</a></li><li><a href="#85将pipeline粘贴到流水线任务中" class="table-of-contents__link toc-highlight">8.5.将pipeline粘贴到流水线任务中</a></li><li><a href="#86构建master分支完成项目更新" class="table-of-contents__link toc-highlight">8.6.构建master分支完成项目更新</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs Releases</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 1.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 2.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 3.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv4" target="_blank" rel="noopener noreferrer" class="footer__link-item">⭐️Version 4.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">⭐️我的博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 AGou-ops' Documetation v4.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d3f82a4d.js"></script>
<script src="/assets/js/main.7273c711.js"></script>
</body>
</html>