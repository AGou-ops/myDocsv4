<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-CloudNative/k8s/Kubernetes with Jenkins CICD">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">åŸºäºkuberneteså¹³å°çš„CICDæŒç»­é›†æˆ | AGou&#x27;s Docsv4</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.agou-ops.cn/docs/CloudNative/k8s/Kubernetes with Jenkins CICD"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="åŸºäºkuberneteså¹³å°çš„CICDæŒç»­é›†æˆ | AGou&#x27;s Docsv4"><meta data-rh="true" name="description" content="æ–‡ç« ç›®å½•"><meta data-rh="true" property="og:description" content="æ–‡ç« ç›®å½•"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Kubernetes with Jenkins CICD"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Kubernetes with Jenkins CICD" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Kubernetes with Jenkins CICD" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-KQED41RW95","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.6908ad1e.css">
<link rel="preload" href="/assets/js/runtime~main.d3f82a4d.js" as="script">
<link rel="preload" href="/assets/js/main.7273c711.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">AGou&#x27;s Docsv4</b></a><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">âœ¨ æˆ‘çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"> ğŸ“– ç›®å½•</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs">ğŸŒ² ç›®å½•æ ‘</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/category/äº‘åŸç”Ÿç›¸å…³">â˜ï¸ äº‘åŸç”Ÿç›¸å…³</a></li><li><a class="dropdown__link" href="/docs/category/linuxåŸºç¡€">ğŸ˜Š LinuxåŸºç¡€</a></li><li><a class="dropdown__link" href="/docs/category/ç¼–ç¨‹è¯­è¨€">â™¨ï¸ ç¼–ç¨‹è¯­è¨€</a></li><li><a class="dropdown__link" href="/docs/category/è„šæœ¬ç›¸å…³">ğŸ•¹ï¸ è„šæœ¬ç›¸å…³</a></li><li><a class="dropdown__link" href="/docs/category/é¢è¯•ç›¸å…³">ğŸ‘¨â€âš–ï¸ é¢è¯•ç›¸å…³</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ç‰ˆæœ¬</a><ul class="dropdown__menu"><li><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver1.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver2.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver3.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub ä»“åº“"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"><b>AGou&#x27;s Docsv4</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/äº‘åŸç”Ÿç›¸å…³">äº‘åŸç”Ÿç›¸å…³</a><button aria-label="Toggle the collapsible sidebar category &#x27;äº‘åŸç”Ÿç›¸å…³&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cicd">CICD</a><button aria-label="Toggle the collapsible sidebar category &#x27;CICD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cloudcomptering">CloudComptering</a><button aria-label="Toggle the collapsible sidebar category &#x27;CloudComptering&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/docker">Docker</a><button aria-label="Toggle the collapsible sidebar category &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elfk">ELFK</a><button aria-label="Toggle the collapsible sidebar category &#x27;ELFK&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/prometheus">Prometheus</a><button aria-label="Toggle the collapsible sidebar category &#x27;Prometheus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/k8s">k8s</a><button aria-label="Toggle the collapsible sidebar category &#x27;k8s&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/helm">Helm</a><button aria-label="Toggle the collapsible sidebar category &#x27;Helm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/installation">Installation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/quicklystart">Quicklystart</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quicklystart&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</a><button aria-label="Toggle the collapsible sidebar category &#x27;å®æˆ˜æ¡ˆä¾‹&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubeadm å¿«é€Ÿéƒ¨ç½²k8sé›†ç¾¤">Kubeadm å¿«é€Ÿéƒ¨ç½²k8sé›†ç¾¤</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes REST API">Kubernetes REST API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes Yaml quicklystart">Kubernetes YAML file quicklystart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes with Jenkins CICD">åŸºäºkuberneteså¹³å°çš„CICDæŒç»­é›†æˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Minikube Basic">Minikube Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Prometheus-Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤">Prometheus+Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Remote access k8s">kubectlè¿œç¨‹è¿æ¥k8s</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k3d">k3d</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s command">Kubernetes CLI command -- kubectl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s å›¾è§£å¤§å…¨">k8så›¾è§£å¤§å…¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s ç½‘ç»œç›¸å…³">k8s ç½‘ç»œç›¸å…³</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8sæ¦‚å¿µåŠåŸç†ç›¸å…³">k8s æ¦‚å¿µåŠåŸç†ç›¸å…³</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/kompose Basic">Kompose Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/kubenetesè¿œç¨‹è°ƒè¯•å·¥å…·">kubenetesè¿œç¨‹è°ƒè¯•å·¥å…·</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/CloudNative/k8s/å°æŠ€å·§/ä½¿ç”¨curlè®¿é—®k8sçš„REST API">å°æŠ€å·§</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Consul å…¥é—¨">Consul å…¥é—¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Dubbo Basic">Dubbo Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Grafana Loki Basic">Grafana Loki</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Istio Basic">Istio Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/">CloudNative.</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/äº‘åŸç”Ÿç›¸å…³"><span itemprop="name">äº‘åŸç”Ÿç›¸å…³</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/k8s"><span itemprop="name">k8s</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">åŸºäºkuberneteså¹³å°çš„CICDæŒç»­é›†æˆ</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>åŸºäºkuberneteså¹³å°çš„CICDæŒç»­é›†æˆ</h1><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æ–‡ç« ç›®å½•">æ–‡ç« ç›®å½•<a href="#æ–‡ç« ç›®å½•" class="hash-link" aria-label="Direct link to æ–‡ç« ç›®å½•" title="Direct link to æ–‡ç« ç›®å½•">â€‹</a></h3><p>[toc]</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1åŸºäºk8sé›†ç¾¤çš„jenkinsæŒç»­é›†æˆ">1.åŸºäºk8sé›†ç¾¤çš„JenkinsæŒç»­é›†æˆ<a href="#1åŸºäºk8sé›†ç¾¤çš„jenkinsæŒç»­é›†æˆ" class="hash-link" aria-label="Direct link to 1.åŸºäºk8sé›†ç¾¤çš„JenkinsæŒç»­é›†æˆ" title="Direct link to 1.åŸºäºk8sé›†ç¾¤çš„JenkinsæŒç»­é›†æˆ">â€‹</a></h2><p>Jenkinsæ›´æ–°ä¼ ç»ŸLNMTé¡¹ç›®æµç¨‹å¾ˆç®€å•ï¼ŒJenkinsä¹Ÿåªéœ€è¦éƒ¨ç½²åœ¨ç‰©ç†æœåŠ¡å™¨å³å¯å®ç°é¡¹ç›®ç‰ˆæœ¬çš„æŒç»­æ›´æ–°è¿­ä»£</p><p>å¦‚æœé¡¹ç›®æ˜¯éƒ¨ç½²åœ¨k8sé›†ç¾¤ï¼ŒJenkinsè¿˜åœ¨ç‰©ç†æœºä¸Šéƒ¨ç½²çš„è¯ï¼Œé¡¹ç›®æ›´æ–°æµç¨‹å°†ä¼šå˜å¾—ç¹çï¼Œå¤§è‡´æµç¨‹ï¼šé¦–å…ˆJenkinså°†é¡¹ç›®ç¼–è¯‘æˆwaråŒ…ï¼Œç„¶åå°†waråœ¨ä¸€å°ç‰©ç†æœºä¸Šè¿è¡Œï¼Œå¦‚æœè¿è¡ŒæˆåŠŸï¼Œå†è°ƒç”¨å¦ä¸€ä¸ªJenkinsä»»åŠ¡ï¼Œè¿™ä¸ªJenkinsä»»åŠ¡ä¸»è¦çš„ä½œç”¨å°±æ˜¯å°†waråŒ…å’ŒROOTç›®å½•copyåˆ°åˆå§‹é•œåƒä¸­ï¼Œå½“é•œåƒæ„å»ºå®Œæ¯•åï¼Œå°†é•œåƒæ¨é€è‡³harborå¹³å°ï¼Œå†ç”±è¿ç»´æ‹¿ç€é•œåƒç‰ˆæœ¬æ”¾åœ¨k8sé‡Œå»å‡çº§ã€‚</p><p>å¦‚æœJenkinsåªæ˜¯å•å•éƒ¨ç½²åœ¨ä¸€å°ç‰©ç†æœºä¸Šï¼ŒæŸå°JenkinsæŒ‚æ‰åï¼Œæ•´ä¸ªCI/CDå¹³å°å°†æ— æ³•æ›´æ–°è¿­ä»£ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆä¸¥é‡çš„åæœï¼Œå¦‚æœå°†Jenkinséƒ¨ç½²åœ¨k8så¹³å°ï¼Œå€ŸåŠ©k8s podè‡ªæ„ˆåŠŸèƒ½ï¼ŒJenkinsæŒ‚æ‰çš„æƒ…å†µå‡ ä¹ä¸ä¼šå‘ç”Ÿã€‚</p><p>Jenkinséƒ¨ç½²åœ¨k8sç¯å¢ƒä¹‹åï¼Œé€šè¿‡å»ºç«‹RBACæˆæƒæœºåˆ¶ï¼Œå¯ä»¥å®ç°Jenkinsä¸€é”®æ›´æ–°è¿­ä»£åˆ°k8sç¯å¢ƒï¼Œæ— éœ€åœ¨ä½¿ç”¨ç‰©ç†æœºç¯å¢ƒé‚£ä¹ˆç¹ççš„æ­¥éª¤</p><blockquote><p>å½“Jenkinsä¸kubernetesé›†æˆåçš„æ›´æ–°æµç¨‹ï¼š</p><p>1ï¼‰Jenkinsä»gitlabä¸Šæ‹‰å–å¼€å‘æäº¤çš„ä»£ç </p><p>2ï¼‰Jenkinsè°ƒç”¨mavenè¿›è¡Œç¼–è¯‘é¡¹ç›®</p><p>3ï¼‰Jenkinsè°ƒç”¨dockerå°†å†™å¥½dockerfileæ„å»ºæˆé•œåƒ</p><p>4ï¼‰å°†é•œåƒæ¨é€è‡³harborä»“åº“</p><p>5ï¼‰Jenkinsè°ƒç”¨k8så°†é•œåƒéƒ¨ç½²åœ¨k8sç¯å¢ƒ</p></blockquote><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/fcebc6a2b3f3211c4481fe783597dce6.png" alt="img" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2å°†jenkinséƒ¨ç½²åœ¨k8sé›†ç¾¤">2.å°†Jenkinséƒ¨ç½²åœ¨k8sé›†ç¾¤<a href="#2å°†jenkinséƒ¨ç½²åœ¨k8sé›†ç¾¤" class="hash-link" aria-label="Direct link to 2.å°†Jenkinséƒ¨ç½²åœ¨k8sé›†ç¾¤" title="Direct link to 2.å°†Jenkinséƒ¨ç½²åœ¨k8sé›†ç¾¤">â€‹</a></h2><blockquote><p><strong>éƒ¨ç½²æ€è·¯ï¼š</strong></p><p>1.ç”±äºJenkinsè¦æ›´æ–°é¡¹ç›®åˆ°å„ä¸ªnamespaceï¼Œå› æ­¤éœ€è¦åšRBACæˆæƒï¼Œå‡†å¤‡ä¸€ä¸ªServiceAccountï¼Œç›´æ¥å°†ServiceAccountç»‘å®šåˆ°cluster-adminé›†ç¾¤è§’è‰²ä¸Šï¼Œä½¿Jenkinsæ‹¥æœ‰å¯¹æ‰€æœ‰namespaceä¸‹çš„é¡¹ç›®æœ‰æ“ä½œæƒé™ã€‚</p><p>2.Jenkinséƒ¨ç½²é‡‡ç”¨statefulsetæ§åˆ¶å™¨ï¼Œå¹¶é…åˆStorageClassåŠ¨æ€å°†Jenkinsæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ã€‚</p><p>3.å‡†å¤‡svcèµ„æºï¼Œå°†Jenkinsçš„8080/50000ç«¯å£è¿›è¡Œæš´éœ²ã€‚</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21ç¼–å†™jenkins-namespaceæ–‡ä»¶">2.1.ç¼–å†™Jenkins namespaceæ–‡ä»¶<a href="#21ç¼–å†™jenkins-namespaceæ–‡ä»¶" class="hash-link" aria-label="Direct link to 2.1.ç¼–å†™Jenkins namespaceæ–‡ä»¶" title="Direct link to 2.1.ç¼–å†™Jenkins namespaceæ–‡ä»¶">â€‹</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 jenkins</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat jenkins-namespace.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Namespace </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22ç¼–å†™jenkins-rbacæˆæƒæ–‡ä»¶">2.2.ç¼–å†™Jenkins rbacæˆæƒæ–‡ä»¶<a href="#22ç¼–å†™jenkins-rbacæˆæƒæ–‡ä»¶" class="hash-link" aria-label="Direct link to 2.2.ç¼–å†™Jenkins rbacæˆæƒæ–‡ä»¶" title="Direct link to 2.2.ç¼–å†™Jenkins rbacæˆæƒæ–‡ä»¶">â€‹</a></h3><p>åˆ›å»ºä¸€ä¸ªserviceaccountè´¦å·Jenkinsï¼Œç›´æ¥å°†saè´¦å·ä¸cluster-adminé›†ç¾¤è§’è‰²è¿›è¡Œç»‘å®š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 jenkins</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat jenkins-rbac.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rbac.authorization.k8s.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">crb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">roleRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">apiGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cluster</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">subjects</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23ç¼–å†™jenkins-statefulsetèµ„æºæ–‡ä»¶">2.3.ç¼–å†™Jenkins statefulsetèµ„æºæ–‡ä»¶<a href="#23ç¼–å†™jenkins-statefulsetèµ„æºæ–‡ä»¶" class="hash-link" aria-label="Direct link to 2.3.ç¼–å†™Jenkins statefulsetèµ„æºæ–‡ä»¶" title="Direct link to 2.3.ç¼–å†™Jenkins statefulsetèµ„æºæ–‡ä»¶">â€‹</a></h3><p>Jenkinsä¹Ÿä¼šäº§ç”Ÿæ•°æ®ï¼Œå› æ­¤é‡‡ç”¨statefulsetéƒ¨ç½²æœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œå¹¶é…åˆStorageClassåŠ¨æ€åˆ›å»ºå­˜å‚¨ç³»ç»Ÿ</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 jenkins</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat jenkins-statefulset.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">serviceAccount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">initContainers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">chown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 1000:1000 /var/jenkins_home&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/jenkins_home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/jenkinsci</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">blueocean</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.24.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> JAVA_OPTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-Xms4096m -Xmx5120m -Duser.timezone=Asia/Shanghai -Dhudson.model.DirectoryBrowserSupport.CSP=&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> slave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/jenkins_home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumeClaimTemplates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="24ç¼–å†™jenkins-storageclassèµ„æºæ–‡ä»¶">2.4.ç¼–å†™Jenkins StorageClassèµ„æºæ–‡ä»¶<a href="#24ç¼–å†™jenkins-storageclassèµ„æºæ–‡ä»¶" class="hash-link" aria-label="Direct link to 2.4.ç¼–å†™Jenkins StorageClassèµ„æºæ–‡ä»¶" title="Direct link to 2.4.ç¼–å†™Jenkins StorageClassèµ„æºæ–‡ä»¶">â€‹</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 jenkins</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat jenkins-storageclass.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nfs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">reclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Retain</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="25ç¼–å†™jenkins-svcèµ„æºæ–‡ä»¶">2.5.ç¼–å†™Jenkins svcèµ„æºæ–‡ä»¶<a href="#25ç¼–å†™jenkins-svcèµ„æºæ–‡ä»¶" class="hash-link" aria-label="Direct link to 2.5.ç¼–å†™Jenkins svcèµ„æºæ–‡ä»¶" title="Direct link to 2.5.ç¼–å†™Jenkins svcèµ„æºæ–‡ä»¶">â€‹</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 jenkins</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat jenkins-svc.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">38080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> slave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="26å‡†å¤‡jenkinsé•œåƒå¹¶æ¨é€è‡³harbor">2.6.å‡†å¤‡Jenkinsé•œåƒå¹¶æ¨é€è‡³harbor<a href="#26å‡†å¤‡jenkinsé•œåƒå¹¶æ¨é€è‡³harbor" class="hash-link" aria-label="Direct link to 2.6.å‡†å¤‡Jenkinsé•œåƒå¹¶æ¨é€è‡³harbor" title="Direct link to 2.6.å‡†å¤‡Jenkinsé•œåƒå¹¶æ¨é€è‡³harbor">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# docker pull jenkinsci/blueocean:1.24.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# docker tag jenkinsci/blueocean:1.24.6 harbor.jiangxl.com/jenkins/jenkinsci-blueocean:1.24.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# docker push harbor.jiangxl.com/jenkins/jenkinsci-blueocean:1.24.6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="27åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹èµ„æºçš„çŠ¶æ€">2.7.åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹èµ„æºçš„çŠ¶æ€<a href="#27åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹èµ„æºçš„çŠ¶æ€" class="hash-link" aria-label="Direct link to 2.7.åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹èµ„æºçš„çŠ¶æ€" title="Direct link to 2.7.åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹èµ„æºçš„çŠ¶æ€">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.åˆ›å»ºæ‰€æœ‰èµ„æº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# kubectl apply -f ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace/jenkins created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/jenkins created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/jenkins-crb created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/jenkins-master created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageclass.storage.k8s.io/jenkins-storageclass created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/jenkins-svc created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.æŸ¥çœ‹èµ„æºçŠ¶æ€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# kubectl get pod,statefulset,svc,storageclass,sa -n jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                   READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/jenkins-master-0   1/1     Running   0          31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                              READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/jenkins-master   1/1     31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                  TYPE       CLUSTER-IP   EXTERNAL-IP   PORT(S)                         AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/jenkins-svc   NodePort   10.101.2.5   &lt;none&gt;        8080:38080/TCP,50000:50000/TCP   31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                               PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageclass.storage.k8s.io/jenkins-storageclass   nfs-storage-01   Retain          Immediate           false                  31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                     SECRETS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/jenkins   1         31m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.æŸ¥çœ‹pvcï¼Œå·²ç»åŠ¨æ€åˆ›å»º</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 jenkins]\# kubectl get pvc -n jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS           AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jenkins-data-jenkins-master-0   Bound    pvc-3f49831b-7faa-456e-9a2f-65b6085933de   10Gi       RWX            jenkins-storageclass   32m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="28é¡µé¢å®‰è£…jenkins">2.8.é¡µé¢å®‰è£…Jenkins<a href="#28é¡µé¢å®‰è£…jenkins" class="hash-link" aria-label="Direct link to 2.8.é¡µé¢å®‰è£…Jenkins" title="Direct link to 2.8.é¡µé¢å®‰è£…Jenkins">â€‹</a></h3><blockquote><p>è®¿é—®é›†ç¾¤èŠ‚ç‚¹ä»»æ„ip+38080ç«¯å£</p><p>è®¿é—®çœ‹åˆ°å¦‚ä¸‹é¡µé¢è¯´æ˜Jenkinsè¿˜åœ¨å¯åŠ¨ä¸­ï¼Œå½“æ—¥å¿—è¾“å‡ºåˆ°ä¸‹å›¾æ ·å­æ—¶ï¼Œåˆ·æ–°Jenkinså³å¯è¿›å…¥ç³»ç»Ÿï¼Œå¤åˆ¶æ—¥å¿—ä¸­passwordè§£é”Jenkins</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/5072a83139484c61860f966035834408.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" class="img_ev3q"></p></blockquote><p><strong>1ï¼‰è§£é”Jenkins</strong></p><p>å¯ä»¥åœ¨æ—¥å¿—ä¸­å¤åˆ¶passwordï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹/var/jenkins_home/secrets/initialAdminPasswordè¿™ä¸ªæ–‡ä»¶</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/fd63e40a9e9f4cc8b62736a8f95e13fd.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>2ï¼‰é€‰æ‹©æ’ä»¶æ¥å®‰è£…</strong></p><p>æŠŠæ‰€æœ‰çš„æ’ä»¶éƒ½å‹¾é€‰ä¸Šï¼Œé¿å…åæœŸå‡ºç°è½¯ä»¶ä¾èµ–</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/a5dc04c56dc34f3098980e8a45329ad3.png" class="img_ev3q"></p><p>ç‚¹å‡»å…¨éƒ¨å³å¯å…¨éƒ¨å‹¾é€‰
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20a43cdcdaf04446a9e34d3910cf3720.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>3ï¼‰ç­‰å¾…æ’ä»¶å®‰è£…å®Œ</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/a192f76b08cf490d924b8c07e2fca199.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>4ï¼‰åˆ›å»ºJenkinsè´¦å·</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/6da90fc978394f78a6973653aa2d9b40.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>5ï¼‰è®¾ç½®å®ä¾‹åœ°å€</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/b7698c5a282d4fd7805a01ea7e0d7785.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>6ï¼‰é‡å¯Jenkins</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/0147db61d00345bb9bb5c89f20fb3f91.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="29ç™»é™†jenkins">2.9.ç™»é™†Jenkins<a href="#29ç™»é™†jenkins" class="hash-link" aria-label="Direct link to 2.9.ç™»é™†Jenkins" title="Direct link to 2.9.ç™»é™†Jenkins">â€‹</a></h3><p>è´¦å·adminå¯†ç admin
<img loading="lazy" src="https://cdn.agou-ops.cn/others/ad1325a8e3a347d3bc795029cb401a12.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3ä½¿ç”¨dockeréƒ¨ç½²gitlab">3.ä½¿ç”¨dockeréƒ¨ç½²gitlab<a href="#3ä½¿ç”¨dockeréƒ¨ç½²gitlab" class="hash-link" aria-label="Direct link to 3.ä½¿ç”¨dockeréƒ¨ç½²gitlab" title="Direct link to 3.ä½¿ç”¨dockeréƒ¨ç½²gitlab">â€‹</a></h2><blockquote><p>è¿™é‡Œåªæ˜¯æ‰©å±•ä¸€ä¸‹å¦‚ä½•ç”¨dockeréƒ¨ç½²gitlabï¼Œå»ºè®®é‡‡ç”¨4ä¸­çš„k8séƒ¨ç½²gitlab</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31éƒ¨ç½²gitlab">3.1.éƒ¨ç½²gitlab<a href="#31éƒ¨ç½²gitlab" class="hash-link" aria-label="Direct link to 3.1.éƒ¨ç½²gitlab" title="Direct link to 3.1.éƒ¨ç½²gitlab">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master2 ~]\# docker run -d --hostname 192.168.16.105 -p 8443:443 -p 8080:80 -p 8022:22 --name gitlab --restart always -v /data2/k8s/gitlab-data/config/:/etc/gitlab -v /data2/k8s/gitlab-data/logs/:/var/log/gitlab -v /data2/k8s/gitlab-data/data/:/var/opt/gitlab gitlab/gitlab-ce:13.11.4-ce.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master2 ~]\# docker ps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS                   PORTS                                                               NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">33d868fe0369        gitlab/gitlab-ce:13.11.4-ce.0   &quot;/assets/wrapper&quot;        14 minutes ago      Up 4 minutes (healthy)   0.0.0.0:8022-&gt;22/tcp, 0.0.0.0:8080-&gt;80/tcp, 0.0.0.0:8443-&gt;443/tcp   gitlab</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å½“å‡ºç°ä»¥ä¸‹é¡µé¢è¡¨ç¤ºgitlabå¯åŠ¨å®Œæˆ
<img loading="lazy" src="https://cdn.agou-ops.cn/others/8aecebfb08ed4dce8db08a824c33bdb1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32è®¿é—®gitlab">3.2.è®¿é—®gitlab<a href="#32è®¿é—®gitlab" class="hash-link" aria-label="Direct link to 3.2.è®¿é—®gitlab" title="Direct link to 3.2.è®¿é—®gitlab">â€‹</a></h3><p>è®¿é—®<a href="http://192.168.16.105:8080/" target="_blank" rel="noopener noreferrer">http://192.168.16.105:8080/</a></p><p>ç¬¬ä¸€æ¬¡ç™»é™†éœ€è¦è®¾ç½®rootå¯†ç 
<img loading="lazy" src="https://cdn.agou-ops.cn/others/31be9f25fca64dd699b78ef9bbeaf6c4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q">
è®¾ç½®å®Œå¯†ç å³å¯ç™»é™†ç³»ç»Ÿ
<img loading="lazy" src="https://cdn.agou-ops.cn/others/cb47d2b998d940dd897ce6c253a29f20.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4å°†gitlabéƒ¨ç½²åœ¨k8sé›†ç¾¤">4.å°†gitlabéƒ¨ç½²åœ¨k8sé›†ç¾¤<a href="#4å°†gitlabéƒ¨ç½²åœ¨k8sé›†ç¾¤" class="hash-link" aria-label="Direct link to 4.å°†gitlabéƒ¨ç½²åœ¨k8sé›†ç¾¤" title="Direct link to 4.å°†gitlabéƒ¨ç½²åœ¨k8sé›†ç¾¤">â€‹</a></h2><p><strong>éƒ¨ç½²åˆ†æï¼š</strong></p><ul><li>gitlabé‡‡ç”¨statefulsetæ§åˆ¶å™¨éƒ¨ç½²ï¼Œé€šè¿‡StorageClasså°†gitlabçš„é…ç½®æ–‡ä»¶ã€gitlabçš„æ•°æ®æ–‡ä»¶è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</li><li>ç”±äºgitlabé•œåƒé›†æˆäº†å¾ˆå¤šç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶åœ¨gitlabæ•°æ®ç›®å½•æ‰€ä½¿ç”¨çš„ç”¨æˆ·å±ç»„ä¸åŒï¼Œå› æ­¤éƒ½éœ€è¦é’ˆå¯¹æ¯ä¸ªç»„ä»¶å»ä¿®æ”¹å¯¹åº”çš„æ‰€å±ç”¨æˆ·ï¼Œå¦åˆ™æ— æƒé™å¯åŠ¨ç›¸å…³ç»„ä»¶ï¼Œé¦–å…ˆç”¨dockerè¿è¡Œgitlabé•œåƒï¼ŒæŸ¥è¯¢å‡ºgitlabæ•°æ®ç›®å½•ä¸­ä¸åŒç»„ä»¶å¯¹åº”çš„ä¸ç”¨æ‰€å±ç”¨æˆ·ï¼Œç„¶ååœ¨åˆå§‹åŒ–å®¹å™¨ä¸­è¿›è¡Œèµ‹æƒ</li><li>ä¿®æ”¹gitlabçš„é…ç½®æ–‡ä»¶ï¼Œç¡®å®šå¯¹å¤–æä¾›è®¿é—®çš„url</li><li>gitlabçš„80ç«¯å£é€šè¿‡svcèµ„æºè¿›è¡Œæš´éœ²</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41å°†gitlabé•œåƒæ¨é€è‡³harborä»“åº“">4.1.å°†gitlabé•œåƒæ¨é€è‡³harborä»“åº“<a href="#41å°†gitlabé•œåƒæ¨é€è‡³harborä»“åº“" class="hash-link" aria-label="Direct link to 4.1.å°†gitlabé•œåƒæ¨é€è‡³harborä»“åº“" title="Direct link to 4.1.å°†gitlabé•œåƒæ¨é€è‡³harborä»“åº“">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 ~]\# docker tag gitlab/gitlab-ce:13.11.4-ce.0 harbor.jiangxl.com/jenkins/gitlab-ce:13.11.4-ce.0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 ~]\# docker push  harbor.jiangxl.com/jenkins/gitlab-ce:13.11.4-ce.0 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42ä½¿ç”¨dockerè¿è¡ŒgitlabæŸ¥è¯¢ç”¨æˆ·çš„idå·">4.2.ä½¿ç”¨dockerè¿è¡ŒgitlabæŸ¥è¯¢ç”¨æˆ·çš„idå·<a href="#42ä½¿ç”¨dockerè¿è¡ŒgitlabæŸ¥è¯¢ç”¨æˆ·çš„idå·" class="hash-link" aria-label="Direct link to 4.2.ä½¿ç”¨dockerè¿è¡ŒgitlabæŸ¥è¯¢ç”¨æˆ·çš„idå·" title="Direct link to 4.2.ä½¿ç”¨dockerè¿è¡ŒgitlabæŸ¥è¯¢ç”¨æˆ·çš„idå·">â€‹</a></h3><p>gitlabæ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä¸åŒçš„æ‰€å±ç”¨æˆ·æ¥ç®¡ç†ï¼Œæˆ‘ä»¬ä¸æ˜ç¡®æ¯ä¸ªç”¨æˆ·çš„uidã€gidæ˜¯å¤šå°‘ï¼Œå› æ­¤éœ€è¦å…ˆç”¨dockerå¯åŠ¨æŸ¥è¯¢ä¸€ä¸‹</p><p>éœ€è¦è®°å¥½è¿™äº›ç»„ä»¶çš„ç”¨æˆ·uidã€gidï¼Œä¸€ä¼šåœ¨statfulsetèµ„æºä¸­å®šä¹‰åˆå§‹åŒ–å®¹å™¨æ—¶ä¼šç”¨åˆ°</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.ä½¿ç”¨dockerè¿è¡Œgitlabå®¹å™¨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 ~]\# docker run -d harbor.jiangxl.com/jenkins/gitlab-ce:13.11.4-ce.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.è¿›å…¥å®¹å™¨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 ~]\# docker exec -it 33d868fe0369 bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.æŸ¥çœ‹gitlabæ•°æ®è·¯å¾„ä¸‹å„ç»„ä»¶ä½¿ç”¨çš„æ‰€å±ç”¨æˆ·</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# ll /var/opt/gitlab/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 20 root              root       4096 May 20 09:12 ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  1 root              root         20 May 14 15:17 ../</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  2 git               git           6 May 20 09:01 .bundle/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--  1 git               git         363 May 20 09:01 .gitconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  2 git               git          29 May 20 09:01 .ssh/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---&gt;  3 gitlab-prometheus root         42 May 20 09:11 alertmanager/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  2 git               root          6 May 20 09:01 backups/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw---&gt;---&gt;-  1 root              root         38 May 20 09:06 bootstrapped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  3 git               git          26 May 20 09:01 git-data/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  3 git               root        123 May 20 09:11 gitaly/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  3 git               root         20 May 20 09:01 gitlab-ci/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  2 git               root         53 May 20 09:11 gitlab-exporter/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  9 git               root        160 May 20 09:11 gitlab-rails/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  2 git               root         24 May 20 09:10 gitlab-shell/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---&gt;  3 git               gitlab-www   55 May 20 09:11 gitlab-workhorse/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  4 gitlab-prometheus root         83 May 20 09:12 grafana/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  3 root              root         71 May 21 02:21 logrotate/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---&gt;  9 root              gitlab-www  163 May 20 09:05 nginx/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx---&gt;---&gt;  2 gitlab-psql       root         26 May 20 09:11 postgres-exporter/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x  3 gitlab-psql       root         81 May 20 09:11 postgresql/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---&gt;  4 gitlab-prometheus root         53 May 20 09:11 prometheus/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--  1 root              root        226 May 20 09:12 public_attributes.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---&gt;  2 gitlab-redis      git          60 May 21 02:29 redis/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--  1 root              root         40 May 20 09:01 trusted-certs-directory-hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.åªéœ€è¦çœ‹postgresqlã€reidsã€gitlab-dataã€prometheusç›®å½•çš„ç”¨æˆ·å³å¯ï¼Œä¸»è¦è¿™å››ä¸ª</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#å¯ä»¥çœ‹åˆ°gitlab-dataçš„ç”¨æˆ·æ˜¯gitã€postgresqlçš„ç”¨æˆ·æ˜¯gitlab-psqlã€redisçš„æ˜¯gitlab-redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# id git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uid=998(git) gid=998(git) groups=998(git)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# id gitlab-psql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uid=996(gitlab-psql) gid=996(gitlab-psql) groups=996(gitlab-psql)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# id gitlab-redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uid=997(gitlab-redis) gid=997(gitlab-redis) groups=997(gitlab-redis)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192:/# id gitlab-prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uid=992(gitlab-prometheus) gid=992(gitlab-prometheus) groups=992(gitlab-prometheus)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43ç¼–å†™gitlab-storageclass-èµ„æºæ–‡ä»¶">4.3.ç¼–å†™gitlab StorageClass èµ„æºæ–‡ä»¶<a href="#43ç¼–å†™gitlab-storageclass-èµ„æºæ–‡ä»¶" class="hash-link" aria-label="Direct link to 4.3.ç¼–å†™gitlab StorageClass èµ„æºæ–‡ä»¶" title="Direct link to 4.3.ç¼–å†™gitlab StorageClass èµ„æºæ–‡ä»¶">â€‹</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 gitlab</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim gitlab-storageclass.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nfs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">reclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Retain</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="44ç¼–å†™gitlab-statefulset-èµ„æºæ–‡ä»¶">4.4.ç¼–å†™gitlab statefulset èµ„æºæ–‡ä»¶<a href="#44ç¼–å†™gitlab-statefulset-èµ„æºæ–‡ä»¶" class="hash-link" aria-label="Direct link to 4.4.ç¼–å†™gitlab statefulset èµ„æºæ–‡ä»¶" title="Direct link to 4.4.ç¼–å†™gitlab statefulset èµ„æºæ–‡ä»¶">â€‹</a></h3><p>StorageClass pvcæ¨¡æ¿å®šä¹‰ä¸¤ä¸ªï¼Œä¸€ä¸ªå­˜å‚¨gitlabæ•°æ®ï¼Œä¸€ä¸ªå­˜å‚¨gitlabé…ç½®æ–‡ä»¶</p><p>å°†åˆšåˆšæŸ¥åˆ°çš„ç”¨æˆ·uidã€gidï¼Œé€šè¿‡åˆå§‹åŒ–å®¹å™¨åˆ†åˆ«èµ‹æƒé™ç»™æ¯ä¸ªç»„ä»¶ç›®å½•</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 gitlab</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim gitlab-statefulset.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">initContainers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">#å®šä¹‰åˆå§‹åŒ–å®¹å™¨ï¼Œå°†æ¯ä¸ªç»„ä»¶è·¯å¾„èµ‹äºˆå¯¹åº”çš„ç”¨æˆ·æƒé™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 998:998 /var/opt/gitlab&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">#gitç”¨æˆ·æˆæƒæ•´ä¸ªgitlabæ•°æ®ç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#å¼€å¯ç‰¹æƒæ¨¡å¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">#å°†æ•°æ®æŒä¹…åŒ–çš„pvcè¿›è¡ŒæŒ‚è½½</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">psql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 996:996 /var/opt/gitlab/postgresql*&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">#gitlab-psqlæˆæƒpostgresqlç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 997:997 /var/opt/gitlab/redis&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">#gitlab-redisæˆæƒredisç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prome                 </span><span class="token comment" style="color:#999988;font-style:italic">#gitlab-prometheusç”¨æˆ·æˆæƒprometheusç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 992:992 /var/opt/gitlab/alertmanager /var/opt/gitlab/grafana /var/opt/gitlab/prometheus&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">chown         </span><span class="token comment" style="color:#999988;font-style:italic">#è¿™ä¸ªåˆå§‹åŒ–å®¹å™¨ä¸»è¦å°±æ˜¯æŠŠé…ç½®ç›®å½•è¿›è¡Œæˆæƒï¼Œå¯åšå¯ä¸åšï¼Œå› ä¸ºè¿™ä¸ªç›®å½•çš„æ‰€å±ç”¨æˆ·å°±æ˜¯rootï¼Œè€Œnfsåˆ›å»ºçš„å­˜å‚¨è·¯å¾„é»˜è®¤ä¹Ÿæ˜¯rootçš„æ‰€å±</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;chown -R 998:998 /etc/gitlab&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">#æˆæƒç»™gitlabç”¨æˆ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">#å®šä¹‰ä¸»å®¹å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/jenkins/gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ce</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">13.11.4</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ce.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">#æŒ‚è½½æŒä¹…åŒ–æ•°æ®å·åˆ°å®¹å™¨çš„è·¯å¾„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumeClaimTemplates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">#å®šä¹‰pvcæ¨¡æ¿</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic">#metadataæ˜¯æ•°ç»„å½¢å¼ï¼Œå› æ­¤å¯ä»¥å®šä¹‰å¤šä¸ªï¼Œä¸€ä¸ªmetadataå°±æ˜¯ä¸€ä¸ªpvcæ¨¡æ¿</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data         </span><span class="token comment" style="color:#999988;font-style:italic">#pvcåç§°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storageclass     </span><span class="token comment" style="color:#999988;font-style:italic">#ä½¿ç”¨çš„StorageClassåç§°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteMany           </span><span class="token comment" style="color:#999988;font-style:italic">#è®¿é—®æ¨¡å¼ä¸ºå¤šä¸»æœºå¯è¯»å†™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="45ç¼–å†™gitlab-service-èµ„æºæ–‡ä»¶">4.5.ç¼–å†™gitlab service èµ„æºæ–‡ä»¶<a href="#45ç¼–å†™gitlab-service-èµ„æºæ–‡ä»¶" class="hash-link" aria-label="Direct link to 4.5.ç¼–å†™gitlab service èµ„æºæ–‡ä»¶" title="Direct link to 4.5.ç¼–å†™gitlab service èµ„æºæ–‡ä»¶">â€‹</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 gitlab</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim gitlab-svc.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="46åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹çŠ¶æ€">4.6.åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹çŠ¶æ€<a href="#46åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹çŠ¶æ€" class="hash-link" aria-label="Direct link to 4.6.åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹çŠ¶æ€" title="Direct link to 4.6.åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹çŠ¶æ€">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.åˆ›å»ºæ‰€æœ‰èµ„æº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 gitlab]\# kubectl apply -f ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/gitlab created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageclass.storage.k8s.io/gitlab-storageclass created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/gitlab-svc created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.æŸ¥çœ‹èµ„æºçš„çŠ¶æ€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 gitlab]\# kubectl get all -n jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                   READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/gitlab-0           1/1     Running   0          4m21s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/jenkins-master-0   1/1     Running   0          18h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                  TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)                          AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/gitlab-svc    NodePort   10.101.97.95    &lt;none&gt;        80:30080/TCP                     57m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/jenkins-svc   NodePort   10.99.113.179   &lt;none&gt;        8080:38080/TCP,50000:50000/TCP   23h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                              READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/gitlab           1/1     57m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/jenkins-master   1/1     23h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.æŸ¥çœ‹pvcèµ„æºçš„çŠ¶æ€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 gitlab]\# kubectl get pvc -n jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS           AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gitlab-config-gitlab-0          Bound    pvc-91e63538-e07d-4196-82e8-4195b29d9352   1Gi        RWX            gitlab-storageclass    64m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gitlab-data-gitlab-0            Bound    pvc-2a300c8d-49e6-4035-99f1-81c3e190fe3e   10Gi       RWX            gitlab-storageclass    57m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jenkins-data-jenkins-master-0   Bound    pvc-9efb572b-d566-418d-bb6e-b225b43de4a5   10Gi       RWX            jenkins-storageclass   23h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="47ä¿®æ”¹gitlabé…ç½®">4.7.ä¿®æ”¹gitlabé…ç½®<a href="#47ä¿®æ”¹gitlabé…ç½®" class="hash-link" aria-label="Direct link to 4.7.ä¿®æ”¹gitlabé…ç½®" title="Direct link to 4.7.ä¿®æ”¹gitlabé…ç½®">â€‹</a></h3><p>å½“gitlabæœåŠ¡å¯åŠ¨ä¹‹åï¼Œé…ç½®æ–‡ä»¶å’Œæ•°æ®ç›®å½•å°±ä¼šå­˜å‚¨åœ¨pvcä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹gitlabçš„é…ç½®æ–‡ä»¶æ˜ç¡®è®¿é—®åœ°å€</p><p>ä¸»è¦ï¼šè¿™é‡Œåªå†™åœ°å€ï¼Œä¸è¦åŠ ç«¯å£ï¼Œå¦‚æœåŠ äº†é™¤80ä»¥å¤–çš„ç«¯å£ï¼Œé‚£ä¹ˆå®¹å™¨é‡Œgitlabçš„80å°±ä¼šæ”¹æˆä½ æŒ‡å®šçš„ç«¯å£ï¼Œé‚£ä¹ˆåšå¾—svcå°†ä¼šå¤±æ•ˆï¼Œæ— æ³•æš´éœ²gitlab</p><p>è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥ä¸åšï¼Œå› ä¸ºå¯¹äºk8sè€Œè¨€éƒ½æ˜¯é€šè¿‡é›†ç¾¤ä»»æ„èŠ‚ç‚¹ipå»æ˜ å°„çš„</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master2 ~]\# vim /data2/k8s/storageclass/jenkins-gitlab-config-gitlab-0-pvc-91e63538-e07d-4196-82e8-4195b29d9352/gitlab.rb </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">external_url &#x27;http://192.168.16.106&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¿®æ”¹å®Œé‡æ–°éƒ¨ç½²ä¸€ä¸‹gitlabå³å¯</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 gitlab]\# kubectl replace -f gitlab-statefulset.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/gitlab replaced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="48è®¿é—®gitlab">4.8.è®¿é—®gitlab<a href="#48è®¿é—®gitlab" class="hash-link" aria-label="Direct link to 4.8.è®¿é—®gitlab" title="Direct link to 4.8.è®¿é—®gitlab">â€‹</a></h3><p>è®¿é—®http://é›†ç¾¤ä»»æ„èŠ‚ç‚¹ip:30080ç«¯å£</p><blockquote><p>gitlabå¯åŠ¨ç¼“æ…¢ï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹gitlabçŠ¶æ€ï¼Œéƒ½æ˜¯runåå³å¯è®¿é—®</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/3cb3db85c0a44853bb427cc3f739f8ef.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p></blockquote><p><strong>1ï¼‰è®¾ç½®ç”¨æˆ·å¯†ç </strong></p><p>æœ€å°‘8ä½ï¼Œè¿™é‡Œè®¾ç½®admin123
<img loading="lazy" src="https://cdn.agou-ops.cn/others/f272c0ffc079443199a81e55f95fba69.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>2ï¼‰è¿›å…¥gitlab</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/207da6d0e57b43008394ab964311a6f2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>3ï¼‰è®¾ç½®è¯­è¨€ä¸ºä¸­æ–‡</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/b1c0dfdc00c24d8588f29c1ef4664fae.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5æäº¤ç¨‹åºä»£ç åˆ°gitlabä¸Š">5.æäº¤ç¨‹åºä»£ç åˆ°gitlabä¸Š<a href="#5æäº¤ç¨‹åºä»£ç åˆ°gitlabä¸Š" class="hash-link" aria-label="Direct link to 5.æäº¤ç¨‹åºä»£ç åˆ°gitlabä¸Š" title="Direct link to 5.æäº¤ç¨‹åºä»£ç åˆ°gitlabä¸Š">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51æ–°å»ºä¸€ä¸ªé¡¹ç›®">5.1.æ–°å»ºä¸€ä¸ªé¡¹ç›®<a href="#51æ–°å»ºä¸€ä¸ªé¡¹ç›®" class="hash-link" aria-label="Direct link to 5.1.æ–°å»ºä¸€ä¸ªé¡¹ç›®" title="Direct link to 5.1.æ–°å»ºä¸€ä¸ªé¡¹ç›®">â€‹</a></h3><p><strong>1ï¼‰ç‚¹å‡»æ–°å»ºé¡¹ç›®</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/77ce6e59d41d4ec1b016f50bd766ef68.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>2ï¼‰åˆ›å»ºç©ºç™½é¡¹ç›®</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/bf036a4f46f84a9e94d1d137ee7d310f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>3ï¼‰å¡«å†™é¡¹ç›®ä¿¡æ¯</strong></p><p>å¯è§çº§åˆ«è®¾ç½®ä¸ºå…¬å¼€
<img loading="lazy" src="https://cdn.agou-ops.cn/others/101cb12d291e489abf69647313fecc9d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>4ï¼‰åˆ›å»ºå®Œæˆ</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/c1de124f7b624b2b95efcf335767eecb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52å°†ç¨‹åºä»£ç æäº¤åˆ°gitlab">5.2.å°†ç¨‹åºä»£ç æäº¤åˆ°gitlab<a href="#52å°†ç¨‹åºä»£ç æäº¤åˆ°gitlab" class="hash-link" aria-label="Direct link to 5.2.å°†ç¨‹åºä»£ç æäº¤åˆ°gitlab" title="Direct link to 5.2.å°†ç¨‹åºä»£ç æäº¤åˆ°gitlab">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 python-demo]\# git init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">åˆå§‹åŒ–ç©ºçš„ Git ç‰ˆæœ¬åº“äº /root/gitlab_project/python-demo/.git/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 python-demo]\# git remote add origin http://192.168.16.106:30080/root/blog_project.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 python-demo]\# git add .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 python-demo]\# git commit -m &quot;Initial commit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 python-demo]\# git push -u origin master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username for &#x27;http://192.168.16.106:30080&#x27;: root        #è¾“å…¥ç”¨æˆ·å</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password for &#x27;http://root@192.168.16.106:30080&#x27;:        #è¾“å…¥å¯†ç </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Counting objects: 48, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Delta compression using up to 4 threads.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Compressing objects: 100% (44/44), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Writing objects: 100% (48/48), 978.49 KiB | 0 bytes/s, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total 48 (delta 4), reused 0 (delta 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To http://192.168.16.106:30080/root/blog_project.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new branch]      master -&gt; master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">åˆ†æ”¯ master è®¾ç½®ä¸ºè·Ÿè¸ªæ¥è‡ª origin çš„è¿œç¨‹åˆ†æ”¯ masterã€‚</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/d4306e08735645e5ae24a93123b7a064.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6jenkinsé›†æˆgitlab">6.Jenkinsé›†æˆgitlab<a href="#6jenkinsé›†æˆgitlab" class="hash-link" aria-label="Direct link to 6.Jenkinsé›†æˆgitlab" title="Direct link to 6.Jenkinsé›†æˆgitlab">â€‹</a></h2><p>å¿…é¡»åœ¨jenkinsé…ç½®gitlabåœ°å€ï¼Œå¦åˆ™pipelineæ‰¾ä¸åˆ°gitåœ°å€</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61åœ¨jenkinsä¸Šå®‰è£…gitlabæ’ä»¶">6.1.åœ¨Jenkinsä¸Šå®‰è£…gitlabæ’ä»¶<a href="#61åœ¨jenkinsä¸Šå®‰è£…gitlabæ’ä»¶" class="hash-link" aria-label="Direct link to 6.1.åœ¨Jenkinsä¸Šå®‰è£…gitlabæ’ä»¶" title="Direct link to 6.1.åœ¨Jenkinsä¸Šå®‰è£…gitlabæ’ä»¶">â€‹</a></h3><p>ä¿®æ”¹Jenkinsé»˜è®¤æºä¸ºæ¸…åæº</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.ä¿®æ”¹æº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /data2/k8s/storageclassjenkins-jenkins-data-jenkins-master-0-pvc-9efb572b-d566-418d-bb6e-b225b43de4a5/updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &#x27;s/http:\/\/updates.jenkins- ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g&#x27; default.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &#x27;s/http:\/\/www.google.com/https:\/\/www.baidu.com/g&#x27; default.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.é‡å¯Jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 ~]\# kubectl replace -f /root/k8s1.19/jenkins/jenkins-statefulset.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/jenkins-master replaced</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç³»ç»Ÿç®¡ç†â€”&gt;æ’ä»¶ç®¡ç†â€”&gt;å¯é€‰æ’ä»¶â€”&gt;æœç´¢gitlabâ€”&gt;å®‰è£…
<img loading="lazy" src="https://cdn.agou-ops.cn/others/07defd42b2a5485ba30659d6d4d775af.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62åœ¨gitlabä¸Šç”Ÿæˆtoken">6.2.åœ¨gitlabä¸Šç”Ÿæˆtoken<a href="#62åœ¨gitlabä¸Šç”Ÿæˆtoken" class="hash-link" aria-label="Direct link to 6.2.åœ¨gitlabä¸Šç”Ÿæˆtoken" title="Direct link to 6.2.åœ¨gitlabä¸Šç”Ÿæˆtoken">â€‹</a></h3><p>edit profileâ€”&gt;&gt;è®¿é—®ä»¤ç‰Œâ€”&gt;&gt;å¡«å†™tokenåç§°â€”&gt;&gt;å‹¾é€‰æƒé™èŒƒå›´
<img loading="lazy" src="https://cdn.agou-ops.cn/others/63547133425548b5a3e5e3a902cf90b3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>tokenåªæ˜¾ç¤ºä¸€æ¬¡ï¼Œå¦¥å–„ä¿ç®¡ï¼šF4N8_LrfC7BdNWXXyJA2</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/41554f761e5742c9af47c519ceedaf51.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="63åœ¨jenkinsæ·»åŠ gitlab-api-token">6.3.åœ¨Jenkinsæ·»åŠ gitlab api token<a href="#63åœ¨jenkinsæ·»åŠ gitlab-api-token" class="hash-link" aria-label="Direct link to 6.3.åœ¨Jenkinsæ·»åŠ gitlab api token" title="Direct link to 6.3.åœ¨Jenkinsæ·»åŠ gitlab api token">â€‹</a></h3><p>ç³»ç»Ÿç®¡ç†â€”&gt;æ‰¾åˆ°gitlabâ€”&gt;è¿›è¡Œé…ç½®å³å¯</p><p>Connection nameï¼šgitlab-token</p><p>Gitlab host URLï¼š<a href="http://192.168.16.104:30080/" target="_blank" rel="noopener noreferrer">http://192.168.16.104:30080/</a></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/04b27f6631e648c0a81627335fdab789.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>å¡«å†™å®ŒåŸºæœ¬ä¿¡æ¯åç‚¹å‡»æ·»åŠ gitlab tokenï¼Œç±»å‹åªèƒ½é€‰æ‹©gitlab api tokenï¼Œå°†tokenç²˜è¿›å»å³å¯</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/3a3cf1606a7b45c6b02a3132aab80ac0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>æ·»åŠ å®Œtokenä¹‹åï¼Œä¸‹æ‹‰é€‰æ‹©åˆšåˆšæ·»åŠ çš„tokenï¼Œä¸å†å˜çº¢è¯´æ˜è¿æ¥gitlabæˆåŠŸ</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/6af8522a35b843e7a3da53e2a3179bd4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7jenkinsåˆ†å¸ƒå¼master-slaveæ¨¡å¼">7.Jenkinsåˆ†å¸ƒå¼master-slaveæ¨¡å¼<a href="#7jenkinsåˆ†å¸ƒå¼master-slaveæ¨¡å¼" class="hash-link" aria-label="Direct link to 7.Jenkinsåˆ†å¸ƒå¼master-slaveæ¨¡å¼" title="Direct link to 7.Jenkinsåˆ†å¸ƒå¼master-slaveæ¨¡å¼">â€‹</a></h2><p>jenkinsåˆ†å¸ƒå¼å°±æ˜¯æœ‰å¤šä¸ªslaveèŠ‚ç‚¹ï¼Œå½“éœ€è¦æ„å»ºçš„é¡¹ç›®éå¸¸å¤šæ—¶ï¼Œmasterçš„æ€§èƒ½ä¼šæœ‰å½±å“ï¼Œslaveä¼šæ‰¿æ‹…masterçš„å·¥ä½œé‡ï¼Œåœ¨slaveåœ¨ä¸Šåˆ›å»ºé¡¹ç›®ã€‚slaveèŠ‚ç‚¹ä¸masterçš„åŒºåˆ«å°±åœ¨äºslaveä¸éœ€è¦å®‰è£…Jenkins</p><p>slaveèŠ‚ç‚¹æœ‰å¾ˆå¤šæ–¹å¼éƒ¨ç½²ï¼Œæˆ‘ä»¬é‡‡ç”¨</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="71æ–°å¢jenkinsèŠ‚ç‚¹">7.1.æ–°å¢JenkinsèŠ‚ç‚¹<a href="#71æ–°å¢jenkinsèŠ‚ç‚¹" class="hash-link" aria-label="Direct link to 7.1.æ–°å¢JenkinsèŠ‚ç‚¹" title="Direct link to 7.1.æ–°å¢JenkinsèŠ‚ç‚¹">â€‹</a></h3><p><strong>1ï¼‰ç³»ç»Ÿç®¡ç†â€”&gt;èŠ‚ç‚¹ç®¡ç†â€”&gt;æ–°å»ºèŠ‚ç‚¹â€”&gt;å¡«å†™èŠ‚ç‚¹åç§°â€”&gt;å›ºå®šèŠ‚ç‚¹â€”&gt;ç¡®å®š</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/95f634c391aa41359aba7c928eb3e693.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>2ï¼‰æ·»åŠ èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯</strong></p><p>åå­—ï¼šJenkins-slave1-107</p><p>æ‰§è¡Œå™¨æ•°é‡ï¼š3</p><p>è¿œç¨‹å·¥ä½œç›®å½•ï¼š/data/jenkins_jobs</p><p>æ ‡ç­¾ï¼šJenkins-slave1-107 #ç”¨äºè®©JenkinsæŸä¸ªä»»åŠ¡è¿è¡Œåœ¨æŸä¸ªèŠ‚ç‚¹ä¸Š</p><p>ç”¨æ³•ï¼šå°½å¯èƒ½çš„ä½¿ç”¨è¿™ä¸ªèŠ‚ç‚¹</p><p>å¯åŠ¨æ–¹å¼ï¼šé€šè¿‡java webå¯åŠ¨ä»£ç†</p><p>è‡ªå®šä¹‰å·¥ä½œç›®å½•ï¼š/data/jenkins_jobs
<img loading="lazy" src="https://cdn.agou-ops.cn/others/24e8095eed63443f90c3b86db984ec93.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>3ï¼‰æ·»åŠ å®ŒèŠ‚ç‚¹å‘ç°èŠ‚ç‚¹æ˜¯çº¢çš„ï¼Œè¿™è¯´æ˜ä»£ç†ç¨‹åºè¿˜æ²¡æœ‰å¯åŠ¨ï¼ŒJenkinsä¸çŸ¥é“èŠ‚ç‚¹æ˜¯è°</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/3dccdb73b2834db791fb00270d95d0e5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>ç‚¹å‡»èŠ‚ç‚¹ï¼Œè¿›å»åä¼šçœ‹åˆ°å¦‚ä½•å¯åŠ¨agentï¼Œå³é”®å¤åˆ¶agent.jaræ‹¿åˆ°é“¾æ¥åœ°å€ï¼Œå»å¯¹åº”çš„æœåŠ¡å™¨ä¸Šä¸‹è½½jaråŒ…ï¼Œç„¶åå¯åŠ¨å³å¯æˆåŠŸæ·»åŠ èŠ‚ç‚¹
<img loading="lazy" src="https://cdn.agou-ops.cn/others/747440af22584bf5867db7b32b7fa9dc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.åˆ›å»ºèŠ‚ç‚¹å·¥ä½œç›®å½•</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node2 ~]\# mkdir /data/jenkins_jobs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node2 ~]\# cd /data/jenkins_jobs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.ä¸‹è½½agentç¨‹åº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node2 /data/jenkins_jobs]\# wget http://192.168.16.104:38080/jnlpJars/agent.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.å¯åŠ¨agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node2 /data/jenkins_jobs]\# nohup java -jar agent.jar -jnlpUrl http://192.168.16.104:38080/computer/Jenkins-slave1-107/jenkins-agent.jnlp -secret efbde6c51590ca2c9097e6866de9f2d18520bfc05440a1872135e78b47283721 -workDir &quot;/data/jenkins_jobs&quot; &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å‘½ä»¤è§£é‡Šï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> java -jar agent.jar \      #å¯åŠ¨jaråŒ…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -jnlpUrl http://192.168.16.104:38080/computer/Jenkins-slave1-107/jenkins-agent.jnlp \  #è¿™ä¸ªè·¯å¾„å°±æ˜¯æˆ‘ä»¬åœ¨Jenkinsä¸Šæ–°å»ºèŠ‚ç‚¹ä¹‹åçš„èŠ‚ç‚¹æ‰€åœ¨è·¯å¾„ï¼Œå¦‚æœä¸æŒ‡å®šï¼ŒJenkinsæ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªèŠ‚ç‚¹å¯¹åº”å“ªå°æœåŠ¡å™¨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -secret efbde6c51590ca2c9097e6866de9f2d18520bfc05440a1872135e78b47283721 \   #è®¤è¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -workDir &quot;/data/jenkins_obs&quot; &amp;     #å·¥ä½œç›®å½•</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>agentå¯åŠ¨ååœ¨Jenkinsé¡µé¢ä¸Šè§‚å¯ŸèŠ‚ç‚¹ï¼Œå‘ç°å·²ç»æ˜¯å¯ç”¨çŠ¶æ€
<img loading="lazy" src="https://cdn.agou-ops.cn/others/5199668c5f564bb78b30223cc63d465d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="72æ–°å»ºä¸€ä¸ªä»»åŠ¡è¿è¡Œåœ¨slave1èŠ‚ç‚¹ä¸Š">7.2.æ–°å»ºä¸€ä¸ªä»»åŠ¡è¿è¡Œåœ¨slave1èŠ‚ç‚¹ä¸Š<a href="#72æ–°å»ºä¸€ä¸ªä»»åŠ¡è¿è¡Œåœ¨slave1èŠ‚ç‚¹ä¸Š" class="hash-link" aria-label="Direct link to 7.2.æ–°å»ºä¸€ä¸ªä»»åŠ¡è¿è¡Œåœ¨slave1èŠ‚ç‚¹ä¸Š" title="Direct link to 7.2.æ–°å»ºä¸€ä¸ªä»»åŠ¡è¿è¡Œåœ¨slave1èŠ‚ç‚¹ä¸Š">â€‹</a></h3><p><strong>1ï¼‰é…ç½®ä»»åŠ¡â€”&gt;generalâ€”&gt;é™åˆ¶é¡¹ç›®çš„è¿è¡ŒèŠ‚ç‚¹â€”&gt;å¡«å†™èŠ‚ç‚¹è®¾ç½®çš„æ ‡ç­¾å³å¯</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/385087446afa435da77418de3cebfdf5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>2ï¼‰è¿è¡Œä»»åŠ¡è§‚å¯Ÿè¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹</strong></p><p>é€‰æ‹©masteråˆ†æ”¯ï¼Œå¼€å§‹æ„å»º
<img loading="lazy" src="https://cdn.agou-ops.cn/others/11026daa09754df8892cc7c42d434b32.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>ä»»åŠ¡å·²ç»è¿è¡Œåˆ°äº†Jenkins-slave1-107èŠ‚ç‚¹ä¸Š</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/f4003605156e44fc994c7a9da3f63b69.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>é’‰é’‰å·²ç»æ”¶åˆ°ä¿¡æ¯å¹¶ä¸”åœ¨èŠ‚ç‚¹å·¥ä½œç›®å½•å·²ç»äº§ç”Ÿæ•°æ®</p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/2b0b214b6069439c837821a44b043a74.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="73è§‚å¯ŸèŠ‚ç‚¹å…³è”çš„æ‰§è¡Œä»»åŠ¡">7.3.è§‚å¯ŸèŠ‚ç‚¹å…³è”çš„æ‰§è¡Œä»»åŠ¡<a href="#73è§‚å¯ŸèŠ‚ç‚¹å…³è”çš„æ‰§è¡Œä»»åŠ¡" class="hash-link" aria-label="Direct link to 7.3.è§‚å¯ŸèŠ‚ç‚¹å…³è”çš„æ‰§è¡Œä»»åŠ¡" title="Direct link to 7.3.è§‚å¯ŸèŠ‚ç‚¹å…³è”çš„æ‰§è¡Œä»»åŠ¡">â€‹</a></h3><blockquote><p>åˆ°è¿™ä¸€æ­¥CI/CDå¹³å°å·²ç»éƒ¨ç½²å®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªæµç¨‹ï¼Œæ›´æ–°ç¨‹åºåˆ°kuberneteså¹³å°
<img loading="lazy" src="https://cdn.agou-ops.cn/others/37216cf5a5824c899d172e8f4137e2c0.png" class="img_ev3q"></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8ä½¿ç”¨pipelineæµæ°´çº¿å°†know-systemé¡¹ç›®æ›´æ–°åˆ°kubernetesç¯å¢ƒ">8.ä½¿ç”¨pipelineæµæ°´çº¿å°†know-systemé¡¹ç›®æ›´æ–°åˆ°kubernetesç¯å¢ƒ<a href="#8ä½¿ç”¨pipelineæµæ°´çº¿å°†know-systemé¡¹ç›®æ›´æ–°åˆ°kubernetesç¯å¢ƒ" class="hash-link" aria-label="Direct link to 8.ä½¿ç”¨pipelineæµæ°´çº¿å°†know-systemé¡¹ç›®æ›´æ–°åˆ°kubernetesç¯å¢ƒ" title="Direct link to 8.ä½¿ç”¨pipelineæµæ°´çº¿å°†know-systemé¡¹ç›®æ›´æ–°åˆ°kubernetesç¯å¢ƒ">â€‹</a></h2><p><strong>k8sæ›´æ–°å¯ä»¥é‡‡ç”¨ä¸¤ç§æ–¹å¼</strong></p><p> 1.å°†èµ„æºyamlæ–‡ä»¶ä¹Ÿä¸Šä¼ åˆ°ä»£ç ä»“åº“ï¼Œé¡¹ç›®æ‰“å®Œé•œåƒåï¼Œå¯ä»¥é€šè¿‡æ›¿æ¢deploymentèµ„æºæˆ‘ä»¬æŒ‡å®šimageçš„å­—ç¬¦ä¸²ï¼ŒæŠŠæœ€æ–°ç‰ˆæœ¬çš„é•œ åƒæ›¿æ¢åˆ°deploymentèµ„æºä¸­ï¼Œæœ€åæ‰§è¡Œkubectl apply ./å®Œæˆæ›´æ–°</p><p> 2.æ‰§è¡Œkubectl å‘½ä»¤æ›´æ–°deploymentèµ„æºçš„é•œåƒ</p><p><strong>ç”±äºæˆ‘ä»¬æ„å»ºä»»åŠ¡éƒ½æ˜¯é€šè¿‡agentå»è¿è¡Œçš„ï¼Œagentéƒ¨ç½²åœ¨k8s nodeèŠ‚ç‚¹ï¼Œç»§æ‰¿äº†dockerã€kubectlå‘½ä»¤ï¼Œå› æ­¤ä¸å¿…æ‹…å¿ƒkubectlå‘½ä»¤ä¸èƒ½ç”¨</strong></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="81å®ç°æ€è·¯">8.1.å®ç°æ€è·¯<a href="#81å®ç°æ€è·¯" class="hash-link" aria-label="Direct link to 8.1.å®ç°æ€è·¯" title="Direct link to 8.1.å®ç°æ€è·¯">â€‹</a></h3><p>1.é¦–å…ˆå°†know-systemåœ¨k8sä¸­è¿›è¡Œéƒ¨ç½²ï¼Œå®ç°å¯ä»¥è®¿é—®çš„çŠ¶æ€</p><p>2.å°†éƒ¨ç½²know-systemçš„yamlæ–‡ä»¶å¤åˆ¶åˆ°ä»£ç ç›®å½•ä¸­ï¼Œå¹¶å°†deploymentèµ„æºä¸­å®¹å™¨imageå¯¹åº”çš„é•œåƒæ”¹æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™æ ·pipelineæ›´æ–°æ—¶å¯ä»¥é€šè¿‡æ›´æ¢è¿™ä¸ªå­—ç¬¦ä¸²ï¼ŒæŠŠæœ€æ–°çš„é•œåƒç‰ˆæœ¬æ›¿æ¢åˆ°deploymentèµ„æºä¸­å®Œæˆæ›´æ–°ï¼Œæœ€åå°†ä»£ç åŠéƒ¨ç½²æ–‡ä»¶æ¨é€åˆ°gitlab</p><p>3.ä¼˜åŒ–pipelineè„šæœ¬ï¼Œå¢åŠ k8séƒ¨ç½²æ­¥éª¤</p><p>4.æ›´æ–°ä»£ç ï¼Œä½¿ç”¨æµæ°´çº¿æ›´æ–°é¡¹ç›®åˆ°k8s</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="82å°†know-systeméƒ¨ç½²åœ¨k8sä¸­">8.2.å°†know-systeméƒ¨ç½²åœ¨k8sä¸­<a href="#82å°†know-systeméƒ¨ç½²åœ¨k8sä¸­" class="hash-link" aria-label="Direct link to 8.2.å°†know-systeméƒ¨ç½²åœ¨k8sä¸­" title="Direct link to 8.2.å°†know-systeméƒ¨ç½²åœ¨k8sä¸­">â€‹</a></h3><p><strong>1ï¼‰å‡†å¤‡é¡¹ç›®yamlæ–‡ä»¶</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.å‡†å¤‡deploymentèµ„æº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat nginx-depoly.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> harbor.jiangxl.com/project/nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data/code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data/nginx/conf/conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">configMap</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">configmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">persistentVolumeClaim</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">claimName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pvc</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">know</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.å‡†å¤‡configmapèµ„æº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat nginx-configmap.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">configmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">know.jiangxl.com.conf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      server_name know.jiangxl.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        root /data/code/know_system;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        index index.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.å‡†å¤‡svcèµ„æº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master1 know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># cat nginx-svc.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> know</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2ï¼‰åˆ›å»ºæ‰€æœ‰èµ„æº</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know-system]\# kubectl apply -f ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/nginx-configmap unchanged</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/know-system configured</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/nginx-service configured</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>3ï¼‰æŸ¥çœ‹é¡¹ç›®é¦–é¡µ</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/5c579af45d324e1c857e235d62ca72f1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="83å°†k8sèµ„æºæ–‡ä»¶æäº¤è‡³gitlab">8.3.å°†k8sèµ„æºæ–‡ä»¶æäº¤è‡³gitlab<a href="#83å°†k8sèµ„æºæ–‡ä»¶æäº¤è‡³gitlab" class="hash-link" aria-label="Direct link to 8.3.å°†k8sèµ„æºæ–‡ä»¶æäº¤è‡³gitlab" title="Direct link to 8.3.å°†k8sèµ„æºæ–‡ä»¶æäº¤è‡³gitlab">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.å°†éƒ¨ç½²æ–‡ä»¶å¤åˆ¶åˆ°ä»£ç ç›®å½•</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# mkdir deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# cp /root/k8s1.19/know-system/* deploy/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.ä¿®æ”¹deploymentèµ„æºä¸­çš„image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#å°†imageå¯¹åº”çš„é•œåƒæ”¹æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œpipelineæ›´æ–°æ—¶å¯ä»¥é€šè¿‡æ›´æ¢è¿™ä¸ªå­—ç¬¦ä¸²æŠŠæœ€æ–°çš„é•œåƒæ›¿æ¢åˆ°deploymentèµ„æºä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# vim deploy/nginx-depoly.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: {{updateimage}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.æäº¤è‡³gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# git add .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# git commit -m &quot;deploy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master1 know_system]\# git push origin master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="84ç¼–å†™jenkins-pipelineå°†é¡¹ç›®æ›´æ–°åˆ°k8s">8.4.ç¼–å†™Jenkins pipelineå°†é¡¹ç›®æ›´æ–°åˆ°k8s<a href="#84ç¼–å†™jenkins-pipelineå°†é¡¹ç›®æ›´æ–°åˆ°k8s" class="hash-link" aria-label="Direct link to 8.4.ç¼–å†™Jenkins pipelineå°†é¡¹ç›®æ›´æ–°åˆ°k8s" title="Direct link to 8.4.ç¼–å†™Jenkins pipelineå°†é¡¹ç›®æ›´æ–°åˆ°k8s">â€‹</a></h3><blockquote><p>å½“å‰pipelineè„šæœ¬ä¸»è¦æ˜¯æ›´æ–°ç”¨yamlæ–‡ä»¶åˆ›å»ºçš„é¡¹ç›®podç°</p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> label </span><span class="token string" style="color:#e3116c">&#x27;Jenkins-slave1-107&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">                //è®©è¯¥pipelineå§‹ç»ˆè¿è¡Œåœ¨Jenkins-slave1-107 Jenkins agentèŠ‚ç‚¹ä¸Šï¼Œå› ä¸ºè¿™ä¸ªèŠ‚ç‚¹æ‰€åœ¨çš„æœåŠ¡å™¨å¯ä»¥è¿è¡Œk8sé›†ç¾¤çš„dockerã€kubeletå‘½ä»¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                                   //environmentä¸»è¦ç”¨äºå®šä¹‰ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥æŠŠä¸€äº›å¸¸ç”¨åˆ°çš„å€¼åšæˆç¯å¢ƒå˜é‡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token assign-left variable" style="color:#36acaa">IMAGE_REPO</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;harbor.jiangxl.com/project&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parameters </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                               //å®šä¹‰å‚æ•°åŒ–æ„å»ºæµç¨‹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gitParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name: </span><span class="token string" style="color:#e3116c">&#x27;VERSION&#x27;</span><span class="token plain">,defaultValue: </span><span class="token string" style="color:#e3116c">&#x27;master&#x27;</span><span class="token plain">,type: </span><span class="token string" style="color:#e3116c">&#x27;BRANCH&#x27;</span><span class="token plain">,description: </span><span class="token string" style="color:#e3116c">&#x27;é€‰æ‹©è¦æ›´æ–°çš„åˆ†æ”¯&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             //å®šä¹‰ä¸€ä¸ªgitparamterså‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ï¼Œç”¨äºé€‰æ‹©æ›´æ–°çš„ä»£ç </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name: </span><span class="token string" style="color:#e3116c">&#x27;project&#x27;</span><span class="token plain">,defaultValue: </span><span class="token string" style="color:#e3116c">&#x27;know-system&#x27;</span><span class="token plain">,description: </span><span class="token string" style="color:#e3116c">&#x27;é¡¹ç›®åç§°&#x27;</span><span class="token plain">,trim: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                  //å®šä¹‰ä¸€ä¸ªç©ºç™½å­—ç¬¦ä¸²ï¼Œå£°æ˜é¡¹ç›®åç§°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                        //å®šä¹‰pipelineæ‰§è¡Œé˜¶æ®µ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;è¿ç»´ç¡®è®¤ä¿¡æ¯&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                                 //é˜¶æ®µ1ï¼Œä½¿ç”¨ä¸€ä¸ªäº¤äº’å¼ï¼Œè®©è¿è¡Œç¡®è®¤æ›´æ–°ä¿¡æ¯ï¼Œå¦‚æœæœ‰è¯¯å¯ç›´æ¥é€€å‡ºæ›´æ–°ï¼Œé¿å…æ›´æ–°é”™è¯¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                input message: </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                jobname: </span><span class="token variable" style="color:#36acaa">${project}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                branch: </span><span class="token variable" style="color:#36acaa">${VERSION}</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;, ok: </span><span class="token string" style="color:#e3116c">&quot;æ›´æ–°&quot;</span><span class="token plain">                       //äº¤äº’å¼è¾“å‡ºä¸€ä¸ªæ›´æ–°çš„é¡¹ç›®å’Œåˆ†æ”¯å·</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;æ‹‰å–é¡¹ç›®ä»£ç &#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                                  //é˜¶æ®µ2ï¼Œç”¨äºæ‹‰å–gitä¸Šå¯¹åº”çš„é¡¹ç›®ä»£ç </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        checkout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token variable" style="color:#36acaa">$class</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GitSCM&#x27;</span><span class="token plain">, branches: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name: </span><span class="token string" style="color:#e3116c">&#x27;$VERSION&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, extensions: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, userRemoteConfigs: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">credentialsId: </span><span class="token string" style="color:#e3116c">&#x27;gitlab-root&#x27;</span><span class="token plain">, url: </span><span class="token string" style="color:#e3116c">&#x27;http://192.168.16.106:30080/root/know_system.git&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;æ„å»ºé¡¹ç›®é•œåƒ&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                             //é˜¶æ®µ3.ç”¨äºå°†é¡¹ç›®ä»£ç æ›´æ–°åˆ°dockeråˆå§‹é•œåƒä¸­ï¼Œä¸»è¦æ­¥éª¤å°±æ˜¯ç”Ÿäº§ä¸€ä¸ªdockerfileï¼Œå°†ä»£ç å¤åˆ¶åˆ°é•œåƒä¸­ï¼Œæœ€åæ ¹æ®Dockerfileæ„å»ºå‡ºé•œåƒ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin class-name">pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">FROM harbor.jiangxl.com/project/nginx-project:v1-code</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">RUN mkdir /data/code/know_system</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">COPY  ./* /data/code/know_system/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EXPOSE 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;                             //ç¼–å†™ä¸€ä¸ªDockerfileï¼Œå®šä¹‰åˆå§‹é•œåƒï¼Œå¹¶å°†æ›´æ–°çš„ä»£ç å¤åˆ¶åˆ°å®¹å™¨çš„æŒ‡å®šè·¯å¾„</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;docker build -t ${IMAGE_REPO}/${project}:master-v${BUILD_ID} .&#x27;</span><span class="token plain">   //æœ€ç»ˆé•œåƒçš„åç§°å°±æ˜¯harbor.jiangxl.com/project/know-system:master-v1                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;æ¨é€é•œåƒåˆ°harborä»“åº“&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">             //é˜¶æ®µ4ï¼Œå°†æ„å»ºå¥½çš„é•œåƒæ¨é€è‡³harborä»“åº“ä¸­ï¼Œä¾¿äºk8sæ‹‰å–æ›´æ–°ç¨‹åº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;docker push ${IMAGE_REPO}/${project}:master-v${BUILD_ID}&#x27;</span><span class="token plain">   //æ¨é€é•œåƒåˆ°harborä»“åº“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;å°†é¡¹ç›®æ›´æ–°åˆ°k8s&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                     //é˜¶æ®µ5ï¼Œä¸»è¦æ˜¯æ›´æ–°k8sä¸­é¡¹ç›®ä½¿ç”¨çš„å®¹å™¨ï¼Œå°†æœ€æ–°æ„å»ºçš„é•œåƒæ›¿æ¢åˆ°é¡¹ç›®podä¸­ï¼Œç„¶åæ›´æ–°pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                                     //ä½¿ç”¨kubectlå‘½ä»¤æ›´æ–°é¡¹ç›®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sed -i &#x27;s#{{updateimage}}#</span><span class="token string variable" style="color:#36acaa">${IMAGE_REPO}</span><span class="token string" style="color:#e3116c">/</span><span class="token string variable" style="color:#36acaa">${project}</span><span class="token string" style="color:#e3116c">:master-v</span><span class="token string variable" style="color:#36acaa">${BUILD_ID}</span><span class="token string" style="color:#e3116c">#g&#x27; deploy/*&quot;</span><span class="token plain">       //å°†deploymentèµ„æºä¸­æˆ‘ä»¬å†™æ­»çš„é•œåƒç‰ˆæœ¬å­—ç¬¦ä¸²ï¼Œæ›¿æ¢æˆåˆšåˆšæ¨é€è‡³harborä»“åº“çš„é•œåƒç‰ˆæœ¬</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;kubectl apply -f deploy/&#x27;</span><span class="token plain">                   //å½“é•œåƒç‰ˆæœ¬æ›¿æ¢åï¼Œæ›´æ–°èµ„æºçš„yamlæ–‡ä»¶å³å¯å®Œæˆé¡¹ç›®æ›´æ–°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      success </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">       //æ„å»ºæˆåŠŸäº†å‘é€ä¸€ä¸ªæ„æˆæˆåŠŸçš„æ¶ˆæ¯åˆ°é’‰é’‰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;æ„å»ºæˆåŠŸï¼Œå‘é€æ¶ˆæ¯åˆ°é’‰é’‰&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://oapi.dingtalk.com/robot/send?access_token=6719ac958daf4f31114cb0c1289837c9aca45d111d8653b04c3d6ae164f25146&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">&#x27;{&quot;msgtype&quot;: &quot;text&quot;,&quot;text&quot;: {&quot;content&quot;:&quot;ğŸ˜„ğŸ‘æ„å»ºæˆåŠŸğŸ‘ğŸ˜„\n å…³é”®å­—ï¼šjenkins\n é¡¹ç›® åç§°: ${JOB_BASE_NAME}\n æ›´æ–°çš„åˆ†æ”¯å·: ${VERSION}\n æœ¬æ¬¡æ„å»ºçš„é•œåƒç‰ˆæœ¬ï¼š${IMAGE_REPO}/${project}:master-v${BUILD_ID}\n æ„å»ºåœ°å€ï¼š${RUN_DISPLAY_URL} &quot;}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      failure </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">       //æ„å»ºå¤±è´¥äº†å‘é€ä¸€ä¸ªæ„æˆæˆåŠŸçš„æ¶ˆæ¯åˆ°é’‰é’‰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;æ„å»ºå¤±è´¥ï¼Œå‘é€æ¶ˆæ¯åˆ°é’‰é’‰&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://oapi.dingtalk.com/robot/send?access_token=6719ac958daf4f31114cb0c1289837c9aca45d111d8653b04c3d6ae164f25146&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">&#x27;{&quot;msgtype&quot;: &quot;text&quot;,&quot;text&quot;: {&quot;content&quot;:&quot;ğŸ˜–âŒæ„å»ºå¤±è´¥âŒğŸ˜–\n å…³é”®å­—ï¼šjenkins\n é¡¹ç›® åç§°: ${JOB_BASE_NAME}\n æ›´æ–°çš„åˆ†æ”¯å·: ${VERSION}\n æœ¬æ¬¡æ„å»ºçš„é•œåƒç‰ˆæœ¬ï¼š${IMAGE_REPO}/${project}:master-v${BUILD_ID}\n æ„å»ºåœ°å€ï¼š${RUN_DISPLAY_URL} &quot;}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      always </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">          //æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½æ‰§è¡Œæ­¤æ­¥éª¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;æ„å»ºæµç¨‹ç»“æŸ&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="85å°†pipelineç²˜è´´åˆ°æµæ°´çº¿ä»»åŠ¡ä¸­">8.5.å°†pipelineç²˜è´´åˆ°æµæ°´çº¿ä»»åŠ¡ä¸­<a href="#85å°†pipelineç²˜è´´åˆ°æµæ°´çº¿ä»»åŠ¡ä¸­" class="hash-link" aria-label="Direct link to 8.5.å°†pipelineç²˜è´´åˆ°æµæ°´çº¿ä»»åŠ¡ä¸­" title="Direct link to 8.5.å°†pipelineç²˜è´´åˆ°æµæ°´çº¿ä»»åŠ¡ä¸­">â€‹</a></h3><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/6b567d43deb0474e8b57f717070c1e95.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="86æ„å»ºmasteråˆ†æ”¯å®Œæˆé¡¹ç›®æ›´æ–°">8.6.æ„å»ºmasteråˆ†æ”¯å®Œæˆé¡¹ç›®æ›´æ–°<a href="#86æ„å»ºmasteråˆ†æ”¯å®Œæˆé¡¹ç›®æ›´æ–°" class="hash-link" aria-label="Direct link to 8.6.æ„å»ºmasteråˆ†æ”¯å®Œæˆé¡¹ç›®æ›´æ–°" title="Direct link to 8.6.æ„å»ºmasteråˆ†æ”¯å®Œæˆé¡¹ç›®æ›´æ–°">â€‹</a></h3><p><strong>1ï¼‰é€‰æ‹©æ›´æ–°ä¿¡æ¯</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/cebe0301954b46e0a696ebe6e2d05e93.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>2ï¼‰è¿ç»´ç¡®è®¤ä¿¡æ¯</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/e14279c1a0824528a12931943441b2ab.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>3ï¼‰pipelineä»»åŠ¡æ›´æ–°æˆåŠŸ</strong></p><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/b322ccd2bf6e48f5a5609660bc537d55.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>4ï¼‰åœ¨blue oceanæŸ¥çœ‹æ­¤æ¬¡æ›´æ–°çš„é•œåƒç‰ˆæœ¬</strong>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/0e471501cd6c4617b630b6bebb53f41c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>5ï¼‰åœ¨rancherä¸Šè§‚å¯Ÿé¡¹ç›®æ˜¯å¦æ›´æ–°æˆæœ€æ–°çš„é•œåƒç‰ˆæœ¬</strong></p><p>æ›´æ–°æµç¨‹é¡ºåˆ©å®Œæˆï¼
<img loading="lazy" src="https://cdn.agou-ops.cn/others/b261c18ee6c646a2848342ae64dda144.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><blockquote><p>è¯¥æ–‡ç« ä¸ºè½¬è½½å†…å®¹ï¼Œä»…åšå¤‡ä»½ç§äººå­¦ä¹ ä½¿ç”¨ï¼ŒåŸæ–‡ï¼š<a href="https://jiangxl.blog.csdn.net/article/details/119828244" target="_blank" rel="noopener noreferrer">https://jiangxl.blog.csdn.net/article/details/119828244</a></p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/AGou-ops/myDocsv4/edit/main/docs/CloudNative/k8s/Kubernetes with Jenkins CICD.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/CloudNative/k8s/Kubernetes Yaml quicklystart"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Kubernetes YAML file quicklystart</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/CloudNative/k8s/Minikube Basic"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Minikube Basic</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#æ–‡ç« ç›®å½•" class="table-of-contents__link toc-highlight">æ–‡ç« ç›®å½•</a></li><li><a href="#1åŸºäºk8sé›†ç¾¤çš„jenkinsæŒç»­é›†æˆ" class="table-of-contents__link toc-highlight">1.åŸºäºk8sé›†ç¾¤çš„JenkinsæŒç»­é›†æˆ</a></li><li><a href="#2å°†jenkinséƒ¨ç½²åœ¨k8sé›†ç¾¤" class="table-of-contents__link toc-highlight">2.å°†Jenkinséƒ¨ç½²åœ¨k8sé›†ç¾¤</a><ul><li><a href="#21ç¼–å†™jenkins-namespaceæ–‡ä»¶" class="table-of-contents__link toc-highlight">2.1.ç¼–å†™Jenkins namespaceæ–‡ä»¶</a></li><li><a href="#22ç¼–å†™jenkins-rbacæˆæƒæ–‡ä»¶" class="table-of-contents__link toc-highlight">2.2.ç¼–å†™Jenkins rbacæˆæƒæ–‡ä»¶</a></li><li><a href="#23ç¼–å†™jenkins-statefulsetèµ„æºæ–‡ä»¶" class="table-of-contents__link toc-highlight">2.3.ç¼–å†™Jenkins statefulsetèµ„æºæ–‡ä»¶</a></li><li><a href="#24ç¼–å†™jenkins-storageclassèµ„æºæ–‡ä»¶" class="table-of-contents__link toc-highlight">2.4.ç¼–å†™Jenkins StorageClassèµ„æºæ–‡ä»¶</a></li><li><a href="#25ç¼–å†™jenkins-svcèµ„æºæ–‡ä»¶" class="table-of-contents__link toc-highlight">2.5.ç¼–å†™Jenkins svcèµ„æºæ–‡ä»¶</a></li><li><a href="#26å‡†å¤‡jenkinsé•œåƒå¹¶æ¨é€è‡³harbor" class="table-of-contents__link toc-highlight">2.6.å‡†å¤‡Jenkinsé•œåƒå¹¶æ¨é€è‡³harbor</a></li><li><a href="#27åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹èµ„æºçš„çŠ¶æ€" class="table-of-contents__link toc-highlight">2.7.åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹èµ„æºçš„çŠ¶æ€</a></li><li><a href="#28é¡µé¢å®‰è£…jenkins" class="table-of-contents__link toc-highlight">2.8.é¡µé¢å®‰è£…Jenkins</a></li><li><a href="#29ç™»é™†jenkins" class="table-of-contents__link toc-highlight">2.9.ç™»é™†Jenkins</a></li></ul></li><li><a href="#3ä½¿ç”¨dockeréƒ¨ç½²gitlab" class="table-of-contents__link toc-highlight">3.ä½¿ç”¨dockeréƒ¨ç½²gitlab</a><ul><li><a href="#31éƒ¨ç½²gitlab" class="table-of-contents__link toc-highlight">3.1.éƒ¨ç½²gitlab</a></li><li><a href="#32è®¿é—®gitlab" class="table-of-contents__link toc-highlight">3.2.è®¿é—®gitlab</a></li></ul></li><li><a href="#4å°†gitlabéƒ¨ç½²åœ¨k8sé›†ç¾¤" class="table-of-contents__link toc-highlight">4.å°†gitlabéƒ¨ç½²åœ¨k8sé›†ç¾¤</a><ul><li><a href="#41å°†gitlabé•œåƒæ¨é€è‡³harborä»“åº“" class="table-of-contents__link toc-highlight">4.1.å°†gitlabé•œåƒæ¨é€è‡³harborä»“åº“</a></li><li><a href="#42ä½¿ç”¨dockerè¿è¡ŒgitlabæŸ¥è¯¢ç”¨æˆ·çš„idå·" class="table-of-contents__link toc-highlight">4.2.ä½¿ç”¨dockerè¿è¡ŒgitlabæŸ¥è¯¢ç”¨æˆ·çš„idå·</a></li><li><a href="#43ç¼–å†™gitlab-storageclass-èµ„æºæ–‡ä»¶" class="table-of-contents__link toc-highlight">4.3.ç¼–å†™gitlab StorageClass èµ„æºæ–‡ä»¶</a></li><li><a href="#44ç¼–å†™gitlab-statefulset-èµ„æºæ–‡ä»¶" class="table-of-contents__link toc-highlight">4.4.ç¼–å†™gitlab statefulset èµ„æºæ–‡ä»¶</a></li><li><a href="#45ç¼–å†™gitlab-service-èµ„æºæ–‡ä»¶" class="table-of-contents__link toc-highlight">4.5.ç¼–å†™gitlab service èµ„æºæ–‡ä»¶</a></li><li><a href="#46åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹çŠ¶æ€" class="table-of-contents__link toc-highlight">4.6.åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶æŸ¥çœ‹çŠ¶æ€</a></li><li><a href="#47ä¿®æ”¹gitlabé…ç½®" class="table-of-contents__link toc-highlight">4.7.ä¿®æ”¹gitlabé…ç½®</a></li><li><a href="#48è®¿é—®gitlab" class="table-of-contents__link toc-highlight">4.8.è®¿é—®gitlab</a></li></ul></li><li><a href="#5æäº¤ç¨‹åºä»£ç åˆ°gitlabä¸Š" class="table-of-contents__link toc-highlight">5.æäº¤ç¨‹åºä»£ç åˆ°gitlabä¸Š</a><ul><li><a href="#51æ–°å»ºä¸€ä¸ªé¡¹ç›®" class="table-of-contents__link toc-highlight">5.1.æ–°å»ºä¸€ä¸ªé¡¹ç›®</a></li><li><a href="#52å°†ç¨‹åºä»£ç æäº¤åˆ°gitlab" class="table-of-contents__link toc-highlight">5.2.å°†ç¨‹åºä»£ç æäº¤åˆ°gitlab</a></li></ul></li><li><a href="#6jenkinsé›†æˆgitlab" class="table-of-contents__link toc-highlight">6.Jenkinsé›†æˆgitlab</a><ul><li><a href="#61åœ¨jenkinsä¸Šå®‰è£…gitlabæ’ä»¶" class="table-of-contents__link toc-highlight">6.1.åœ¨Jenkinsä¸Šå®‰è£…gitlabæ’ä»¶</a></li><li><a href="#62åœ¨gitlabä¸Šç”Ÿæˆtoken" class="table-of-contents__link toc-highlight">6.2.åœ¨gitlabä¸Šç”Ÿæˆtoken</a></li><li><a href="#63åœ¨jenkinsæ·»åŠ gitlab-api-token" class="table-of-contents__link toc-highlight">6.3.åœ¨Jenkinsæ·»åŠ gitlab api token</a></li></ul></li><li><a href="#7jenkinsåˆ†å¸ƒå¼master-slaveæ¨¡å¼" class="table-of-contents__link toc-highlight">7.Jenkinsåˆ†å¸ƒå¼master-slaveæ¨¡å¼</a><ul><li><a href="#71æ–°å¢jenkinsèŠ‚ç‚¹" class="table-of-contents__link toc-highlight">7.1.æ–°å¢JenkinsèŠ‚ç‚¹</a></li><li><a href="#72æ–°å»ºä¸€ä¸ªä»»åŠ¡è¿è¡Œåœ¨slave1èŠ‚ç‚¹ä¸Š" class="table-of-contents__link toc-highlight">7.2.æ–°å»ºä¸€ä¸ªä»»åŠ¡è¿è¡Œåœ¨slave1èŠ‚ç‚¹ä¸Š</a></li><li><a href="#73è§‚å¯ŸèŠ‚ç‚¹å…³è”çš„æ‰§è¡Œä»»åŠ¡" class="table-of-contents__link toc-highlight">7.3.è§‚å¯ŸèŠ‚ç‚¹å…³è”çš„æ‰§è¡Œä»»åŠ¡</a></li></ul></li><li><a href="#8ä½¿ç”¨pipelineæµæ°´çº¿å°†know-systemé¡¹ç›®æ›´æ–°åˆ°kubernetesç¯å¢ƒ" class="table-of-contents__link toc-highlight">8.ä½¿ç”¨pipelineæµæ°´çº¿å°†know-systemé¡¹ç›®æ›´æ–°åˆ°kubernetesç¯å¢ƒ</a><ul><li><a href="#81å®ç°æ€è·¯" class="table-of-contents__link toc-highlight">8.1.å®ç°æ€è·¯</a></li><li><a href="#82å°†know-systeméƒ¨ç½²åœ¨k8sä¸­" class="table-of-contents__link toc-highlight">8.2.å°†know-systeméƒ¨ç½²åœ¨k8sä¸­</a></li><li><a href="#83å°†k8sèµ„æºæ–‡ä»¶æäº¤è‡³gitlab" class="table-of-contents__link toc-highlight">8.3.å°†k8sèµ„æºæ–‡ä»¶æäº¤è‡³gitlab</a></li><li><a href="#84ç¼–å†™jenkins-pipelineå°†é¡¹ç›®æ›´æ–°åˆ°k8s" class="table-of-contents__link toc-highlight">8.4.ç¼–å†™Jenkins pipelineå°†é¡¹ç›®æ›´æ–°åˆ°k8s</a></li><li><a href="#85å°†pipelineç²˜è´´åˆ°æµæ°´çº¿ä»»åŠ¡ä¸­" class="table-of-contents__link toc-highlight">8.5.å°†pipelineç²˜è´´åˆ°æµæ°´çº¿ä»»åŠ¡ä¸­</a></li><li><a href="#86æ„å»ºmasteråˆ†æ”¯å®Œæˆé¡¹ç›®æ›´æ–°" class="table-of-contents__link toc-highlight">8.6.æ„å»ºmasteråˆ†æ”¯å®Œæˆé¡¹ç›®æ›´æ–°</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs Releases</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 1.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 2.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 3.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv4" target="_blank" rel="noopener noreferrer" class="footer__link-item">â­ï¸Version 4.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">â­ï¸æˆ‘çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 AGou-ops' Documetation v4.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d3f82a4d.js"></script>
<script src="/assets/js/main.7273c711.js"></script>
</body>
</html>