<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-CloudNative/k8s/Prometheus-Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Prometheus+Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤ | AGou&#x27;s Docsv4</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.agou-ops.cn/docs/CloudNative/k8s/Prometheus-Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Prometheus+Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤ | AGou&#x27;s Docsv4"><meta data-rh="true" name="description" content="æ–‡ç« ç›®å½•"><meta data-rh="true" property="og:description" content="æ–‡ç« ç›®å½•"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Prometheus-Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Prometheus-Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Prometheus-Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-KQED41RW95","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.916b7a43.css">
<link rel="preload" href="/assets/js/runtime~main.b04b912f.js" as="script">
<link rel="preload" href="/assets/js/main.4851b47f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">AGou&#x27;s Docsv4</b></a><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">âœ¨ æˆ‘çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"> ğŸ“– ç›®å½•</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs">ğŸŒ² ç›®å½•æ ‘</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/category/äº‘åŸç”Ÿç›¸å…³">â˜ï¸ äº‘åŸç”Ÿç›¸å…³</a></li><li><a class="dropdown__link" href="/docs/category/linuxåŸºç¡€">ğŸ˜Š LinuxåŸºç¡€</a></li><li><a class="dropdown__link" href="/docs/category/ç¼–ç¨‹è¯­è¨€">â™¨ï¸ ç¼–ç¨‹è¯­è¨€</a></li><li><a class="dropdown__link" href="/docs/category/è„šæœ¬ç›¸å…³">ğŸ•¹ï¸ è„šæœ¬ç›¸å…³</a></li><li><a class="dropdown__link" href="/docs/category/é¢è¯•ç›¸å…³">ğŸ‘¨â€âš–ï¸ é¢è¯•ç›¸å…³</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ç‰ˆæœ¬</a><ul class="dropdown__menu"><li><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver1.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver2.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver3.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub ä»“åº“"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"><b>AGou&#x27;s Docsv4</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/äº‘åŸç”Ÿç›¸å…³">äº‘åŸç”Ÿç›¸å…³</a><button aria-label="Toggle the collapsible sidebar category &#x27;äº‘åŸç”Ÿç›¸å…³&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cicd">CICD</a><button aria-label="Toggle the collapsible sidebar category &#x27;CICD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cloudcomptering">CloudComptering</a><button aria-label="Toggle the collapsible sidebar category &#x27;CloudComptering&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/docker">Docker</a><button aria-label="Toggle the collapsible sidebar category &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elfk">ELFK</a><button aria-label="Toggle the collapsible sidebar category &#x27;ELFK&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/prometheus">Prometheus</a><button aria-label="Toggle the collapsible sidebar category &#x27;Prometheus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/k8s">k8s</a><button aria-label="Toggle the collapsible sidebar category &#x27;k8s&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/helm">Helm</a><button aria-label="Toggle the collapsible sidebar category &#x27;Helm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/installation">Installation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/quicklystart">Quicklystart</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quicklystart&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</a><button aria-label="Toggle the collapsible sidebar category &#x27;å®æˆ˜æ¡ˆä¾‹&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubeadm å¿«é€Ÿéƒ¨ç½²k8sé›†ç¾¤">Kubeadm å¿«é€Ÿéƒ¨ç½²k8sé›†ç¾¤</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes REST API">Kubernetes REST API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes Yaml quicklystart">Kubernetes YAML file quicklystart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes with Jenkins CICD">åŸºäºkuberneteså¹³å°çš„CICDæŒç»­é›†æˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Minikube Basic">Minikube Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/CloudNative/k8s/Prometheus-Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤">Prometheus+Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Remote access k8s">kubectlè¿œç¨‹è¿æ¥k8s</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k3d">k3d</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s command">Kubernetes CLI command -- kubectl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s å›¾è§£å¤§å…¨">k8så›¾è§£å¤§å…¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s ç½‘ç»œç›¸å…³">k8s ç½‘ç»œç›¸å…³</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8sæ¦‚å¿µåŠåŸç†ç›¸å…³">k8s æ¦‚å¿µåŠåŸç†ç›¸å…³</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/kompose Basic">Kompose Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/kubenetesè¿œç¨‹è°ƒè¯•å·¥å…·">kubenetesè¿œç¨‹è°ƒè¯•å·¥å…·</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Consul å…¥é—¨">Consul å…¥é—¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Dubbo Basic">Dubbo Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Grafana Loki Basic">Grafana Loki</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Istio Basic">Istio Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/">CloudNative.</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/äº‘åŸç”Ÿç›¸å…³"><span itemprop="name">äº‘åŸç”Ÿç›¸å…³</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/k8s"><span itemprop="name">k8s</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Prometheus+Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Prometheus+Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤</h1><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æ–‡ç« ç›®å½•">æ–‡ç« ç›®å½•<a href="#æ–‡ç« ç›®å½•" class="hash-link" aria-label="Direct link to æ–‡ç« ç›®å½•" title="Direct link to æ–‡ç« ç›®å½•">â€‹</a></h3><p>[toc]</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1k8sç›‘æ§æŒ‡æ ‡">1.k8sç›‘æ§æŒ‡æ ‡<a href="#1k8sç›‘æ§æŒ‡æ ‡" class="hash-link" aria-label="Direct link to 1.k8sç›‘æ§æŒ‡æ ‡" title="Direct link to 1.k8sç›‘æ§æŒ‡æ ‡">â€‹</a></h2><p><strong>kubernetesæœ¬èº«ç›‘æ§</strong></p><ul><li>Nodeèµ„æºåˆ©ç”¨ç‡</li><li>Nodeæ•°é‡</li><li>Podsæ•°é‡</li><li>èµ„æºå¯¹è±¡çŠ¶æ€</li></ul><p><strong>Podç›‘æ§</strong></p><ul><li>podæ•°é‡</li><li>å®¹å™¨èµ„æºåˆ©ç”¨ç‡</li><li>åº”ç”¨ç¨‹åº</li></ul><p><strong>å®ç°æ€è·¯</strong></p><ul><li>podæ€§èƒ½<ul><li>ä½¿ç”¨cadvisorè¿›è¡Œå®ç°ï¼Œç›‘æ§å®¹å™¨çš„CPUã€å†…å­˜åˆ©ç”¨ç‡</li></ul></li><li>Nodeæ€§èƒ½<ul><li>ä½¿ç”¨node-exporterå®ç°ï¼Œä¸»è¦ç›‘æ§èŠ‚ç‚¹CPUã€å†…å­˜åˆ©ç”¨ç‡</li></ul></li><li>K8Sèµ„æºå¯¹è±¡<ul><li>ä½¿ç”¨kube-state-metricså®ç°ï¼Œä¸»è¦ç”¨äºç›‘æ§podã€deploymentã€service</li></ul></li></ul><p>k8sæœåŠ¡å‘ç°å‚è€ƒæ–‡æ¡£ï¼š <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config" target="_blank" rel="noopener noreferrer">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config</a></p><p>æœ¬æ–‡å°†ä¼šå®ç°k8så…¨æ–¹ä½ç›‘æ§ï¼Œå¹¶é…åˆgrafanaå±•ç¤ºk8sèµ„æºå¯¹è±¡çš„ä½¿ç”¨çŠ¶æ€ï¼Œä»¥åŠé…åˆalertmanagerå‘Šè­¦</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2k8såŸºç¡€ç¯å¢ƒå‡†å¤‡">2.k8såŸºç¡€ç¯å¢ƒå‡†å¤‡<a href="#2k8såŸºç¡€ç¯å¢ƒå‡†å¤‡" class="hash-link" aria-label="Direct link to 2.k8såŸºç¡€ç¯å¢ƒå‡†å¤‡" title="Direct link to 2.k8såŸºç¡€ç¯å¢ƒå‡†å¤‡">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21ç¯å¢ƒå‡†å¤‡">2.1.ç¯å¢ƒå‡†å¤‡<a href="#21ç¯å¢ƒå‡†å¤‡" class="hash-link" aria-label="Direct link to 2.1.ç¯å¢ƒå‡†å¤‡" title="Direct link to 2.1.ç¯å¢ƒå‡†å¤‡">â€‹</a></h3><table><thead><tr><th>IP</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>192.168.16.106</td><td>k8s-master</td></tr><tr><td>192.168.16.104</td><td>k8s-node1</td></tr><tr><td>192.168.16.107</td><td>k8s-node2</td></tr><tr><td>192.168.16.105</td><td>nfs</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22éƒ¨ç½²nfsä½œä¸ºprometheuså­˜å‚¨">2.2.éƒ¨ç½²nfsä½œä¸ºprometheuså­˜å‚¨<a href="#22éƒ¨ç½²nfsä½œä¸ºprometheuså­˜å‚¨" class="hash-link" aria-label="Direct link to 2.2.éƒ¨ç½²nfsä½œä¸ºprometheuså­˜å‚¨" title="Direct link to 2.2.éƒ¨ç½²nfsä½œä¸ºprometheuså­˜å‚¨">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs ~]\# mkdir /data/prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs ~]\# yum -y install nfs-utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs ~]\# vim /etc/exports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/data/prometheus   192.168.16.0/24(rw,sync,no_root_squash)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs ~]\# systemctl restart nfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs ~]\# showmount -e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Export list for nfs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/data/prometheus 192.168.16.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs ~]\# chomd -R 777 /data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23è·å–prometheus-yamlæ–‡ä»¶">2.3.è·å–prometheus yamlæ–‡ä»¶<a href="#23è·å–prometheus-yamlæ–‡ä»¶" class="hash-link" aria-label="Direct link to 2.3.è·å–prometheus yamlæ–‡ä»¶" title="Direct link to 2.3.è·å–prometheus yamlæ–‡ä»¶">â€‹</a></h3><blockquote><p>åœ¨è¿™é‡Œä¸‹è½½</p><p><a href="https://github.com/kubernetes/kubernetes/tree/release-1.16/cluster/addons/prometheus" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/kubernetes/tree/release-1.16/cluster/addons/prometheus</a></p><p>ç›´æ¥å…‹éš†å®Œæ•´ç›®å½•ä¹Ÿå¯ä»¥</p><p><a href="https://github.com/kubernetes/kubernetes.git" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/kubernetes.git</a></p><p>âš ï¸ä¿®æ”¹ï¼š<a href="https://gitlab.com/AGou-ops/k8s_prometheus_yaml.git" target="_blank" rel="noopener noreferrer">https://gitlab.com/AGou-ops/k8s_prometheus_yaml.git</a></p><p>prometheusåœ¨githubçš„k8sç›®å½•ä¸­masteråˆ†æ”¯å·²ç»æ‰¾ä¸åˆ°äº†ï¼Œå¯ä»¥åœ¨release-1.16è¿™é‡Œæ‰¾åˆ°</p></blockquote><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.æ‹‰å–prometheus yamlæ–‡ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s]\# git clone https://github.com/kubernetes/kubernetes.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.å°†prometheus yamlæ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–ç›®å½•</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s]\# cp -rp kubernetes/cluster/addons/prometheus/ . </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>æœ¬äººçš„yamlæ–‡ä»¶</strong></p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106165528931.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>å®˜æ–¹yamlæ–‡ä»¶</strong></p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106165536705.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>æ–‡ä»¶è¯´æ˜</strong></p><p>ä¸»è¦åˆ†ä¸ºå››éƒ¨åˆ†ï¼šprometheuséƒ¨ç½²ã€alertmanageréƒ¨ç½²ã€kube-state-metricséƒ¨ç½²ã€node-exporteréƒ¨ç½²</p><table><thead><tr><th>æ–‡ä»¶å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>alertmanager-configmap.yaml</td><td>alertmanageré…ç½®é›†åˆçš„yamlæ–‡ä»¶</td></tr><tr><td>alertmanager-deployment.yaml</td><td>alertmanageråˆ›å»ºpodçš„yamlæ–‡ä»¶</td></tr><tr><td>alertmanager-pvc.yaml</td><td>alertmanageræŒ‚è½½å­˜å‚¨å·çš„yamlæ–‡ä»¶</td></tr><tr><td>alertmanager-service.yaml</td><td>alertmanagerå¯¹å¤–æš´éœ²ç«¯å£çš„yamlæ–‡ä»¶</td></tr><tr><td>grafana_pv_pvc.yaml</td><td>grafanaæŒ‚è½½å­˜å‚¨å·çš„yamlæ–‡ä»¶</td></tr><tr><td>grafana_statefulset.yaml</td><td>grafanaå‘å¸ƒpodçš„yamlæ–‡ä»¶ï¼Œé‡‡ç”¨statefulsetèµ„æº</td></tr><tr><td>grafana_svc.yaml</td><td>grafanaå¯¹å¤–æš´éœ²ç«¯å£çš„yamlæ–‡ä»¶</td></tr><tr><td>install_node_exportes.sh</td><td>æ‰¹é‡åœ¨nodeèŠ‚ç‚¹å®‰è£…node_exporterçš„è„šæœ¬</td></tr><tr><td>k8s_time.yaml</td><td>k8såŒæ­¥å®¿ä¸»æœºæ—¶é—´çš„yamlæ–‡ä»¶</td></tr><tr><td>kube-state-metrics-deployment.yaml</td><td>k8sé‡‡é›†èµ„æºçŠ¶æ€æŒ‡æ ‡ç¨‹åºçš„yamlæ–‡ä»¶</td></tr><tr><td>kube-state-metrics-rbac.yaml</td><td>8sé‡‡é›†ç¨‹åºæˆæƒçš„yamlæ–‡ä»¶</td></tr><tr><td>kube-state-metrics-service.yaml</td><td>k8sé‡‡é›†ç¨‹åºå¯¹å¤–æš´éœ²çš„yamlæ–‡ä»¶</td></tr><tr><td>node-exporter-ds.yml</td><td>node_exporteréƒ¨ç½²çš„yamlæ–‡ä»¶</td></tr><tr><td>node-exporter-service.yaml</td><td>node_exporterå¯¹å¤–æš´éœ²çš„yamlæ–‡ä»¶</td></tr><tr><td>prometheus-configmap.yaml</td><td>prometheusçš„é…ç½®æ–‡ä»¶é›†</td></tr><tr><td>prometheus-pv-pvc.yaml</td><td>prometheusæŒ‚è½½å­˜å‚¨çš„yamlæ–‡ä»¶</td></tr><tr><td>prometheus-rbac.yaml</td><td>prometheusæˆæƒè®¿é—®apiçš„yamlæ–‡ä»¶</td></tr><tr><td>prometheus-rules-pvc.yaml</td><td>prometheuså‘Šè­¦è§„åˆ™å­˜å‚¨å·çš„yamlæ–‡ä»¶</td></tr><tr><td>prometheus-rules.yaml</td><td>prometheuså°†ruleåšæˆcmèµ„æºçš„yamlæ–‡ä»¶</td></tr><tr><td>prometheus-service.yaml</td><td>prometheuså¯¹å¤–æä¾›è®¿é—®çš„yamlæ–‡ä»¶</td></tr><tr><td>prometheus-statefulset-static-pv.yaml</td><td>prometheusç¨‹åºéƒ¨ç½²çš„yamlæ–‡ä»¶</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="24åˆ›å»ºå‘½åç©ºé—´prometheus">2.4.åˆ›å»ºå‘½åç©ºé—´prometheus<a href="#24åˆ›å»ºå‘½åç©ºé—´prometheus" class="hash-link" aria-label="Direct link to 2.4.åˆ›å»ºå‘½åç©ºé—´prometheus" title="Direct link to 2.4.åˆ›å»ºå‘½åç©ºé—´prometheus">â€‹</a></h3><p>åˆ›å»ºä¸€ä¸ªnsä¸ºprometheusï¼Œå°†é™¤äº†kube-state-metricså¤–çš„yamlä¸­çš„namespaceä¿®æ”¹ä¸ºprometheus</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.åˆ›å»ºns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus]\# kubectl create namespace prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace/prometheus created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.ä¿®æ”¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ç”¨vimæ‰“å¼€è¾“å…¥ä»¥ä¸‹å‘½ä»¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:%s/namespace: kube-system/namespace: prometheus/g</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3åœ¨k8sä¸­éƒ¨ç½²prometheus">3.åœ¨k8sä¸­éƒ¨ç½²prometheus<a href="#3åœ¨k8sä¸­éƒ¨ç½²prometheus" class="hash-link" aria-label="Direct link to 3.åœ¨k8sä¸­éƒ¨ç½²prometheus" title="Direct link to 3.åœ¨k8sä¸­éƒ¨ç½²prometheus">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31prometheus-yamlå‡†å¤‡">3.1.prometheus-yamlå‡†å¤‡<a href="#31prometheus-yamlå‡†å¤‡" class="hash-link" aria-label="Direct link to 3.1.prometheus-yamlå‡†å¤‡" title="Direct link to 3.1.prometheus-yamlå‡†å¤‡">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ä¸»è¦ç”¨åˆ°ä»¥ä¸‹å‡ ä¸ªyaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus]\# ls prometheus-*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus-configmap.yaml  prometheus-rbac.yaml  prometheus-service.yaml  prometheus-statefulset.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åˆ›å»ºé¡ºåº</p><blockquote><p>å…ˆåˆ›å»ºprometheus-rbac.yaml</p><p>åœ¨åˆ›å»ºprometheus-configmap.yaml</p><p>åœ¨åˆ›å»ºprometheus-statefulset.yaml</p><p>æœ€ååˆ›å»ºprometheus-service.yaml</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32åˆ›å»ºrbacèµ„æº">3.2.åˆ›å»ºrbacèµ„æº<a href="#32åˆ›å»ºrbacèµ„æº" class="hash-link" aria-label="Direct link to 3.2.åˆ›å»ºrbacèµ„æº" title="Direct link to 3.2.åˆ›å»ºrbacèµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus]\# kubectl create -f prometheus-rbac.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/prometheus created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io/prometheus created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/prometheus created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="33åˆ›å»ºconfigmapèµ„æº">3.3.åˆ›å»ºconfigmapèµ„æº<a href="#33åˆ›å»ºconfigmapèµ„æº" class="hash-link" aria-label="Direct link to 3.3.åˆ›å»ºconfigmapèµ„æº" title="Direct link to 3.3.åˆ›å»ºconfigmapèµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus]\# kubectl create -f prometheus-configmap.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/prometheus-config created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="34åˆ›å»ºstatefulsetèµ„æº">3.4.åˆ›å»ºstatefulsetèµ„æº<a href="#34åˆ›å»ºstatefulsetèµ„æº" class="hash-link" aria-label="Direct link to 3.4.åˆ›å»ºstatefulsetèµ„æº" title="Direct link to 3.4.åˆ›å»ºstatefulsetèµ„æº">â€‹</a></h3><p>githubä¸Šçš„statefulsetèµ„æºä½¿ç”¨çš„æ˜¯storageclaseeåŠ¨æ€åˆ›å»ºpvï¼Œç”±äºä¸ä¼šä½¿ç”¨storageclassï¼Œå› æ­¤å°†statefulsetèµ„æºè¿›è¡Œæ”¹é€ ï¼Œä½¿ç”¨é™æ€pvåšå­˜å‚¨</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="341æ”¹é€ statefulstèµ„æºæ”¯æŒé™æ€pv">3.4.1.æ”¹é€ statefulstèµ„æºæ”¯æŒé™æ€pv<a href="#341æ”¹é€ statefulstèµ„æºæ”¯æŒé™æ€pv" class="hash-link" aria-label="Direct link to 3.4.1.æ”¹é€ statefulstèµ„æºæ”¯æŒé™æ€pv" title="Direct link to 3.4.1.æ”¹é€ statefulstèµ„æºæ”¯æŒé™æ€pv">â€‹</a></h4><p>æ”¹é€ æ€è·¯ï¼šåœ¨yamlä¸­å¢åŠ pvã€pvcçš„é…ç½®ï¼Œåœ¨å°†åŸæ¥çš„storageclassé…ç½®é¡¹åˆ é™¤ï¼Œåœ¨120è¡Œçš„volumeä¸­å¢åŠ pvcçš„é…ç½®å³å¯</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master ~/k8s/prometheus</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim prometheus-statefulset-static-pv.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 16Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PersistentVolume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pv</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">capacity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 16Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nfs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data/prometheus/prometheus_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.16.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">k8s-app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/cluster-service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">addonmanager.kubernetes.io/mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Reconcile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2.2.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;prometheus&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">podManagementPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Parallel&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RollingUpdate&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">k8s-app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">k8s-app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">priorityClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> system</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cluster</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">critical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">serviceAccountName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">initContainers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;init-chown-data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;busybox:latest&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;IfNotPresent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;chown&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-R&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;65534:65534&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/data&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">subPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">configmap</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jimmidyson/configmap-reload:v0.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;IfNotPresent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dir=/etc/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">webhook</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">url=http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9090/</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">/reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;prom/prometheus:v2.23.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;IfNotPresent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config.file=/etc/config/prometheus.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage.tsdb.path=/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">web.console.libraries=/etc/prometheus/console_libraries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">web.console.templates=/etc/prometheus/consoles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">web.enable</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lifecycle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">readinessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">httpGet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">/ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">timeoutSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">httpGet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">/healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">timeoutSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># based on 10 running nodes with 30 pods each</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 200m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1000Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 200m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1000Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">subPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">terminationGracePeriodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">configMap</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">persistentVolumeClaim</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">claimName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="342åˆ›å»ºstatefulsetèµ„æº">3.4.2.åˆ›å»ºstatefulsetèµ„æº<a href="#342åˆ›å»ºstatefulsetèµ„æº" class="hash-link" aria-label="Direct link to 3.4.2.åˆ›å»ºstatefulsetèµ„æº" title="Direct link to 3.4.2.åˆ›å»ºstatefulsetèµ„æº">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus]\# kubectl create -f  prometheus-statefulset-static-pv.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolumeclaim/prometheus-data created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolume/pv-prometheus created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/prometheus created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="35åˆ›å»ºserviceèµ„æº">3.5.åˆ›å»ºserviceèµ„æº<a href="#35åˆ›å»ºserviceèµ„æº" class="hash-link" aria-label="Direct link to 3.5.åˆ›å»ºserviceèµ„æº" title="Direct link to 3.5.åˆ›å»ºserviceèµ„æº">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="351ä¿®æ”¹serviceèµ„æºæ”¯æŒnodeport">3.5.1.ä¿®æ”¹serviceèµ„æºæ”¯æŒnodeport<a href="#351ä¿®æ”¹serviceèµ„æºæ”¯æŒnodeport" class="hash-link" aria-label="Direct link to 3.5.1.ä¿®æ”¹serviceèµ„æºæ”¯æŒnodeport" title="Direct link to 3.5.1.ä¿®æ”¹serviceèµ„æºæ”¯æŒnodeport">â€‹</a></h4><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master ~/k8s/prometheus</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim prometheus-service.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Prometheus&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/cluster-service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">addonmanager.kubernetes.io/mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Reconcile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">k8s-app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="352åˆ›å»ºserviceèµ„æº">3.5.2.åˆ›å»ºserviceèµ„æº<a href="#352åˆ›å»ºserviceèµ„æº" class="hash-link" aria-label="Direct link to 3.5.2.åˆ›å»ºserviceèµ„æº" title="Direct link to 3.5.2.åˆ›å»ºserviceèµ„æº">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus]\# kubectl create -f prometheus-service.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/prometheus created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="36æŸ¥çœ‹åˆ›å»ºçš„prometheusæ‰€æœ‰èµ„æºç±»å‹">3.6.æŸ¥çœ‹åˆ›å»ºçš„prometheusæ‰€æœ‰èµ„æºç±»å‹<a href="#36æŸ¥çœ‹åˆ›å»ºçš„prometheusæ‰€æœ‰èµ„æºç±»å‹" class="hash-link" aria-label="Direct link to 3.6.æŸ¥çœ‹åˆ›å»ºçš„prometheusæ‰€æœ‰èµ„æºç±»å‹" title="Direct link to 3.6.æŸ¥çœ‹åˆ›å»ºçš„prometheusæ‰€æœ‰èµ„æºç±»å‹">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus]\# kubectl get pod,svc,pv,pvc -n prometheus -o wide</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106171837694.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>ä¸»è¦è®¿é—®30387ç«¯å£çœ‹åˆ°prometheus</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="37è®¿é—®prometheus">3.7.è®¿é—®prometheus<a href="#37è®¿é—®prometheus" class="hash-link" aria-label="Direct link to 3.7.è®¿é—®prometheus" title="Direct link to 3.7.è®¿é—®prometheus">â€‹</a></h3><p>ä½¿ç”¨ä»»æ„nodeèŠ‚ç‚¹çš„ipåŠ 30387ç«¯å£å³å¯è®¿é—®ï¼š<a href="http://192.168.16.106:30387/" target="_blank" rel="noopener noreferrer">http://192.168.16.106:30387/</a></p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106171846551.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>æŸ¥çœ‹ç›‘æ§ä¸»æœº</p><p>å¯ä»¥çœ‹åˆ°å·²ç»æœ‰å¾ˆå¤šäº†ï¼Œè¿™äº›é…ç½®éƒ½æ˜¯configmapèµ„æºä¸­é…ç½®çš„
<img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106171854253.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="38prometheusé…ç½®æ–‡ä»¶è§£é‡Š">3.8.prometheusé…ç½®æ–‡ä»¶è§£é‡Š<a href="#38prometheusé…ç½®æ–‡ä»¶è§£é‡Š" class="hash-link" aria-label="Direct link to 3.8.prometheusé…ç½®æ–‡ä»¶è§£é‡Š" title="Direct link to 3.8.prometheusé…ç½®æ–‡ä»¶è§£é‡Š">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="381è¿›å…¥prometheuså®¹å™¨">3.8.1.è¿›å…¥prometheuså®¹å™¨<a href="#381è¿›å…¥prometheuså®¹å™¨" class="hash-link" aria-label="Direct link to 3.8.1.è¿›å…¥prometheuså®¹å™¨" title="Direct link to 3.8.1.è¿›å…¥prometheuså®¹å™¨">â€‹</a></h4><p>è¯­æ³•ï¼škubectl exec -it podå è¿›å…¥çš„ç¯å¢ƒ -c å®¹å™¨åç§° -n å‘½åç©ºé—´</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus]\# kubectl exec -it prometheus-0 sh -c prometheus-server -n prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/prometheus $ </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é…ç½®æ–‡ä»¶ä½äº:/etc/config/prometheus.yml</p><p>tsdbå­˜å‚¨ä½äº:/data</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="382é…ç½®æ–‡ä»¶è§£é‡Š">3.8.2.é…ç½®æ–‡ä»¶è§£é‡Š<a href="#382é…ç½®æ–‡ä»¶è§£é‡Š" class="hash-link" aria-label="Direct link to 3.8.2.é…ç½®æ–‡ä»¶è§£é‡Š" title="Direct link to 3.8.2.é…ç½®æ–‡ä»¶è§£é‡Š">â€‹</a></h4><p>/prometheus $ more /etc/config/prometheus.yml</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">scrape_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">static_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">é™æ€é…ç½®ï¼Œå°†æœ¬æœºåŠ åˆ°äº†prometheusç›‘æ§ï¼Œè¿™ä¸ªlocalhostå°±æ˜¯è¿è¡Œprometheuså®¹å™¨çš„åœ°å€</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>kubernetes-apiserversè‡ªåŠ¨å‘ç°</strong></p><p>å°†apiserverçš„åœ°å€è¿›è¡Œæš´éœ²å¹¶è·å–ç›‘æ§æŒ‡æ ‡</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">apiservers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kubernetes_sd_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">relabel_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default;kubernetes;https</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_service_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_endpoint_port_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scheme</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tls_config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ca_file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">insecure_skip_verify</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">bearer_token_file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/run/secrets/kubernetes.io/serviceaccount/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106171909965.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>k8sçš„nodeèŠ‚ç‚¹è‡ªåŠ¨å‘ç°</strong></p><p>è‡ªåŠ¨å‘ç°k8sä¸­çš„æ‰€æœ‰nodeèŠ‚ç‚¹å¹¶è¿›è¡Œç›‘æ§</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- job_name: kubernetes-nodes-cadvisor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubernetes_sd_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - role: node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  relabel_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - action: labelmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    regex: __meta_kubernetes_node_label_(.+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - target_label: __metrics_path__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replacement: /metrics/cadvisor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scheme: https</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tls_config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insecure_skip_verify: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106171919584.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>å‘ç°endpointçš„èµ„æº</strong></p><p>ä¸»è¦æ˜¯å‘ç°endpointèµ„æºç±»å‹çš„podï¼Œå¯ä»¥é€šè¿‡kubectl get epæŸ¥çœ‹è°æ˜¯endpointèµ„æº</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kubernetes_sd_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">relabel_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_service_annotation_prometheus_io_scrape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> (https</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_service_annotation_prometheus_io_scheme</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> __scheme__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> (.+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_service_annotation_prometheus_io_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> __metrics_path__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> (</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">^</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+)(</span><span class="token punctuation" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">\d+)</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">;(\d+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replacement</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __address__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_service_annotation_prometheus_io_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> __address__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> labelmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> __meta_kubernetes_service_label_(.+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes_namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_service_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106171929948.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>å‘ç°services</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kubernetes_sd_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metrics_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /probe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">module</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> http_2xx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">relabel_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_service_annotation_prometheus_io_probe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __address__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> __param_target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">replacement</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> blackbox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> __address__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __param_target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> labelmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> __meta_kubernetes_service_label_(.+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes_namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">source_labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __meta_kubernetes_service_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>å‘ç°pod</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- job_name: kubernetes-pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubernetes_sd_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - role: pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  relabel_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - action: keep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    regex: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - __meta_kubernetes_pod_annotation_prometheus_io_scrape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - action: replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    regex: (.+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - __meta_kubernetes_pod_annotation_prometheus_io_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_label: __metrics_path__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - action: replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    regex: ([^:]+)(?::\d+)?;(\d+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replacement: $1:$2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - __address__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - __meta_kubernetes_pod_annotation_prometheus_io_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_label: __address__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - action: labelmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    regex: __meta_kubernetes_pod_label_(.+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - action: replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - __meta_kubernetes_namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_label: kubernetes_namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - action: replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - __meta_kubernetes_pod_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_label: kubernetes_pod_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="39k8s-metricsé¡µé¢">3.9.k8s metricsé¡µé¢<a href="#39k8s-metricsé¡µé¢" class="hash-link" aria-label="Direct link to 3.9.k8s metricsé¡µé¢" title="Direct link to 3.9.k8s metricsé¡µé¢">â€‹</a></h3><p>metricsé¡µé¢è®¿é—®å¦‚ä¸‹ä¹Ÿæ²¡å…³ç³»ï¼Œmetricsè²Œä¼¼åªèƒ½é›†ç¾¤å†…éƒ¨è¿›è¡Œè®¿é—®</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106171942988.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>åªè¦èƒ½åœ¨prometheusæœç´¢åˆ°containeræ•°æ®å°±å¯ä»¥</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106171951255.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4åœ¨k8sä¸­éƒ¨ç½²grafana">4.åœ¨k8sä¸­éƒ¨ç½²grafana<a href="#4åœ¨k8sä¸­éƒ¨ç½²grafana" class="hash-link" aria-label="Direct link to 4.åœ¨k8sä¸­éƒ¨ç½²grafana" title="Direct link to 4.åœ¨k8sä¸­éƒ¨ç½²grafana">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41ç¼–å†™granfana-pv-pvcèµ„æº">4.1.ç¼–å†™granfana-pv-pvcèµ„æº<a href="#41ç¼–å†™granfana-pv-pvcèµ„æº" class="hash-link" aria-label="Direct link to 4.1.ç¼–å†™granfana-pv-pvcèµ„æº" title="Direct link to 4.1.ç¼–å†™granfana-pv-pvcèµ„æº">â€‹</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.ç¼–å†™èµ„æº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master ~/k8s/prometheus3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim grafana_pv_pvc.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grafana</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ui</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grafana</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 3Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PersistentVolume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pv</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">grafana</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ui</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grafana</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">capacity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 3Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nfs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data/prometheus/grafana</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.16.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.åœ¨nfsä¸Šåˆ›å»ºå¯¹åº”çš„æŒ‚è½½ç‚¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@nfs ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># mkdir /data/prometheus/grafana</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42ç¼–å†™granfana-statefulsetèµ„æº">4.2.ç¼–å†™granfana-statefulsetèµ„æº<a href="#42ç¼–å†™granfana-statefulsetèµ„æº" class="hash-link" aria-label="Direct link to 4.2.ç¼–å†™granfana-statefulsetèµ„æº" title="Direct link to 4.2.ç¼–å†™granfana-statefulsetèµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# vim grafana_statefulset.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: grafana-ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: grafana-ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceName: &quot;grafana-ui&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: grafana-ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: grafana-ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: grafana-ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: grafana/grafana:6.6.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imagePullPolicy: &quot;IfNotPresent&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - containerPort: 3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          limits:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cpu: 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            memory: 256Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cpu: 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            memory: 256Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - name: grafana-ui-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mountPath: /var/lib/grafana</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            subPath: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      securityContext:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fsGroup: 472</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runAsUser: 472</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: grafana-ui-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            claimName: grafana-ui-data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43ç¼–å†™granfana-svcèµ„æº">4.3.ç¼–å†™granfana-svcèµ„æº<a href="#43ç¼–å†™granfana-svcèµ„æº" class="hash-link" aria-label="Direct link to 4.3.ç¼–å†™granfana-svcèµ„æº" title="Direct link to 4.3.ç¼–å†™granfana-svcèµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# vim grafana_svc.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: grafana-ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: grafana-ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      port: 3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      targetPort: 3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app: grafana-ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="44k8såˆ›å»ºgrafana">4.4.k8såˆ›å»ºgrafana<a href="#44k8såˆ›å»ºgrafana" class="hash-link" aria-label="Direct link to 4.4.k8såˆ›å»ºgrafana" title="Direct link to 4.4.k8såˆ›å»ºgrafana">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create -f grafana_pv_pvc.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolumeclaim &quot;grafana-ui-data&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolume &quot;pv-grafana-ui-data&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create -f prometheus-statefulset-static-pv.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolumeclaim/prometheus-data created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolume/pv-prometheus created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/prometheus created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create -f grafana_svc.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/grafana-ui created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="45æŸ¥çœ‹èµ„æºè¿è¡ŒçŠ¶æ€">4.5.æŸ¥çœ‹èµ„æºè¿è¡ŒçŠ¶æ€<a href="#45æŸ¥çœ‹èµ„æºè¿è¡ŒçŠ¶æ€" class="hash-link" aria-label="Direct link to 4.5.æŸ¥çœ‹èµ„æºè¿è¡ŒçŠ¶æ€" title="Direct link to 4.5.æŸ¥çœ‹èµ„æºè¿è¡ŒçŠ¶æ€">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl get pv,pvc,pod,statefulset,svc -n grafana-ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                  CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS        CLAIM                         STORAGECLASS   REASON   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolume/pv-grafana-ui-data   3Gi        RWO            Retain           Terminating   grafana-ui/grafana-ui-data                            151m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolume/pv-prometheus        16Gi       RWO            Retain           Bound         kube-system/prometheus-data                           47m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                    STATUS        VOLUME               CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolumeclaim/grafana-ui-data   Terminating   pv-grafana-ui-data   3Gi        RWO                           151m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME               READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/grafana-ui-0   1/1     Running   0          16m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                          READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps/grafana-ui   1/1     16m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                 TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/grafana-ui   NodePort   10.96.170.142   &lt;none&gt;        3000:32040/TCP   85m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172010434.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="46ç™»é™†grafana">4.6.ç™»é™†grafana<a href="#46ç™»é™†grafana" class="hash-link" aria-label="Direct link to 4.6.ç™»é™†grafana" title="Direct link to 4.6.ç™»é™†grafana">â€‹</a></h3><p>è®¿é—®ï¼šé›†ç¾¤ä»»æ„ipå’Œ32040ç«¯å£å³å¯è®¿é—®</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172018940.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="47å¯¼å…¥k8sèµ„æºç›‘æ§podèµ„æºæ¨¡æ¿">4.7.å¯¼å…¥k8sèµ„æºç›‘æ§podèµ„æºæ¨¡æ¿<a href="#47å¯¼å…¥k8sèµ„æºç›‘æ§podèµ„æºæ¨¡æ¿" class="hash-link" aria-label="Direct link to 4.7.å¯¼å…¥k8sèµ„æºç›‘æ§podèµ„æºæ¨¡æ¿" title="Direct link to 4.7.å¯¼å…¥k8sèµ„æºç›‘æ§podèµ„æºæ¨¡æ¿">â€‹</a></h3><p>æ¨èæ¨¡æ¿ï¼š</p><ul><li>é›†ç¾¤èµ„æºç›‘æ§ï¼š3119</li><li>èµ„æºçŠ¶æ€ç›‘æ§ï¼š6417</li><li>nodeç›‘æ§ï¼š9276</li></ul><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172028210.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>å¯¼å…¥æˆåŠŸ</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172037255.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="48è§£å†³æ¨¡æ¿è¡¨è¾¾å¼é—®é¢˜æ— æ³•å±•ç°æ‰€æœ‰pod">4.8.è§£å†³æ¨¡æ¿è¡¨è¾¾å¼é—®é¢˜æ— æ³•å±•ç°æ‰€æœ‰pod<a href="#48è§£å†³æ¨¡æ¿è¡¨è¾¾å¼é—®é¢˜æ— æ³•å±•ç°æ‰€æœ‰pod" class="hash-link" aria-label="Direct link to 4.8.è§£å†³æ¨¡æ¿è¡¨è¾¾å¼é—®é¢˜æ— æ³•å±•ç°æ‰€æœ‰pod" title="Direct link to 4.8.è§£å†³æ¨¡æ¿è¡¨è¾¾å¼é—®é¢˜æ— æ³•å±•ç°æ‰€æœ‰pod">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="481é—®é¢˜æè¿°">4.8.1.é—®é¢˜æè¿°<a href="#481é—®é¢˜æè¿°" class="hash-link" aria-label="Direct link to 4.8.1.é—®é¢˜æè¿°" title="Direct link to 4.8.1.é—®é¢˜æè¿°">â€‹</a></h4><p>æ¨¡æ¿ä¸­çš„å›¾å½¢å…³äºpodå’Œdockerçš„å…¨éƒ¨æœ‰é—®é¢˜ï¼Œä»…å•å•æ˜¾ç¤ºä¸€ä¸ªpod</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172046186.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="482é—®é¢˜è§£å†³">4.8.2.é—®é¢˜è§£å†³<a href="#482é—®é¢˜è§£å†³" class="hash-link" aria-label="Direct link to 4.8.2.é—®é¢˜è§£å†³" title="Direct link to 4.8.2.é—®é¢˜è§£å†³">â€‹</a></h4><p>ä¿®æ”¹ä»–ä»¬çš„è¡¨è¾¾å¼å°±å¯ä»¥äº†ï¼Œå°†pod_nameä¿®æ”¹ä¸ºpod</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172056945.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>ä¿®æ”¹ä¸ºç«‹é©¬æ˜¾ç¤ºå‡ºæ‰€æœ‰podï¼Œæ‰€æœ‰å…³äºpodå’Œdockerçš„éƒ½æ˜¯è¿™ä¹ˆæ”¹</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172106157.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>æœ€ç»ˆå±•ç¤ºæ•ˆæœ</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172114765.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5ç›‘æ§k8s-nodeèŠ‚ç‚¹">5.ç›‘æ§k8s nodeèŠ‚ç‚¹<a href="#5ç›‘æ§k8s-nodeèŠ‚ç‚¹" class="hash-link" aria-label="Direct link to 5.ç›‘æ§k8s nodeèŠ‚ç‚¹" title="Direct link to 5.ç›‘æ§k8s nodeèŠ‚ç‚¹">â€‹</a></h2><p>å¯¹äºnodeèŠ‚ç‚¹çš„ç›‘æ§æˆ‘ä»¬ä¸ç”¨éƒ¨ç½²åœ¨k8sé‡Œï¼Œç›´æ¥åœ¨æ¯å°nodeæœºå™¨ä¸Šå®‰è£…node_exporterå³å¯</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51ç¼–å†™ä¸€é”®éƒ¨ç½²node_exporterè„šæœ¬">5.1.ç¼–å†™ä¸€é”®éƒ¨ç½²node_exporterè„šæœ¬<a href="#51ç¼–å†™ä¸€é”®éƒ¨ç½²node_exporterè„šæœ¬" class="hash-link" aria-label="Direct link to 5.1.ç¼–å†™ä¸€é”®éƒ¨ç½²node_exporterè„šæœ¬" title="Direct link to 5.1.ç¼–å†™ä¸€é”®éƒ¨ç½²node_exporterè„šæœ¬">â€‹</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s-master ~/k8s/prometheus3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"># </span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> install_node_exportes.sh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#æ‰¹é‡å®‰è£…node_exporter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">soft_dir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/root/soft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> -e </span><span class="token variable" style="color:#36acaa">$soft_dir</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$soft_dir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">netstat</span><span class="token plain"> -lnpt </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$?</span><span class="token plain"> -eq </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token assign-left variable" style="color:#36acaa">use</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">netstat</span><span class="token variable" style="color:#36acaa"> -lnpt </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">9100</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F/ </span><span class="token variable string" style="color:#e3116c">&#x27;{print $NF}&#x27;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;9100ç«¯å£å·²ç»è¢«å ç”¨ï¼Œå ç”¨è€…æ˜¯ </span><span class="token string variable" style="color:#36acaa">$use</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$soft_dir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> http://192.168.16.106:888/prometheus/node_exporter-1.0.1.linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xf node_exporter-1.0.1.linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> node_exporter-1.0.1.linux-amd64 /usr/local/node_exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34">/usr/lib/systemd/system/node_exporter.service</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Description=https://prometheus.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Restart=on-failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStart=/usr/local/node_exporter/node_exporter --collector.systemd --collector.systemd.unit-whitelist=(docker|kubelet|node_exporter).service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">WantedBy=multi-user.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> node_exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart node_exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">netstat</span><span class="token plain"> -lnpt </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$?</span><span class="token plain"> -eq </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ehoc </span><span class="token string" style="color:#e3116c">&quot;node_eporter install finish...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52å¯¹k8sçš„nodeè¿›è¡Œæ‰§è¡Œnode_exporterè„šæœ¬">5.2.å¯¹k8sçš„nodeè¿›è¡Œæ‰§è¡Œnode_exporterè„šæœ¬<a href="#52å¯¹k8sçš„nodeè¿›è¡Œæ‰§è¡Œnode_exporterè„šæœ¬" class="hash-link" aria-label="Direct link to 5.2.å¯¹k8sçš„nodeè¿›è¡Œæ‰§è¡Œnode_exporterè„šæœ¬" title="Direct link to 5.2.å¯¹k8sçš„nodeè¿›è¡Œæ‰§è¡Œnode_exporterè„šæœ¬">â€‹</a></h3><p>åœ¨è¿™é‡Œä¸‹è½½è„šæœ¬ç”¨å°±è¡Œäº†</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172136934.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node1 ~]\# wget http://192.168.16.106:888/install_node_exportes.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node1 ~]\# sh install_node_exportes.sh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node1 ~]\#  netstat -lnpt | grep 9100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp6       0      0 :::9100                 :::*                    LISTEN      14906/node_exporter </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="53åœ¨prometheusçš„configmapèµ„æºä¸­å¢åŠ nodeèŠ‚ç‚¹é…ç½®">5.3.åœ¨prometheusçš„configmapèµ„æºä¸­å¢åŠ nodeèŠ‚ç‚¹é…ç½®<a href="#53åœ¨prometheusçš„configmapèµ„æºä¸­å¢åŠ nodeèŠ‚ç‚¹é…ç½®" class="hash-link" aria-label="Direct link to 5.3.åœ¨prometheusçš„configmapèµ„æºä¸­å¢åŠ nodeèŠ‚ç‚¹é…ç½®" title="Direct link to 5.3.åœ¨prometheusçš„configmapèµ„æºä¸­å¢åŠ nodeèŠ‚ç‚¹é…ç½®">â€‹</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master ~/k8s/prometheus3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">\</span><span class="token comment" style="color:#999988;font-style:italic"># vim prometheus-configmap.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> k8s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">static_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 192.168.16.104</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 192.168.16.107</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172150508.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>æ›´æ–°é…ç½®</strong></p><p>æ›´æ–°å®Œé…ç½®ï¼Œprometheusé¡µé¢ä¼šç«‹é©¬æ˜¾ç¤ºï¼Œå› æ­¤æ¯å½“configmapä¸€ä¿®æ”¹ï¼Œprometheuså®¹å™¨å°±ä¼šé‡è½½</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl apply -f prometheus-configmap.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/prometheus-config created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆåŠŸæ·»åŠ nodeç›‘æ§</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172200609.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="54å¯¼å…¥k8s-nodeä¸»æœºç›‘æ§æ¨¡æ¿">5.4.å¯¼å…¥k8s nodeä¸»æœºç›‘æ§æ¨¡æ¿<a href="#54å¯¼å…¥k8s-nodeä¸»æœºç›‘æ§æ¨¡æ¿" class="hash-link" aria-label="Direct link to 5.4.å¯¼å…¥k8s nodeä¸»æœºç›‘æ§æ¨¡æ¿" title="Direct link to 5.4.å¯¼å…¥k8s nodeä¸»æœºç›‘æ§æ¨¡æ¿">â€‹</a></h3><p>nodeç›‘æ§ï¼š9276</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172210569.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>å¡«å†™ä¿¡æ¯</strong></p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172219328.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q">
<strong>æŸ¥çœ‹å›¾å½¢</strong>
<img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172235454.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6k8sä½¿ç”¨kube-state-metrics-ç›‘æ§èµ„æºçŠ¶æ€">6.k8sä½¿ç”¨kube-state-metrics-ç›‘æ§èµ„æºçŠ¶æ€<a href="#6k8sä½¿ç”¨kube-state-metrics-ç›‘æ§èµ„æºçŠ¶æ€" class="hash-link" aria-label="Direct link to 6.k8sä½¿ç”¨kube-state-metrics-ç›‘æ§èµ„æºçŠ¶æ€" title="Direct link to 6.k8sä½¿ç”¨kube-state-metrics-ç›‘æ§èµ„æºçŠ¶æ€">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61åˆ›å»ºrbacèµ„æº">6.1.åˆ›å»ºrbacèµ„æº<a href="#61åˆ›å»ºrbacèµ„æº" class="hash-link" aria-label="Direct link to 6.1.åˆ›å»ºrbacèµ„æº" title="Direct link to 6.1.åˆ›å»ºrbacèµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create kube-state-metrics-rbac.yaml </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62åˆ›å»ºdeploymentèµ„æº">6.2.åˆ›å»ºdeploymentèµ„æº<a href="#62åˆ›å»ºdeploymentèµ„æº" class="hash-link" aria-label="Direct link to 6.2.åˆ›å»ºdeploymentèµ„æº" title="Direct link to 6.2.åˆ›å»ºdeploymentèµ„æº">â€‹</a></h3><p>deploymentèµ„æºé‡Œé¢ç»“åˆäº†configmapèµ„æº</p><p>éœ€è¦æŠŠé•œåƒçš„åœ°å€ä¿®æ”¹æˆlizhenliang/kube-state-metrics:v1.8.0ã€lizhenliang/addon-resizer:1.8.6</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create -f kube-state-metrics-deployment.yaml </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172259875.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="63åˆ›å»ºserviceèµ„æº">6.3.åˆ›å»ºserviceèµ„æº<a href="#63åˆ›å»ºserviceèµ„æº" class="hash-link" aria-label="Direct link to 6.3.åˆ›å»ºserviceèµ„æº" title="Direct link to 6.3.åˆ›å»ºserviceèµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create -f kube-state-metrics-service.yaml </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="64èµ„æºå‡†å¤‡å°±ç»ª">6.4.èµ„æºå‡†å¤‡å°±ç»ª<a href="#64èµ„æºå‡†å¤‡å°±ç»ª" class="hash-link" aria-label="Direct link to 6.4.èµ„æºå‡†å¤‡å°±ç»ª" title="Direct link to 6.4.èµ„æºå‡†å¤‡å°±ç»ª">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl get all -n kube-system | grep kube-state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172316131.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="65åœ¨prometheusæŸ¥çœ‹æ˜¯å¦è·å–ç›‘æ§æŒ‡æ ‡">6.5.åœ¨prometheusæŸ¥çœ‹æ˜¯å¦è·å–ç›‘æ§æŒ‡æ ‡<a href="#65åœ¨prometheusæŸ¥çœ‹æ˜¯å¦è·å–ç›‘æ§æŒ‡æ ‡" class="hash-link" aria-label="Direct link to 6.5.åœ¨prometheusæŸ¥çœ‹æ˜¯å¦è·å–ç›‘æ§æŒ‡æ ‡" title="Direct link to 6.5.åœ¨prometheusæŸ¥çœ‹æ˜¯å¦è·å–ç›‘æ§æŒ‡æ ‡">â€‹</a></h3><p>å®‰è£…å®Œkube-state-metricsä¹‹åï¼Œç›´æ¥å°±å¯ä»¥åœ¨prometheusä¸ŠæŸ¥è¯¢ç›‘æ§æŒ‡æ ‡ï¼Œéƒ½æ˜¯ä»¥kubeå¼€å¤´çš„</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172326163.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="66å¯¼å…¥k8s-èµ„æºçŠ¶æ€æ¨¡æ¿">6.6.å¯¼å…¥k8s èµ„æºçŠ¶æ€æ¨¡æ¿<a href="#66å¯¼å…¥k8s-èµ„æºçŠ¶æ€æ¨¡æ¿" class="hash-link" aria-label="Direct link to 6.6.å¯¼å…¥k8s èµ„æºçŠ¶æ€æ¨¡æ¿" title="Direct link to 6.6.å¯¼å…¥k8s èµ„æºçŠ¶æ€æ¨¡æ¿">â€‹</a></h3><p>èµ„æºçŠ¶æ€ç›‘æ§ï¼š6417</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/2021010617233747.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>æŸ¥çœ‹å›¾å½¢ï¼Œä¹Ÿæ˜¯æœ‰å¾ˆå¤šç›‘æ§ä¸åˆ°</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172345276.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7åœ¨k8sä¸­éƒ¨ç½²alertmanagerå®ç°å‘Šè­¦ç³»ç»Ÿ">7.åœ¨k8sä¸­éƒ¨ç½²alertmanagerå®ç°å‘Šè­¦ç³»ç»Ÿ<a href="#7åœ¨k8sä¸­éƒ¨ç½²alertmanagerå®ç°å‘Šè­¦ç³»ç»Ÿ" class="hash-link" aria-label="Direct link to 7.åœ¨k8sä¸­éƒ¨ç½²alertmanagerå®ç°å‘Šè­¦ç³»ç»Ÿ" title="Direct link to 7.åœ¨k8sä¸­éƒ¨ç½²alertmanagerå®ç°å‘Šè­¦ç³»ç»Ÿ">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="71åˆ›å»ºalertmanager-pv-pvcèµ„æº">7.1.åˆ›å»ºalertmanager-pv-pvcèµ„æº<a href="#71åˆ›å»ºalertmanager-pv-pvcèµ„æº" class="hash-link" aria-label="Direct link to 7.1.åˆ›å»ºalertmanager-pv-pvcèµ„æº" title="Direct link to 7.1.åˆ›å»ºalertmanager-pv-pvcèµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.ç¼–å†™yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# vim alertmanager-pvc.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: alertmanager-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: alertmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes.io/cluster-service: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addonmanager.kubernetes.io/mode: EnsureExists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accessModes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      storage: &quot;2Gi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PersistentVolume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: pv-alertmanager-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: alertmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  capacity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage: 2Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accessModes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nfs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path: /data/prometheus/alertmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: 192.168.16.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.åˆ›å»º</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create -f alertmanager-pvc.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolumeclaim/alertmanager created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolume/pv-alertmanager-data create</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="72åˆ›å»ºalertmanager-cmèµ„æºå¢åŠ å¾®ä¿¡å‘Šè­¦é…ç½®">7.2.åˆ›å»ºalertmanager-cmèµ„æºå¢åŠ å¾®ä¿¡å‘Šè­¦é…ç½®<a href="#72åˆ›å»ºalertmanager-cmèµ„æºå¢åŠ å¾®ä¿¡å‘Šè­¦é…ç½®" class="hash-link" aria-label="Direct link to 7.2.åˆ›å»ºalertmanager-cmèµ„æºå¢åŠ å¾®ä¿¡å‘Šè­¦é…ç½®" title="Direct link to 7.2.åˆ›å»ºalertmanager-cmèµ„æºå¢åŠ å¾®ä¿¡å‘Šè­¦é…ç½®">â€‹</a></h3><p>å¢åŠ å¾®ä¿¡æŠ¥è­¦</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.å¢åŠ å¾®ä¿¡å‘Šè­¦é…ç½®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# vim alertmanager-configmap.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: alertmanager-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: alertmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes.io/cluster-service: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addonmanager.kubernetes.io/mode: EnsureExists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  alertmanager.yml: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    global:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resolve_timeout: 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    receivers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: &#x27;wechat&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wechat_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - corp_id: &#x27;ww48f74fc8ed3a07ba&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          to_party: &#x27;1&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          agent_id: &#x27;1000003&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          api_secret: &#x27;j3ocaGJJM7KejlqzBIJ38b6D6t9QhqlIAh7k4fA1cT0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          send_resolved: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    route:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      group_interval: 1m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      group_wait: 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      receiver: wechat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      repeat_interval: 1m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.åˆ›å»ºèµ„æº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create -f alertmanager-configmap.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/alertmanager-config created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="73åˆ›å»ºalertmanager-deploymentèµ„æº">7.3.åˆ›å»ºalertmanager-deploymentèµ„æº<a href="#73åˆ›å»ºalertmanager-deploymentèµ„æº" class="hash-link" aria-label="Direct link to 7.3.åˆ›å»ºalertmanager-deploymentèµ„æº" title="Direct link to 7.3.åˆ›å»ºalertmanager-deploymentèµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create -f alertmanager-deployment.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/alertmanager created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="74åˆ›å»ºalertmanager-serviceèµ„æº">7.4.åˆ›å»ºalertmanager-serviceèµ„æº<a href="#74åˆ›å»ºalertmanager-serviceèµ„æº" class="hash-link" aria-label="Direct link to 7.4.åˆ›å»ºalertmanager-serviceèµ„æº" title="Direct link to 7.4.åˆ›å»ºalertmanager-serviceèµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create -f alertmanager-service.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/alertmanager created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="75æŸ¥çœ‹alertmanageræ‰€æœ‰èµ„æº">7.5æŸ¥çœ‹alertmanageræ‰€æœ‰èµ„æº<a href="#75æŸ¥çœ‹alertmanageræ‰€æœ‰èµ„æº" class="hash-link" aria-label="Direct link to 7.5æŸ¥çœ‹alertmanageræ‰€æœ‰èµ„æº" title="Direct link to 7.5æŸ¥çœ‹alertmanageræ‰€æœ‰èµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl get all,pv,pvc,cm -n alertmanager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172401946.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="76è®¿é—®alertmanager">7.6.è®¿é—®alertmanager<a href="#76è®¿é—®alertmanager" class="hash-link" aria-label="Direct link to 7.6.è®¿é—®alertmanager" title="Direct link to 7.6.è®¿é—®alertmanager">â€‹</a></h3><p>ä»»æ„nodeèŠ‚ç‚¹+31831ç«¯å£å³å¯</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172410897.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p>é…ç½®æ–‡ä»¶å·²ç»æ”¯æŒå¾®ä¿¡æŠ¥è­¦</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172419513.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8é…ç½®alertmanagerå®ç°k8så‘Šè­¦ç³»ç»Ÿ">8.é…ç½®alertmanagerå®ç°k8så‘Šè­¦ç³»ç»Ÿ<a href="#8é…ç½®alertmanagerå®ç°k8så‘Šè­¦ç³»ç»Ÿ" class="hash-link" aria-label="Direct link to 8.é…ç½®alertmanagerå®ç°k8så‘Šè­¦ç³»ç»Ÿ" title="Direct link to 8.é…ç½®alertmanagerå®ç°k8så‘Šè­¦ç³»ç»Ÿ">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="81åœ¨nfsä¸Šå‡†å¤‡ä¸¤ä¸ªå‘Šè­¦è§„åˆ™æ–‡ä»¶">8.1.åœ¨NFSä¸Šå‡†å¤‡ä¸¤ä¸ªå‘Šè­¦è§„åˆ™æ–‡ä»¶<a href="#81åœ¨nfsä¸Šå‡†å¤‡ä¸¤ä¸ªå‘Šè­¦è§„åˆ™æ–‡ä»¶" class="hash-link" aria-label="Direct link to 8.1.åœ¨NFSä¸Šå‡†å¤‡ä¸¤ä¸ªå‘Šè­¦è§„åˆ™æ–‡ä»¶" title="Direct link to 8.1.åœ¨NFSä¸Šå‡†å¤‡ä¸¤ä¸ªå‘Šè­¦è§„åˆ™æ–‡ä»¶">â€‹</a></h3><p>æˆ‘ä»¬å¯¹äºå‘Šè­¦è§„åˆ™æ–‡ä»¶ä¸é‡‡ç”¨configmapçš„æ–¹å¼è€Œæ˜¯é‡‡ç”¨pvã€pvcçš„æ–¹å¼æŠŠå‘Šè­¦è§„åˆ™æŒ‚è½½åˆ°å®¹å™¨é‡Œ</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.åœ¨nfsä¸Šåˆ›å»ºpvå­˜å‚¨è·¯å¾„</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs ~]\# mkdir /data/prometheus/rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs ~]\# chmod -R 777 /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs ~]\# cd /data/prometheus/rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.å‡†å¤‡ä¸»æœºå®•æœºçš„å‘Šè­¦è§„åˆ™æ–‡ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs rules]\# vim hostdown.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- name: general.rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - alert: ä¸»æœºå®•æœº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expr: up == 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for: 1m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serverity: error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      summary: &quot;ä¸»æœº {{ $labels.instance }} åœæ­¢å·¥ä½œ&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description: &quot;{{ $labels.instance }} job {{ $labels.job }} å·²ç»å®•æœº5åˆ†é’Ÿä»¥ä¸Š!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.å‡†å¤‡ä¸»æœºåŸºç¡€ç›‘æ§å‘Šè­¦è§„åˆ™æ–‡ä»¶      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@nfs rules]\# vim node.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- name: node.rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - alert: NodeFilessystemUsage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expr: 100 - (node_filesystem_free_bytes{fstype=~&quot;ext4|xfs&quot;,mountpoint=&quot;/&quot;} / node_filesystem_size_bytes{fstype=~&quot;ext4|xfs&quot;,mountpoint=&quot;/&quot;} *100) &gt; 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for: 1m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serverity: warning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      summary: &quot;ä¸»æœº {{ $labels.instance }} : {{ $labels.mountpoint }} ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description: &quot;{{ $labels.instance }} : {{ $labels.mountpoint }} ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡80% (å½“å‰å€¼: {{ $value }}) &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - alert: NodeMemoryUsage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expr: 100 - ((node_memory_MemFree_bytes+node_memory_Cached_bytes+node_memory_Buffers_bytes) / node_memory_MemTotal_bytes * 100) &gt; 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for: 1m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serverity: warning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      summary: &quot;ä¸»æœº {{ $labels.instance }} å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description: &quot;{{ $labels.instance }} å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80% (å½“å‰å€¼: {{ $value }}) &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - alert: NodeCpuUsage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expr: 100 - (avg(irate(node_cpu_seconds_total{mode=&#x27;idle&#x27;}[5m])) by (instance) *100) &gt; 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for: 1m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serverity: warning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      summary: &quot;ä¸»æœº {{ $labels.instance }} CPUä½¿ç”¨ç‡è¿‡é«˜&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description: &quot;{{ $labels.instance }} CPUä½¿ç”¨ç‡è¶…è¿‡80% (å½“å‰å€¼: {{ $value }}) &quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="82ç¼–å†™ruleså‘Šè­¦è§„åˆ™çš„pvpvcyamlæ–‡ä»¶">8.2.ç¼–å†™ruleså‘Šè­¦è§„åˆ™çš„pvã€pvcyamlæ–‡ä»¶<a href="#82ç¼–å†™ruleså‘Šè­¦è§„åˆ™çš„pvpvcyamlæ–‡ä»¶" class="hash-link" aria-label="Direct link to 8.2.ç¼–å†™ruleså‘Šè­¦è§„åˆ™çš„pvã€pvcyamlæ–‡ä»¶" title="Direct link to 8.2.ç¼–å†™ruleså‘Šè­¦è§„åˆ™çš„pvã€pvcyamlæ–‡ä»¶">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.ç¼–å†™èµ„æºæ–‡ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# vim prometheus-rules-pvc.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: prometheus-rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accessModes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      storage: &quot;2Gi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PersistentVolume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: pv-prometheus-rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  capacity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage: 2Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accessModes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nfs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path: /data/prometheus/rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: 192.168.16.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.åˆ›å»ºèµ„æº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl create -f prometheus-rules-pvc.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolumeclaim/prometheus-rules created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolume/pv-prometheus-rules created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="83ä¿®æ”¹prometheusçš„statefulsetèµ„æºé›†æˆrules">8.3.ä¿®æ”¹prometheusçš„statefulsetèµ„æºé›†æˆrules<a href="#83ä¿®æ”¹prometheusçš„statefulsetèµ„æºé›†æˆrules" class="hash-link" aria-label="Direct link to 8.3.ä¿®æ”¹prometheusçš„statefulsetèµ„æºé›†æˆrules" title="Direct link to 8.3.ä¿®æ”¹prometheusçš„statefulsetèµ„æºé›†æˆrules">â€‹</a></h3><p>åœ¨prometheusçš„statefulsetèµ„æºä¸­å¢åŠ rulesçš„pvcæŒ‚è½½è·¯å¾„</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# vim prometheus-statefulset-static-pv.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - name: config-volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              mountPath: /etc/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - name: prometheus-rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              mountPath: /etc/config/rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - name: prometheus-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              mountPath: /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              subPath: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      terminationGracePeriodSeconds: 300</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: config-volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          configMap:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name: prometheus-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: prometheus-rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            claimName: prometheus-rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: prometheus-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            claimName: prometheus-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172451817.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="84æ›´æ–°prometheus-statefulsetèµ„æº">8.4.æ›´æ–°prometheus-statefulsetèµ„æº<a href="#84æ›´æ–°prometheus-statefulsetèµ„æº" class="hash-link" aria-label="Direct link to 8.4.æ›´æ–°prometheus-statefulsetèµ„æº" title="Direct link to 8.4.æ›´æ–°prometheus-statefulsetèµ„æº">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl apply -f prometheus-statefulset-static-pv.yaml </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="85ä¿®æ”¹prometheus-configmapèµ„æºé…ç½®alertmanageråœ°å€">8.5.ä¿®æ”¹prometheus-configmapèµ„æºé…ç½®alertmanageråœ°å€<a href="#85ä¿®æ”¹prometheus-configmapèµ„æºé…ç½®alertmanageråœ°å€" class="hash-link" aria-label="Direct link to 8.5.ä¿®æ”¹prometheus-configmapèµ„æºé…ç½®alertmanageråœ°å€" title="Direct link to 8.5.ä¿®æ”¹prometheus-configmapèµ„æºé…ç½®alertmanageråœ°å€">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.ä¿®æ”¹é…ç½®å¢åŠ alertmanageråœ°å€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# vim prometheus-configmap.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alerting:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      alertmanagers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - static_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - targets:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - 192.168.16.106:31831</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.æ›´æ–°èµ„æº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-master ~/k8s/prometheus3]\# kubectl apply -f prometheus-configmap.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/prometheus-config configured      </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="85æŸ¥çœ‹é¡µé¢æ˜¯å¦å¢åŠ å‘Šè­¦è§„åˆ™">8.5.æŸ¥çœ‹é¡µé¢æ˜¯å¦å¢åŠ å‘Šè­¦è§„åˆ™<a href="#85æŸ¥çœ‹é¡µé¢æ˜¯å¦å¢åŠ å‘Šè­¦è§„åˆ™" class="hash-link" aria-label="Direct link to 8.5.æŸ¥çœ‹é¡µé¢æ˜¯å¦å¢åŠ å‘Šè­¦è§„åˆ™" title="Direct link to 8.5.æŸ¥çœ‹é¡µé¢æ˜¯å¦å¢åŠ å‘Šè­¦è§„åˆ™">â€‹</a></h3><p>å·²ç»æˆåŠŸå¡«åŠ ruleså‘Šè­¦è§„åˆ™</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172502911.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="86æ¨¡æ‹Ÿnodeä¸»æœºå®•æœºå¹¶æŸ¥çœ‹å¾®ä¿¡å‘Šè­¦å†…å®¹">8.6.æ¨¡æ‹Ÿnodeä¸»æœºå®•æœºå¹¶æŸ¥çœ‹å¾®ä¿¡å‘Šè­¦å†…å®¹<a href="#86æ¨¡æ‹Ÿnodeä¸»æœºå®•æœºå¹¶æŸ¥çœ‹å¾®ä¿¡å‘Šè­¦å†…å®¹" class="hash-link" aria-label="Direct link to 8.6.æ¨¡æ‹Ÿnodeä¸»æœºå®•æœºå¹¶æŸ¥çœ‹å¾®ä¿¡å‘Šè­¦å†…å®¹" title="Direct link to 8.6.æ¨¡æ‹Ÿnodeä¸»æœºå®•æœºå¹¶æŸ¥çœ‹å¾®ä¿¡å‘Šè­¦å†…å®¹">â€‹</a></h3><p><strong>æ¨¡æ‹Ÿè§¦å‘å‘Šè­¦</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">å°†ä»»æ„ä¸€ä¸ªnodeèŠ‚ç‚¹çš„node_exporteråœæ‰å³å¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8s-node1 ~]\# systemctl stop node_exporter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>å‘Šè­¦å·²ç»äº§ç”Ÿ</strong></p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172537744.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>å‘Šè­¦æ¶ˆæ¯å·²ç»å‘é€</strong></p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172545238.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><p><strong>æŸ¥çœ‹å‘Šè­¦å†…å®¹</strong></p><p>å·²ç»æˆåŠŸæ”¶åˆ°å‘Šè­¦ï¼Œk8sç›‘æ§ç³»åˆ—ç¯‡åˆ°æ­¤ç»“æŸ</p><p><img loading="lazy" src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/20210106172554537.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="img_ev3q"></p><blockquote><p>è¯¥æ–‡ç« ä¸ºè½¬è½½å†…å®¹ï¼Œä»…åšå¤‡ä»½ç§äººå­¦ä¹ ä½¿ç”¨ï¼ŒåŸæ–‡ï¼š<a href="https://jiangxl.blog.csdn.net/article/details/112283085" target="_blank" rel="noopener noreferrer">https://jiangxl.blog.csdn.net/article/details/112283085</a></p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CloudNative/k8s/Prometheus-Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/CloudNative/k8s/Minikube Basic"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Minikube Basic</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/CloudNative/k8s/Remote access k8s"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">kubectlè¿œç¨‹è¿æ¥k8s</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#æ–‡ç« ç›®å½•" class="table-of-contents__link toc-highlight">æ–‡ç« ç›®å½•</a></li><li><a href="#1k8sç›‘æ§æŒ‡æ ‡" class="table-of-contents__link toc-highlight">1.k8sç›‘æ§æŒ‡æ ‡</a></li><li><a href="#2k8såŸºç¡€ç¯å¢ƒå‡†å¤‡" class="table-of-contents__link toc-highlight">2.k8såŸºç¡€ç¯å¢ƒå‡†å¤‡</a><ul><li><a href="#21ç¯å¢ƒå‡†å¤‡" class="table-of-contents__link toc-highlight">2.1.ç¯å¢ƒå‡†å¤‡</a></li><li><a href="#22éƒ¨ç½²nfsä½œä¸ºprometheuså­˜å‚¨" class="table-of-contents__link toc-highlight">2.2.éƒ¨ç½²nfsä½œä¸ºprometheuså­˜å‚¨</a></li><li><a href="#23è·å–prometheus-yamlæ–‡ä»¶" class="table-of-contents__link toc-highlight">2.3.è·å–prometheus yamlæ–‡ä»¶</a></li><li><a href="#24åˆ›å»ºå‘½åç©ºé—´prometheus" class="table-of-contents__link toc-highlight">2.4.åˆ›å»ºå‘½åç©ºé—´prometheus</a></li></ul></li><li><a href="#3åœ¨k8sä¸­éƒ¨ç½²prometheus" class="table-of-contents__link toc-highlight">3.åœ¨k8sä¸­éƒ¨ç½²prometheus</a><ul><li><a href="#31prometheus-yamlå‡†å¤‡" class="table-of-contents__link toc-highlight">3.1.prometheus-yamlå‡†å¤‡</a></li><li><a href="#32åˆ›å»ºrbacèµ„æº" class="table-of-contents__link toc-highlight">3.2.åˆ›å»ºrbacèµ„æº</a></li><li><a href="#33åˆ›å»ºconfigmapèµ„æº" class="table-of-contents__link toc-highlight">3.3.åˆ›å»ºconfigmapèµ„æº</a></li><li><a href="#34åˆ›å»ºstatefulsetèµ„æº" class="table-of-contents__link toc-highlight">3.4.åˆ›å»ºstatefulsetèµ„æº</a></li><li><a href="#35åˆ›å»ºserviceèµ„æº" class="table-of-contents__link toc-highlight">3.5.åˆ›å»ºserviceèµ„æº</a></li><li><a href="#36æŸ¥çœ‹åˆ›å»ºçš„prometheusæ‰€æœ‰èµ„æºç±»å‹" class="table-of-contents__link toc-highlight">3.6.æŸ¥çœ‹åˆ›å»ºçš„prometheusæ‰€æœ‰èµ„æºç±»å‹</a></li><li><a href="#37è®¿é—®prometheus" class="table-of-contents__link toc-highlight">3.7.è®¿é—®prometheus</a></li><li><a href="#38prometheusé…ç½®æ–‡ä»¶è§£é‡Š" class="table-of-contents__link toc-highlight">3.8.prometheusé…ç½®æ–‡ä»¶è§£é‡Š</a></li><li><a href="#39k8s-metricsé¡µé¢" class="table-of-contents__link toc-highlight">3.9.k8s metricsé¡µé¢</a></li></ul></li><li><a href="#4åœ¨k8sä¸­éƒ¨ç½²grafana" class="table-of-contents__link toc-highlight">4.åœ¨k8sä¸­éƒ¨ç½²grafana</a><ul><li><a href="#41ç¼–å†™granfana-pv-pvcèµ„æº" class="table-of-contents__link toc-highlight">4.1.ç¼–å†™granfana-pv-pvcèµ„æº</a></li><li><a href="#42ç¼–å†™granfana-statefulsetèµ„æº" class="table-of-contents__link toc-highlight">4.2.ç¼–å†™granfana-statefulsetèµ„æº</a></li><li><a href="#43ç¼–å†™granfana-svcèµ„æº" class="table-of-contents__link toc-highlight">4.3.ç¼–å†™granfana-svcèµ„æº</a></li><li><a href="#44k8såˆ›å»ºgrafana" class="table-of-contents__link toc-highlight">4.4.k8såˆ›å»ºgrafana</a></li><li><a href="#45æŸ¥çœ‹èµ„æºè¿è¡ŒçŠ¶æ€" class="table-of-contents__link toc-highlight">4.5.æŸ¥çœ‹èµ„æºè¿è¡ŒçŠ¶æ€</a></li><li><a href="#46ç™»é™†grafana" class="table-of-contents__link toc-highlight">4.6.ç™»é™†grafana</a></li><li><a href="#47å¯¼å…¥k8sèµ„æºç›‘æ§podèµ„æºæ¨¡æ¿" class="table-of-contents__link toc-highlight">4.7.å¯¼å…¥k8sèµ„æºç›‘æ§podèµ„æºæ¨¡æ¿</a></li><li><a href="#48è§£å†³æ¨¡æ¿è¡¨è¾¾å¼é—®é¢˜æ— æ³•å±•ç°æ‰€æœ‰pod" class="table-of-contents__link toc-highlight">4.8.è§£å†³æ¨¡æ¿è¡¨è¾¾å¼é—®é¢˜æ— æ³•å±•ç°æ‰€æœ‰pod</a></li></ul></li><li><a href="#5ç›‘æ§k8s-nodeèŠ‚ç‚¹" class="table-of-contents__link toc-highlight">5.ç›‘æ§k8s nodeèŠ‚ç‚¹</a><ul><li><a href="#51ç¼–å†™ä¸€é”®éƒ¨ç½²node_exporterè„šæœ¬" class="table-of-contents__link toc-highlight">5.1.ç¼–å†™ä¸€é”®éƒ¨ç½²node_exporterè„šæœ¬</a></li><li><a href="#52å¯¹k8sçš„nodeè¿›è¡Œæ‰§è¡Œnode_exporterè„šæœ¬" class="table-of-contents__link toc-highlight">5.2.å¯¹k8sçš„nodeè¿›è¡Œæ‰§è¡Œnode_exporterè„šæœ¬</a></li><li><a href="#53åœ¨prometheusçš„configmapèµ„æºä¸­å¢åŠ nodeèŠ‚ç‚¹é…ç½®" class="table-of-contents__link toc-highlight">5.3.åœ¨prometheusçš„configmapèµ„æºä¸­å¢åŠ nodeèŠ‚ç‚¹é…ç½®</a></li><li><a href="#54å¯¼å…¥k8s-nodeä¸»æœºç›‘æ§æ¨¡æ¿" class="table-of-contents__link toc-highlight">5.4.å¯¼å…¥k8s nodeä¸»æœºç›‘æ§æ¨¡æ¿</a></li></ul></li><li><a href="#6k8sä½¿ç”¨kube-state-metrics-ç›‘æ§èµ„æºçŠ¶æ€" class="table-of-contents__link toc-highlight">6.k8sä½¿ç”¨kube-state-metrics-ç›‘æ§èµ„æºçŠ¶æ€</a><ul><li><a href="#61åˆ›å»ºrbacèµ„æº" class="table-of-contents__link toc-highlight">6.1.åˆ›å»ºrbacèµ„æº</a></li><li><a href="#62åˆ›å»ºdeploymentèµ„æº" class="table-of-contents__link toc-highlight">6.2.åˆ›å»ºdeploymentèµ„æº</a></li><li><a href="#63åˆ›å»ºserviceèµ„æº" class="table-of-contents__link toc-highlight">6.3.åˆ›å»ºserviceèµ„æº</a></li><li><a href="#64èµ„æºå‡†å¤‡å°±ç»ª" class="table-of-contents__link toc-highlight">6.4.èµ„æºå‡†å¤‡å°±ç»ª</a></li><li><a href="#65åœ¨prometheusæŸ¥çœ‹æ˜¯å¦è·å–ç›‘æ§æŒ‡æ ‡" class="table-of-contents__link toc-highlight">6.5.åœ¨prometheusæŸ¥çœ‹æ˜¯å¦è·å–ç›‘æ§æŒ‡æ ‡</a></li><li><a href="#66å¯¼å…¥k8s-èµ„æºçŠ¶æ€æ¨¡æ¿" class="table-of-contents__link toc-highlight">6.6.å¯¼å…¥k8s èµ„æºçŠ¶æ€æ¨¡æ¿</a></li></ul></li><li><a href="#7åœ¨k8sä¸­éƒ¨ç½²alertmanagerå®ç°å‘Šè­¦ç³»ç»Ÿ" class="table-of-contents__link toc-highlight">7.åœ¨k8sä¸­éƒ¨ç½²alertmanagerå®ç°å‘Šè­¦ç³»ç»Ÿ</a><ul><li><a href="#71åˆ›å»ºalertmanager-pv-pvcèµ„æº" class="table-of-contents__link toc-highlight">7.1.åˆ›å»ºalertmanager-pv-pvcèµ„æº</a></li><li><a href="#72åˆ›å»ºalertmanager-cmèµ„æºå¢åŠ å¾®ä¿¡å‘Šè­¦é…ç½®" class="table-of-contents__link toc-highlight">7.2.åˆ›å»ºalertmanager-cmèµ„æºå¢åŠ å¾®ä¿¡å‘Šè­¦é…ç½®</a></li><li><a href="#73åˆ›å»ºalertmanager-deploymentèµ„æº" class="table-of-contents__link toc-highlight">7.3.åˆ›å»ºalertmanager-deploymentèµ„æº</a></li><li><a href="#74åˆ›å»ºalertmanager-serviceèµ„æº" class="table-of-contents__link toc-highlight">7.4.åˆ›å»ºalertmanager-serviceèµ„æº</a></li><li><a href="#75æŸ¥çœ‹alertmanageræ‰€æœ‰èµ„æº" class="table-of-contents__link toc-highlight">7.5æŸ¥çœ‹alertmanageræ‰€æœ‰èµ„æº</a></li><li><a href="#76è®¿é—®alertmanager" class="table-of-contents__link toc-highlight">7.6.è®¿é—®alertmanager</a></li></ul></li><li><a href="#8é…ç½®alertmanagerå®ç°k8så‘Šè­¦ç³»ç»Ÿ" class="table-of-contents__link toc-highlight">8.é…ç½®alertmanagerå®ç°k8så‘Šè­¦ç³»ç»Ÿ</a><ul><li><a href="#81åœ¨nfsä¸Šå‡†å¤‡ä¸¤ä¸ªå‘Šè­¦è§„åˆ™æ–‡ä»¶" class="table-of-contents__link toc-highlight">8.1.åœ¨NFSä¸Šå‡†å¤‡ä¸¤ä¸ªå‘Šè­¦è§„åˆ™æ–‡ä»¶</a></li><li><a href="#82ç¼–å†™ruleså‘Šè­¦è§„åˆ™çš„pvpvcyamlæ–‡ä»¶" class="table-of-contents__link toc-highlight">8.2.ç¼–å†™ruleså‘Šè­¦è§„åˆ™çš„pvã€pvcyamlæ–‡ä»¶</a></li><li><a href="#83ä¿®æ”¹prometheusçš„statefulsetèµ„æºé›†æˆrules" class="table-of-contents__link toc-highlight">8.3.ä¿®æ”¹prometheusçš„statefulsetèµ„æºé›†æˆrules</a></li><li><a href="#84æ›´æ–°prometheus-statefulsetèµ„æº" class="table-of-contents__link toc-highlight">8.4.æ›´æ–°prometheus-statefulsetèµ„æº</a></li><li><a href="#85ä¿®æ”¹prometheus-configmapèµ„æºé…ç½®alertmanageråœ°å€" class="table-of-contents__link toc-highlight">8.5.ä¿®æ”¹prometheus-configmapèµ„æºé…ç½®alertmanageråœ°å€</a></li><li><a href="#85æŸ¥çœ‹é¡µé¢æ˜¯å¦å¢åŠ å‘Šè­¦è§„åˆ™" class="table-of-contents__link toc-highlight">8.5.æŸ¥çœ‹é¡µé¢æ˜¯å¦å¢åŠ å‘Šè­¦è§„åˆ™</a></li><li><a href="#86æ¨¡æ‹Ÿnodeä¸»æœºå®•æœºå¹¶æŸ¥çœ‹å¾®ä¿¡å‘Šè­¦å†…å®¹" class="table-of-contents__link toc-highlight">8.6.æ¨¡æ‹Ÿnodeä¸»æœºå®•æœºå¹¶æŸ¥çœ‹å¾®ä¿¡å‘Šè­¦å†…å®¹</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs Releases</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 1.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 2.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 3.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv4" target="_blank" rel="noopener noreferrer" class="footer__link-item">â­ï¸Version 4.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">â­ï¸æˆ‘çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 AGou-ops' Documetation v4.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b04b912f.js"></script>
<script src="/assets/js/main.4851b47f.js"></script>
</body>
</html>