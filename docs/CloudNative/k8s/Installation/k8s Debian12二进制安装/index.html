<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-CloudNative/k8s/Installation/k8s Debian12äºŒè¿›åˆ¶å®‰è£…">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">k8s Debian12äºŒè¿›åˆ¶å®‰è£… | AGou&#x27;s Docsv4</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.agou-ops.cn/docs/CloudNative/k8s/Installation/k8s Debian12äºŒè¿›åˆ¶å®‰è£…"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="k8s Debian12äºŒè¿›åˆ¶å®‰è£… | AGou&#x27;s Docsv4"><meta data-rh="true" name="description" content="ä¸€ã€é¢„å…ˆå‡†å¤‡"><meta data-rh="true" property="og:description" content="ä¸€ã€é¢„å…ˆå‡†å¤‡"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Installation/k8s Debian12äºŒè¿›åˆ¶å®‰è£…"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Installation/k8s Debian12äºŒè¿›åˆ¶å®‰è£…" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/CloudNative/k8s/Installation/k8s Debian12äºŒè¿›åˆ¶å®‰è£…" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-KQED41RW95","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.6908ad1e.css">
<link rel="preload" href="/assets/js/runtime~main.2d282a18.js" as="script">
<link rel="preload" href="/assets/js/main.509f804f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">AGou&#x27;s Docsv4</b></a><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">âœ¨ æˆ‘çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"> ğŸ“– ç›®å½•</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs">ğŸŒ² ç›®å½•æ ‘</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/category/äº‘åŸç”Ÿç›¸å…³">â˜ï¸ äº‘åŸç”Ÿç›¸å…³</a></li><li><a class="dropdown__link" href="/docs/category/linuxåŸºç¡€">ğŸ˜Š LinuxåŸºç¡€</a></li><li><a class="dropdown__link" href="/docs/category/ç¼–ç¨‹è¯­è¨€">â™¨ï¸ ç¼–ç¨‹è¯­è¨€</a></li><li><a class="dropdown__link" href="/docs/category/è„šæœ¬ç›¸å…³">ğŸ•¹ï¸ è„šæœ¬ç›¸å…³</a></li><li><a class="dropdown__link" href="/docs/category/é¢è¯•ç›¸å…³">ğŸ‘¨â€âš–ï¸ é¢è¯•ç›¸å…³</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ç‰ˆæœ¬</a><ul class="dropdown__menu"><li><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver1.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver2.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver3.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub ä»“åº“"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"><b>AGou&#x27;s Docsv4</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/äº‘åŸç”Ÿç›¸å…³">äº‘åŸç”Ÿç›¸å…³</a><button aria-label="Toggle the collapsible sidebar category &#x27;äº‘åŸç”Ÿç›¸å…³&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cicd">CICD</a><button aria-label="Toggle the collapsible sidebar category &#x27;CICD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cloudcomptering">CloudComptering</a><button aria-label="Toggle the collapsible sidebar category &#x27;CloudComptering&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/docker">Docker</a><button aria-label="Toggle the collapsible sidebar category &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elfk">ELFK</a><button aria-label="Toggle the collapsible sidebar category &#x27;ELFK&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/prometheus">Prometheus</a><button aria-label="Toggle the collapsible sidebar category &#x27;Prometheus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/k8s">k8s</a><button aria-label="Toggle the collapsible sidebar category &#x27;k8s&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/helm">Helm</a><button aria-label="Toggle the collapsible sidebar category &#x27;Helm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/installation">Installation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Installation/Kubeadm å¿«é€Ÿéƒ¨ç½²æ‰‹å†Œ">Kubeadm å¿«é€Ÿéƒ¨ç½²æ‰‹å†Œ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Installation/Kubernetes äºŒè¿›åˆ¶å®‰è£…">Kubernetes äºŒè¿›åˆ¶å®‰è£…</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/CloudNative/k8s/Installation/k8s Debian12äºŒè¿›åˆ¶å®‰è£…">k8s Debian12äºŒè¿›åˆ¶å®‰è£…</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Installation/ä½¿ç”¨ Kubeadm éƒ¨ç½²ï¼ˆå•masterï¼‰">ä½¿ç”¨ Kubeadm éƒ¨ç½²(å•master)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Installation/ä½¿ç”¨ Kubespray éƒ¨ç½²">ä½¿ç”¨ Kubespray éƒ¨ç½²</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Installation/ä½¿ç”¨å›½å†…æºåŠç›¸å…³å°å·¥å…·">ä½¿ç”¨å›½å†…æºåŠç›¸å…³å°å·¥å…·</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Installation/å¸¸ç”¨ç»„ä»¶å®‰è£…">å¸¸ç”¨ç»„ä»¶å®‰è£…</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/quicklystart">Quicklystart</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quicklystart&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</a><button aria-label="Toggle the collapsible sidebar category &#x27;å®æˆ˜æ¡ˆä¾‹&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubeadm å¿«é€Ÿéƒ¨ç½²k8sé›†ç¾¤">Kubeadm å¿«é€Ÿéƒ¨ç½²k8sé›†ç¾¤</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes REST API">Kubernetes REST API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes Yaml quicklystart">Kubernetes YAML file quicklystart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Kubernetes with Jenkins CICD">åŸºäºkuberneteså¹³å°çš„CICDæŒç»­é›†æˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Minikube Basic">Minikube Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Prometheus-Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤">Prometheus+Grafanaå…¨æ–¹ä½ç›‘æ§Kubernetesé›†ç¾¤</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/Remote access k8s">kubectlè¿œç¨‹è¿æ¥k8s</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k3d">k3d</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s command">Kubernetes CLI command -- kubectl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s å›¾è§£å¤§å…¨">k8så›¾è§£å¤§å…¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8s ç½‘ç»œç›¸å…³">k8s ç½‘ç»œç›¸å…³</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/k8sæ¦‚å¿µåŠåŸç†ç›¸å…³">k8s æ¦‚å¿µåŠåŸç†ç›¸å…³</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/kompose Basic">Kompose Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/k8s/kubenetesè¿œç¨‹è°ƒè¯•å·¥å…·">kubenetesè¿œç¨‹è°ƒè¯•å·¥å…·</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Consul å…¥é—¨">Consul å…¥é—¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Dubbo Basic">Dubbo Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Grafana Loki Basic">Grafana Loki</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/Istio Basic">Istio Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CloudNative/">CloudNative.</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/äº‘åŸç”Ÿç›¸å…³"><span itemprop="name">äº‘åŸç”Ÿç›¸å…³</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/k8s"><span itemprop="name">k8s</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/installation"><span itemprop="name">Installation</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">k8s Debian12äºŒè¿›åˆ¶å®‰è£…</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>k8s Debian12äºŒè¿›åˆ¶å®‰è£…</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ä¸€é¢„å…ˆå‡†å¤‡">ä¸€ã€é¢„å…ˆå‡†å¤‡<a href="#ä¸€é¢„å…ˆå‡†å¤‡" class="hash-link" aria-label="Direct link to ä¸€ã€é¢„å…ˆå‡†å¤‡" title="Direct link to ä¸€ã€é¢„å…ˆå‡†å¤‡">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-æœåŠ¡å™¨è§’è‰²">1.1 æœåŠ¡å™¨è§’è‰²<a href="#11-æœåŠ¡å™¨è§’è‰²" class="hash-link" aria-label="Direct link to 1.1 æœåŠ¡å™¨è§’è‰²" title="Direct link to 1.1 æœåŠ¡å™¨è§’è‰²">â€‹</a></h3><p>ç¯å¢ƒä¿¡æ¯ï¼š</p><ul><li>k8sç‰ˆæœ¬ï¼šv1.25.12</li><li>Debian12(bookworm)ï¼šå†…æ ¸6.1.0-9-amd64</li></ul><table><thead><tr><th>è§’è‰²</th><th>IP</th><th>ç»„ä»¶åˆ—è¡¨</th></tr></thead><tbody><tr><td>master</td><td>172.19.82.157</td><td>kube-apiserverã€kube-controller-manageã€kube-schedulerã€kubeletã€kube-proxyã€etcdã€containerd</td></tr><tr><td>node01</td><td>172.19.82.158</td><td>kubeletã€kube-proxyã€containerdã€etcd</td></tr><tr><td>node02</td><td>172.19.82.159</td><td>kubeletã€kube-proxyã€containerdã€etcd</td></tr></tbody></table><p>â„¹ç”±äºæ‰‹ä¸Šèµ„æºæœ‰é™ï¼Œæ‰€ä»¥æ­å»ºä¸€ä¸ªä¸€ä¸»ä¸¤ä»çš„é›†ç¾¤ï¼Œå¦‚æœåç»­æƒ³è¦æ‰©å±•çš„è¯ï¼Œä»…éœ€è¦å†æ·»åŠ masteræˆ–è€…nodeèŠ‚ç‚¹å³å¯ï¼Œæ­¤å¤–etcdå¯ä»¥éƒ¨ç½²åˆ°é›†ç¾¤ä¹‹å¤–å¹¶åšé«˜å¯ç”¨ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12-ç³»ç»Ÿåˆå§‹åŒ–">1.2 ç³»ç»Ÿåˆå§‹åŒ–<a href="#12-ç³»ç»Ÿåˆå§‹åŒ–" class="hash-link" aria-label="Direct link to 1.2 ç³»ç»Ÿåˆå§‹åŒ–" title="Direct link to 1.2 ç³»ç»Ÿåˆå§‹åŒ–">â€‹</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ç¦ç”¨é˜²ç«å¢™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop ufw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl disable ufw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å…³é—­SELinuxï¼Œæˆ‘è¿™é‡Œcloudintå®‰è£…çš„ç³»ç»Ÿï¼Œæ²¡æœ‰é˜²ç«å¢™å’Œselinux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&#x27;s/enforcing/disabled/&#x27;</span><span class="token plain"> /etc/selinux/config  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setenforce </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å…³é—­äº¤æ¢åˆ†åŒºswap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">swap -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -ri </span><span class="token string" style="color:#e3116c">&#x27;s/.*swap.*/#&amp;/&#x27;</span><span class="token plain"> /etc/fstab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åŒæ­¥æ—¶åŒºä¸æ—¶é—´ï¼Œ**éå¸¸é‡è¦**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timedatectl set-timezone Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ntpdate ntp.aliyun.com    </span><span class="token comment" style="color:#999988;font-style:italic"># æ²¡æœ‰ntpdateçš„è¯ï¼Œéœ€è¦å®‰è£…ä¸€ä¸‹ï¼Œapt install ntpdate -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®ulimitï¼Œæœ€å¤§æ–‡ä»¶æ‰“å¼€æ•°ï¼Œä¼˜åŒ–linuxæ€§èƒ½ï¼Œé‡æ–°é€€å‡ºç™»å½•å½“å‰shellå³å¯ç”Ÿæ•ˆ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">ulimit</span><span class="token plain"> -SHn </span><span class="token number" style="color:#36acaa">65535</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/security/limits.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">root soft nofile 65536</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">root hard nofile 131072</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">root soft nproc 65535</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">root hard nproc 655350</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">root soft memlock unlimited</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">root hard memlock unlimited</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å®‰è£…ipvs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> ipvsadm ipset sysstat conntrack -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åŠ è½½</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe -- ip_vs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe -- ip_vs_rr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe -- ip_vs_wrr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe -- ip_vs_sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe -- nf_conntrack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å†™å…¥é…ç½®æ–‡ä»¶æ°¸ä¹…ç”Ÿæ•ˆ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/modules-load.d/ipvs.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF </span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ip_vs</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ip_vs_rr</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ip_vs_wrr</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ip_vs_sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">nf_conntrack</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ip_tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ip_set</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">xt_set</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ipt_set</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ipt_rpfilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ipt_REJECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ipip</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># é‡å¯æœåŠ¡ä»¥åŠ è½½æ¨¡å—</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart systemd-modules-load.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ£€æŸ¥æ¨¡å—æ˜¯å¦åŠ è½½ï¼Œè¿™é‡Œå¯ä»¥rebootä¸€ä¸‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lsmod </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -e ip_vs -e nf_conntrack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ä¿®æ”¹å†…æ ¸å‚æ•°ï¼ŒæŒ‰éœ€ä¿®æ”¹å³å¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/sysctl.d/k8s.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.ip_forward = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.bridge.bridge-nf-call-iptables = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">fs.may_detach_mounts = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">vm.overcommit_memory=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">vm.panic_on_oom=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">fs.inotify.max_user_watches=89100</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">fs.file-max=52706963</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">fs.nr_open=52706963</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.netfilter.nf_conntrack_max=2310720</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_keepalive_time = 600</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_keepalive_probes = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_keepalive_intvl =15</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_max_tw_buckets = 36000</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_tw_reuse = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_max_orphans = 327680</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_orphan_retries = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_syncookies = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_max_syn_backlog = 16384</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.ip_conntrack_max = 65536</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_max_syn_backlog = 16384</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_timestamps = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.core.somaxconn = 16384</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv6.conf.all.disable_ipv6 = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv6.conf.default.disable_ipv6 = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv6.conf.lo.disable_ipv6 = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv6.conf.all.forwarding = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ä½¿å…¶ç”Ÿæ•ˆ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sysctl --system</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13-hostsè®¾ç½®">1.3 hostsè®¾ç½®<a href="#13-hostsè®¾ç½®" class="hash-link" aria-label="Direct link to 1.3 hostsè®¾ç½®" title="Direct link to 1.3 hostsè®¾ç½®">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="131-é€šè¿‡hostsæ–‡ä»¶é…ç½®">1.3.1 é€šè¿‡hostsæ–‡ä»¶é…ç½®<a href="#131-é€šè¿‡hostsæ–‡ä»¶é…ç½®" class="hash-link" aria-label="Direct link to 1.3.1 é€šè¿‡hostsæ–‡ä»¶é…ç½®" title="Direct link to 1.3.1 é€šè¿‡hostsæ–‡ä»¶é…ç½®">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/hosts </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">172.19.82.157 master.k8s.local master</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">172.19.82.158 node01.k8s.local node01</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">172.19.82.159 node02.k8s.local node02</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æµ‹è¯•ç½‘ç»œè¿é€š</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> master node01 node02</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ping</span><span class="token plain"> -c </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="132-ä½¿ç”¨bind9-dnså·¥å…·">1.3.2 ä½¿ç”¨bind9 DNSå·¥å…·<a href="#132-ä½¿ç”¨bind9-dnså·¥å…·" class="hash-link" aria-label="Direct link to 1.3.2 ä½¿ç”¨bind9 DNSå·¥å…·" title="Direct link to 1.3.2 ä½¿ç”¨bind9 DNSå·¥å…·">â€‹</a></h4><p>â„¹ä»…åœ¨ä¸€å°æœºå™¨ä¸Šå®‰è£…bind9å³å¯ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©masterèŠ‚ç‚¹ï¼Œå¦‚æœæœ‰é«˜å¯ç”¨éœ€æ±‚çš„è¯å¯ä»¥å®‰è£…å¤šä¸ªbindåšé›†ç¾¤ã€‚</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># å®‰è£…bind9 DNSå·¥å…·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> bind9 dnsutils -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¿®æ”¹é…ç½®ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/bind/named.conf.options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å†…å®¹å¦‚ä¸‹(åˆ æ‰äº†éƒ¨åˆ†æ³¨é‡Š)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        directory </span><span class="token string" style="color:#e3116c">&quot;/var/cache/bind&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // å½“DNSè§£æä¸åˆ°æ—¶ï¼Œè½¬å‘ç»™å…¶ä»–DNSæœåŠ¡å™¨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        forwarders </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">8.8</span><span class="token plain">.8.8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dnssec-validation auto</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen-on-v6 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822111122.png" alt="image.png" class="img_ev3q">
é…ç½®è§£æåŸŸä»¥åŠæ¨¡æ¿æ–‡ä»¶ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®è§£æåŸŸ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/bind/named.conf.default-zones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// æ­£å‘è§£æåŸŸ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zone </span><span class="token string" style="color:#e3116c">&quot;k8s.local&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/etc/bind/db.k8s.local&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// åå‘è§£æåŸŸ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zone </span><span class="token string" style="color:#e3116c">&quot;82.19.172.in-addr.zrpa&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/etc/bind/db.in-addr.k8s.local&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å¤åˆ¶æ¨¡ç‰ˆæ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -a /etc/bind/db.local /etc/bind/db.k8s.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -a /etc/bind/db.127 /etc/bind/db.in-addr.k8s.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®æ­£å‘è§£ææ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/bind/db.k8s.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$TTL</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">604800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@       IN      SOA     dns.k8s.local. k8s.local. </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> Serial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         </span><span class="token number" style="color:#36acaa">604800</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> Refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token number" style="color:#36acaa">86400</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> Retry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">2419200</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> Expire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         </span><span class="token number" style="color:#36acaa">604800</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> Negative Cache TTL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@       IN      NS      dns.k8s.local.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dns     IN      A       </span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.157</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master  IN      A       </span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.157</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node01  IN      A       </span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.158</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node02  IN      A       </span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®åå‘è§£ææ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/bind/db.in-addr.k8s.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$TTL</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">604800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@       IN      SOA     dns.k8s.local. k8s.local. </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> Serial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         </span><span class="token number" style="color:#36acaa">604800</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> Refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token number" style="color:#36acaa">86400</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> Retry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">2419200</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> Expire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         </span><span class="token number" style="color:#36acaa">604800</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> Negative Cache TTL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@       IN      NS      dns.k8s.local.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">157</span><span class="token plain">     IN      PTR     k8s.local.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">157</span><span class="token plain">     IN      PTR     master.k8s.local.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">158</span><span class="token plain">     IN      PTR     node01.k8s.local.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">159</span><span class="token plain">     IN      PTR     node02.k8s.local.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é‡å¯æœåŠ¡åŠæµ‹è¯•ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart bind9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ä¿®æ”¹ä¸»æœºçš„é¦–é€‰DNSåœ°å€ä¸º172.19.82.157</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /etc/resolv.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nameserver </span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.157</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nameserver </span><span class="token number" style="color:#36acaa">8.8</span><span class="token plain">.8.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æµ‹è¯•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> master node01 node02</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dig</span><span class="token plain"> +short </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">.k8s.local</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åº”å½“è¾“å‡ºï¼Œæˆªå›¾å¦‚ä¸‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.157</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.158</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.159</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822114543.png" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="14-å¯é€‰å®‰è£…supervisor">1.4 ï¼ˆå¯é€‰ï¼‰å®‰è£…supervisor<a href="#14-å¯é€‰å®‰è£…supervisor" class="hash-link" aria-label="Direct link to 1.4 ï¼ˆå¯é€‰ï¼‰å®‰è£…supervisor" title="Direct link to 1.4 ï¼ˆå¯é€‰ï¼‰å®‰è£…supervisor">â€‹</a></h3><p>å®‰è£…supervisorç®€å•å®ç°æœåŠ¡â€œé«˜å¯ç”¨â€.
â„¹éå¿…é¡»ï¼Œä½¿ç”¨systemdæ¥ç®¡ç†ä¹Ÿå¯ä»¥.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> supervisor -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># è®¾ç½®ä¸ºå¼€æœºè‡ªå¯ï¼Œå¹¶å¯åŠ¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> supervisor --now</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="äºŒå®‰è£…criå®¹å™¨è¿è¡Œæ—¶åŠharborç§æœ‰ä»“">äºŒã€å®‰è£…CRIå®¹å™¨è¿è¡Œæ—¶åŠharborç§æœ‰ä»“<a href="#äºŒå®‰è£…criå®¹å™¨è¿è¡Œæ—¶åŠharborç§æœ‰ä»“" class="hash-link" aria-label="Direct link to äºŒã€å®‰è£…CRIå®¹å™¨è¿è¡Œæ—¶åŠharborç§æœ‰ä»“" title="Direct link to äºŒã€å®‰è£…CRIå®¹å™¨è¿è¡Œæ—¶åŠharborç§æœ‰ä»“">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-å®‰è£…containerd">2.1 å®‰è£…containerd<a href="#21-å®‰è£…containerd" class="hash-link" aria-label="Direct link to 2.1 å®‰è£…containerd" title="Direct link to 2.1 å®‰è£…containerd">â€‹</a></h3><p>å®‰è£…æ–¹å¼æœ‰å¥½å‡ ç§ï¼ŒäºŒè¿›åˆ¶å®‰è£…ï¼Œä»“åº“å®‰è£…ä»¥åŠç¼–è¯‘å®‰è£…ã€‚</p><p>è¿™é‡Œæˆ‘ä½¿ç”¨äºŒè¿›åˆ¶è¿›è¡Œå®‰è£…ï¼Œä»“åº“å®‰è£…å‚è€ƒï¼š<a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md#option-2-from-apt-get-or-dnf" target="_blank" rel="noopener noreferrer">https://github.com/containerd/containerd/blob/main/docs/getting-started.md#option-2-from-apt-get-or-dnf</a>
ğŸ˜„ let&#x27;s go~</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="211-æ­¥éª¤ä¸€å®‰è£…containerd">2.1.1 æ­¥éª¤ä¸€å®‰è£…containerd<a href="#211-æ­¥éª¤ä¸€å®‰è£…containerd" class="hash-link" aria-label="Direct link to 2.1.1 æ­¥éª¤ä¸€å®‰è£…containerd" title="Direct link to 2.1.1 æ­¥éª¤ä¸€å®‰è£…containerd">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ä»https://github.com/containerd/containerd/releasesï¼Œä¸‹è½½containerdçš„äºŒè¿›åˆ¶åŒ…ï¼Œæ³¨æ„è½¯ä»¶åŒ…æ¶æ„.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/containerd/containerd/releases/download/v1.6.23/containerd-1.6.23-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> Cxzvf /usr/local containerd-1.6.23-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å®‰è£…serviceæœåŠ¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> -O /lib/systemd/system/containerd.service https://raw.githubusercontent.com/containerd/containerd/main/containerd.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># é‡è½½å¹¶å¯åŠ¨æœåŠ¡ï¼Œè®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> containerd --now</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822131441.png" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="212-æ­¥éª¤äºŒå®‰è£…runc">2.1.2 æ­¥éª¤äºŒå®‰è£…runC<a href="#212-æ­¥éª¤äºŒå®‰è£…runc" class="hash-link" aria-label="Direct link to 2.1.2 æ­¥éª¤äºŒå®‰è£…runC" title="Direct link to 2.1.2 æ­¥éª¤äºŒå®‰è£…runC">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/opencontainers/runc/releases/download/v1.1.9/runc.amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -m </span><span class="token number" style="color:#36acaa">755</span><span class="token plain"> runc.amd64 /usr/local/sbin/runc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="213-æ­¥éª¤ä¸‰å®‰è£…cniæ’ä»¶">2.1.3 æ­¥éª¤ä¸‰å®‰è£…CNIæ’ä»¶<a href="#213-æ­¥éª¤ä¸‰å®‰è£…cniæ’ä»¶" class="hash-link" aria-label="Direct link to 2.1.3 æ­¥éª¤ä¸‰å®‰è£…CNIæ’ä»¶" title="Direct link to 2.1.3 æ­¥éª¤ä¸‰å®‰è£…CNIæ’ä»¶">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/containernetworking/plugins/releases/download/v1.3.0/cni-plugins-linux-amd64-v1.3.0.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># tar Cxzvf /usr/local/bin cni-plugins-linux-amd64-v1.3.0.tgz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.3.0.tgz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="214-é…ç½®containerdä½¿ç”¨systemd-cgroupé©±åŠ¨">2.1.4 é…ç½®containerdä½¿ç”¨systemd cgroupé©±åŠ¨<a href="#214-é…ç½®containerdä½¿ç”¨systemd-cgroupé©±åŠ¨" class="hash-link" aria-label="Direct link to 2.1.4 é…ç½®containerdä½¿ç”¨systemd cgroupé©±åŠ¨" title="Direct link to 2.1.4 é…ç½®containerdä½¿ç”¨systemd cgroupé©±åŠ¨">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ç”Ÿæˆé»˜è®¤çš„é…ç½®æ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">containerd config default </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /etc/containerd/config.toml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822132245.png" alt="image.png" class="img_ev3q">
å¤§æ¦‚ç¬¬125è¡Œï¼Œä¿®æ”¹   <code>SystemdCgroup</code> ä¸º<code>true</code>.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/containerd/config.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ä¿®æ”¹é»˜è®¤çš„pauseå®¹å™¨é•œåƒåœ°å€ä¸ºé˜¿é‡Œäº‘å›½å†…æº</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sandbox_image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.9&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822132616.png" alt="image.png" class="img_ev3q">
å¤§æ¦‚ç¬¬61è¡Œã€‚
ä¿®æ”¹å®Œä¿å­˜ä¹‹åï¼Œé‡å¯<code>systemctl restart containerd</code>.
æ£€æŸ¥è¿è¡ŒçŠ¶æ€ï¼š
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822132807.png" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="215-å®‰è£…crictlå®¢æˆ·ç«¯å·¥å…·">2.1.5 å®‰è£…crictlå®¢æˆ·ç«¯å·¥å…·<a href="#215-å®‰è£…crictlå®¢æˆ·ç«¯å·¥å…·" class="hash-link" aria-label="Direct link to 2.1.5 å®‰è£…crictlå®¢æˆ·ç«¯å·¥å…·" title="Direct link to 2.1.5 å®‰è£…crictlå®¢æˆ·ç«¯å·¥å…·">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.28.0/crictl-v1.28.0-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xf crictl-v1.28.0-linux-amd64.tar.gz -C /usr/local/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ç¼–å†™é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯ä½¿ç”¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> -c </span><span class="token string" style="color:#e3116c">&quot;cat &gt; /etc/crictl.yaml&quot;</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">runtime-endpoint: unix:///run/containerd/containerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">image-endpoint: unix:///run/containerd/containerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">timeout: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">debug: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ<code>crictl ps</code>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822133349.png" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22-å®‰è£…harborç§æœ‰ä»“">2.2 å®‰è£…harborç§æœ‰ä»“<a href="#22-å®‰è£…harborç§æœ‰ä»“" class="hash-link" aria-label="Direct link to 2.2 å®‰è£…harborç§æœ‰ä»“" title="Direct link to 2.2 å®‰è£…harborç§æœ‰ä»“">â€‹</a></h3><p>harborå»ºè®®éƒ¨ç½²åœ¨å…¶ä»–ä¸»æœºä¸Šï¼Œæ¯”å¦‚è¯´ä¸»æ§æœºï¼Œä¸k8sé›†ç¾¤åˆ†å‰²å¼€æ¥ï¼Œè¿™ä¸ªéšä¾¿ï¼Œçœ‹ä½ è‡ªå·±ã€‚</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/goharbor/harbor/releases/download/v2.8.4/harbor-offline-installer-v2.8.4.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xzvf harbor-offline-installer-v2.8.4.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># è¿è¡Œå®‰è£…ç¨‹åºå³å¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ./install.sh </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åç»­æ­¥éª¤ç•¥.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ä¸‰ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦">ä¸‰ã€ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦<a href="#ä¸‰ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦" class="hash-link" aria-label="Direct link to ä¸‰ã€ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦" title="Direct link to ä¸‰ã€ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-å®‰è£…cfssl">3.1 å®‰è£…cfssl<a href="#31-å®‰è£…cfssl" class="hash-link" aria-label="Direct link to 3.1 å®‰è£…cfssl" title="Direct link to 3.1 å®‰è£…cfssl">â€‹</a></h3><p>â„¹åœ¨masterèŠ‚ç‚¹æˆ–è€…ä¸»æ§æœºï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ä¸Šå®‰è£…cfsslå³å¯ï¼Œå…¶ä»–ä¸»æœºä¸éœ€è¦ã€‚</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/cloudflare/cfssl/releases/download/v1.6.4/cfssl_1.6.4_linux_amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/cloudflare/cfssl/releases/download/v1.6.4/cfssljson_1.6.4_linux_amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/cloudflare/cfssl/releases/download/v1.6.4/cfssl-certinfo_1.6.4_linux_amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -m </span><span class="token number" style="color:#36acaa">755</span><span class="token plain"> cfssl_1.6.4_linux_amd64 /usr/local/bin/cfssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -m </span><span class="token number" style="color:#36acaa">755</span><span class="token plain"> cfssljson_1.6.4_linux_amd64 /usr/local/bin/cfssl-json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -m </span><span class="token number" style="color:#36acaa">755</span><span class="token plain"> cfssl-certinfo_1.6.4_linux_amd64 /usr/local/bin/cfssl-certinfo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ£€æŸ¥å®‰è£…ï¼š
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822134549.png" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32-åˆå§‹åŒ–åŠè¯´æ˜">3.2 åˆå§‹åŒ–åŠè¯´æ˜<a href="#32-åˆå§‹åŒ–åŠè¯´æ˜" class="hash-link" aria-label="Direct link to 3.2 åˆå§‹åŒ–åŠè¯´æ˜" title="Direct link to 3.2 åˆå§‹åŒ–åŠè¯´æ˜">â€‹</a></h3><p>åˆ›å»ºk8sé›†ç¾¤åŠetcdæ‰€éœ€è¦çš„è¯ä¹¦ç›®å½•ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ä¸‹é¢ä¸€ä¸ªå‘½ä»¤ä¸‰ä¸ªä¸»æœºéƒ½æ‰§è¡Œä¸€ä¸‹ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -pv /etc/kubernetes/TLS/</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">etcd,k8s</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¯´æ˜ï¼šä¸€å…±åˆ›å»ºäº†ä¸‰ä¸ªCAï¼Œåˆ†åˆ«ç”¨äºï¼š</p><ul><li>etcdé›†ç¾¤</li><li>apiserverã€controller managerã€kubeletã€kube-schedulerç­‰</li><li>front-proxy</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å››éƒ¨ç½²masterèŠ‚ç‚¹">å››ã€éƒ¨ç½²masterèŠ‚ç‚¹<a href="#å››éƒ¨ç½²masterèŠ‚ç‚¹" class="hash-link" aria-label="Direct link to å››ã€éƒ¨ç½²masterèŠ‚ç‚¹" title="Direct link to å››ã€éƒ¨ç½²masterèŠ‚ç‚¹">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41-éƒ¨ç½²etcdé›†ç¾¤">4.1 éƒ¨ç½²etcdé›†ç¾¤<a href="#41-éƒ¨ç½²etcdé›†ç¾¤" class="hash-link" aria-label="Direct link to 4.1 éƒ¨ç½²etcdé›†ç¾¤" title="Direct link to 4.1 éƒ¨ç½²etcdé›†ç¾¤">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="411-ä¸‹è½½å®‰è£…etcdå’ŒetcdctläºŒè¿›åˆ¶æ–‡ä»¶">4.1.1 ä¸‹è½½å®‰è£…etcdå’ŒetcdctläºŒè¿›åˆ¶æ–‡ä»¶<a href="#411-ä¸‹è½½å®‰è£…etcdå’ŒetcdctläºŒè¿›åˆ¶æ–‡ä»¶" class="hash-link" aria-label="Direct link to 4.1.1 ä¸‹è½½å®‰è£…etcdå’ŒetcdctläºŒè¿›åˆ¶æ–‡ä»¶" title="Direct link to 4.1.1 ä¸‹è½½å®‰è£…etcdå’ŒetcdctläºŒè¿›åˆ¶æ–‡ä»¶">â€‹</a></h4><p>æˆ‘ä»¬éœ€è¦åœ¨157ï¼Œ158å’Œ159ä¸‰å°æœºå™¨ä¸­éƒ½è£…ä¸Šetcdï¼Œä»¥ç»„æˆetcdé›†ç¾¤ï¼Œä¿è¯etcdçš„é«˜å¯ç”¨ã€‚</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 157ï¼Œ158ï¼Œ159æœºå™¨ä¸Šï¼Œä¹Ÿå°±æ˜¯masterå’Œnode01ã€node02èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åˆ›å»ºetcdç”¨æˆ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">useradd</span><span class="token plain"> -s /sbin/nologin -M etcd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/etcd-io/etcd/releases/download/v3.4.27/etcd-v3.4.27-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xf etcd-v3.4.27-linux-amd64.tar.gz -C /usr/local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> /usr/local/etcd-v3.4.27-linux-amd64 /usr/local/etcd-v3.4.27</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åˆ›å»ºè½¯è¿æ¥æ–¹ä¾¿ä½¿ç”¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -sv /usr/local/etcd-v3.4.27/etcd /usr/local/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -sv /usr/local/etcd-v3.4.27/etcdctl /usr/local/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ£€æŸ¥etcdå®‰è£…ç»“æœï¼š
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822141125.png" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="412-ä¸ºetcdåˆ¶ä½œè¯ä¹¦">4.1.2 ä¸ºetcdåˆ¶ä½œè¯ä¹¦<a href="#412-ä¸ºetcdåˆ¶ä½œè¯ä¹¦" class="hash-link" aria-label="Direct link to 4.1.2 ä¸ºetcdåˆ¶ä½œè¯ä¹¦" title="Direct link to 4.1.2 ä¸ºetcdåˆ¶ä½œè¯ä¹¦">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ä»…åœ¨masterä¸»æœºä¸Šæ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /etc/kubernetes/TLS/etcd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> ca-config.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;signing&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;default&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;expiry&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;87600h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;profiles&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;etcd&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token string" style="color:#e3116c">&quot;expiry&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;87600h&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token string" style="color:#e3116c">&quot;usages&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;signing&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;key encipherment&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;server auth&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;client auth&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> ca-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;etcd CA&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;algo&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rsa&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;size&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;names&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;L&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HangZhou&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;ST&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ZheJiang&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -initca ca-csr.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssl-json -bare ca</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ£€æŸ¥caç”Ÿæˆç»“æœï¼Œè§ä¸‹å›¾</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /etc/kubernetes/TLS/etcd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å°†å¯èƒ½ç”¨åˆ°çš„IPåŠ åˆ°hostså­—æ®µé‡Œé¢ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> etcd-server-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;etcd&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;hosts&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;172.19.82.157&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;172.19.82.158&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;172.19.82.159&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;192.168.3.28&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;10.96.0.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;algo&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rsa&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;size&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;names&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;L&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HangZhou&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;ST&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ZheJiang&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ä½¿ç”¨ä¸Šé¢çš„è‡ªç­¾CAç­¾å‘etcdè¯ä¹¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -ca</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem -ca-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-key.pem -config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-config.json -profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">etcd etcd-server-csr.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssl-json -bare etcd-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> é…ç½®æ–‡ä»¶å­—æ®µè§£é‡Šï¼š</p><blockquote><ul><li>CNï¼šCommon Nameï¼Œæµè§ˆå™¨ä½¿ç”¨è¯¥å­—æ®µéªŒè¯ç½‘å€æ˜¯å¦åˆæ³•ï¼Œä¸€èˆ¬å†™åŸŸåï¼Œéå¸¸é‡è¦</li><li>STï¼šStateï¼Œçœ</li><li>Lï¼šLocalityï¼Œåœ°åŒº</li><li>Oï¼šOrganization Nameï¼Œç»„ç»‡åç§°</li><li>OUï¼šOrganization Unit Nameï¼Œç»„ç»‡å•ä½åç§°</li></ul></blockquote><p>æ£€æŸ¥CAç”Ÿæˆç»“æœï¼š
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230823104905.png" alt="image.png" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ca-config.jsonè§£æï¼š</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>expiryï¼šæœ‰æ•ˆæœŸä¸º200å¹´
profiles-serverï¼šå¯åŠ¨serverçš„æ—¶å€™éœ€è¦é…ç½®è¯ä¹¦
profiles-clientï¼šclientå»è¿æ¥serverçš„æ—¶å€™éœ€è¦è¯ä¹¦
profiles-peerï¼šåŒå‘è¯ä¹¦ï¼ŒæœåŠ¡ç«¯æ‰¾å®¢æˆ·ç«¯éœ€è¦è¯ä¹¦ï¼Œå®¢æˆ·ç«¯æ‰¾æœåŠ¡ç«¯éœ€è¦è¯ä¹¦
etcd-peer-csrè§£æï¼š</p><p>hostsï¼šetcdæœ‰å¯èƒ½éƒ¨ç½²åˆ°å“ªäº›ç»„ä»¶çš„IPéƒ½è¦å¡«è¿›æ¥
cfssl gencertï¼šç”Ÿæˆè¯ä¹¦
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230823105545.png" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="413-é…ç½®åŠå¯åŠ¨etcdé›†ç¾¤">4.1.3 é…ç½®åŠå¯åŠ¨etcdé›†ç¾¤<a href="#413-é…ç½®åŠå¯åŠ¨etcdé›†ç¾¤" class="hash-link" aria-label="Direct link to 4.1.3 é…ç½®åŠå¯åŠ¨etcdé›†ç¾¤" title="Direct link to 4.1.3 é…ç½®åŠå¯åŠ¨etcdé›†ç¾¤">â€‹</a></h4><p>å¤åˆ¶è¯ä¹¦æ–‡ä»¶ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># å¤åˆ¶3.3ä¸­ç”Ÿæˆçš„è¯ä¹¦åˆ°certsç›®å½•ï¼Œæ³¨æ„ï¼Œä¸‰ä¸ªä¸»æœºéƒ½è¦æ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># node01ï¼Œè‡ªå·±åšå…å¯†å“¦ï¼Œè¿™é‡Œå°±ä¸æ•™äº†ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> -r master:/etc/kubernetes/TLS/etcd/*.pem /etc/kubernetes/TLS/etcd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># node02</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> -r master:/etc/kubernetes/TLS/etcd/*.pem /etc/kubernetes/TLS/etcd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç¼–å†™å¯åŠ¨è„šæœ¬ï¼š
âš æ³¨æ„ä»¥ä¸‹è„šæœ¬ä¸­ï¼Œnode01ï¼ˆ158ï¼‰ï¼Œnode02ï¼ˆ159ï¼‰ä¸»æœºä¸Šéƒ½è¦ä¿®æ”¹å¯¹åº”çš„ç›‘å¬åœ°å€ï¼Œä¸èƒ½ç…§æ¬.
éœ€è¦ä¿®æ”¹çš„åœ°æ–¹æœ‰ä»¥ä¸‹äº”å¤„ï¼š</p><ul><li><code>--name</code></li><li><code>--advertise-client-urls </code></li><li><code>--initial-advertise-peer-urls</code></li><li><code>--listen-peer-urls</code></li><li><code>--listen-client-urls</code></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># åœ¨157 masterä¸»æœºä¸Š</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /usr/local/etcd-v3.4.27/etcd-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/usr/bin/env sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./etcd --name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">etcd-server-157 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --advertise-client-urls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://172.19.82.157:2379 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cert-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/etcd-server.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --client-cert-auth</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --data-dir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/data/etcd </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --experimental-initial-corrupt-check</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --experimental-watch-progress-notify-interval</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">5s </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --initial-advertise-peer-urls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://172.19.82.157:2380 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --initial-cluster</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">etcd-server-157</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://172.19.82.157:2380,etcd-server-158</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://172.19.82.158:2380,etcd-server-159</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://172.19.82.159:2380 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --key-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/etcd-server-key.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --listen-client-urls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://127.0.0.1:2379,https://172.19.82.157:2379 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --listen-metrics-urls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">http://127.0.0.1:2381 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --listen-peer-urls</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://172.19.82.157:2380 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --peer-cert-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/etcd-server.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --peer-client-cert-auth</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --peer-key-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/etcd-server-key.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --peer-trusted-ca-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --snapshot-count</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10000</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --trusted-ca-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/ca.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230823111335.png" alt="image.png" class="img_ev3q">
ä¿®æ”¹è„šæœ¬åŠç›®å½•æƒé™ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /usr/local/etcd-v3.4.27/etcd-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> -R etcd:etcd /usr/local/etcd-v3.4.27/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> -R etcd:etcd /data/etcd/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> -R etcd:etcd /data/logs/etcd-server/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> -R etcd:etcd /etc/kubernetes/TLS/etcd/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åˆ›å»ºsupervisoré…ç½®æ–‡ä»¶ï¼š
ä¸‰ä¸ªä¸»æœºéƒ½å¾—æ‰§è¡Œï¼Œä¸åŒä¸»æœºåªéœ€è¦ä¿®æ”¹ä¸‹<code>[program:etcd-server-157]</code>è¿™ä¸ªå³å¯ï¼Œæ¢æˆ158å’Œ159.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/supervisor/conf.d/etcd-server.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">program:etcd-server-157</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">command</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/etcd-v3.4.27/etcd-startup.sh                 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> the program </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">relative uses </span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain">, can take args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">numprocs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                                                      </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of processes copies to start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">directory</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/etcd-v3.4.27                               </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> directory to cwd to before </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def no cwd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autostart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> start at supervisord start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autorestart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> retstart at unexpected quit </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                                                    </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of secs prog must stay running </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def. </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startretries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">                                                  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># of serial start failures (default 3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">exitcodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0,2</span><span class="token plain">                                                   </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;expected&#x27;</span><span class="token plain"> </span><span class="token builtin class-name">exit</span><span class="token plain"> codes </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0,2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopsignal</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QUIT                                                 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> signal used to </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token environment constant" style="color:#36acaa">TERM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopwaitsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain">                                                 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max num secs to </span><span class="token function" style="color:#d73a49">wait</span><span class="token plain"> b4 SIGKILL </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">etcd                                                       </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> setuid to this UNIX account to run the program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">redirect_stderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                            </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> redirect proc stderr to stdout </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/data/logs/etcd-server/etcd.stdout.log           </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> stdout log path, NONE </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> none</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> default AUTO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">64MB                                    </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># logfile bytes b4 rotation (default 50MB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_backups</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">                                        </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># of stdout logfile backups (default 10)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_capture_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">1MB                                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of bytes </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;capturemode&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_events_enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false                                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> emit events on stdout writes </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é‡è½½supervisoré…ç½®æ–‡ä»¶ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">supervisorctl update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supervisorctl status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822151410.png" alt="image.png" class="img_ev3q">
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼ˆleaderæ˜¯è°ï¼Ÿï¼‰</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">etcdctl -w table --cacert</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/ca.pem --cert</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/etcd-server.pem --key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/etcd-server-key.pem --endpoints https://172.19.82.157:2379 endpoint status --cluster</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">![image.png](https://cdn.agou-ops.cn/others/20230823111655.png)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">etcdctl -w table --cacert=/etc/kubernetes/TLS/etcd/ca.pem --cert=/etc/kubernetes/TLS/etcd/etcd-server.pem --key=/etc/kubernetes/TLS/etcd/etcd-server-key.pem --endpoints https://172.19.82.157:2379 member list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230823111723.png" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42-éƒ¨ç½²api-server">4.2 éƒ¨ç½²API server<a href="#42-éƒ¨ç½²api-server" class="hash-link" aria-label="Direct link to 4.2 éƒ¨ç½²API server" title="Direct link to 4.2 éƒ¨ç½²API server">â€‹</a></h3><p>API serveræˆ‘å°±ä¸åšé›†ç¾¤äº†ï¼ˆå•èŠ‚ç‚¹ï¼‰ï¼Œæ–¹æ³•å…¶å®å’Œetcdå¤§å·®ä¸å·®.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="421-ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦">4.2.1 ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦<a href="#421-ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦" class="hash-link" aria-label="Direct link to 4.2.1 ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦" title="Direct link to 4.2.1 ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># è¿™é‡Œç›´æ¥ä½¿ç”¨ä¸Šé¢etcdçš„è‡ªå»ºCAï¼Œå¦‚æœetcdéƒ¨ç½²åˆ°é›†ç¾¤ä¹‹å¤–çš„è¯ï¼Œå¯ä»¥é‡æ–°å»ºä¸ªCAä»¥ä½œåŒºåˆ†ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># masterä¸»æœºä¸Š</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /etc/kubernetes/TLS/k8s/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> ca-config.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;signing&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;default&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;expiry&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;87600h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;profiles&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;kubernetes&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token string" style="color:#e3116c">&quot;expiry&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;87600h&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token string" style="color:#e3116c">&quot;usages&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;signing&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;key encipherment&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;server auth&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;client auth&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> ca-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kubernetes&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;algo&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rsa&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;size&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;names&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;L&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HangZhou&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;ST&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ZheJiang&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;O&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;k8s&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;OU&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;System&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -initca ca-csr.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssl-json -bare ca -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> kube-apiserver-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kubernetes&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;hosts&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;kubernetes&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;kubernetes.default&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;kubernetes.default.svc&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;kubernetes.default.svc.cluster&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;kubernetes.default.svc.cluster.local&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;172.19.82.157&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;172.19.82.158&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;172.19.82.159&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;192.168.3.28&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;10.96.0.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;algo&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rsa&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;size&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;names&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;L&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HangZhou&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;ST&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ZheJiang&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;O&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;k8s&quot;</span><span class="token plain">,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;OU&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;System&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -ca</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem -ca-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-key.pem -config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-config.json -profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes kube-apiserver-csr.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssl-json -bare kube-apiserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ç”Ÿæˆsa keyï¼Œåé¢ä¼šç”¨åˆ°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl genrsa -out sa.key </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl rsa -in sa.key -pubout -out sa.pub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> proxy-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> proxy-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> front-proxy-ca-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;CA&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;expiry&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;87600h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kubernetes&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token string" style="color:#e3116c">&quot;algo&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rsa&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token string" style="color:#e3116c">&quot;size&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -initca front-proxy-ca-csr.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssl-json -bare front-proxy-ca</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> front-proxy-client-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;front-proxy-client&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token string" style="color:#e3116c">&quot;algo&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rsa&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token string" style="color:#e3116c">&quot;size&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-ca</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">front-proxy-ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-ca-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">front-proxy-ca-key.pem  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-config</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/ca-config.json   </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes front-proxy-client-csr.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssl-json -bare front-proxy-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230823114325.png" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="422-éƒ¨ç½²api-server">4.2.2 éƒ¨ç½²api-server<a href="#422-éƒ¨ç½²api-server" class="hash-link" aria-label="Direct link to 4.2.2 éƒ¨ç½²api-server" title="Direct link to 4.2.2 éƒ¨ç½²api-server">â€‹</a></h4><p>ä»“åº“åœ°å€ï¼š<a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.25.md#v12512" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.25.md#v12512</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://dl.k8s.io/v1.25.12/kubernetes-server-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xf kubernetes-server-linux-amd64.tar.gz -C /usr/local/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /usr/local/kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åˆ é™¤ä¸å¿…è¦çš„æºç å’Œæ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -f kubernetes-src.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf server/bin/*.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf server/bin/*_tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ è½¯è¿æ¥æ–¹ä¾¿ä½¿ç”¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -sv /usr/local/kubernetes/server/bin/* /usr/local/bin/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¯åŠ¨è„šæœ¬ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /etc/kubernetes/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /usr/local/kubernetes/server/bin/kube-apiserver-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/usr/bin/env sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ä¸‹é¢çš„certå’Œkeyç»Ÿç»Ÿç”¨ä¸€å¥—å°±å¥½äº†ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/usr/bin/env sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./kube-apiserver </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --v</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --logtostderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --allow-privileged</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --bind-address</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.157  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --secure-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">6443</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --advertise-address</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">157</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --service-cluster-ip-range</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.244</span><span class="token plain">.0.0/12 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --service-node-port-range</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">30000</span><span class="token plain">-40000  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --etcd-servers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://172.19.82.157:2379,https://172.19.82.158:2379,https://172.19.82.159:2379 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --etcd-cafile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --etcd-certfile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/etcd-server.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --etcd-keyfile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/etcd/etcd-server-key.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --client-ca-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --tls-cert-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/kube-apiserver.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --tls-private-key-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/kube-apiserver-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubelet-client-certificate</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/kube-apiserver.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubelet-client-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/kube-apiserver-key.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --service-account-key-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/sa.pub  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --service-account-signing-key-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/sa.key  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --service-account-issuer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://kubernetes.default.svc.cluster.local </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubelet-preferred-address-types</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">InternalIP,ExternalIP,Hostname  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --enable-admission-plugins</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --authorization-mode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Node,RBAC  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --enable-bootstrap-token-auth</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --requestheader-client-ca-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/proxy-client/front-proxy-ca.pem  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --proxy-client-cert-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/proxy-client/front-proxy-client.pem  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --proxy-client-key-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/proxy-client/front-proxy-client-key.pem  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --requestheader-allowed-names</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">front-proxy-client  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --requestheader-group-headers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">X-Remote-Group  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --requestheader-extra-headers-prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">X-Remote-Extra-  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --requestheader-username-headers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">X-Remote-User  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /usr/local/kubernetes/server/bin/kube-apiserver-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -pv /data/logs/kubernetes/kube-apiserver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é…ç½®supervisorï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/supervisor/conf.d/apiserver.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">program:apiserver-157</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">command</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/kubernetes/server/bin/kube-apiserver-startup.sh                 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> the program </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">relative uses </span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain">, can take args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">numprocs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                                                      </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of processes copies to start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">directory</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/kubernetes/server/bin                               </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> directory to cwd to before </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def no cwd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autostart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> start at supervisord start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autorestart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> retstart at unexpected quit </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                                                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of secs prog must stay running </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def. </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startretries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">                                                  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># of serial start failures (default 3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">exitcodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0,2</span><span class="token plain">                                                   </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;expected&#x27;</span><span class="token plain"> </span><span class="token builtin class-name">exit</span><span class="token plain"> codes </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0,2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopsignal</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QUIT                                                 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> signal used to </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token environment constant" style="color:#36acaa">TERM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopwaitsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain">                                                 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max num secs to </span><span class="token function" style="color:#d73a49">wait</span><span class="token plain"> b4 SIGKILL </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root                                                       </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> setuid to this UNIX account to run the program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">redirect_stderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                            </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> redirect proc stderr to stdout </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/data/logs/kubernetes/kube-apiserver/apiserver.stdout.log           </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> stdout log path, NONE </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> none</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> default AUTO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">64MB                                    </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># logfile bytes b4 rotation (default 50MB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_backups</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">                                        </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># of stdout logfile backups (default 10)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_capture_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">1MB                                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of bytes </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;capturemode&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_events_enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false                                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> emit events on stdout writes </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># é‡è½½supervisoré…ç½®æ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supervisorctl update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss -tnulp  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp   LISTEN </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">16384</span><span class="token plain">                                *:6443             *:*    users:</span><span class="token variable punctuation" style="color:#393A34">((</span><span class="token variable" style="color:#36acaa">&quot;kube</span><span class="token variable operator" style="color:#393A34">-</span><span class="token variable" style="color:#36acaa">apiserver&quot;</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">pid</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">5989</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">fd</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">7</span><span class="token variable punctuation" style="color:#393A34">))</span><span class="token plain">                                            </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230822170053.png" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43-éƒ¨ç½²controller-manager">4.3 éƒ¨ç½²controller-manager<a href="#43-éƒ¨ç½²controller-manager" class="hash-link" aria-label="Direct link to 4.3 éƒ¨ç½²controller-manager" title="Direct link to 4.3 éƒ¨ç½²controller-manager">â€‹</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /etc/kubernetes/TLS/k8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> kube-controller-manager-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;system:kube-controller-manager&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;hosts&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;algo&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rsa&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;size&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;names&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;L&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HangZhou&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;ST&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ZheJiang&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;O&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;system:kube-controller-manager&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;OU&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;System&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -ca</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem -ca-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-key.pem -config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-config.json -profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes kube-controller-manager-csr.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssl-json -bare kube-controller-manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ é›†ç¾¤apiserverä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-cluster kubernetes </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --certificate-authority</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --embed-certs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --server</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;https://172.19.82.157:6443&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-controller-manager.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ è¯ä¹¦æ–‡ä»¶ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-credentials system:kube-controller-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --client-certificate</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/kube-controller-manager.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --client-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/kube-controller-manager-key.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --embed-certs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-controller-manager.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ ç”¨æˆ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-context default </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">system:kube-controller-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-controller-manager.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šé»˜è®¤çš„é›†ç¾¤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context default --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-controller-manager.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /usr/local/kubernetes/server/bin/kube-controller-manager-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/usr/bin/env sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./kube-controller-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --v</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --root-ca-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster-signing-cert-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster-signing-key-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/ca-key.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --service-account-private-key-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/sa.key </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-controller-manager.kubeconfig </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --leader-elect</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --use-service-account-credentials</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --node-monitor-grace-period</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">40s </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --node-monitor-period</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">5s </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --pod-eviction-timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">2m0s </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --controllers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">*,bootstrapsigner,tokencleaner </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --allocate-node-cidrs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster-cidr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.244</span><span class="token plain">.0.0/12 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --requestheader-client-ca-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/proxy-client/front-proxy-ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --node-cidr-mask-size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /usr/local/kubernetes/server/bin/kube-controller-manager-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -pv /data/logs/kubernetes/kube-controller-manager/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/supervisor/conf.d/controller-manager.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">program:kube-controller-manager-157</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">command</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/kubernetes/server/bin/kube-controller-manager-startup.sh                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> the program </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">relative uses </span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain">, can take args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">numprocs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                                                                        </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of processes copies to start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">directory</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/kubernetes/server/bin                                              </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> directory to cwd to before </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def no cwd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autostart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                                    </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> start at supervisord start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autorestart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                                  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> retstart at unexpected quit </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">30</span><span class="token plain">                                                                      </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of secs prog must stay running </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def. </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startretries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">                                                                    </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># of serial start failures (default 3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">exitcodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0,2</span><span class="token plain">                                                                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;expected&#x27;</span><span class="token plain"> </span><span class="token builtin class-name">exit</span><span class="token plain"> codes </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0,2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopsignal</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QUIT                                                                   </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> signal used to </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token environment constant" style="color:#36acaa">TERM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopwaitsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain">                                                                   </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max num secs to </span><span class="token function" style="color:#d73a49">wait</span><span class="token plain"> b4 SIGKILL </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root                                                                         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> setuid to this UNIX account to run the program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">redirect_stderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                              </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> redirect proc stderr to stdout </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/data/logs/kubernetes/kube-controller-manager/controller.stdout.log  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> stderr log path, NONE </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> none</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> default AUTO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">64MB                                                      </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># logfile bytes b4 rotation (default 50MB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_backups</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">                                                          </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># of stdout logfile backups (default 10)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_capture_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">1MB                                                       </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of bytes </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;capturemode&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_events_enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false                                                       </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> emit events on stdout writes </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230823134408.png" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="44-éƒ¨ç½²kube-scheduler">4.4 éƒ¨ç½²kube-scheduler<a href="#44-éƒ¨ç½²kube-scheduler" class="hash-link" aria-label="Direct link to 4.4 éƒ¨ç½²kube-scheduler" title="Direct link to 4.4 éƒ¨ç½²kube-scheduler">â€‹</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /etc/kubernetes/TLS/k8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> kube-scheduler-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;system:kube-scheduler&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;hosts&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;algo&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rsa&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;size&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;names&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;L&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HangZhou&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;ST&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ZheJiang&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;O&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;system:kube-scheduler&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;OU&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;System&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -ca</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem -ca-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-key.pem -config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-config.json -profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes kube-scheduler-csr.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssl-json -bare kube-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ é›†ç¾¤apiserverä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-cluster kubernetes </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --certificate-authority</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --embed-certs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --server</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;https://172.19.82.157:6443&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-scheduler.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ è¯ä¹¦æ–‡ä»¶ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-credentials system:kube-scheduler </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --client-certificate</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/kube-scheduler.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --client-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/kube-scheduler-key.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --embed-certs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-scheduler.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ ç”¨æˆ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-context default </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">system:kube-scheduler </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-scheduler.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šé»˜è®¤çš„é›†ç¾¤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context default --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-scheduler.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /usr/local/kubernetes/server/bin/kube-scheduler-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/usr/bin/env sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./kube-scheduler </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --v</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --leader-elect</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-scheduler.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /usr/local/kubernetes/server/bin/kube-scheduler-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -pv /data/logs/kubernetes/kube-scheduler/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/supervisor/conf.d/scheduler.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">program:kube-scheduler-157</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">command</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/kubernetes/server/bin/kube-scheduler-startup.sh                   </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> the program </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">relative uses </span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain">, can take args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">numprocs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                                                               </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of processes copies to start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">directory</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/kubernetes/server/bin                                  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> directory to cwd to before </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def no cwd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autostart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                           </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> start at supervisord start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autorestart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> retstart at unexpected quit </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                                                             </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of secs prog must stay running </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def. </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startretries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">                                                           </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># of serial start failures (default 3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">exitcodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0,2</span><span class="token plain">                                                            </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;expected&#x27;</span><span class="token plain"> </span><span class="token builtin class-name">exit</span><span class="token plain"> codes </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0,2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopsignal</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QUIT                                                          </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> signal used to </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token environment constant" style="color:#36acaa">TERM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopwaitsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain">                                                          </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max num secs to </span><span class="token function" style="color:#d73a49">wait</span><span class="token plain"> b4 SIGKILL </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root                                                                </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> setuid to this UNIX account to run the program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">redirect_stderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> redirect proc stderr to stdout </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/data/logs/kubernetes/kube-scheduler/scheduler.stdout.log </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> stderr log path, NONE </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> none</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> default AUTO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">64MB                                             </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># logfile bytes b4 rotation (default 50MB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_backups</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">                                                 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># of stdout logfile backups (default 10)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_capture_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">1MB                                              </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of bytes </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;capturemode&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_events_enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false                                              </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> emit events on stdout writes </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supervisorctl update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è‡³æ­¤ï¼ŒmasterèŠ‚ç‚¹çš„æ ¸å¿ƒç»„ä»¶åŸºæœ¬å®‰è£…å®Œæˆäº†ï¼Œä½¿ç”¨sså‘½ä»¤æŸ¥çœ‹æœåŠ¡ç›‘å¬çŠ¶æ€ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ss -tnulp </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> kube</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp   LISTEN </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">16384</span><span class="token plain">                        </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:10259      </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:*    users:</span><span class="token variable punctuation" style="color:#393A34">((</span><span class="token variable" style="color:#36acaa">&quot;kube</span><span class="token variable operator" style="color:#393A34">-</span><span class="token variable" style="color:#36acaa">scheduler&quot;</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">pid</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">9385</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">fd</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">7</span><span class="token variable punctuation" style="color:#393A34">))</span><span class="token plain">                                                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp   LISTEN </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">16384</span><span class="token plain">                        </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:10257      </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:*    users:</span><span class="token variable punctuation" style="color:#393A34">((</span><span class="token variable" style="color:#36acaa">&quot;kube</span><span class="token variable operator" style="color:#393A34">-</span><span class="token variable" style="color:#36acaa">controller&quot;</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">pid</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">9370</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">fd</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">7</span><span class="token variable punctuation" style="color:#393A34">))</span><span class="token plain">                                                                    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp   LISTEN </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">16384</span><span class="token plain">                                *:6443             *:*    users:</span><span class="token variable punctuation" style="color:#393A34">((</span><span class="token variable" style="color:#36acaa">&quot;kube</span><span class="token variable operator" style="color:#393A34">-</span><span class="token variable" style="color:#36acaa">apiserver&quot;</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">pid</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">5989</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">fd</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">7</span><span class="token variable punctuation" style="color:#393A34">))</span><span class="token plain">                                                                    </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="45-é…ç½®kubectlæ‰€éœ€è¦çš„kubeconfig">4.5 é…ç½®kubectlæ‰€éœ€è¦çš„kubeconfig<a href="#45-é…ç½®kubectlæ‰€éœ€è¦çš„kubeconfig" class="hash-link" aria-label="Direct link to 4.5 é…ç½®kubectlæ‰€éœ€è¦çš„kubeconfig" title="Direct link to 4.5 é…ç½®kubectlæ‰€éœ€è¦çš„kubeconfig">â€‹</a></h3><p>æ­¥éª¤å¤§ä½“å’Œä¸Šé¢éƒ½æ˜¯ä¸€è‡´çš„ã€‚</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /etc/kubernetes/TLS/k8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> kubectl-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kubectl&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;hosts&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;algo&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rsa&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;size&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;names&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;L&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HangZhou&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;ST&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ZheJiang&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;O&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;system:masters&quot;</span><span class="token plain">,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;OU&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;System&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -ca</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem -ca-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-key.pem -config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-config.json -profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes kubectl-csr.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssl-json -bare kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># è¿™ä¸ªä½ æ”¾åˆ°å’Œä¸Šé¢åŒæ ·çš„ä½ç½®ï¼Œç„¶åå¤åˆ¶åˆ°~/.kubeé‡Œé¢ä¹Ÿè¡Œï¼Œè¿™é‡Œæˆ‘å›¾ä¸ªæ–¹ä¾¿</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ é›†ç¾¤apiserverä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-cluster kubernetes </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--certificate-authority</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--embed-certs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--server</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;https://172.19.82.157:6443&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/root/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ è¯ä¹¦æ–‡ä»¶ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-credentials cluster-admin </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--client-certificate</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/kubectl.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--client-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/kubectl-key.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--embed-certs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/root/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ ç”¨æˆ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-context default </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--cluster</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">cluster-admin </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/root/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šé»˜è®¤çš„é›†ç¾¤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context default --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/root/.kube/config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230823163202.png" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="46-éƒ¨ç½²nodeç›¸å…³ç»„ä»¶kube-proxykubelet">4.6 éƒ¨ç½²nodeç›¸å…³ç»„ä»¶kube-proxyã€kubelet<a href="#46-éƒ¨ç½²nodeç›¸å…³ç»„ä»¶kube-proxykubelet" class="hash-link" aria-label="Direct link to 4.6 éƒ¨ç½²nodeç›¸å…³ç»„ä»¶kube-proxyã€kubelet" title="Direct link to 4.6 éƒ¨ç½²nodeç›¸å…³ç»„ä»¶kube-proxyã€kubelet">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="461-bootstrapè‡ªåŠ¨è®¤è¯kubelet">4.6.1 bootstrapè‡ªåŠ¨è®¤è¯kubelet<a href="#461-bootstrapè‡ªåŠ¨è®¤è¯kubelet" class="hash-link" aria-label="Direct link to 4.6.1 bootstrapè‡ªåŠ¨è®¤è¯kubelet" title="Direct link to 4.6.1 bootstrapè‡ªåŠ¨è®¤è¯kubelet">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /etc/kubernetes/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ç”Ÿæˆéšæœºè®¤è¯tokenidå’Œsecretï¼Œå¹¶èµ‹äºˆæƒé™ï¼Œä¸‹é¢ç›´åˆ°EOFä¸€å—æ‰§è¡Œã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TOKEN_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> -c </span><span class="token variable number" style="color:#36acaa">16</span><span class="token variable" style="color:#36acaa"> /dev/urandom </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> od -An -t x </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">tr</span><span class="token variable" style="color:#36acaa"> -d </span><span class="token variable string" style="color:#e3116c">&#x27; &#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> -c6</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TOKEN_SECRET</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> -c </span><span class="token variable number" style="color:#36acaa">16</span><span class="token variable" style="color:#36acaa"> /dev/urandom </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> od -An -t x </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">tr</span><span class="token variable" style="color:#36acaa"> -d </span><span class="token variable string" style="color:#e3116c">&#x27; &#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> -c16</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> bootstrap.secret.yaml </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: bootstrap-token-</span><span class="token string variable" style="color:#36acaa">$a</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">type: bootstrap.kubernetes.io/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">stringData:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  description: &quot;The default bootstrap token generated by &#x27;kubelet &#x27;.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  token-id: &quot;</span><span class="token string variable" style="color:#36acaa">$TOKEN_ID</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  token-secret: &quot;</span><span class="token string variable" style="color:#36acaa">$TOKEN_SECRET</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  usage-bootstrap-authentication: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  usage-bootstrap-signing: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  auth-extra-groups:  system:bootstrappers:default-node-token,system:bootstrappers:worker,system:bootstrappers:ingress</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: kubelet-bootstrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:node-bootstrapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">- apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  kind: Group</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:bootstrappers:default-node-token</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: node-autoapprove-bootstrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:certificates.k8s.io:certificatesigningrequests:nodeclient</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">- apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  kind: Group</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:bootstrappers:default-node-token</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: node-autoapprove-certificate-rotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:certificates.k8s.io:certificatesigningrequests:selfnodeclient</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">- apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  kind: Group</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    rbac.authorization.kubernetes.io/autoupdate: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    kubernetes.io/bootstrapping: rbac-defaults</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:kube-apiserver-to-kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - apiGroups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      - &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      - nodes/proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      - nodes/stats</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      - nodes/log</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      - nodes/spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      - nodes/metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    verbs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      - &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:kube-apiserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  namespace: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:kube-apiserver-to-kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    kind: User</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    name: kube-apiserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ é›†ç¾¤apiserverä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-cluster kubernetes  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --certificate-authority</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --embed-certs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true   </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --server</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;https://172.19.82.157:6443&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet-bootstrap.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ è¯ä¹¦æ–‡ä»¶ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-credentials kubelet-bootstrap-user  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --token</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$TOKEN_ID</span><span class="token builtin class-name">.</span><span class="token variable" style="color:#36acaa">$TOKEN_SECRET</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet-bootstrap.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ ç”¨æˆ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-context kubelet-bootstrap-user@kubernetes </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes   </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubelet-bootstrap-user </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet-bootstrap.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šé»˜è®¤çš„é›†ç¾¤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context kubelet-bootstrap-user@kubernetes  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet-bootstrap.kubeconfig</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="462-éƒ¨ç½²kubelet">4.6.2 éƒ¨ç½²kubelet<a href="#462-éƒ¨ç½²kubelet" class="hash-link" aria-label="Direct link to 4.6.2 éƒ¨ç½²kubelet" title="Direct link to 4.6.2 éƒ¨ç½²kubelet">â€‹</a></h4><p>âš  ç”±äºmasterèŠ‚ç‚¹åŒæ ·è¦è¿è¡Œä¸€äº›podï¼Œæ¯”å¦‚flannelã€calicoç½‘ç»œç»„ä»¶ç­‰ï¼Œæ‰€ä»¥åœ¨masterèŠ‚ç‚¹ä¹Ÿéœ€è¦å®‰è£…Kubeletå’ŒKube-proxyç»„ä»¶ã€‚</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># å‚è€ƒï¼šhttps://kubernetes.io/zh-cn/docs/reference/config-api/kubelet-config.v1beta1/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/kubernetes/config/kubelet-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: kubelet.config.k8s.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: KubeletConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">address: </span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.157</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port: </span><span class="token number" style="color:#36acaa">10250</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">readOnlyPort: </span><span class="token number" style="color:#36acaa">10255</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">authentication:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  anonymous:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  webhook:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cacheTTL: 2m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x509:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clientCAFile: /etc/kubernetes/TLS/k8s/ca.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">authorization:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mode: Webhook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  webhook:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cacheAuthorizedTTL: 5m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cacheUnauthorizedTTL: 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cgroupDriver: systemd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cgroupsPerQOS: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterDNS:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- </span><span class="token number" style="color:#36acaa">10.100</span><span class="token plain">.0.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterDomain: cluster.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">containerLogMaxFiles: </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">containerLogMaxSize: 10Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contentType: application/vnd.kubernetes.protobuf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cpuCFSQuota: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cpuManagerPolicy: none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cpuManagerReconcilePeriod: 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enableControllerAttachDetach: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enableDebuggingHandlers: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enforceNodeAllocatable:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eventBurst: </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eventRecordQPS: </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evictionHard:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  imagefs.available: </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  memory.available: 100Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nodefs.available: </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nodefs.inodesFree: </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evictionPressureTransitionPeriod: 5m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">failSwapOn: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fileCheckFrequency: 20s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hairpinMode: promiscuous-bridge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">healthzBindAddress: </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">healthzPort: </span><span class="token number" style="color:#36acaa">10248</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">httpCheckFrequency: 20s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imageGCHighThresholdPercent: </span><span class="token number" style="color:#36acaa">85</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imageGCLowThresholdPercent: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imageMinimumGCAge: 2m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptablesDropBit: </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptablesMasqueradeBit: </span><span class="token number" style="color:#36acaa">14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeAPIBurst: </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeAPIQPS: </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">makeIPTablesUtilChains: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maxOpenFiles: </span><span class="token number" style="color:#36acaa">1000000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maxPods: </span><span class="token number" style="color:#36acaa">110</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nodeStatusUpdateFrequency: 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oomScoreAdj: -999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">podPidsLimit: -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">registryBurst: </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">registryPullQPS: </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolvConf: /etc/resolv.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rotateCertificates: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtimeRequestTimeout: 2m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serializeImagePulls: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">staticPodPath: /etc/kubernetes/manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">streamingConnectionIdleTimeout: 4h0m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syncFrequency: 1m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volumeStatsAggPeriod: 1m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /usr/local/kubernetes/server/bin/kubelet-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/usr/bin/env sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./kubelet </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --bootstrap-kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet-bootstrap.kubeconfig </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet.kubeconfig </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet-conf.yml </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --hostname-override</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">master0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --node-labels</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">node.kubernetes.io/node</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --container-runtime-endpoint</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">unix:///var/run/containerd/containerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ é›†ç¾¤apiserverä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-cluster kubernetes </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--certificate-authority</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--embed-certs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--server</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;https://172.19.82.157:6443&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet-bootstrap.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ è¯ä¹¦æ–‡ä»¶ä¿¡æ¯ï¼Œä¸‹é¢è¿™ä¸ªtokenæ˜¯ä¹‹å‰ç”Ÿæˆçš„ï¼Œä¹Ÿå°±æ˜¯/etc/kubernetes/config/token.csv</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-credentials kubelet-bootstrap </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--token</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">8d435b925863119020c4da4d16e064c8 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet-bootstrap.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ ç”¨æˆ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-context default </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--cluster</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubelet-bootstrap </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet-bootstrap.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šé»˜è®¤çš„é›†ç¾¤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context default --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kubelet-bootstrap.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /usr/local/kubernetes/server/bin/kubelet-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -pv /data/logs/kubernetes/kubelet/ /etc/kubernetes/manifests/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/supervisor/conf.d/kubelet.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">program:kubelet-157</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">command</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/kubernetes/server/bin/kubelet-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> the program </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">relative uses </span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain">, can take args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">numprocs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                                                               </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of processes copies to start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">directory</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/kubernetes/server/bin                                  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> directory to cwd to before </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def no cwd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autostart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                           </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> start at supervisord start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autorestart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> retstart at unexpected quit </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                                                             </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of secs prog must stay running </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def. </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startretries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">                                                           </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># of serial start failures (default 3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">exitcodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0,2</span><span class="token plain">                                                            </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;expected&#x27;</span><span class="token plain"> </span><span class="token builtin class-name">exit</span><span class="token plain"> codes </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0,2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopsignal</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QUIT                                                          </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> signal used to </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token environment constant" style="color:#36acaa">TERM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopwaitsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain">                                                          </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max num secs to </span><span class="token function" style="color:#d73a49">wait</span><span class="token plain"> b4 SIGKILL </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root                                                                </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> setuid to this UNIX account to run the program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">redirect_stderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> redirect proc stderr to stdout </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/data/logs/kubernetes/kubelet/kubelet.stdout.log </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> stderr log path, NONE </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> none</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> default AUTO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">64MB                                             </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># logfile bytes b4 rotation (default 50MB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_backups</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">                                                 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># of stdout logfile backups (default 10)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_capture_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">1MB                                              </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of bytes </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;capturemode&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_events_enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false                                              </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> emit events on stdout writes </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supervisorctl update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230824111121.png" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="463-å°†masterèŠ‚ç‚¹ä½œä¸ºnodeåŠ å…¥åˆ°é›†ç¾¤å†…éƒ¨">4.6.3 å°†masterèŠ‚ç‚¹ä½œä¸ºnodeåŠ å…¥åˆ°é›†ç¾¤å†…éƒ¨<a href="#463-å°†masterèŠ‚ç‚¹ä½œä¸ºnodeåŠ å…¥åˆ°é›†ç¾¤å†…éƒ¨" class="hash-link" aria-label="Direct link to 4.6.3 å°†masterèŠ‚ç‚¹ä½œä¸ºnodeåŠ å…¥åˆ°é›†ç¾¤å†…éƒ¨" title="Direct link to 4.6.3 å°†masterèŠ‚ç‚¹ä½œä¸ºnodeåŠ å…¥åˆ°é›†ç¾¤å†…éƒ¨">â€‹</a></h4><p><strong>âš  æ³¨æ„ï¼šè¿™ä¸ªæ­¥éª¤å¦‚æœåšäº†bootstrap kubeletï¼Œåˆ™ä¸éœ€è¦æ‰‹åŠ¨æˆæƒï¼Œå¯ç›´æ¥å¿½ç•¥æ”¹æ­¥éª¤ã€‚</strong></p><blockquote><p> ä»¥ä¸‹æ¥æºäºç½‘ç»œï¼š
å½“kubeletç»„ä»¶å¯åŠ¨æˆåŠŸåï¼Œå°±ä¼šæƒ³apiserverå‘é€ä¸€ä¸ªè¯·æ±‚åŠ å…¥é›†ç¾¤çš„ä¿¡æ¯ï¼Œåªæœ‰å½“masterèŠ‚ç‚¹æˆæƒåŒæ„åï¼Œæ‰å¯ä»¥æ­£å¸¸åŠ å…¥ï¼Œè™½ç„¶æ˜¯masterèŠ‚ç‚¹éƒ¨ç½²çš„nodeç»„ä»¶ï¼Œ&gt; ä½†æ˜¯ä¹Ÿä¼šå‘ç”Ÿä¸€ä¸ªåŠ å…¥é›†ç¾¤çš„ä¿¡æ¯ï¼Œéœ€è¦masteråŒæ„ã€‚</p><p>å½“kubeletå¯åŠ¨ä¹‹åï¼Œé¦–å…ˆä¼šåœ¨è¯ä¹¦ç›®å½•ç”Ÿæˆä¸€ä¸ªkubelet-client.key.tmpè¿™ä¸ªæ–‡ä»¶ï¼Œå½“ä½¿ç”¨kubectl certificate approveå‘½ä»¤æˆæƒæˆåŠŸnodeçš„è¯·æ±‚ä¹‹åï¼Œkubele&gt; t-client.key.tmpå°æ—¶ï¼Œéšä¹‹ä¼šç”Ÿæˆä¸€ä¸ªkubelet-client-current.pemçš„è¯ä¹¦æ–‡ä»¶ï¼Œç”¨äºä¸apiserverå»ºç«‹è¿æ¥ï¼Œæ­¤æ—¶å†ä½¿ç”¨kubectl get &gt; nodeå°±ä¼šçœ‹åˆ°èŠ‚ç‚¹ä¿¡æ¯äº†ã€‚</p><p>æ‰©å±•ï¼šå¦‚æœåæœŸæƒ³è¦ä¿®æ”¹nodeçš„åç§°ï¼Œé‚£ä¹ˆå°±æŠŠç”Ÿæˆçš„kubeletè¯ä¹¦æ–‡ä»¶å…¨éƒ¨åˆ é™¤ï¼Œç„¶åä½¿ç”¨kubectl delete &gt; nodeåˆ é™¤è¯¥èŠ‚ç‚¹ï¼Œåœ¨ä¿®æ”¹kubeleté…ç½®æ–‡ä»¶ä¸­è¯¥èŠ‚ç‚¹çš„åç§°ï¼Œç„¶åä½¿ç”¨kubectl delete &gt; csråˆ é™¤æˆæƒä¿¡æ¯ï¼Œå†é‡å¯kubeletç”Ÿæˆæ–°çš„æˆæƒä¿¡æ¯ï¼Œç„¶åæˆæƒé€šè¿‡å³å¯çœ‹åˆ°æ–°çš„åå­—çš„nodeèŠ‚ç‚¹ã€‚</p><p>åªæœ‰å½“æˆæƒé€šè¿‡åï¼Œkubeletç”Ÿæˆäº†è¯ä¹¦æ–‡ä»¶ï¼Œkubeletçš„ç«¯å£æ‰ä¼šè¢«å¯åŠ¨</p><p>æ³¨æ„ï¼šå½“kubeletçš„æˆæƒè¢«masterè¯·æ±‚é€šåï¼Œkube-proxyå¯åŠ¨æˆåŠŸåï¼ŒèŠ‚ç‚¹æ‰ä¼šæ­£çœŸçš„åŠ å…¥é›†ç¾¤ï¼Œå³ä½¿kubectl get &gt; nodeçœ‹åˆ°çš„èŠ‚ç‚¹æ˜¯Readyï¼Œè¯¥èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸å¯ç”¨çš„ï¼Œå¿…é¡»å½“kube-proxyå¯åŠ¨å®Œæ¯•åï¼Œè¿™ä¸ªèŠ‚ç‚¹æ‰ç®—æ­£çœŸçš„å¯åŠ¨å®Œæ¯•.</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># masterèŠ‚ç‚¹ä¸Šï¼Œè·å–è¯·æ±‚åˆ—è¡¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                   AGE     SIGNERNAME                                    REQUESTOR           REQUESTEDDURATION   CONDITION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node-csr-VVgl1LpQ91JlbJLifEJIy_0KlbQ1mih6GPaGfaykQ-I   2m46s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">              Pending</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å‡†è®¸è¯¥èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl certificate approve node-csr-VVgl1LpQ91JlbJLifEJIy_0KlbQ1mih6GPaGfaykQ-I</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certificatesigningrequest.certificates.k8s.io/node-csr-VVgl1LpQ91JlbJLifEJIy_0KlbQ1mih6GPaGfaykQ-I approved</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>èŠ‚ç‚¹åŠ å…¥ç»“æœ<code>kubectl get nodes</code>ï¼š
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230824113851.png" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="463-éƒ¨ç½²kube-proxy">4.6.3 éƒ¨ç½²kube-proxy<a href="#463-éƒ¨ç½²kube-proxy" class="hash-link" aria-label="Direct link to 4.6.3 éƒ¨ç½²kube-proxy" title="Direct link to 4.6.3 éƒ¨ç½²kube-proxy">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kube-proxy.yml </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: kube-proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:kube-proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: system:node-proxier</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">- kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: kube-proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: kube-proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    kubernetes.io/service-account.name: &quot;kube-proxy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">type: kubernetes.io/service-account-token</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f kube-proxy.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># è·å–token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">JWT_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl -n kube-system get secret/kube-proxy </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">--output</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">jsonpath</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&#x27;{.data.token}&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> base64 -d</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ é›†ç¾¤apiserverä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-cluster kubernetes   </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --certificate-authority</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/TLS/k8s/ca.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --embed-certs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true    </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --server</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;https://172.19.82.157:6443&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-proxy.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-credentials system:kube-proxy    </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --token</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${JWT_TOKEN}</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-proxy.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ·»åŠ ç”¨æˆ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-context default    </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes   </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">system:kube-proxy   </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-proxy.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šé»˜è®¤çš„é›†ç¾¤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context default   </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubeconfig</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-proxy.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å‚è€ƒï¼šhttps://kubernetes.io/zh-cn/docs/reference/config-api/kube-proxy-config.v1alpha1/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/kubernetes/config/kube-proxy-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bindAddress: </span><span class="token number" style="color:#36acaa">172.19</span><span class="token plain">.82.157</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clientConnection:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  acceptContentTypes: </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  burst: </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  contentType: application/vnd.kubernetes.protobuf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubeconfig: /etc/kubernetes/config/kube-proxy.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  qps: </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterCIDR: </span><span class="token number" style="color:#36acaa">10.244</span><span class="token plain">.0.0/16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configSyncPeriod: 15m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conntrack:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  max: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  maxPerCore: </span><span class="token number" style="color:#36acaa">32768</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  min: </span><span class="token number" style="color:#36acaa">131072</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tcpCloseWaitTimeout: 1h0m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tcpEstablishedTimeout: 24h0m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enableProfiling: </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">healthzBindAddress: </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:10256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hostnameOverride: </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$a</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  masqueradeAll: </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  masqueradeBit: </span><span class="token number" style="color:#36acaa">14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  minSyncPeriod: 0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  syncPeriod: 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipvs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  masqueradeAll: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  minSyncPeriod: 5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scheduler: </span><span class="token string" style="color:#e3116c">&quot;rr&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  syncPeriod: 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: KubeProxyConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metricsBindAddress: </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:10249</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mode: </span><span class="token string" style="color:#e3116c">&quot;ipvs&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nodePortAddresses: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oomScoreAdj: -999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">portRange: </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">udpIdleTimeout: 250ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /usr/local/kubernetes/server/bin/kube-proxy-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/usr/bin/env sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./kube-proxy </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/config/kube-proxy-conf.yml </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --v</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /usr/local/kubernetes/server/bin/kube-proxy-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -pv /data/logs/kubernetes/kube-proxy/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/supervisor/conf.d/kube-proxy.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">program:kube-proxy-157</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">command</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/kubernetes/server/bin/kube-proxy-startup.sh     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> the program </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">relative uses </span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain">, can take args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">numprocs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                                                               </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of processes copies to start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">directory</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/kubernetes/server/bin                                  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> directory to cwd to before </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def no cwd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autostart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                           </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> start at supervisord start </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">autorestart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                         </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> retstart at unexpected quit </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                                                             </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of secs prog must stay running </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def. </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">startretries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">                                                           </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># of serial start failures (default 3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">exitcodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0,2</span><span class="token plain">                                                            </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;expected&#x27;</span><span class="token plain"> </span><span class="token builtin class-name">exit</span><span class="token plain"> codes </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0,2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopsignal</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">QUIT                                                          </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> signal used to </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token environment constant" style="color:#36acaa">TERM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stopwaitsecs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain">                                                          </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max num secs to </span><span class="token function" style="color:#d73a49">wait</span><span class="token plain"> b4 SIGKILL </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root                                                                </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> setuid to this UNIX account to run the program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">redirect_stderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true                                                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> redirect proc stderr to stdout </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/data/logs/kubernetes/kube-proxy/kube-proxy.stdout.log </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> stderr log path, NONE </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> none</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> default AUTO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">64MB                                             </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> max </span><span class="token comment" style="color:#999988;font-style:italic"># logfile bytes b4 rotation (default 50MB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_logfile_backups</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">                                                 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># of stdout logfile backups (default 10)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_capture_maxbytes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">1MB                                              </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> number of bytes </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;capturemode&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">stdout_events_enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false                                              </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> emit events on stdout writes </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supervisorctl update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230824115519.png" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="464-æˆæƒapiserverè®¿é—®kubelet">4.6.4 æˆæƒapiserverè®¿é—®kubelet<a href="#464-æˆæƒapiserverè®¿é—®kubelet" class="hash-link" aria-label="Direct link to 4.6.4 æˆæƒapiserverè®¿é—®kubelet" title="Direct link to 4.6.4 æˆæƒapiserverè®¿é—®kubelet">â€‹</a></h4><p>å¦‚æœä¸åšè¯¥æˆæƒçš„è¯ï¼Œä¼šå¯¼è‡´kubectlæ— æ³•è·å–åˆ°é›†ç¾¤çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚logs.
åˆ›å»ºä¸€ä¸ªRBACèµ„æºä½¿å¾—apiserverèƒ½å¤Ÿè®¿é—®kubeletï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /etc/kubernetes/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> apiserver2kubelet-rbac.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rbac.authorization.kubernetes.io/autoupdate: </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes.io/bootstrapping: rbac-defaults</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: system:kube-apiserver-to-kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - apiGroups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - nodes/proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - nodes/stats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - nodes/log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - nodes/spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - nodes/metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - pods/log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    verbs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token string" style="color:#e3116c">&quot;*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: system:kube-apiserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: system:kube-apiserver-to-kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f apiserver2kubelet-rbac.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io/system:apiserver2kubelet created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/system:kube-apiserver created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="465-éƒ¨ç½²flannelç½‘ç»œç»„ä»¶">4.6.5 éƒ¨ç½²flannelç½‘ç»œç»„ä»¶<a href="#465-éƒ¨ç½²flannelç½‘ç»œç»„ä»¶" class="hash-link" aria-label="Direct link to 4.6.5 éƒ¨ç½²flannelç½‘ç»œç»„ä»¶" title="Direct link to 4.6.5 éƒ¨ç½²flannelç½‘ç»œç»„ä»¶">â€‹</a></h4><p>éƒ¨ç½²å®Œä»¥ä¸Šç»„ä»¶ä¹‹åï¼Œä½¿ç”¨<code>kubectl get nodes</code>å‘ç°æ–°åŠ è¿›æ¥çš„masterèŠ‚ç‚¹å¤„äº<code>NotReady</code>çŠ¶æ€ï¼ŒåŸå› æ˜¯æ²¡æœ‰ç½‘ç»œç»„ä»¶ï¼Œä¸€æ—¦å®‰è£…å¥½ç½‘ç»œç»„ä»¶ä¼šç«‹å³å˜ä¸º<code>Ready</code>çŠ¶æ€ã€‚</p><p>é…ç½®containerdä½¿ç”¨ä»£ç†å’Œç§æœ‰ä»“ï¼ˆä¸ç„¶é•œåƒæ‹‰ä¸ä¸‹æ¥å–”ï¼‰ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®ä»£ç†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /lib/systemd/system/containerd.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åœ¨Servicesé…ç½®æ®µæ·»åŠ </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Environment</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;HTTP_PROXY=172.19.82.100:7891&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Environment</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;HTTPS_PROXY=172.19.82.100:7891&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®ç§æœ‰ä»“</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/containerd/config.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å¤§æ¦‚ç¬¬149è¡Œå¼€å§‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">plugins.</span><span class="token string" style="color:#e3116c">&quot;io.containerd.grpc.v1.cri&quot;</span><span class="token plain">.registry.configs</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">plugins.</span><span class="token string" style="color:#e3116c">&quot;io.containerd.grpc.v1.cri&quot;</span><span class="token plain">.registry.configs.</span><span class="token string" style="color:#e3116c">&quot;harbor.xxx.local&quot;</span><span class="token plain">.auth</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        username </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;al-admin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;52PXZ2IDNWzk&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">plugins.</span><span class="token string" style="color:#e3116c">&quot;io.containerd.grpc.v1.cri&quot;</span><span class="token plain">.registry.configs.</span><span class="token string" style="color:#e3116c">&quot;harbor.xxx.local&quot;</span><span class="token plain">.tls</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        insecure_skip_verify </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">plugins.</span><span class="token string" style="color:#e3116c">&quot;io.containerd.grpc.v1.cri&quot;</span><span class="token plain">.registry.mirrors</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">plugins.</span><span class="token string" style="color:#e3116c">&quot;io.containerd.grpc.v1.cri&quot;</span><span class="token plain">.registry.mirrors.</span><span class="token string" style="color:#e3116c">&quot;harbor.xxx.local&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         endpoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;https://harbor.xxx.local&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart containerd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230824134826.png" alt="image.png" class="img_ev3q"></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /etc/kubernetes/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å¦‚æœä½ ç”¨çš„ä¸æ˜¯10.244.0.0/16è¿™ä¸ªç½‘æ®µï¼Œåˆ™éœ€è¦æ‰‹åŠ¨ä¿®æ”¹kube-flannel.ymlèµ„æºé…ç½®æ–‡ä»¶ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å¦‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> kube-flannel.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  net-conf.json: </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Network&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.96.0.0/16&quot;</span><span class="token plain">,   </span><span class="token comment" style="color:#999988;font-style:italic"># æ”¹è¿™é‡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Backend&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;vxlan&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f kube-flannel.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ£€æŸ¥flannelè¿è¡ŒçŠ¶æ€<code>kubectl get po -n kube-flannel</code>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230825141026.png" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="47-æ£€æŸ¥masterèŠ‚ç‚¹éƒ¨ç½²ç»“æœ">4.7 æ£€æŸ¥masterèŠ‚ç‚¹éƒ¨ç½²ç»“æœ<a href="#47-æ£€æŸ¥masterèŠ‚ç‚¹éƒ¨ç½²ç»“æœ" class="hash-link" aria-label="Direct link to 4.7 æ£€æŸ¥masterèŠ‚ç‚¹éƒ¨ç½²ç»“æœ" title="Direct link to 4.7 æ£€æŸ¥masterèŠ‚ç‚¹éƒ¨ç½²ç»“æœ">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="471-æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€">4.7.1 æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€<a href="#471-æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€" class="hash-link" aria-label="Direct link to 4.7.1 æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€" title="Direct link to 4.7.1 æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€">â€‹</a></h4><ul><li>æœåŠ¡è¿è¡ŒçŠ¶æ€ï¼ˆ<code>supervisorctl status</code>ï¼‰ï¼š
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230825141505.png" alt="image.png" class="img_ev3q"></li><li>ç»„ä»¶çŠ¶æ€ï¼ˆ<code>kubectl get cs</code>ï¼‰ï¼š
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230825141536.png" alt="image.png" class="img_ev3q"></li><li>masterèŠ‚ç‚¹çŠ¶æ€(<code>kubectl get node -owide</code>)
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230825141605.png" alt="image.png" class="img_ev3q">
å¦‚æœä»¥ä¸Šæœ‰æŠ¥é”™ï¼Œå°±å›å¤´æ£€æŸ¥æˆ–è€…é‡æ–°éƒ¨ç½²ä¸€ä¸‹æœ‰é—®é¢˜çš„æœåŠ¡å³å¯ã€‚</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="472-é™„æ–‡ä»¶åˆ—è¡¨åŠç®€ä»‹">4.7.2 é™„ï¼šæ–‡ä»¶åˆ—è¡¨åŠç®€ä»‹<a href="#472-é™„æ–‡ä»¶åˆ—è¡¨åŠç®€ä»‹" class="hash-link" aria-label="Direct link to 4.7.2 é™„ï¼šæ–‡ä»¶åˆ—è¡¨åŠç®€ä»‹" title="Direct link to 4.7.2 é™„ï¼šæ–‡ä»¶åˆ—è¡¨åŠç®€ä»‹">â€‹</a></h4><ul><li>è¯ä¹¦åŠé…ç½®æ–‡ä»¶ä¸€è§ˆï¼š</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> tree /etc/kubernetes/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/kubernetes/             </span><span class="token comment" style="color:#999988;font-style:italic"># è¯¥ç›®å½•ä¸ºk8sé›†ç¾¤çš„æ‰€æœ‰è¯ä¹¦å’Œé…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ TLS                      </span><span class="token comment" style="color:#999988;font-style:italic"># è¯ä¹¦å­˜æ”¾ç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ etcd                 </span><span class="token comment" style="color:#999988;font-style:italic"># etcdè¯ä¹¦å­˜æ”¾ç›®å½•ï¼Œå•ç‹¬çš„ä¸€ä¸ªCA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ca-config.json   </span><span class="token comment" style="color:#999988;font-style:italic"># caé…ç½®æ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ca-csr.json      </span><span class="token comment" style="color:#999988;font-style:italic"># caè¯·æ±‚é…ç½®æ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ca-key.pem       </span><span class="token comment" style="color:#999988;font-style:italic"># caç§é’¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ca.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ca.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ etcd-server-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ etcd-server-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ etcd-server.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â””â”€â”€ etcd-server.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â””â”€â”€ k8s                  </span><span class="token comment" style="color:#999988;font-style:italic"># k8sé›†ç¾¤ç»„ä»¶è¯ä¹¦ç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ ca-config.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ ca-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ ca-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ ca.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ ca.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-apiserver-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-apiserver-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-apiserver.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-apiserver.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-controller-manager-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-controller-manager-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-controller-manager.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-controller-manager.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-scheduler-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-scheduler-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-scheduler.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kube-scheduler.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kubectl-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kubectl-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kubectl.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ kubectl.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ proxy-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ front-proxy-ca-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ front-proxy-ca-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ front-proxy-ca.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ front-proxy-ca.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ front-proxy-client-csr.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ front-proxy-client-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ front-proxy-client.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”‚Â Â  â””â”€â”€ front-proxy-client.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â”œâ”€â”€ sa.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â””â”€â”€ sa.pub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ config               </span><span class="token comment" style="color:#999988;font-style:italic"># æ‰€æœ‰é…ç½®ï¼ŒåŒ…æ‹¬è®¤è¯å’Œå„ç§kubeconfig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ apiserver2kubelet-rbac.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ bootstrap.secret.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kube-controller-manager.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kube-flannel.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kube-proxy-config.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kube-proxy-scret.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kube-proxy.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kube-scheduler.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kubelet-bootstrap.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kubelet-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â””â”€â”€ kubelet.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> directories, </span><span class="token number" style="color:#36acaa">51</span><span class="token plain"> files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>k8säºŒè¿›åˆ¶ç¨‹åºä»¥åŠå¯åŠ¨è„šæœ¬ä¸€è§ˆï¼š</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ä»¥.shç»“å°¾çš„å°±æ˜¯å¯¹åº”æœåŠ¡çš„å¯åŠ¨è„šæœ¬</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> tree /usr/local/kubernetes/server/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/kubernetes/server/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ apiextensions-apiserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-aggregator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-apiserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-apiserver-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-controller-manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-controller-manager-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-log-runner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-proxy-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-scheduler-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kubeadm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kubectl-convert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kubelet-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ mounter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> directory, </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"> files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>supervisoré…ç½®æ–‡ä»¶ä¸€è§ˆï¼š</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># k8så„ç»„ä»¶çš„supervisoré…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> tree /etc/supervisor/conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/supervisor/conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ apiserver.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ controller-manager.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ etcd-server.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-proxy.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kubelet.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ scheduler.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> directory, </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="äº”éƒ¨ç½²nodeèŠ‚ç‚¹">äº”ã€éƒ¨ç½²nodeèŠ‚ç‚¹<a href="#äº”éƒ¨ç½²nodeèŠ‚ç‚¹" class="hash-link" aria-label="Direct link to äº”ã€éƒ¨ç½²nodeèŠ‚ç‚¹" title="Direct link to äº”ã€éƒ¨ç½²nodeèŠ‚ç‚¹">â€‹</a></h2><p><strong>å…¶å®å®Œå…¨å¯ä»¥åˆå¹¶æˆä¸€ä¸ªï¼Œä½†æ˜¯ä¸ºäº†æ¡ç†æ¸…æ™°ï¼Œæ‰€ä»¥æ‹†å¼€å•ç‹¬å¼„ã€‚</strong>
åœ¨masterä¸Šå°†kubeletå’Œkube-proxyäºŒè¿›åˆ¶æ–‡ä»¶åˆ†å‘ä¸‹å»ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> node01 node02</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># åˆ›å»ºç¨‹åºç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mkdir -pv /usr/local/kubernetes/server/bin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># åˆ†å‘bootstrapè®¤è¯æ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> -r /usr/local/kubernetes/server/bin/kubelet* /usr/local/kubernetes/server/bin/kube-proxy* </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">:/usr/local/kubernetes/server/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># å¢åŠ å¯æ‰§è¡Œæƒé™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;chmod +x /usr/local/kubernetes/server/bin/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51-éƒ¨ç½²kubelet">5.1 éƒ¨ç½²kubelet<a href="#51-éƒ¨ç½²kubelet" class="hash-link" aria-label="Direct link to 5.1 éƒ¨ç½²kubelet" title="Direct link to 5.1 éƒ¨ç½²kubelet">â€‹</a></h3><p>åœ¨masterèŠ‚ç‚¹ä¸Šåˆ†å‘è®¤è¯æ–‡ä»¶åŠkubeleté…ç½®æ–‡ä»¶ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> node01 node02</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®è¯ä¹¦åŠé…ç½®æ–‡ä»¶ç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mkdir -pv /etc/kubernetes/{TLS,config,manifests}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># åˆ†å‘bootstrapè®¤è¯æ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> /etc/kubernetes/config/kubelet-bootstrap.kubeconfig </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">:/etc/kubernetes/config/kubelet-bootstrap.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># å¤åˆ¶é…ç½®æ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> /etc/kubernetes/config/kubelet-conf.yml </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">:/etc/kubernetes/config/kubelet-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> /etc/kubernetes/TLS/k8s/ca.pem </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">:/etc/kubernetes/TLS/k8s/ca.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é…ç½®supervisorï¼ˆå’ŒmasterèŠ‚ç‚¹ç±»ä¼¼ï¼Œæ‰€ä»¥ç›´æ¥å¤åˆ¶è¿‡å»å¥½äº†ï¼‰ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> node01 node02</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># åˆ›å»ºæ—¥å¿—ç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mkdir -pv /data/logs/kubernetes/kubelet&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># å¤åˆ¶kubeletçš„supervisoré…ç½®æ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> /etc/supervisor/conf.d/kubelet.conf </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">:/etc/supervisor/conf.d/kubelet.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ä¿®æ”¹idï¼Œæ–¹ä¾¿åŒºåˆ†ï¼Œè¿™é‡Œä¸çŸ¥ä¸ºä½•ä¸‹é¢å‘½ä»¤ä¸èƒ½ç”¨ã€‚ã€‚ï¼ˆæ‰‹åŠ¨æ”¹ä¸€ä¸‹å§</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ssh $i &quot;id=`ip a show dev eth0 | grep -w inet | awk &#x27;{print $2}&#x27; | sed -e &#x27;s/.*\.\([0-9]\+\)\/.*/\1/&#x27;` ; sed -i &quot;s/157/$id/&quot; /etc/supervisor/conf.d/kubelet.conf&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230825150503.png" alt="image.png" class="img_ev3q">
æ”¹å®Œä¹‹ååœ¨node01å’Œnode02åˆ†åˆ«æ‰§è¡Œï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># node01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">ip</span><span class="token variable" style="color:#36acaa"> a show dev eth0 </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> -w inet </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $2}&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">cut</span><span class="token variable" style="color:#36acaa"> -d </span><span class="token variable string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token variable" style="color:#36acaa"> -f </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/172.19.82.157/</span><span class="token string variable" style="color:#36acaa">$IP</span><span class="token string" style="color:#e3116c">/&quot;</span><span class="token plain"> /etc/kubernetes/config/kubelet-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/master0/node01/&quot;</span><span class="token plain"> /usr/local/kubernetes/server/bin/kubelet-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supervisor update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># node02</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">ip</span><span class="token variable" style="color:#36acaa"> a show dev eth0 </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> -w inet </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $2}&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">cut</span><span class="token variable" style="color:#36acaa"> -d </span><span class="token variable string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token variable" style="color:#36acaa"> -f </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/172.19.82.157/</span><span class="token string variable" style="color:#36acaa">$IP</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> /etc/kubernetes/config/kubelet-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/master0/node02/&quot;</span><span class="token plain"> /usr/local/kubernetes/server/bin/kubelet-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supervisor update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¯åŠ¨å®Œæˆä¹‹ååœ¨masterèŠ‚ç‚¹ä¸Šå¯ä»¥çœ‹åˆ°ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME      STATUS     ROLES    AGE     VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master0   Ready      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   125m    v1.25.12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node01    NotReady   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   12s     v1.25.12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node02    NotReady   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   3m27s   v1.25.12</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52-éƒ¨ç½²kube-proxy">5.2 éƒ¨ç½²kube-proxy<a href="#52-éƒ¨ç½²kube-proxy" class="hash-link" aria-label="Direct link to 5.2 éƒ¨ç½²kube-proxy" title="Direct link to 5.2 éƒ¨ç½²kube-proxy">â€‹</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> node01 node02</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mkdir -pv /data/logs/kubernetes/kube-proxy/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># æ‹·è´kube-proxyé…ç½®åˆ°nodeèŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> /etc/kubernetes/config/kube-proxy.kubeconfig </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">:/etc/kubernetes/config/kube-proxy.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> /etc/kubernetes/config/kube-proxy-conf.yml </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">:/etc/kubernetes/config/kube-proxy-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> /etc/supervisor/conf.d/kube-proxy.conf </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">:/etc/supervisor/conf.d/kube-proxy.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åœ¨node01èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">ip</span><span class="token variable" style="color:#36acaa"> a show dev eth0 </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> -w inet </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $2}&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">cut</span><span class="token variable" style="color:#36acaa"> -d </span><span class="token variable string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token variable" style="color:#36acaa"> -f </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/172.19.82.157/</span><span class="token string variable" style="color:#36acaa">$IP</span><span class="token string" style="color:#e3116c">/&quot;</span><span class="token plain"> /etc/kubernetes/config/kube-proxy-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supervisor update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åœ¨node02èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">ip</span><span class="token variable" style="color:#36acaa"> a show dev eth0 </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> -w inet </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $2}&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">cut</span><span class="token variable" style="color:#36acaa"> -d </span><span class="token variable string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token variable" style="color:#36acaa"> -f </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/172.19.82.157/</span><span class="token string variable" style="color:#36acaa">$IP</span><span class="token string" style="color:#e3116c">/&quot;</span><span class="token plain"> /etc/kubernetes/config/kube-proxy-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supervisor update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="53-æ£€æŸ¥nodeèŠ‚ç‚¹éƒ¨ç½²ç»“æœ">5.3 æ£€æŸ¥nodeèŠ‚ç‚¹éƒ¨ç½²ç»“æœ<a href="#53-æ£€æŸ¥nodeèŠ‚ç‚¹éƒ¨ç½²ç»“æœ" class="hash-link" aria-label="Direct link to 5.3 æ£€æŸ¥nodeèŠ‚ç‚¹éƒ¨ç½²ç»“æœ" title="Direct link to 5.3 æ£€æŸ¥nodeèŠ‚ç‚¹éƒ¨ç½²ç»“æœ">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="531-æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€">5.3.1 æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€<a href="#531-æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€" class="hash-link" aria-label="Direct link to 5.3.1 æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€" title="Direct link to 5.3.1 æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€">â€‹</a></h4><ul><li>supervisoræœåŠ¡è¿è¡ŒçŠ¶æ€ï¼ˆ<code>sueprvisorctl status</code>ï¼‰ï¼š
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230825154847.png" alt="image.png" class="img_ev3q"></li><li>ç½‘ç»œç»„ä»¶ä»¥åŠèŠ‚ç‚¹çŠ¶æ€ï¼š(<code>kubectl get node -owide/kubectl get po -A -owide</code>)ï¼š
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230825155014.png" alt="image.png" class="img_ev3q"></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="532-é™„æ–‡ä»¶åˆ—è¡¨åŠç®€ä»‹">5.3.2 é™„ï¼šæ–‡ä»¶åˆ—è¡¨åŠç®€ä»‹<a href="#532-é™„æ–‡ä»¶åˆ—è¡¨åŠç®€ä»‹" class="hash-link" aria-label="Direct link to 5.3.2 é™„ï¼šæ–‡ä»¶åˆ—è¡¨åŠç®€ä»‹" title="Direct link to 5.3.2 é™„ï¼šæ–‡ä»¶åˆ—è¡¨åŠç®€ä»‹">â€‹</a></h4><p>ä»¥node01èŠ‚ç‚¹ä¸ºä¾‹ï¼Œå…¶ä»–nodeèŠ‚ç‚¹éƒ½ä¸€æ ·ã€‚</p><ul><li>è¯ä¹¦åŠé…ç½®æ–‡ä»¶ä¸€è§ˆï¼š</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> tree /etc/kubernetes/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/kubernetes/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ TLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ etcd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ca-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ca.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ etcd-server-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”‚Â Â  â””â”€â”€ etcd-server.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â””â”€â”€ k8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â      â””â”€â”€ ca.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kube-proxy-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kube-proxy-config.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kube-proxy.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kubelet-bootstrap.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â”œâ”€â”€ kubelet-conf.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚Â Â  â””â”€â”€ kubelet.kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> directories, </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>supervisoré…ç½®æ–‡ä»¶ä¸€è§ˆï¼š</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tree /etc/supervisor/conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/supervisor/conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ etcd-server.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-proxy.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ kubelet.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> directory, </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>k8sç»„ä»¶äºŒè¿›åˆ¶ç¨‹åºåŠå¯¹åº”å¯åŠ¨è„šæœ¬ä¸€è§ˆï¼š</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tree /usr/local/kubernetes/server/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/kubernetes/server/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kube-proxy-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ kubelet-startup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> directory, </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å…­å…¶ä»–å¯é€‰ç»„ä»¶å®‰è£…">å…­ã€å…¶ä»–å¯é€‰ç»„ä»¶å®‰è£…<a href="#å…­å…¶ä»–å¯é€‰ç»„ä»¶å®‰è£…" class="hash-link" aria-label="Direct link to å…­ã€å…¶ä»–å¯é€‰ç»„ä»¶å®‰è£…" title="Direct link to å…­ã€å…¶ä»–å¯é€‰ç»„ä»¶å®‰è£…">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61-coredns">6.1 coredns<a href="#61-coredns" class="hash-link" aria-label="Direct link to 6.1 coredns" title="Direct link to 6.1 coredns">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="611-éƒ¨ç½²coredns">6.1.1 éƒ¨ç½²coredns<a href="#611-éƒ¨ç½²coredns" class="hash-link" aria-label="Direct link to 6.1.1 éƒ¨ç½²coredns" title="Direct link to 6.1.1 éƒ¨ç½²coredns">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /etc/kubernetes/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://raw.githubusercontent.com/coredns/deployment/master/kubernetes/coredns.yaml.sed -O coredns.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ä¿®æ”¹èµ„æºæ¸…å•é‡Œé¢çš„Corefileå’ŒclusterIP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> coredns.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ç¬¬ä¸€å¤„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Corefile: </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .:53 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        health </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          lameduck 5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kubernetes cluster.local in-addr.arpa ip6.arpa </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ä¿®æ”¹åå‘è§£æ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          fallthrough in-addr.arpa ip6.arpa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        prometheus :9153</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        forward </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8.8</span><span class="token plain">.8.8 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># ä¿®æ”¹ä¸ºå¤–éƒ¨dnsè§£æåœ°å€ï¼Œå½“corednsè§£æä¸åˆ°æ—¶ä¼šä¼ ç»™è¯¥dns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          max_concurrent </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cache </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loadbalance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">                           </span><span class="token comment" style="color:#999988;font-style:italic"># è¿™åé¢æœ‰ä¸ªSTUBDOMAINSå»æ‰</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ç¬¬äºŒå¤„ï¼Œå¤§æ¦‚191è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterIP: </span><span class="token number" style="color:#36acaa">10.100</span><span class="token plain">.0.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ä¿®æ”¹å®Œæˆä¹‹å</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f coredns.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ£€æŸ¥corednsè¿è¡ŒçŠ¶æ€ï¼š
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230825162329.png" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æµ‹è¯•coredns">æµ‹è¯•coredns<a href="#æµ‹è¯•coredns" class="hash-link" aria-label="Direct link to æµ‹è¯•coredns" title="Direct link to æµ‹è¯•coredns">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> helloworld.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: karthequian/helloworld:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - containerPort: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: helloworld-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app: helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      port: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      targetPort: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f helloworld.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># è¿è¡Œç½‘ç»œæµ‹è¯•å®¹å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl run tmp-shell --rm -i --tty --image nicolaka/netshoot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmp-shell î‚° ~ î‚° </span><span class="token function" style="color:#d73a49">dig</span><span class="token plain"> kubernetes.default.svc.cluster.local +short</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">10.96</span><span class="token plain">.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmp-shell2 î‚° ~ î‚° </span><span class="token function" style="color:#d73a49">dig</span><span class="token plain"> helloworld-service.default.svc.cluster.local +short</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">10.105</span><span class="token plain">.77.246</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62-nginx-ingress">6.2 nginx ingress<a href="#62-nginx-ingress" class="hash-link" aria-label="Direct link to 6.2 nginx ingress" title="Direct link to 6.2 nginx ingress">â€‹</a></h3><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener noreferrer">https://kubernetes.github.io/ingress-nginx/</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.1/deploy/static/provider/baremetal/deploy.yaml -O nginx-ingress.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f nginx-ingress.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="63-é¢æ¿">6.3 é¢æ¿<a href="#63-é¢æ¿" class="hash-link" aria-label="Direct link to 6.3 é¢æ¿" title="Direct link to 6.3 é¢æ¿">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="631-dashboard">6.3.1 dashboard<a href="#631-dashboard" class="hash-link" aria-label="Direct link to 6.3.1 dashboard" title="Direct link to 6.3.1 dashboard">â€‹</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://raw.githubusercontent.com/kubernetes/dashboard/v3.0.0-alpha0/charts/kubernetes-dashboard.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f kubernetes-dashboard.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ä¿®æ”¹dashboardçš„Servicesç±»å‹ä¸ºnodeportï¼Œæ–¹ä¾¿è®¿é—®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl --namespace kubernetes-dashboard patch svc kubernetes-dashboard -p </span><span class="token string" style="color:#e3116c">&#x27;{&quot;spec&quot;: {&quot;type&quot;: &quot;NodePort&quot;}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.agou-ops.cn/others/20230825180332.png" alt="image.png" class="img_ev3q">
å®‰è£…å®Œæˆä¹‹åï¼Œä½¿ç”¨ä¸€ä¸‹å‘½ä»¤è·å–è‡ªåŠ¨åˆ†é…çš„nodeportï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get svc/kubernetes-dashboard -n kubernetes-dashboard -owide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                   TYPE       CLUSTER-IP      EXTERNAL-IP   PORT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">         AGE     SELECTOR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubernetes-dashboard   NodePort   </span><span class="token number" style="color:#36acaa">10.99</span><span class="token plain">.165.217   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">443</span><span class="token plain">:36046/TCP   3m54s   k8s-app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kubernetes-dashboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®¿é—®ä»»ä¸€èŠ‚ç‚¹çš„IPåŠ ä¸Šé¢çš„nodeportå³å¯ï¼Œæ¯”å¦‚ï¼š<a href="https://172.19.82.157:36046/#/login" target="_blank" rel="noopener noreferrer">https://172.19.82.157:36046/#/login</a>
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230827094647.png" alt="image.png" class="img_ev3q">
åˆ›å»ºsaä½¿ç”¨tokenç™»å½•dashboardï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> dashboard-sa.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: dashboard-admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: dashboard-admin-rolebinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: cluster-admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: dashboard-admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ³¨æ„è¾ƒæ–°ç‰ˆæœ¬çš„k8sä¸ä¼šè‡ªåŠ¨åˆ›å»ºsecret</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: dashboard-admin-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes.io/service-account.name: dashboard-admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type: kubernetes.io/service-account-token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f dashboard-sa.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># è·å–token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> kubectl describe secret dashboard-admin-secret -n kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name:         dashboard-admin-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace:    kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels:       </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations:  kubernetes.io/service-account.name: dashboard-admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              kubernetes.io/service-account.uid: 80bf284e-06e7-4ea4-b747-0a2e77f0ed1f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type:  kubernetes.io/service-account-token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ca.crt:     </span><span class="token number" style="color:#36acaa">1314</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace:  </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IlhYRkQ2bmRNc0s2WktiWHYxT044M1ZfWTQ2UWRxZk81U3Q4TFJnRFo2QncifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tc2VjcmV0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImRhc2hib2FyZC1hZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjgwYmYyODRlLTA2ZTctNGVhNC1iNzQ3LTBhMmU3N2YwZWQxZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDpkYXNoYm9hcmQtYWRtaW4ifQ.RN82A652pjg5PSoIfVCrzj6b6irTQAaHP4Sr-ROf2LCA3A-GttYaH3Tq0pNQx3x2lfhEK2wqWjmKUtcP7yCfoemkXNdAHV_XOnM1qJ86crv-DHkbaqc8JikwyPOucwex8pZ-EeblDpNUyD-QKbImWRmE3XF09g3tBgRrqANFBKbJd82ABKg_BZyQV1iLEz0wN1Int3uk4f8nm19_YoPfjJPE1UcmKcI0m44aqqANSYNU4e6gej4d-YkBHvaIUZ0-9j9r7t_dKS1qVQiqcAwxdFlt0Tjxbi2KurOIAtazQriHaSbe7VhDJa_v-WYfzcZuHgoWpAELyAR9rbcyScgMbw</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½¿ç”¨ä¸Šé¢è¾“å‡ºçš„tokenå³å¯ç™»å½•dashboard.
<img loading="lazy" src="https://cdn.agou-ops.cn/others/20230827100314.png" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="632-rancher">6.3.2 rancher<a href="#632-rancher" class="hash-link" aria-label="Direct link to 6.3.2 rancher" title="Direct link to 6.3.2 rancher">â€‹</a></h4><p>ç•¥ï¼Œå‚è€ƒï¼š<a href="https://ranchermanager.docs.rancher.com/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster#install-the-rancher-helm-chart" target="_blank" rel="noopener noreferrer">ä½¿ç”¨helmå¿«é€Ÿå®‰è£…rancher</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ä¸ƒæœªå®Œå¾…ç»­">ä¸ƒã€æœªå®Œå¾…ç»­<a href="#ä¸ƒæœªå®Œå¾…ç»­" class="hash-link" aria-label="Direct link to ä¸ƒã€æœªå®Œå¾…ç»­" title="Direct link to ä¸ƒã€æœªå®Œå¾…ç»­">â€‹</a></h2><p>To Be Continued...</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/AGou-ops/myDocsv4/edit/main/docs/CloudNative/k8s/Installation/k8s Debian12äºŒè¿›åˆ¶å®‰è£….md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/CloudNative/k8s/Installation/Kubernetes äºŒè¿›åˆ¶å®‰è£…"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Kubernetes äºŒè¿›åˆ¶å®‰è£…</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/CloudNative/k8s/Installation/ä½¿ç”¨ Kubeadm éƒ¨ç½²ï¼ˆå•masterï¼‰"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ä½¿ç”¨ Kubeadm éƒ¨ç½²(å•master)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ä¸€é¢„å…ˆå‡†å¤‡" class="table-of-contents__link toc-highlight">ä¸€ã€é¢„å…ˆå‡†å¤‡</a><ul><li><a href="#11-æœåŠ¡å™¨è§’è‰²" class="table-of-contents__link toc-highlight">1.1 æœåŠ¡å™¨è§’è‰²</a></li><li><a href="#12-ç³»ç»Ÿåˆå§‹åŒ–" class="table-of-contents__link toc-highlight">1.2 ç³»ç»Ÿåˆå§‹åŒ–</a></li><li><a href="#13-hostsè®¾ç½®" class="table-of-contents__link toc-highlight">1.3 hostsè®¾ç½®</a></li><li><a href="#14-å¯é€‰å®‰è£…supervisor" class="table-of-contents__link toc-highlight">1.4 ï¼ˆå¯é€‰ï¼‰å®‰è£…supervisor</a></li></ul></li><li><a href="#äºŒå®‰è£…criå®¹å™¨è¿è¡Œæ—¶åŠharborç§æœ‰ä»“" class="table-of-contents__link toc-highlight">äºŒã€å®‰è£…CRIå®¹å™¨è¿è¡Œæ—¶åŠharborç§æœ‰ä»“</a><ul><li><a href="#21-å®‰è£…containerd" class="table-of-contents__link toc-highlight">2.1 å®‰è£…containerd</a></li><li><a href="#22-å®‰è£…harborç§æœ‰ä»“" class="table-of-contents__link toc-highlight">2.2 å®‰è£…harborç§æœ‰ä»“</a></li></ul></li><li><a href="#ä¸‰ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦" class="table-of-contents__link toc-highlight">ä¸‰ã€ä½¿ç”¨cfsslç”Ÿæˆè¯ä¹¦</a><ul><li><a href="#31-å®‰è£…cfssl" class="table-of-contents__link toc-highlight">3.1 å®‰è£…cfssl</a></li><li><a href="#32-åˆå§‹åŒ–åŠè¯´æ˜" class="table-of-contents__link toc-highlight">3.2 åˆå§‹åŒ–åŠè¯´æ˜</a></li></ul></li><li><a href="#å››éƒ¨ç½²masterèŠ‚ç‚¹" class="table-of-contents__link toc-highlight">å››ã€éƒ¨ç½²masterèŠ‚ç‚¹</a><ul><li><a href="#41-éƒ¨ç½²etcdé›†ç¾¤" class="table-of-contents__link toc-highlight">4.1 éƒ¨ç½²etcdé›†ç¾¤</a></li><li><a href="#42-éƒ¨ç½²api-server" class="table-of-contents__link toc-highlight">4.2 éƒ¨ç½²API server</a></li><li><a href="#43-éƒ¨ç½²controller-manager" class="table-of-contents__link toc-highlight">4.3 éƒ¨ç½²controller-manager</a></li><li><a href="#44-éƒ¨ç½²kube-scheduler" class="table-of-contents__link toc-highlight">4.4 éƒ¨ç½²kube-scheduler</a></li><li><a href="#45-é…ç½®kubectlæ‰€éœ€è¦çš„kubeconfig" class="table-of-contents__link toc-highlight">4.5 é…ç½®kubectlæ‰€éœ€è¦çš„kubeconfig</a></li><li><a href="#46-éƒ¨ç½²nodeç›¸å…³ç»„ä»¶kube-proxykubelet" class="table-of-contents__link toc-highlight">4.6 éƒ¨ç½²nodeç›¸å…³ç»„ä»¶kube-proxyã€kubelet</a></li><li><a href="#47-æ£€æŸ¥masterèŠ‚ç‚¹éƒ¨ç½²ç»“æœ" class="table-of-contents__link toc-highlight">4.7 æ£€æŸ¥masterèŠ‚ç‚¹éƒ¨ç½²ç»“æœ</a></li></ul></li><li><a href="#äº”éƒ¨ç½²nodeèŠ‚ç‚¹" class="table-of-contents__link toc-highlight">äº”ã€éƒ¨ç½²nodeèŠ‚ç‚¹</a><ul><li><a href="#51-éƒ¨ç½²kubelet" class="table-of-contents__link toc-highlight">5.1 éƒ¨ç½²kubelet</a></li><li><a href="#52-éƒ¨ç½²kube-proxy" class="table-of-contents__link toc-highlight">5.2 éƒ¨ç½²kube-proxy</a></li><li><a href="#53-æ£€æŸ¥nodeèŠ‚ç‚¹éƒ¨ç½²ç»“æœ" class="table-of-contents__link toc-highlight">5.3 æ£€æŸ¥nodeèŠ‚ç‚¹éƒ¨ç½²ç»“æœ</a></li></ul></li><li><a href="#å…­å…¶ä»–å¯é€‰ç»„ä»¶å®‰è£…" class="table-of-contents__link toc-highlight">å…­ã€å…¶ä»–å¯é€‰ç»„ä»¶å®‰è£…</a><ul><li><a href="#61-coredns" class="table-of-contents__link toc-highlight">6.1 coredns</a></li><li><a href="#62-nginx-ingress" class="table-of-contents__link toc-highlight">6.2 nginx ingress</a></li><li><a href="#63-é¢æ¿" class="table-of-contents__link toc-highlight">6.3 é¢æ¿</a></li></ul></li><li><a href="#ä¸ƒæœªå®Œå¾…ç»­" class="table-of-contents__link toc-highlight">ä¸ƒã€æœªå®Œå¾…ç»­</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs Releases</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 1.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 2.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 3.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv4" target="_blank" rel="noopener noreferrer" class="footer__link-item">â­ï¸Version 4.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">â­ï¸æˆ‘çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 AGou-ops' Documetation v4.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2d282a18.js"></script>
<script src="/assets/js/main.509f804f.js"></script>
</body>
</html>