<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-LinuxBasics/Cache/Varnish/varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½®">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½® | AGou&#x27;s Docsv4</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.agou-ops.cn/docs/LinuxBasics/Cache/Varnish/varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½®"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½® | AGou&#x27;s Docsv4"><meta data-rh="true" name="description" content="[TOC]"><meta data-rh="true" property="og:description" content="[TOC]"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.agou-ops.cn/docs/LinuxBasics/Cache/Varnish/varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½®"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/LinuxBasics/Cache/Varnish/varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½®" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.agou-ops.cn/docs/LinuxBasics/Cache/Varnish/varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½®" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-KQED41RW95","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.916b7a43.css">
<link rel="preload" href="/assets/js/runtime~main.cc0608bb.js" as="script">
<link rel="preload" href="/assets/js/main.ac32433b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">AGou&#x27;s Docsv4</b></a><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">âœ¨ æˆ‘çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"> ğŸ“– ç›®å½•</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs">ğŸŒ² ç›®å½•æ ‘</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a class="dropdown__link" href="/docs/category/äº‘åŸç”Ÿç›¸å…³">â˜ï¸ äº‘åŸç”Ÿç›¸å…³</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/category/linuxåŸºç¡€">ğŸ˜Š LinuxåŸºç¡€</a></li><li><a class="dropdown__link" href="/docs/category/ç¼–ç¨‹è¯­è¨€">â™¨ï¸ ç¼–ç¨‹è¯­è¨€</a></li><li><a class="dropdown__link" href="/docs/category/è„šæœ¬ç›¸å…³">ğŸ•¹ï¸ è„šæœ¬ç›¸å…³</a></li><li><a class="dropdown__link" href="/docs/Interview/">ğŸ‘¨â€âš–ï¸ é¢è¯•ç›¸å…³</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ç‰ˆæœ¬</a><ul class="dropdown__menu"><li><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver1.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver2.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="dropdown__link">Ver3.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub ä»“åº“"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Welcome to AGou&#x27;s Docs!" class="themedImage_ToTc themedImage--dark_i4oU"><b>AGou&#x27;s Docsv4</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/linuxåŸºç¡€">LinuxåŸºç¡€</a><button aria-label="Toggle the collapsible sidebar category &#x27;LinuxåŸºç¡€&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/ansible">Ansible</a><button aria-label="Toggle the collapsible sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/cache">Cache</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cache&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/nuster">Nuster</a><button aria-label="Toggle the collapsible sidebar category &#x27;Nuster&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/varnish">Varnish</a><button aria-label="Toggle the collapsible sidebar category &#x27;Varnish&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/Cache/Varnish/varnish Basic">varnish Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/Cache/Varnish/varnish å‚è€ƒç¤ºä¾‹">varnish å‚è€ƒç¤ºä¾‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/LinuxBasics/Cache/Varnish/varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½®">varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½®</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/dhcp-pxe-cobbler">DHCP-PXE-Cobbler</a><button aria-label="Toggle the collapsible sidebar category &#x27;DHCP-PXE-Cobbler&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/databases">DataBases</a><button aria-label="Toggle the collapsible sidebar category &#x27;DataBases&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/filesystem">FileSystem</a><button aria-label="Toggle the collapsible sidebar category &#x27;FileSystem&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kvm">KVM</a><button aria-label="Toggle the collapsible sidebar category &#x27;KVM&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kafka">Kafka</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kafka&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/loadbalancer">LoadBalancer</a><button aria-label="Toggle the collapsible sidebar category &#x27;LoadBalancer&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/makefile">Makefile</a><button aria-label="Toggle the collapsible sidebar category &#x27;Makefile&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/nexus">Nexus</a><button aria-label="Toggle the collapsible sidebar category &#x27;Nexus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/rabbitmq">RabbitMQ</a><button aria-label="Toggle the collapsible sidebar category &#x27;RabbitMQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/shell">Shell</a><button aria-label="Toggle the collapsible sidebar category &#x27;Shell&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/springboot">SpringBoot</a><button aria-label="Toggle the collapsible sidebar category &#x27;SpringBoot&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/terraform">Terraform</a><button aria-label="Toggle the collapsible sidebar category &#x27;Terraform&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/web-servers">Web-Servers</a><button aria-label="Toggle the collapsible sidebar category &#x27;Web-Servers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zabbix">Zabbix</a><button aria-label="Toggle the collapsible sidebar category &#x27;Zabbix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zookeeper">Zookeeper</a><button aria-label="Toggle the collapsible sidebar category &#x27;Zookeeper&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/CertBot Nginx SSL">CertBot Nginx SSL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/Firewalld IPtableså¿«é€Ÿæ‰‹å†Œ">firewalld iptableså¿«é€Ÿæ‰‹å†Œ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/JumpServer">JumpServer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/Linux å‹æµ‹å¤§å…¨">Linux å‹æµ‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/OpenVPN for CentOS">OpenVPN for CentOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/PowerDNS">PowerDNS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/SQL review">SQL å¤ä¹ </a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/SSH Tunnel">SSH Tunnel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/Split - Logrotate">Split &amp; Logrotate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/Tcpdump - Wireshark">tcpdump &amp; wireshark</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/Useful Command">å‘½ä»¤ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/VPS èŠ‚ç‚¹æ­å»º">VPS èŠ‚ç‚¹æ­å»º</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/Vagrant">Vagrant Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/Windows useful cmd">windows å‘½ä»¤æŒ‡ç¤ºç¬¦</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/WireGuard VPN for Ubuntu">WireGuard VPN for Ubuntu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/dnsmasq">dnsmasq éƒ¨ç½²ä¸ä½¿ç”¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/">Linux Basics.</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/inotifywait æ–‡ä»¶ç›‘æ§">Inotify æ–‡ä»¶ç›‘æ§</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/k3s - k3d Basic">k3s &amp; k3d Basic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/keepalived">keepalived</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/lsyncd">lsyncd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/lvm è®²è§£">lvm è®²è§£</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/rsync - inotifyï¼ˆsersyncï¼‰">rsync + inotify(sersync)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/LinuxBasics/vim tricks">æ¯å¤©ä¸€ä¸ªvimå°æŠ€å·§</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/linuxåŸºç¡€"><span itemprop="name">LinuxåŸºç¡€</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/cache"><span itemprop="name">Cache</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/varnish"><span itemprop="name">Varnish</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½®</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½®</h1><p>[TOC]</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ç¼“å­˜httpå¤´éƒ¨ç›¸å…³ä»‹ç»">ç¼“å­˜HTTPå¤´éƒ¨ç›¸å…³ä»‹ç»<a href="#ç¼“å­˜httpå¤´éƒ¨ç›¸å…³ä»‹ç»" class="hash-link" aria-label="Direct link to ç¼“å­˜HTTPå¤´éƒ¨ç›¸å…³ä»‹ç»" title="Direct link to ç¼“å­˜HTTPå¤´éƒ¨ç›¸å…³ä»‹ç»">â€‹</a></h2><p>ç¼“å­˜ç±»å‹ï¼šä»£ç†å¼ç¼“å­˜ï¼ˆé€’å½’æ–¹å¼ï¼‰ï¼›æ—æŒ‚å¼ç¼“å­˜ï¼ˆè¿­ä»£ï¼‰</p><p>ç¼“å­˜æœºåˆ¶ï¼šè¿‡æœŸæœºåˆ¶ï¼ˆExpiresï¼‰ã€æ¡ä»¶å¼ç¼“å­˜ï¼ˆé€šè¿‡æœ€è¿‘æ–‡ä»¶ä¿®æ”¹æ—¶é—´æˆ³æˆ–Etagçš„æ‰©å±•æ ‡ç­¾æ¥è¾¨åˆ«ï¼‰ã€‚</p><p>è¿‡æœŸæ—¶é—´ï¼šExpires
HTTP/1.0
Expiresï¼šè¿‡æœŸ
HTTP/1.1
Cache-Control: max-age=  ï¼ˆç§æœ‰ç¼“å­˜ï¼Œå•ä½ç§’ï¼‰
Cache-Control: s-maxage=  ï¼ˆå…±æœ‰ç¼“å­˜ï¼‰</p><p>ç¼“å­˜å±‚çº§ï¼š
ç§æœ‰ç¼“å­˜ï¼šç”¨æˆ·ä»£ç†é™„å¸¦çš„æœ¬åœ°ç¼“å­˜æœºåˆ¶ï¼›
å…¬å…±ç¼“å­˜ï¼šåå‘ä»£ç†æœåŠ¡å™¨çš„ç¼“å­˜åŠŸèƒ½ï¼›
æ¡ä»¶å¼è¯·æ±‚ï¼š
Last-Modified/If-Modified-Sinceï¼šåŸºäºæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æˆ³æ¥
åˆ¤åˆ«ï¼šEtag/If-None-Matchï¼šåŸºäºæ–‡ä»¶çš„æ ¡éªŒç æ¥åˆ¤åˆ«ï¼›
User-Agent &lt;--&gt; private cache &lt;--&gt; public cache &lt;--&gt; public cache 2 &lt;--&gt; Original Server</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="varnishå·¥ä½œåŸç†åŠç®€å•é…ç½®">varnishå·¥ä½œåŸç†åŠç®€å•é…ç½®<a href="#varnishå·¥ä½œåŸç†åŠç®€å•é…ç½®" class="hash-link" aria-label="Direct link to varnishå·¥ä½œåŸç†åŠç®€å•é…ç½®" title="Direct link to varnishå·¥ä½œåŸç†åŠç®€å•é…ç½®">â€‹</a></h2><p>Varnishæ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„å¼€æºHTTPåŠ é€Ÿå™¨ï¼Œå…·æœ‰<strong>åå‘ä»£ç†</strong>ï¼Œ<strong>ç¼“å­˜</strong>çš„åŠŸèƒ½ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="varnishå®˜æ–¹æ¶æ„å›¾">varnishå®˜æ–¹æ¶æ„å›¾<a href="#varnishå®˜æ–¹æ¶æ„å›¾" class="hash-link" aria-label="Direct link to varnishå®˜æ–¹æ¶æ„å›¾" title="Direct link to varnishå®˜æ–¹æ¶æ„å›¾">â€‹</a></h3><p><img loading="lazy" src="http://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/varnish/architecture.svg" alt="varnish-arch" class="img_ev3q"></p><p>Varnishä¸»è¦è¿è¡Œ2ä¸ªè¿›ç¨‹ï¼Œ<code>Management</code>è¿›ç¨‹å’Œ<code>Child</code>è¿›ç¨‹</p><ul><li><code>Managementè¿›ç¨‹</code>ï¼šä¸»è¦å®ç°åº”ç”¨æ–°çš„é…ç½®ã€ç¼–è¯‘VCLã€ç›‘æ§varnishã€åˆå§‹åŒ–varnishä»¥åŠæä¾›ä¸€ä¸ªå‘½ä»¤è¡Œæ¥å£ç­‰ã€‚Managementè¿›ç¨‹ä¼šæ¯éš”å‡ ç§’é’Ÿæ¢æµ‹ä¸€ä¸‹Childè¿›ç¨‹ä»¥åˆ¤æ–­å…¶æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é•¿å†…æœªå¾—åˆ°Childè¿›ç¨‹çš„å›åº”ï¼ŒManagementå°†ä¼šé‡å¯æ­¤Childè¿›ç¨‹ã€‚</li><li><code>Childè¿›ç¨‹</code>ï¼šä¸»è¦æ˜¯ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ï¼Œç®¡ç†workerçº¿ç¨‹ï¼Œå»ºç«‹ç¼“å­˜ï¼Œæ›´æ–°ç»Ÿè®¡è®¡æ•°å™¨å’Œè®°å½•æµé‡</li></ul><p><code>VCL</code>ï¼ˆVarnish Configuration Languageï¼‰æ˜¯varnishé…ç½®ç¼“å­˜ç­–ç•¥çš„å·¥å…·ï¼Œæ‹¥æœ‰å®ƒè‡ªå·±ç‹¬ç«‹çš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚åœ¨ç­–ç•¥å¯åŠ¨å‰ï¼Œä¼šç”±Managementè¿›ç¨‹è½¬æ¢ä¸ºcä»£ç ï¼ˆåˆ©ç”¨VCCï¼Œå°†VCLè½¬æ¢æˆCçš„ç¼–è¯‘å™¨ï¼‰ï¼Œç„¶åé€šè¿‡gccç¼–è¯‘å™¨ç¼–è¯‘æˆ2è¿›åˆ¶ç¨‹åºã€‚ç¼–è¯‘å®ŒæˆåManagementè´Ÿè´£å°†å…¶è¿æ¥åˆ°childè¿›ç¨‹ï¼Œå¯ä»¥åœ¨varnishè¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åˆ‡æ¢ç¼“å­˜ç­–ç•¥ã€‚</p><p><code>shared memory log</code>ï¼ˆå…±äº«å†…å­˜æ—¥å¿—ï¼‰ä¸ºäº†ä¸ç³»ç»Ÿçš„å…¶å®ƒéƒ¨åˆ†è¿›è¡Œäº¤äº’ï¼ŒChildè¿›ç¨‹ä½¿ç”¨äº†å¯ä»¥é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥å£è¿›è¡Œè®¿é—®çš„å…±äº«å†…å­˜æ—¥å¿—ï¼Œå› æ­¤ï¼Œå¦‚æœæŸçº¿ç¨‹éœ€è¦è®°å½•ä¿¡æ¯ï¼Œå…¶ä»…éœ€è¦æŒæœ‰ä¸€ä¸ªé”ï¼Œè€Œåå‘å…±äº«å†…å­˜ä¸­çš„æŸå†…å­˜åŒºåŸŸå†™å…¥æ•°æ®ï¼Œå†é‡Šæ”¾æŒæœ‰çš„é”å³å¯ã€‚è€Œä¸ºäº†å‡å°‘ç«äº‰ï¼Œæ¯ä¸ªworkerçº¿ç¨‹éƒ½ä½¿ç”¨äº†æ—¥å¿—æ•°æ®ç¼“å­˜ã€‚
å…±äº«å†…å­˜æ—¥å¿—å¤§å°ä¸€èˆ¬ä¸º90Mï¼Œå…¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå‰ä¸€éƒ¨åˆ†ä¸ºè®¡æ•°å™¨ï¼ŒååŠéƒ¨åˆ†ä¸ºå®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®ã€‚varnishæä¾›äº†å¤šä¸ªä¸åŒçš„å·¥å…·å¦‚varnishlogã€varnishncsaæˆ–varnishstatç­‰æ¥åˆ†æå…±äº«å†…å­˜æ—¥å¿—ä¸­çš„ä¿¡æ¯å¹¶èƒ½å¤Ÿä»¥æŒ‡å®šçš„æ–¹å¼è¿›è¡Œæ˜¾ç¤ºã€‚</p><p><code>varnishadm</code>å’Œ<code>vagent2</code>æ˜¯ç®¡ç†Managementçš„ä¸€ä¸ªç®¡ç†æ¥å£</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="varnishå·¥ä½œæµç¨‹">varnishå·¥ä½œæµç¨‹<a href="#varnishå·¥ä½œæµç¨‹" class="hash-link" aria-label="Direct link to varnishå·¥ä½œæµç¨‹" title="Direct link to varnishå·¥ä½œæµç¨‹">â€‹</a></h3><p><img loading="lazy" src="http://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/varnish/varnish-02.png" alt="varnish02" class="img_ev3q"></p><ul><li><code>vcl_recvå‡½æ•°</code>ï¼šåœ¨Varnishå®Œæˆå¯¹è¯·æ±‚æŠ¥æ–‡çš„è§£ç ä¸ºåŸºæœ¬æ•°æ®ç»“æ„åç¬¬ä¸€ä¸ªè¦æ‰§è¡Œçš„å­ä¾‹ç¨‹ï¼Œå®ƒé€šå¸¸æœ‰å››ä¸ªä¸»è¦ç”¨é€”ï¼š1.ä¿®æ”¹å®¢æˆ·ç«¯æ•°æ®ä»¥å‡å°‘ç¼“å­˜å¯¹è±¡å·®å¼‚æ€§ï¼›æ¯”å¦‚åˆ é™¤URLä¸­çš„www.ç­‰å­—ç¬¦ï¼›2.åŸºäºå®¢æˆ·ç«¯æ•°æ®é€‰ç”¨ç¼“å­˜ç­–ç•¥ï¼›æ¯”å¦‚ä»…ç¼“å­˜ç‰¹å®šçš„URLè¯·æ±‚ã€ä¸ç¼“å­˜POSTè¯·æ±‚ç­‰ï¼›3.ä¸ºæŸwebåº”ç”¨ç¨‹åºæ‰§è¡ŒURLé‡å†™è§„åˆ™ï¼› 4.æŒ‘é€‰åˆé€‚çš„åç«¯WebæœåŠ¡å™¨ï¼›</li><li><code>vcl_hashå‡½æ•°</code>ï¼šé»˜è®¤VCLå°†ä¸»æœºåæˆ–IPåœ°å€ä»¥åŠè¯·æ±‚çš„URLè¿›è¡Œhash</li><li><code>vcl_hitå‡½æ•°</code>ï¼šåœ¨ç¼“å­˜ä¸­æ‰¾åˆ°è¯·æ±‚çš„å†…å®¹åå°†è‡ªåŠ¨è°ƒç”¨è¯¥å‡½æ•°</li><li><code>vcl_passå‡½æ•°</code>ï¼šæ­¤å‡½æ•°åœ¨è¿›å…¥passæ¨¡å¼æ—¶è¢«è°ƒç”¨ï¼Œç”¨æˆ·å°†è¯·æ±‚ç›´æ¥ä¼ é€’è‡³åç«¯ä¸»æœºã€‚åç«¯ä¸»æœºåœ¨åº”ç­”æ•°æ®åå°†åº”ç­”æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ï¼Œä½†ä¸è¿›è¡Œä»»ä½•ç¼“å­˜ï¼Œåœ¨å½“å‰é“¾æ¥ä¸‹æ¯æ¬¡éƒ½è¿”å›æœ€æ–°çš„å†…å®¹ã€‚</li><li><code>vcl_misså‡½æ•°</code>ï¼šåœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°è¯·æ±‚çš„å†…å®¹æ—¶è‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚æ­¤å‡½æ•°å¯ç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦ä»åç«¯æœåŠ¡å™¨è·å–å†…å®¹</li><li><code>vcl_purgeå‡½æ•°</code>ï¼šç§»é™¤ç¼“å­˜</li><li><code>vcl_pipeå‡½æ•°</code>ï¼šè¿›å…¥pipeæ¨¡å¼æ—¶ï¼Œç”¨æˆ·å°†<strong>è¯·æ±‚ç›´æ¥ä¼ é€’è‡³åç«¯ä¸»æœº</strong>ï¼Œåœ¨è¯·æ±‚å’Œè¿”å›çš„å†…å®¹æ²¡æœ‰æ”¹å˜çš„æƒ…å†µä¸‹ï¼Œå°†ä¸å˜çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç›´åˆ°è¿™ä¸ªé“¾æ¥è¢«å…³é—­ã€‚</li><li><code>vcl_backend_fetchå‡½æ•°</code>ï¼šå¯èƒ½æ˜¯è¢«vcl_missæˆ–è€…vcl_passè°ƒç”¨ã€‚å¦‚æœæ˜¯è¢«vcl_misså‡½æ•°ï¼šè°ƒç”¨åˆ™æ‰€è·å–çš„å¯¹è±¡ä¼šè¢«ç¼“å­˜ï¼Œå¦‚æœæ˜¯è¢«vcl_passè°ƒç”¨åˆ™è·å–çš„å¯¹è±¡ä¸ä¼šç¼“å­˜</li><li><code>vcl_deliverå‡½æ•°</code>ï¼šå°†åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°è¯·æ±‚çš„å†…å®¹å‘é€ç»™å®¢æˆ·ç«¯å‰è°ƒç”¨æ­¤å‡½æ•°</li><li><code>vcl_synthå‡½æ•°</code>ï¼šåˆ›å»ºåˆæˆå“åº”ï¼Œä¾‹å¦‚ä¸ªæ€§åŒ–å®šåˆ¶é”™è¯¯æ¶ˆæ¯ï¼Œè¦è°ƒç”¨æ­¤å‡½æ•°</li></ul><p>actionsæœ‰ä»¥ä¸‹å‡ ç§:</p><ul><li><code>pass</code>ï¼šå½“ä¸€ä¸ªè¯·æ±‚è¢« pass å,è¿™ä¸ªè¯·æ±‚å°†é€šè¿‡ varnish è½¬å‘åˆ°åç«¯æœåŠ¡å™¨,
ä½†æ˜¯å®ƒä¸ä¼šè¢«ç¼“å­˜ã€‚pass å¯ä»¥æ”¾åœ¨ vcl_recv å’Œ vcl_fetch ä¸­ã€‚</li><li><code>lookup</code>ï¼šå½“ä¸€ä¸ªè¯·æ±‚åœ¨ vcl_recv ä¸­è¢« lookup å,varnish å°†ä»ç¼“å­˜ä¸­æå–æ•°
æ®,å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®,å°†è¢«è®¾ç½®ä¸º pass,ä¸èƒ½åœ¨ vcl_fetch ä¸­è®¾ç½® lookupã€‚</li><li><code>pipe</code>ï¼špipe å’Œ pass ç›¸ä¼¼,éƒ½è¦è®¿é—®åç«¯æœåŠ¡å™¨,ä¸è¿‡å½“è¿›å…¥ pipe æ¨¡å¼å,åœ¨
æ­¤è¿æ¥æœªå…³é—­å‰,åç»­çš„æ‰€æœ‰è¯·æ±‚éƒ½å‘åˆ°åç«¯æœåŠ¡å™¨</li><li><code>deliver</code>ï¼šè¯·æ±‚çš„ç›®æ ‡è¢«ç¼“å­˜,ç„¶åå‘é€ç»™å®¢æˆ·ç«¯</li></ul><p>3ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼šRequestsã€Responses ã€ objects</p><ul><li><code>req</code>ï¼šè¯·æ±‚ç›®æ ‡,å½“ varnish æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚,è¿™æ—¶ req object å°±è¢«åˆ›å»ºäº†,
ä½ åœ¨ vcl_recv ä¸­çš„å¤§éƒ¨åˆ†å·¥ä½œ,éƒ½æ˜¯åœ¨ req object ä¸Šå±•å¼€çš„ã€‚</li><li><code>beresp</code>ï¼šåç«¯æœåŠ¡å™¨è¿”å›çš„ç›®æ ‡,å®ƒåŒ…å«è¿”å›çš„å¤´ä¿¡æ¯,ä½ åœ¨ vcl_fetch ä¸­çš„å¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯åœ¨ beresp object ä¸Šå¼€å±•çš„ã€‚</li><li><code>obj</code>ï¼šè¢« cache çš„ç›®æ ‡,åªè¯»çš„ç›®æ ‡è¢«ä¿å­˜äºå†…å­˜ä¸­,obj.ttl çš„å€¼å¯ä¿®æ”¹,å…¶ä»–çš„åªèƒ½è¯»ã€‚</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="varnishå†…å»ºå˜é‡">varnishå†…å»ºå˜é‡<a href="#varnishå†…å»ºå˜é‡" class="hash-link" aria-label="Direct link to varnishå†…å»ºå˜é‡" title="Direct link to varnishå†…å»ºå˜é‡">â€‹</a></h2><ul><li>Â·req.*ï¼šrequestï¼Œè¡¨ç¤ºç”±å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚æŠ¥æ–‡ç›¸å…³ï¼›</li><li><em>Â·bereq.</em>ï¼šç”±varnishå‘å¾€BEä¸»æœºçš„httpdè¯·æ±‚ç›¸å…³ï¼›</li><li>Â·beresp.*ï¼šç”±BEä¸»æœºå“åº”ç»™varnishçš„å“åº”æŠ¥æ–‡ç›¸å…³ï¼›</li><li><em>Â·resp.</em>ï¼šç”±varnishå“åº”ç»™clientç›¸å…³ï¼›</li><li>Â·obj.*ï¼šå­˜å‚¨åœ¨ç¼“å­˜ç©ºé—´ä¸­çš„ç¼“å­˜å¯¹è±¡çš„å±æ€§ï¼›åªè¯»ï¼›</li></ul><p><strong>å¸¸ç”¨å˜é‡ï¼š</strong></p><ul><li>Â·bereq.<em>, req.</em>ï¼š
bereq.http.HEADERS
bereq.requestï¼šè¯·æ±‚æ–¹æ³•ï¼›
bereq.urlï¼šè¯·æ±‚çš„urlï¼›
bereq.protoï¼šè¯·æ±‚çš„åè®®ç‰ˆæœ¬ï¼›
bereq.backendï¼šæŒ‡æ˜è¦è°ƒç”¨çš„åç«¯ä¸»æœºï¼›
req.http.Cookieï¼šå®¢æˆ·ç«¯çš„è¯·æ±‚æŠ¥æ–‡ä¸­Cookieé¦–éƒ¨çš„å€¼ï¼›
req.http.User-Agent ~ â€œchromeâ€</li><li>Â·beresp.<em>, resp.</em>ï¼š
beresp.http.HEADERS
beresp.statusï¼šå“åº”çš„çŠ¶æ€ç ï¼›
reresp.protoï¼šåè®®ç‰ˆæœ¬ï¼›
beresp.backend.nameï¼šBEä¸»æœºçš„ä¸»æœºåï¼›
beresp.ttlï¼šBEä¸»æœºå“åº”çš„å†…å®¹çš„ä½™ä¸‹çš„å¯ç¼“å­˜æ—¶é•¿ï¼›</li><li>Â·obj.*
obj.hitsï¼šæ­¤å¯¹è±¡ä»ç¼“å­˜ä¸­å‘½ä¸­çš„æ¬¡æ•°ï¼›
obj.ttlï¼šå¯¹è±¡çš„ttlå€¼</li><li>Â·server.*
server.ip
server.hostname</li><li>Â·client.*
client.ip</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="varnishæ—¥å¿—shared-memory-log">varnishæ—¥å¿—(Shared memory log)<a href="#varnishæ—¥å¿—shared-memory-log" class="hash-link" aria-label="Direct link to varnishæ—¥å¿—(Shared memory log)" title="Direct link to varnishæ—¥å¿—(Shared memory log)">â€‹</a></h2><p>æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—ï¼š</p><ul><li><code>varnishlog</code>:ç”¨äºè®¿é—®ç‰¹å®šçš„æ•°æ®ï¼Œå®ƒæä¾›äº†ç‰¹å®šå®¢æˆ·çš„ä¿¡æ¯å’Œè¦æ±‚ã€‚	 	<ul><li><code>varnishlog</code>å¯ä»¥è¿è¡Œä¸ºå®ˆæŠ¤è¿›ç¨‹,å°†æ—¥å¿—ä¿å­˜åˆ°æ–‡ä»¶å½“ä¸­å»</li></ul></li><li><code>varnishncsa</code>:ä»¥NCSAé€šç”¨æ—¥å¿—æ ¼å¼æ˜¾ç¤ºvarnishè®¿é—®æ—¥å¿—ã€‚	 	</li><li><code>varnishtest</code>:å…è®¸æ˜¾ç¤ºæµ‹è¯•ä¸­çš„æ—¥å¿—è®°å½•å’Œè®¡æ•°å™¨ã€‚	 </li></ul><p>ç»Ÿè®¡å·¥å…·ï¼š</p><ul><li><code>varnishstat</code>:ç”¨äºè®¿é—®å…¨å±€è®¡æ•°å™¨ï¼Œä¸è¯»å–varnishæ—¥å¿—ä¸­çš„æ¡ç›®ã€‚<ul><li><code>-1</code>:ä¸€æ¬¡æ€§è¾“å‡º,éæŒç»­æ€§è¾“å‡º</li><li><code>-f</code>:æŒ‡å®šè¾“å‡ºçš„å­—æ®µåç§°åˆ—è¡¨,å¦‚è‹¥æŸ¥çœ‹å¤šä¸ªå­—æ®µ,éœ€è¦æ·»åŠ å¤šä¸ª<code>-f</code>å‚æ•°</li></ul></li><li><code>varnishtop</code>:è¯»å–Varnishæ—¥å¿—å¹¶å‘ˆç°æœ€å¸¸å‡ºç°çš„æ—¥å¿—æ¡ç›®çš„ä¸æ–­æ›´æ–°çš„åˆ—è¡¨ã€‚	 	<ul><li><code>-1</code>:ä¸€æ¬¡æ€§è¾“å‡º,éæŒç»­æ€§è¾“å‡º</li><li><code>-i &lt;taglist&gt;</code>:æŸ¥çœ‹æŒ‡å®šå­—æ®µ,å¦‚è‹¥æŸ¥çœ‹å¤šä¸ªå­—æ®µ,éœ€è¦æ·»åŠ å¤šä¸ª<code>-i</code>å‚æ•°,å¦,<code>-I &lt;[taglist:]regex&gt;</code>å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ç­›é€‰</li><li><code>-x &lt;taglist&gt;</code>,ç”¨æ³•åŒ<code>-i</code>é€‰é¡¹,å°†æŸä¸ªå­—æ®µæ’é™¤åœ¨å¤–,<code>-X</code>è¡¨ç¤ºä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</li></ul></li><li><code>varnishhist</code>:è¯»å–Varnishæ—¥å¿—ï¼Œå¹¶æ˜¾ç¤ºä¸€ä¸ªè¿ç»­æ›´æ–°çš„ç›´æ–¹å›¾ï¼Œæ˜¾ç¤ºæœ€åNä¸ªè¯·æ±‚çš„å¤„ç†åˆ†å¸ƒæƒ…å†µã€‚	</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="varnishadmäº¤äº’å¼é…ç½®">varnishadmäº¤äº’å¼é…ç½®<a href="#varnishadmäº¤äº’å¼é…ç½®" class="hash-link" aria-label="Direct link to varnishadmäº¤äº’å¼é…ç½®" title="Direct link to varnishadmäº¤äº’å¼é…ç½®">â€‹</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ç™»å½•ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -S /etc/varnish/secret -T </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">é…ç½®æ–‡ä»¶ç›¸å…³ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vcl.list ï¼šçŠ¶æ€å¼•æ“åˆ—è¡¨ï¼›</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vcl.loadï¼šè£…è½½ï¼ŒåŠ è½½å¹¶ç¼–è¯‘ï¼›</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vcl.useï¼šæ¿€æ´»ï¼›</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vcl.discardï¼šåˆ é™¤ï¼›</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vcl.show </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-v</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">configname</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">ï¼šæŸ¥çœ‹æŒ‡å®šçš„é…ç½®æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯çœ‹é»˜è®¤é…ç½®ï¼›</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">è¿è¡Œæ—¶å‚æ•°ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    param.show -lï¼šæ˜¾ç¤ºåˆ—è¡¨ï¼›</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    param.show </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">PARAM</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    param.set </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">PARAM</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">VALUE</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ç¼“å­˜å­˜å‚¨ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">åç«¯æœåŠ¡å™¨ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backend.list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é™¤äº†ä½¿ç”¨<code>varnishadm</code>æ¥ç¼–è¯‘æ¿€æ´»vclå¤–,è¿˜å¯ä»¥ä½¿ç”¨<code>varnish_reload_vcl</code>æ¥ä¸€æ¬¡æ€§å®Œæˆ.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ç®€å•é…ç½®-åŠoptsä¼˜åŒ–é€‰é¡¹">ç®€å•é…ç½® åŠOPTSä¼˜åŒ–é€‰é¡¹<a href="#ç®€å•é…ç½®-åŠoptsä¼˜åŒ–é€‰é¡¹" class="hash-link" aria-label="Direct link to ç®€å•é…ç½® åŠOPTSä¼˜åŒ–é€‰é¡¹" title="Direct link to ç®€å•é…ç½® åŠOPTSä¼˜åŒ–é€‰é¡¹">â€‹</a></h2><p>varnish å®‰è£…å®Œæ¯•ä¹‹åä¼šåœ¨<code>/etc/varnish</code>ç”Ÿæˆä¸¤ä¸ªé…ç½®æ–‡ä»¶</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/etc/varnish</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ default.vcl         </span><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®å„Child/Cacheçº¿ç¨‹çš„ç¼“å­˜ç­–ç•¥ï¼›</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ secret          </span><span class="token comment" style="color:#999988;font-style:italic"># varnishè¿æ¥æ—¶çš„å®‰å…¨ç§˜é’¥æ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ varnish.params      </span><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®varnishæœåŠ¡è¿›ç¨‹çš„å·¥ä½œç‰¹æ€§ï¼Œä¾‹å¦‚ç›‘å¬çš„åœ°å€å’Œç«¯å£ï¼Œç¼“å­˜æœºåˆ¶ï¼›</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> directories, </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>varnish.params</code>ä¸»è¦é…ç½®ä¿¡æ¯</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">VARNISH_VCL_CONF</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/varnish/default.vcl       </span><span class="token comment" style="color:#999988;font-style:italic"># VCL é…ç½®æ–‡ä»¶è·¯å¾„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">VARNISH_LISTEN_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">80</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># ç›‘å¬ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">VARNISH_ADMIN_LISTEN_ADDRESS</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1      </span><span class="token comment" style="color:#999988;font-style:italic"># varnish-adminç›‘å¬åœ°å€åŠç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">VARNISH_ADMIN_LISTEN_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">6082</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Shared secret file for admin interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">VARNISH_SECRET_FILE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/varnish/secret     </span><span class="token comment" style="color:#999988;font-style:italic"># ç®¡ç†å‘˜ç§˜é’¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># VARNISH_STORAGE=&quot;malloc,256M&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">VARNISH_STORAGE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;file,/data/varnish/cache,1g&quot;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># varnishå­˜å‚¨æ¨¡å¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># User and group for the varnishd worker processes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">VARNISH_USER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">varnish</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">VARNISH_GROUP</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">varnish</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Other options, see the man page varnishd(1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#DAEMON_OPTS=&quot;-p thread_pool_min=5 -p thread_pool_max=500 -p thread_pool_timeout=300&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DAEMON_OPTS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">â€-p </span><span class="token assign-left variable" style="color:#36acaa">thread_pools</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> -p </span><span class="token assign-left variable" style="color:#36acaa">thread_pool_min</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> -p </span><span class="token assign-left variable" style="color:#36acaa">thread_pool_max</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">500</span><span class="token plain"> -p </span><span class="token assign-left variable" style="color:#36acaa">thread_pool_timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">300</span><span class="token plain">â€³</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>varnishçš„ç¼“å­˜å­˜å‚¨æœºåˆ¶( Storage Types)ï¼š</p><ul><li><code>malloc[,size]  </code>    å†…å­˜å­˜å‚¨ï¼Œ<!-- -->[,size]<!-- -->ç”¨äºå®šä¹‰ç©ºé—´å¤§å°ï¼›é‡å¯åæ‰€æœ‰ç¼“å­˜é¡¹å¤±æ•ˆï¼›ä¸€èˆ¬4Gè¾ƒåˆé€‚ï¼Œå†…å­˜ç©ºé—´æœ‰é™ï¼Œä¸”å†…å­˜ç¢ç‰‡ä¼šå¤§å¤§å½±å“æ€§èƒ½ï¼›</li><li><code>file[,path[,size[,granularity]]]ã€€</code>ç£ç›˜æ–‡ä»¶å­˜å‚¨ï¼Œé»‘ç›’ï¼›é‡å¯åæ‰€æœ‰ç¼“å­˜é¡¹å¤±æ•ˆï¼›</li><li><code>persistent,path,sizeã€€</code>æ–‡ä»¶å­˜å‚¨ï¼Œé»‘ç›’ï¼›é‡å¯åæ‰€æœ‰ç¼“å­˜é¡¹æœ‰æ•ˆï¼›åœ¨<code>5.2.0</code>ç‰ˆæœ¬ä¸ºå®éªŒçŠ¶æ€,<code>6.4.0</code>ç‰ˆæœ¬å®˜æ–¹ä¸æ¨èè¯¥æ¨¡å¼ï¼›</li></ul><p><strong>DAEMON_OPTSé™„åŠ é€‰é¡¹:</strong></p><p>åœ¨çº¿ç¨‹æ± å†…éƒ¨ï¼Œå…¶æ¯ä¸€ä¸ªè¯·æ±‚ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼› å…¶workerçº¿ç¨‹çš„æœ€å¤§æ•°å†³å®šäº†varnishçš„å¹¶å‘å“åº”èƒ½åŠ›ï¼›</p><ul><li><code>thread_pools</code>ï¼šNumber of worker thread pools. æœ€å¥½å°äºæˆ–ç­‰äºCPUæ ¸å¿ƒæ•°é‡ï¼› </li><li><code>thread_pool_max</code>ï¼š æ¯çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°ï¼›</li><li><code>thread_pool_min</code>ï¼šThe minimum number of worker threads in each pool. é¢å¤–æ„ä¹‰ä¸ºâ€œæœ€å¤§ç©ºé—²çº¿ç¨‹æ•°â€ï¼›
æœ€å¤§å¹¶å‘è¿æ¥æ•° = <strong>thread_pools * thread_pool_max</strong></li><li><code>thread_pool_timeout</code>ï¼šThread idle threshold. Threads inexcess of thread_pool_min, which have been idle for at least this long,çº¿ç¨‹è¶…æ—¶æ—¶é—´</li><li>thread_pool_add_delayï¼šæ–°åˆ›å»ºçº¿ç¨‹çš„å»¶è¿Ÿæ—¶é—´</li><li>thread_pool_destroy_delayï¼šæ€æ­»ç©ºé—²çº¿ç¨‹å»¶è¿Ÿæ—¶é—´,ä¹Ÿå°±æ˜¯æ‘§æ¯ä¹‹å‰éœ€è¦çŠ¹è±«ä¸€ä¸‹ï¼Œè¿™ä¸ªçŠ¹è±«çš„æ—¶é—´</li></ul><p><strong>Timerç›¸å…³çš„å‚æ•°</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">send_timeoutï¼šè®¾ç½®å®¢æˆ·ç«¯é“¾æ¥çš„è¶…æ—¶æ—¶é—´</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timeout_idleï¼šè®¾ç½®ä¿æŒé“¾æ¥çš„ç©ºé—²æ—¶é•¿ï¼Œç»å¸¸éœ€è¦ï¼ï¼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timeout_reqï¼šæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡é¦–éƒ¨çš„æœ€é•¿æ—¶é—´</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥<a href="#å‚è€ƒé“¾æ¥" class="hash-link" aria-label="Direct link to å‚è€ƒé“¾æ¥" title="Direct link to å‚è€ƒé“¾æ¥">â€‹</a></h2><ul><li>varnishå®˜æ–¹æ–‡æ¡£:<a href="https://www.varnish-cache.org/" target="_blank" rel="noopener noreferrer">https://www.varnish-cache.org/</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/LinuxBasics/Cache/Varnish/varnish æ¶æ„ã€å·¥ä½œåŸç†åŠç®€å•é…ç½®.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/LinuxBasics/Cache/Varnish/varnish å‚è€ƒç¤ºä¾‹"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">varnish å‚è€ƒç¤ºä¾‹</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/dhcp-pxe-cobbler"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DHCP-PXE-Cobbler</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ç¼“å­˜httpå¤´éƒ¨ç›¸å…³ä»‹ç»" class="table-of-contents__link toc-highlight">ç¼“å­˜HTTPå¤´éƒ¨ç›¸å…³ä»‹ç»</a></li><li><a href="#varnishå·¥ä½œåŸç†åŠç®€å•é…ç½®" class="table-of-contents__link toc-highlight">varnishå·¥ä½œåŸç†åŠç®€å•é…ç½®</a><ul><li><a href="#varnishå®˜æ–¹æ¶æ„å›¾" class="table-of-contents__link toc-highlight">varnishå®˜æ–¹æ¶æ„å›¾</a></li><li><a href="#varnishå·¥ä½œæµç¨‹" class="table-of-contents__link toc-highlight">varnishå·¥ä½œæµç¨‹</a></li></ul></li><li><a href="#varnishå†…å»ºå˜é‡" class="table-of-contents__link toc-highlight">varnishå†…å»ºå˜é‡</a></li><li><a href="#varnishæ—¥å¿—shared-memory-log" class="table-of-contents__link toc-highlight">varnishæ—¥å¿—(Shared memory log)</a></li><li><a href="#varnishadmäº¤äº’å¼é…ç½®" class="table-of-contents__link toc-highlight">varnishadmäº¤äº’å¼é…ç½®</a></li><li><a href="#ç®€å•é…ç½®-åŠoptsä¼˜åŒ–é€‰é¡¹" class="table-of-contents__link toc-highlight">ç®€å•é…ç½® åŠOPTSä¼˜åŒ–é€‰é¡¹</a></li><li><a href="#å‚è€ƒé“¾æ¥" class="table-of-contents__link toc-highlight">å‚è€ƒé“¾æ¥</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs Releases</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 1.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 2.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv3" target="_blank" rel="noopener noreferrer" class="footer__link-item">Version 3.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://agou-ops.cn/myDocsv4" target="_blank" rel="noopener noreferrer" class="footer__link-item">â­ï¸Version 4.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://agou-ops.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">â­ï¸æˆ‘çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/AGou-ops" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 AGou-ops' Documetation v4.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cc0608bb.js"></script>
<script src="/assets/js/main.ac32433b.js"></script>
</body>
</html>