"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[9605],{3905:(e,r,a)=>{a.d(r,{Zo:()=>m,kt:()=>f});var t=a(67294);function n(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function o(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,t)}return a}function i(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?o(Object(a),!0).forEach((function(r){n(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}function l(e,r){if(null==e)return{};var a,t,n=function(e,r){if(null==e)return{};var a,t,n={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||(n[a]=e[a]);return n}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=t.createContext({}),p=function(e){var r=t.useContext(s),a=r;return e&&(a="function"==typeof e?e(r):i(i({},r),e)),a},m=function(e){var r=p(e.components);return t.createElement(s.Provider,{value:r},e.children)},c={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},u=t.forwardRef((function(e,r){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=p(a),f=n,d=u["".concat(s,".").concat(f)]||u[f]||c[f]||o;return a?t.createElement(d,i(i({ref:r},m),{},{components:a})):t.createElement(d,i({ref:r},m))}));function f(e,r){var a=arguments,n=r&&r.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=u;var l={};for(var s in r)hasOwnProperty.call(r,s)&&(l[s]=r[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}u.displayName="MDXCreateElement"},78067:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var t=a(87462),n=(a(67294),a(3905));const o={},i="Terraform Basic",l={unversionedId:"LinuxBasics/Terraform/Terraform Basic",id:"LinuxBasics/Terraform/Terraform Basic",title:"Terraform Basic",description:"Terraform \u7b80\u4ecb",source:"@site/docs/LinuxBasics/Terraform/Terraform Basic.md",sourceDirName:"LinuxBasics/Terraform",slug:"/LinuxBasics/Terraform/Terraform Basic",permalink:"/docs/LinuxBasics/Terraform/Terraform Basic",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/LinuxBasics/Terraform/Terraform Basic.md",tags:[],version:"current",frontMatter:{},sidebar:"linuxBasics",previous:{title:"Terraform",permalink:"/docs/category/terraform"},next:{title:"Terraform \u793a\u4f8b",permalink:"/docs/LinuxBasics/Terraform/Terraform Examples"}},s={},p=[{value:"Terraform \u7b80\u4ecb",id:"terraform-\u7b80\u4ecb",level:2},{value:"Terraform \u5b89\u88c5",id:"terraform-\u5b89\u88c5",level:2},{value:"Terraform with AWS",id:"terraform-with-aws",level:2},{value:"\u5feb\u901f\u5f00\u59cb",id:"\u5feb\u901f\u5f00\u59cb",level:3},{value:"\u5c06state\u6587\u4ef6\u5b58\u653e\u5230\u8fdc\u7a0b",id:"\u5c06state\u6587\u4ef6\u5b58\u653e\u5230\u8fdc\u7a0b",level:2},{value:"\u5176\u4ed6",id:"\u5176\u4ed6",level:2},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}],m={toc:p};function c(e){let{components:r,...a}=e;return(0,n.kt)("wrapper",(0,t.Z)({},m,a,{components:r,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"terraform-basic"},"Terraform Basic"),(0,n.kt)("h2",{id:"terraform-\u7b80\u4ecb"},"Terraform \u7b80\u4ecb"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Terraform(IaaC)\u662f\u7528\u4e8e\u5b89\u5168\u6709\u6548\u5730\u6784\u5efa\uff0c\u66f4\u6539\u548c\u7248\u672c\u63a7\u5236\u57fa\u7840\u7ed3\u6784\u7684\u5de5\u5177\u3002 Terraform\u53ef\u4ee5\u7ba1\u7406\u73b0\u6709\u548c\u6d41\u884c\u7684\u670d\u52a1\u63d0\u4f9b\u5546\u4ee5\u53ca\u5b9a\u5236\u7684\u5185\u90e8\u89e3> \u51b3\u65b9\u6848\u3002"),(0,n.kt)("p",{parentName:"blockquote"},"\u914d\u7f6e\u6587\u4ef6\u5411Terraform\u63cf\u8ff0\u4e86\u8fd0\u884c\u5355\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6216\u6574\u4e2a\u6570\u636e\u4e2d\u5fc3\u6240\u9700\u7684\u7ec4\u4ef6\u3002Terraform\u751f\u6210\u6267\u884c\u8ba1\u5212\uff0c\u4ee5\u63cf\u8ff0\u8fbe\u5230\u9884\u671f\u72b6\u6001\u6240\u9700\u6267\u884c\u7684> \u64cd\u4f5c\uff0c\u7136\u540e\u6267\u884c\u8be5\u8ba1\u5212\u4ee5\u6784\u5efa\u6240\u63cf\u8ff0\u7684\u57fa\u7840\u7ed3\u6784\u3002\u968f\u7740\u914d\u7f6e\u7684\u66f4\u6539\uff0cTerraform\u80fd\u591f\u786e\u5b9a\u66f4\u6539\u7684\u5185\u5bb9\u5e76\u521b\u5efa\u53ef\u4ee5\u5e94\u7528\u7684\u589e\u91cf\u6267\u884c\u8ba1\u5212\u3002"),(0,n.kt)("p",{parentName:"blockquote"},"Terraform\u53ef\u4ee5\u7ba1\u7406\u7684\u57fa\u7840\u7ed3\u6784\u5305\u62ec\u4f4e\u7ea7\u7ec4\u4ef6\uff0c\u4f8b\u5982\u8ba1\u7b97\u5b9e\u4f8b\uff0c\u5b58\u50a8\u548c\u7f51\u7edc\uff0c\u4ee5\u53ca\u9ad8\u7ea7\u7ec4\u4ef6\uff0c\u4f8b\u5982DNS\u6761\u76ee\uff0cSaaS\u529f\u80fd\u7b49\u3002")),(0,n.kt)("h2",{id:"terraform-\u5b89\u88c5"},"Terraform \u5b89\u88c5"),(0,n.kt)("p",null,"\u9996\u5148\u4ece",(0,n.kt)("a",{parentName:"p",href:"https://www.terraform.io/downloads.html"},"\u5b98\u65b9\u7ad9\u70b9"),"\u4e0b\u8f7d\u4e0e\u5f53\u524d\u7cfb\u7edf\u76f8\u540c\u7684",(0,n.kt)("inlineCode",{parentName:"p"},"Terraform"),"\u7248\u672c, \u89e3\u538b\u7f29, \u7136\u540e\u653e\u7f6e\u4e8e\u73af\u5883\u53d8\u91cf\u76ee\u5f55\u4e0b\u5373\u53ef."),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"Linux"),"\u7cfb\u7edf\u4e0b(",(0,n.kt)("a",{parentName:"p",href:"https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/aws-get-started"},"\u5176\u4ed6\u7cfb\u7edf?"),"):"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"$ wget https://releases.hashicorp.com/terraform/0.13.5/terraform_0.13.5_linux_amd64.zip\n$ unzip terraform_0.13.5_linux_amd64.zip\n$ cd terraform_0.13.5_linux_amd64\n$ chmod +x terraform\n$ mv terraform /usr/bin/\n\n## \u68c0\u9a8c\u5b89\u88c5\n$ terraform --version\nTerraform v0.13.5\n\n# \u4e3abash\u6216\u8005zsh\u6dfb\u52a0\u547d\u4ee4\u884c\u81ea\u52a8\u8865\u5168\u529f\u80fd\n$ terraform -install-autocomplete\n")),(0,n.kt)("h2",{id:"terraform-with-aws"},"Terraform with AWS"),(0,n.kt)("p",null,"\u9884\u5148\u51c6\u5907:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html"},"aws cli"),"\u5df2\u6210\u529f\u5b89\u88c5;"),(0,n.kt)("li",{parentName:"ul"},"\u6210\u529f\u83b7\u53d6",(0,n.kt)("inlineCode",{parentName:"li"},"AKSK"),";"),(0,n.kt)("li",{parentName:"ul"},"aws \u672c\u5730\u8bc1\u4e66\u5df2\u6210\u529f\u914d\u7f6e;")),(0,n.kt)("p",null,"aws cli\u5b89\u88c5\u5f88\u7b80\u5355, \u5728\u6b64\u5c31\u4e0d\u518d\u8d58\u8ff0."),(0,n.kt)("p",null,"\u4f7f\u7528",(0,n.kt)("inlineCode",{parentName:"p"},"AKSK"),"\u914d\u7f6eaws\u672c\u5730\u8bc1\u4e66:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"$ aws configure\n# \u4f1a\u63d0\u793a\u8f93\u5165AKSK\u4fe1\u606f, \u53ef\u4ee5\u4ece https://console.aws.amazon.com/iam/home?#security_credential \u83b7\u53d6\nAWS Access Key ID [****************CRUK]: AKI******HHMRQ\nAWS Secret Access Key [****************4K/x]: z0RR******NK0wZE37A\nDefault region name [ap-east-1]: \nDefault output format [yaml]: \n")),(0,n.kt)("p",null,"\u6267\u884c\u5b8c\u8be5\u547d\u4ee4\u4e4b\u540e, \u4f1a\u81ea\u52a8\u5728\u5bb6\u76ee\u5f55(Mac/Linux/Windows)\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a",(0,n.kt)("inlineCode",{parentName:"p"},".aws"),"\u7684\u6587\u4ef6\u5939, \u6587\u4ef6\u5939\u4e2d\u5305\u542b",(0,n.kt)("inlineCode",{parentName:"p"},"config"),"\u914d\u7f6e\u6587\u4ef6\u4ee5\u53ca",(0,n.kt)("inlineCode",{parentName:"p"},"credentials"),"\u8bc1\u4e66\u8ba4\u8bc1\u6587\u4ef6(\u5b9e\u9645\u4e3a",(0,n.kt)("inlineCode",{parentName:"p"},"AKSK"),"\u660e\u6587\u7684ini\u98ce\u683c\u6587\u4ef6)."),(0,n.kt)("h3",{id:"\u5feb\u901f\u5f00\u59cb"},"\u5feb\u901f\u5f00\u59cb"),(0,n.kt)("p",null,"\u7f16\u5199\u914d\u7f6e\u6587\u4ef6: "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'# vim main.tf\nterraform {\n  required_providers {\n    aws = {\n      source  = "hashicorp/aws"\n      version = "~> 3.0"\n    }\n  }\n}\n\n# Configure the AWS Provider\nprovider "aws" {\n  profile = "default"\n  region = "us-east-1"\n}\n\nresource "aws_instance" "example" {\n  count         = 1     # \u8fd0\u884c\u7684\u5b9e\u4f8b\u6570\n  ami           = "ami-07efac79022b86107"        # \u6307\u5b9aami\n  instance_type = "t2.micro"            # \u6307\u5b9a\u5b9e\u4f8b\u7c7b\u578b\n  tags = {\n    Name = "Server ${count.index}"\n  }\n}\n')),(0,n.kt)("p",null,"\u521d\u59cb\u5316:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"$ terrform init\n")),(0,n.kt)("p",null,"\u683c\u5f0f\u5316\u548c\u9a8c\u8bc1\u914d\u7f6e\u6587\u4ef6:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"$ terraform fmt\n$ terraform validate\nSuccess! The configuration is valid.\n")),(0,n.kt)("p",null,"\u5e94\u7528\u914d\u7f6e\u6587\u4ef6:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'$ terraform apply\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  # aws_instance.example will be created\n  + resource "aws_instance" "example" {\n      + ami                          = "ami-03657b56516ab7912"\n      + arn                          = (known after apply)\n      + associate_public_ip_address  = (known after apply)\n      + availability_zone            = (known after apply)\n      + cpu_core_count               = (known after apply)\n      + cpu_threads_per_core         = (known after apply)\n      + get_password_data            = false\n...\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only \'yes\' will be accepted to approve.\n\n  Enter a value: yes    # \u786e\u8ba4\u5b8c\u4fe1\u606f\u4e4b\u540e\u8f93\u5165yes\n\naws_instance.example: Creating...\naws_instance.example: Still creating... [10s elapsed]\naws_instance.example: Still creating... [20s elapsed]\naws_instance.example: Still creating... [30s elapsed]\naws_instance.example: Creation complete after 33s [id=i-0073fc0ea18bc948b]\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed\n\n')),(0,n.kt)("p",null,"\u4f7f\u7528",(0,n.kt)("inlineCode",{parentName:"p"},"terraform show"),"\u67e5\u770b\u751f\u6210\u540e\u7684\u4fe1\u606f."),(0,n.kt)("h2",{id:"\u5c06state\u6587\u4ef6\u5b58\u653e\u5230\u8fdc\u7a0b"},"\u5c06state\u6587\u4ef6\u5b58\u653e\u5230\u8fdc\u7a0b"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"Terraform"),"\u7684\u72b6\u6001\u6587\u4ef6\u4ee5\u53ca\u6240\u6709\u914d\u7f6e\u6587\u4ef6\u90fd\u662f\u5b58\u4e8e\u672c\u5730\u7684, \u5982\u679c\u8981\u534f\u540c\u5de5\u4f5c, \u5219\u9700\u5c06\u6587\u4ef6\u63a8\u9001\u5230\u8fdc\u7aef, \u53ef\u4ee5\u4f7f\u7528",(0,n.kt)("inlineCode",{parentName:"p"},"Github"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"GitLab"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"aws S3"),"\u7b49\u7b49, \u540c\u65f6, \u5b98\u65b9\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e91\u7aef\u5e73\u53f0\u6765\u5b58\u50a8\u548c\u534f\u540c\u5de5\u4f5c."),(0,n.kt)("p",null,"Terraform Cloud \u4f7f\u7528\u53c2\u8003: ",(0,n.kt)("a",{parentName:"p",href:"https://learn.hashicorp.com/tutorials/terraform/aws-remote?in=terraform/aws-get-started"},"https://learn.hashicorp.com/tutorials/terraform/aws-remote?in=terraform/aws-get-started")),(0,n.kt)("p",null,"token\u751f\u6210: ",(0,n.kt)("a",{parentName:"p",href:"https://app.terraform.io/app/settings/tokens"},"https://app.terraform.io/app/settings/tokens"),", \u5c06\u751f\u6210\u4e4b\u540e\u7684token\u653e\u7f6e\u4e8e",(0,n.kt)("inlineCode",{parentName:"p"},"~/.terraformrc"),"\u6587\u4ef6\u4e2d(Windows\u7cfb\u7edf\u4e3a",(0,n.kt)("inlineCode",{parentName:"p"},"%APPDATA%\\terraform.rc"),"), \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\u6240\u793a:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'credentials "app.terraform.io" {\n  token = "REPLACE_ME"\n}\n\n')),(0,n.kt)("p",null,"\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5f15\u7528\u8fdc\u7aef\u5b58\u50a8\u914d\u7f6e\u793a\u4f8b\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\u6240\u793a:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'terraform {\n  backend "remote" {\n    organization = "AGou-ops"\n\n    workspaces {\n      name = "Example-Workspace"\n    }\n  }\n}\n')),(0,n.kt)("p",null,"\u6700\u540e\u521d\u59cb\u5316\u5373\u53ef, ",(0,n.kt)("inlineCode",{parentName:"p"},"terraform init")),(0,n.kt)("h2",{id:"\u5176\u4ed6"},"\u5176\u4ed6"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"terraform apply [--auto-approve -target <RESOURCES>]"),": \u5e94\u7528.tf\u6587\u4ef6, \u5e76\u81ea\u52a8\u5e94\u7b54yes, \u6307\u5b9a\u8d44\u6e90\u540d\u79f0;"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"terraform fmt"),": \u683c\u5f0f\u5316\u914d\u7f6e\u6587\u4ef6;"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"terraform validate"),": \u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u8bed\u6cd5\u662f\u5426\u6b63\u786e;"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"terraform show"),": \u67e5\u770b\u751f\u6210\u4e4b\u540e\u7684\u72b6\u6001;"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"terraform state list"),": \u67e5\u770b\u72b6\u6001\u5217\u8868;"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"terraform state show <STATE_LIST_OUTPUT_NAME>"),": \u67e5\u770b\u6307\u5b9a\u72b6\u6001\u7684\u8be6\u7ec6\u4fe1\u606f;"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"terraform refresh"),": \u5237\u65b0\u72b6\u6001;"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"terraform destroy [-target <RESOURCES>]"),": \u6467\u6bc1;")),(0,n.kt)("h2",{id:"\u53c2\u8003\u94fe\u63a5"},"\u53c2\u8003\u94fe\u63a5"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Terraform Documentation: ",(0,n.kt)("a",{parentName:"li",href:"https://www.terraform.io/docs"},"https://www.terraform.io/docs")),(0,n.kt)("li",{parentName:"ul"},"Terraform AWS: ",(0,n.kt)("a",{parentName:"li",href:"https://registry.terraform.io/providers/hashicorp/aws/latest/docs"},"https://registry.terraform.io/providers/hashicorp/aws/latest/docs")),(0,n.kt)("li",{parentName:"ul"},"Terraform Provider: ",(0,n.kt)("a",{parentName:"li",href:"https://www.terraform.io/docs/providers/index.html"},"https://www.terraform.io/docs/providers/index.html"))))}c.isMDXComponent=!0}}]);