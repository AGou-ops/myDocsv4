"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[6068],{3905:(e,n,t)=>{t.d(n,{Zo:()=>i,kt:()=>k});var r=t(67294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,s=function(e,n){if(null==e)return{};var t,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var c=r.createContext({}),u=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},i=function(e){var n=u(e.components);return r.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,s=e.mdxType,a=e.originalType,c=e.parentName,i=l(e,["components","mdxType","originalType","parentName"]),d=u(t),k=s,b=d["".concat(c,".").concat(k)]||d[k]||p[k]||a;return t?r.createElement(b,o(o({ref:n},i),{},{components:t})):r.createElement(b,o({ref:n},i))}));function k(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var a=t.length,o=new Array(a);o[0]=d;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:s,o[1]=l;for(var u=2;u<a;u++)o[u]=t[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},55956:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var r=t(87462),s=(t(67294),t(3905));const a={},o=void 0,l={unversionedId:"CloudNative/k8s/Installation/k8s Debian12\u4e8c\u8fdb\u5236\u5b89\u88c5",id:"CloudNative/k8s/Installation/k8s Debian12\u4e8c\u8fdb\u5236\u5b89\u88c5",title:"k8s Debian12\u4e8c\u8fdb\u5236\u5b89\u88c5",description:"\u4e00\u3001\u9884\u5148\u51c6\u5907",source:"@site/docs/CloudNative/k8s/Installation/k8s Debian12\u4e8c\u8fdb\u5236\u5b89\u88c5.md",sourceDirName:"CloudNative/k8s/Installation",slug:"/CloudNative/k8s/Installation/k8s Debian12\u4e8c\u8fdb\u5236\u5b89\u88c5",permalink:"/docs/CloudNative/k8s/Installation/k8s Debian12\u4e8c\u8fdb\u5236\u5b89\u88c5",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CloudNative/k8s/Installation/k8s Debian12\u4e8c\u8fdb\u5236\u5b89\u88c5.md",tags:[],version:"current",frontMatter:{},sidebar:"cloudNative",previous:{title:"Kubernetes \u4e8c\u8fdb\u5236\u5b89\u88c5",permalink:"/docs/CloudNative/k8s/Installation/Kubernetes \u4e8c\u8fdb\u5236\u5b89\u88c5"},next:{title:"\u4f7f\u7528 Kubeadm \u90e8\u7f72(\u5355master)",permalink:"/docs/CloudNative/k8s/Installation/\u4f7f\u7528 Kubeadm \u90e8\u7f72\uff08\u5355master\uff09"}},c={},u=[{value:"\u4e00\u3001\u9884\u5148\u51c6\u5907",id:"\u4e00\u9884\u5148\u51c6\u5907",level:2},{value:"1.1 \u670d\u52a1\u5668\u89d2\u8272",id:"11-\u670d\u52a1\u5668\u89d2\u8272",level:3},{value:"1.2 \u7cfb\u7edf\u521d\u59cb\u5316",id:"12-\u7cfb\u7edf\u521d\u59cb\u5316",level:3},{value:"1.3 hosts\u8bbe\u7f6e",id:"13-hosts\u8bbe\u7f6e",level:3},{value:"1.3.1 \u901a\u8fc7hosts\u6587\u4ef6\u914d\u7f6e",id:"131-\u901a\u8fc7hosts\u6587\u4ef6\u914d\u7f6e",level:4},{value:"1.3.2 \u4f7f\u7528bind9 DNS\u5de5\u5177",id:"132-\u4f7f\u7528bind9-dns\u5de5\u5177",level:4},{value:"1.4 \uff08\u53ef\u9009\uff09\u5b89\u88c5supervisor",id:"14-\u53ef\u9009\u5b89\u88c5supervisor",level:3},{value:"\u4e8c\u3001\u5b89\u88c5CRI\u5bb9\u5668\u8fd0\u884c\u65f6\u53caharbor\u79c1\u6709\u4ed3",id:"\u4e8c\u5b89\u88c5cri\u5bb9\u5668\u8fd0\u884c\u65f6\u53caharbor\u79c1\u6709\u4ed3",level:2},{value:"2.1 \u5b89\u88c5containerd",id:"21-\u5b89\u88c5containerd",level:3},{value:"2.1.1 \u6b65\u9aa4\u4e00\u5b89\u88c5containerd",id:"211-\u6b65\u9aa4\u4e00\u5b89\u88c5containerd",level:4},{value:"2.1.2 \u6b65\u9aa4\u4e8c\u5b89\u88c5runC",id:"212-\u6b65\u9aa4\u4e8c\u5b89\u88c5runc",level:4},{value:"2.1.3 \u6b65\u9aa4\u4e09\u5b89\u88c5CNI\u63d2\u4ef6",id:"213-\u6b65\u9aa4\u4e09\u5b89\u88c5cni\u63d2\u4ef6",level:4},{value:"2.1.4 \u914d\u7f6econtainerd\u4f7f\u7528systemd cgroup\u9a71\u52a8",id:"214-\u914d\u7f6econtainerd\u4f7f\u7528systemd-cgroup\u9a71\u52a8",level:4},{value:"2.1.5 \u5b89\u88c5crictl\u5ba2\u6237\u7aef\u5de5\u5177",id:"215-\u5b89\u88c5crictl\u5ba2\u6237\u7aef\u5de5\u5177",level:4},{value:"2.2 \u5b89\u88c5harbor\u79c1\u6709\u4ed3",id:"22-\u5b89\u88c5harbor\u79c1\u6709\u4ed3",level:3},{value:"\u4e09\u3001\u4f7f\u7528cfssl\u751f\u6210\u8bc1\u4e66",id:"\u4e09\u4f7f\u7528cfssl\u751f\u6210\u8bc1\u4e66",level:2},{value:"3.1 \u5b89\u88c5cfssl",id:"31-\u5b89\u88c5cfssl",level:3},{value:"3.2 \u521d\u59cb\u5316\u53ca\u8bf4\u660e",id:"32-\u521d\u59cb\u5316\u53ca\u8bf4\u660e",level:3},{value:"\u56db\u3001\u90e8\u7f72master\u8282\u70b9",id:"\u56db\u90e8\u7f72master\u8282\u70b9",level:2},{value:"4.1 \u90e8\u7f72etcd\u96c6\u7fa4",id:"41-\u90e8\u7f72etcd\u96c6\u7fa4",level:3},{value:"4.1.1 \u4e0b\u8f7d\u5b89\u88c5etcd\u548cetcdctl\u4e8c\u8fdb\u5236\u6587\u4ef6",id:"411-\u4e0b\u8f7d\u5b89\u88c5etcd\u548cetcdctl\u4e8c\u8fdb\u5236\u6587\u4ef6",level:4},{value:"4.1.2 \u4e3aetcd\u5236\u4f5c\u8bc1\u4e66",id:"412-\u4e3aetcd\u5236\u4f5c\u8bc1\u4e66",level:4},{value:"4.2 \u90e8\u7f72API server",id:"42-\u90e8\u7f72api-server",level:3},{value:"4.2.1 \u4f7f\u7528cfssl\u751f\u6210\u8bc1\u4e66",id:"421-\u4f7f\u7528cfssl\u751f\u6210\u8bc1\u4e66",level:4},{value:"4.2.2 \u90e8\u7f72api-server",id:"422-\u90e8\u7f72api-server",level:4},{value:"4.3 \u90e8\u7f72controller-manager",id:"43-\u90e8\u7f72controller-manager",level:3},{value:"4.4 \u90e8\u7f72kube-scheduler",id:"44-\u90e8\u7f72kube-scheduler",level:3},{value:"4.5 \u914d\u7f6ekubectl\u6240\u9700\u8981\u7684kubeconfig",id:"45-\u914d\u7f6ekubectl\u6240\u9700\u8981\u7684kubeconfig",level:3},{value:"4.6 \u90e8\u7f72node\u76f8\u5173\u7ec4\u4ef6kube-proxy\u3001kubelet",id:"46-\u90e8\u7f72node\u76f8\u5173\u7ec4\u4ef6kube-proxykubelet",level:3},{value:"4.6.1 bootstrap\u81ea\u52a8\u8ba4\u8bc1kubelet",id:"461-bootstrap\u81ea\u52a8\u8ba4\u8bc1kubelet",level:4},{value:"4.6.2 \u90e8\u7f72kubelet",id:"462-\u90e8\u7f72kubelet",level:4},{value:"4.6.3 \u5c06master\u8282\u70b9\u4f5c\u4e3anode\u52a0\u5165\u5230\u96c6\u7fa4\u5185\u90e8",id:"463-\u5c06master\u8282\u70b9\u4f5c\u4e3anode\u52a0\u5165\u5230\u96c6\u7fa4\u5185\u90e8",level:4},{value:"4.6.3 \u90e8\u7f72kube-proxy",id:"463-\u90e8\u7f72kube-proxy",level:4},{value:"4.6.4 \u6388\u6743apiserver\u8bbf\u95eekubelet",id:"464-\u6388\u6743apiserver\u8bbf\u95eekubelet",level:4},{value:"4.6.5 \u90e8\u7f72flannel\u7f51\u7edc\u7ec4\u4ef6",id:"465-\u90e8\u7f72flannel\u7f51\u7edc\u7ec4\u4ef6",level:4},{value:"4.7 \u68c0\u67e5master\u8282\u70b9\u90e8\u7f72\u7ed3\u679c",id:"47-\u68c0\u67e5master\u8282\u70b9\u90e8\u7f72\u7ed3\u679c",level:3},{value:"4.7.1 \u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001",id:"471-\u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001",level:4},{value:"4.7.2 \u9644\uff1a\u6587\u4ef6\u5217\u8868\u53ca\u7b80\u4ecb",id:"472-\u9644\u6587\u4ef6\u5217\u8868\u53ca\u7b80\u4ecb",level:4},{value:"\u4e94\u3001\u90e8\u7f72node\u8282\u70b9",id:"\u4e94\u90e8\u7f72node\u8282\u70b9",level:2},{value:"5.1 \u90e8\u7f72kubelet",id:"51-\u90e8\u7f72kubelet",level:3},{value:"5.2 \u90e8\u7f72kube-proxy",id:"52-\u90e8\u7f72kube-proxy",level:3},{value:"5.3 \u68c0\u67e5node\u8282\u70b9\u90e8\u7f72\u7ed3\u679c",id:"53-\u68c0\u67e5node\u8282\u70b9\u90e8\u7f72\u7ed3\u679c",level:3},{value:"5.3.1 \u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001",id:"531-\u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001",level:4},{value:"5.3.2 \u9644\uff1a\u6587\u4ef6\u5217\u8868\u53ca\u7b80\u4ecb",id:"532-\u9644\u6587\u4ef6\u5217\u8868\u53ca\u7b80\u4ecb",level:4},{value:"\u516d\u3001\u5176\u4ed6\u53ef\u9009\u7ec4\u4ef6\u5b89\u88c5",id:"\u516d\u5176\u4ed6\u53ef\u9009\u7ec4\u4ef6\u5b89\u88c5",level:2},{value:"6.1 coredns",id:"61-coredns",level:3},{value:"6.1.1 \u90e8\u7f72coredns",id:"611-\u90e8\u7f72coredns",level:4},{value:"\u6d4b\u8bd5coredns",id:"\u6d4b\u8bd5coredns",level:4},{value:"6.2 nginx ingress",id:"62-nginx-ingress",level:3},{value:"6.3 \u9762\u677f",id:"63-\u9762\u677f",level:3},{value:"6.3.1 dashboard",id:"631-dashboard",level:4},{value:"6.3.2 rancher",id:"632-rancher",level:4},{value:"\u4e03\u3001\u672a\u5b8c\u5f85\u7eed",id:"\u4e03\u672a\u5b8c\u5f85\u7eed",level:2}],i={toc:u};function p(e){let{components:n,...t}=e;return(0,s.kt)("wrapper",(0,r.Z)({},i,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"\u4e00\u9884\u5148\u51c6\u5907"},"\u4e00\u3001\u9884\u5148\u51c6\u5907"),(0,s.kt)("h3",{id:"11-\u670d\u52a1\u5668\u89d2\u8272"},"1.1 \u670d\u52a1\u5668\u89d2\u8272"),(0,s.kt)("p",null,"\u73af\u5883\u4fe1\u606f\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"k8s\u7248\u672c\uff1av1.25.12"),(0,s.kt)("li",{parentName:"ul"},"Debian12(bookworm)\uff1a\u5185\u68386.1.0-9-amd64")),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:null},"\u89d2\u8272"),(0,s.kt)("th",{parentName:"tr",align:null},"IP"),(0,s.kt)("th",{parentName:"tr",align:null},"\u7ec4\u4ef6\u5217\u8868"))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"master"),(0,s.kt)("td",{parentName:"tr",align:null},"172.19.82.157"),(0,s.kt)("td",{parentName:"tr",align:null},"kube-apiserver\u3001kube-controller-manage\u3001kube-scheduler\u3001kubelet\u3001kube-proxy\u3001etcd\u3001containerd")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"node01"),(0,s.kt)("td",{parentName:"tr",align:null},"172.19.82.158"),(0,s.kt)("td",{parentName:"tr",align:null},"kubelet\u3001kube-proxy\u3001containerd\u3001etcd")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"node02"),(0,s.kt)("td",{parentName:"tr",align:null},"172.19.82.159"),(0,s.kt)("td",{parentName:"tr",align:null},"kubelet\u3001kube-proxy\u3001containerd\u3001etcd")))),(0,s.kt)("p",null,"\u2139\u7531\u4e8e\u624b\u4e0a\u8d44\u6e90\u6709\u9650\uff0c\u6240\u4ee5\u642d\u5efa\u4e00\u4e2a\u4e00\u4e3b\u4e24\u4ece\u7684\u96c6\u7fa4\uff0c\u5982\u679c\u540e\u7eed\u60f3\u8981\u6269\u5c55\u7684\u8bdd\uff0c\u4ec5\u9700\u8981\u518d\u6dfb\u52a0master\u6216\u8005node\u8282\u70b9\u5373\u53ef\uff0c\u6b64\u5916etcd\u53ef\u4ee5\u90e8\u7f72\u5230\u96c6\u7fa4\u4e4b\u5916\u5e76\u505a\u9ad8\u53ef\u7528\u3002"),(0,s.kt)("h3",{id:"12-\u7cfb\u7edf\u521d\u59cb\u5316"},"1.2 \u7cfb\u7edf\u521d\u59cb\u5316"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u7981\u7528\u9632\u706b\u5899\nsystemctl stop ufw\nsystemctl disable ufw\n# \u5173\u95edSELinux\uff0c\u6211\u8fd9\u91cccloudint\u5b89\u88c5\u7684\u7cfb\u7edf\uff0c\u6ca1\u6709\u9632\u706b\u5899\u548cselinux\nsed -i 's/enforcing/disabled/' /etc/selinux/config  \nsetenforce 0\n# \u5173\u95ed\u4ea4\u6362\u5206\u533aswap\nswap -a\nsed -ri 's/.*swap.*/#&/' /etc/fstab\n# \u540c\u6b65\u65f6\u533a\u4e0e\u65f6\u95f4\uff0c**\u975e\u5e38\u91cd\u8981**\ntimedatectl set-timezone Asia/Shanghai\nntpdate ntp.aliyun.com    # \u6ca1\u6709ntpdate\u7684\u8bdd\uff0c\u9700\u8981\u5b89\u88c5\u4e00\u4e0b\uff0capt install ntpdate -y\n# \u914d\u7f6eulimit\uff0c\u6700\u5927\u6587\u4ef6\u6253\u5f00\u6570\uff0c\u4f18\u5316linux\u6027\u80fd\uff0c\u91cd\u65b0\u9000\u51fa\u767b\u5f55\u5f53\u524dshell\u5373\u53ef\u751f\u6548\nulimit -SHn 65535\ncat >> /etc/security/limits.conf << EOF\nroot soft nofile 65536\nroot hard nofile 131072\nroot soft nproc 65535\nroot hard nproc 655350\nroot soft memlock unlimited\nroot hard memlock unlimited\nEOF\n# \u5b89\u88c5ipvs\napt install ipvsadm ipset sysstat conntrack -y\n# \u52a0\u8f7d\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack\n# \u5199\u5165\u914d\u7f6e\u6587\u4ef6\u6c38\u4e45\u751f\u6548\ncat >> /etc/modules-load.d/ipvs.conf <<EOF \nip_vs\nip_vs_rr\nip_vs_wrr\nip_vs_sh\nnf_conntrack\nip_tables\nip_set\nxt_set\nipt_set\nipt_rpfilter\nipt_REJECT\nipip\nEOF\n# \u91cd\u542f\u670d\u52a1\u4ee5\u52a0\u8f7d\u6a21\u5757\nsystemctl restart systemd-modules-load.service\n# \u68c0\u67e5\u6a21\u5757\u662f\u5426\u52a0\u8f7d\uff0c\u8fd9\u91cc\u53ef\u4ee5reboot\u4e00\u4e0b\nlsmod | grep -e ip_vs -e nf_conntrack\n# \u4fee\u6539\u5185\u6838\u53c2\u6570\uff0c\u6309\u9700\u4fee\u6539\u5373\u53ef\ncat > /etc/sysctl.d/k8s.conf <<EOF\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-iptables = 1\nfs.may_detach_mounts = 1\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.netfilter.nf_conntrack_max=2310720\n\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl =15\nnet.ipv4.tcp_max_tw_buckets = 36000\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_max_orphans = 327680\nnet.ipv4.tcp_orphan_retries = 3\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.ip_conntrack_max = 65536\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_timestamps = 0\nnet.core.somaxconn = 16384\n\nnet.ipv6.conf.all.disable_ipv6 = 0\nnet.ipv6.conf.default.disable_ipv6 = 0\nnet.ipv6.conf.lo.disable_ipv6 = 0\nnet.ipv6.conf.all.forwarding = 0\nEOF\n# \u4f7f\u5176\u751f\u6548\nsysctl --system\n")),(0,s.kt)("h3",{id:"13-hosts\u8bbe\u7f6e"},"1.3 hosts\u8bbe\u7f6e"),(0,s.kt)("h4",{id:"131-\u901a\u8fc7hosts\u6587\u4ef6\u914d\u7f6e"},"1.3.1 \u901a\u8fc7hosts\u6587\u4ef6\u914d\u7f6e"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"cat >> /etc/hosts << EOF\n172.19.82.157 master.k8s.local master\n172.19.82.158 node01.k8s.local node01\n172.19.82.159 node02.k8s.local node02\nEOF\n\n# \u6d4b\u8bd5\u7f51\u7edc\u8fde\u901a\nfor i in master node01 node02; do ping -c 2 $i; done\n")),(0,s.kt)("h4",{id:"132-\u4f7f\u7528bind9-dns\u5de5\u5177"},"1.3.2 \u4f7f\u7528bind9 DNS\u5de5\u5177"),(0,s.kt)("p",null,"\u2139\u4ec5\u5728\u4e00\u53f0\u673a\u5668\u4e0a\u5b89\u88c5bind9\u5373\u53ef\uff0c\u6211\u8fd9\u91cc\u9009\u62e9master\u8282\u70b9\uff0c\u5982\u679c\u6709\u9ad8\u53ef\u7528\u9700\u6c42\u7684\u8bdd\u53ef\u4ee5\u5b89\u88c5\u591a\u4e2abind\u505a\u96c6\u7fa4\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5b89\u88c5bind9 DNS\u5de5\u5177\napt install bind9 dnsutils -y\n")),(0,s.kt)("p",null,"\u4fee\u6539\u914d\u7f6e\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'vim /etc/bind/named.conf.options\n# \u5185\u5bb9\u5982\u4e0b(\u5220\u6389\u4e86\u90e8\u5206\u6ce8\u91ca)\noptions {\n        directory "/var/cache/bind";\n        // \u5f53DNS\u89e3\u6790\u4e0d\u5230\u65f6\uff0c\u8f6c\u53d1\u7ed9\u5176\u4ed6DNS\u670d\u52a1\u5668\n        forwarders {\n                8.8.8.8;\n        };\n        dnssec-validation auto;\n\n        listen-on-v6 { any; };\n};\n')),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822111122.png",alt:"image.png"}),"\n\u914d\u7f6e\u89e3\u6790\u57df\u4ee5\u53ca\u6a21\u677f\u6587\u4ef6\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'# \u914d\u7f6e\u89e3\u6790\u57df\nvim /etc/bind/named.conf.default-zones\n// \u6b63\u5411\u89e3\u6790\u57df\nzone "k8s.local" IN {\n        type master;\n        file "/etc/bind/db.k8s.local";\n};\n// \u53cd\u5411\u89e3\u6790\u57df\nzone "82.19.172.in-addr.zrpa" IN {\n        type master;\n        file "/etc/bind/db.in-addr.k8s.local";\n};\n# \u590d\u5236\u6a21\u7248\u6587\u4ef6\ncp -a /etc/bind/db.local /etc/bind/db.k8s.local\ncp -a /etc/bind/db.127 /etc/bind/db.in-addr.k8s.local\n# \u914d\u7f6e\u6b63\u5411\u89e3\u6790\u6587\u4ef6\nvim /etc/bind/db.k8s.local\n$TTL    604800\n@       IN      SOA     dns.k8s.local. k8s.local. (\n                              2         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                         604800 )       ; Negative Cache TTL\n;\n@       IN      NS      dns.k8s.local.\ndns     IN      A       172.19.82.157\nmaster  IN      A       172.19.82.157\nnode01  IN      A       172.19.82.158\nnode02  IN      A       172.19.82.159\n# \u914d\u7f6e\u53cd\u5411\u89e3\u6790\u6587\u4ef6\nvim /etc/bind/db.in-addr.k8s.local\n$TTL    604800\n@       IN      SOA     dns.k8s.local. k8s.local. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                         604800 )       ; Negative Cache TTL\n;\n@       IN      NS      dns.k8s.local.\n157     IN      PTR     k8s.local.\n157     IN      PTR     master.k8s.local.\n158     IN      PTR     node01.k8s.local.\n159     IN      PTR     node02.k8s.local.\n')),(0,s.kt)("p",null,"\u91cd\u542f\u670d\u52a1\u53ca\u6d4b\u8bd5\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl restart bind9\n# \u4fee\u6539\u4e3b\u673a\u7684\u9996\u9009DNS\u5730\u5740\u4e3a172.19.82.157\ncat /etc/resolv.conf\nnameserver 172.19.82.157\nnameserver 8.8.8.8\n# \u6d4b\u8bd5\nfor i in master node01 node02; do dig +short $i.k8s.local; done\n# \u5e94\u5f53\u8f93\u51fa\uff0c\u622a\u56fe\u5982\u4e0b\n172.19.82.157\n172.19.82.158\n172.19.82.159\n")),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822114543.png",alt:"image.png"})),(0,s.kt)("h3",{id:"14-\u53ef\u9009\u5b89\u88c5supervisor"},"1.4 \uff08\u53ef\u9009\uff09\u5b89\u88c5supervisor"),(0,s.kt)("p",null,"\u5b89\u88c5supervisor\u7b80\u5355\u5b9e\u73b0\u670d\u52a1\u201c\u9ad8\u53ef\u7528\u201d.\n\u2139\u975e\u5fc5\u987b\uff0c\u4f7f\u7528systemd\u6765\u7ba1\u7406\u4e5f\u53ef\u4ee5."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"}," apt install supervisor -y\n # \u8bbe\u7f6e\u4e3a\u5f00\u673a\u81ea\u542f\uff0c\u5e76\u542f\u52a8\n systemctl enable supervisor --now\n")),(0,s.kt)("h2",{id:"\u4e8c\u5b89\u88c5cri\u5bb9\u5668\u8fd0\u884c\u65f6\u53caharbor\u79c1\u6709\u4ed3"},"\u4e8c\u3001\u5b89\u88c5CRI\u5bb9\u5668\u8fd0\u884c\u65f6\u53caharbor\u79c1\u6709\u4ed3"),(0,s.kt)("h3",{id:"21-\u5b89\u88c5containerd"},"2.1 \u5b89\u88c5containerd"),(0,s.kt)("p",null,"\u5b89\u88c5\u65b9\u5f0f\u6709\u597d\u51e0\u79cd\uff0c\u4e8c\u8fdb\u5236\u5b89\u88c5\uff0c\u4ed3\u5e93\u5b89\u88c5\u4ee5\u53ca\u7f16\u8bd1\u5b89\u88c5\u3002"),(0,s.kt)("p",null,"\u8fd9\u91cc\u6211\u4f7f\u7528\u4e8c\u8fdb\u5236\u8fdb\u884c\u5b89\u88c5\uff0c\u4ed3\u5e93\u5b89\u88c5\u53c2\u8003\uff1a",(0,s.kt)("a",{parentName:"p",href:"https://github.com/containerd/containerd/blob/main/docs/getting-started.md#option-2-from-apt-get-or-dnf"},"https://github.com/containerd/containerd/blob/main/docs/getting-started.md#option-2-from-apt-get-or-dnf"),"\n\ud83d\ude04 let's go~"),(0,s.kt)("h4",{id:"211-\u6b65\u9aa4\u4e00\u5b89\u88c5containerd"},"2.1.1 \u6b65\u9aa4\u4e00\u5b89\u88c5containerd"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u4ecehttps://github.com/containerd/containerd/releases\uff0c\u4e0b\u8f7dcontainerd\u7684\u4e8c\u8fdb\u5236\u5305\uff0c\u6ce8\u610f\u8f6f\u4ef6\u5305\u67b6\u6784.\nwget https://github.com/containerd/containerd/releases/download/v1.6.23/containerd-1.6.23-linux-amd64.tar.gz\n\ntar Cxzvf /usr/local containerd-1.6.23-linux-amd64.tar.gz\n\n# \u5b89\u88c5service\u670d\u52a1\nwget -O /lib/systemd/system/containerd.service https://raw.githubusercontent.com/containerd/containerd/main/containerd.service\n# \u91cd\u8f7d\u5e76\u542f\u52a8\u670d\u52a1\uff0c\u8bbe\u7f6e\u4e3a\u5f00\u673a\u81ea\u542f\u52a8\nsystemctl daemon-reload\nsystemctl enable containerd --now\n")),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822131441.png",alt:"image.png"})),(0,s.kt)("h4",{id:"212-\u6b65\u9aa4\u4e8c\u5b89\u88c5runc"},"2.1.2 \u6b65\u9aa4\u4e8c\u5b89\u88c5runC"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"}," wget https://github.com/opencontainers/runc/releases/download/v1.1.9/runc.amd64\ninstall -m 755 runc.amd64 /usr/local/sbin/runc\n")),(0,s.kt)("h4",{id:"213-\u6b65\u9aa4\u4e09\u5b89\u88c5cni\u63d2\u4ef6"},"2.1.3 \u6b65\u9aa4\u4e09\u5b89\u88c5CNI\u63d2\u4ef6"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://github.com/containernetworking/plugins/releases/download/v1.3.0/cni-plugins-linux-amd64-v1.3.0.tgz\n# tar Cxzvf /usr/local/bin cni-plugins-linux-amd64-v1.3.0.tgz\ntar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.3.0.tgz\n")),(0,s.kt)("h4",{id:"214-\u914d\u7f6econtainerd\u4f7f\u7528systemd-cgroup\u9a71\u52a8"},"2.1.4 \u914d\u7f6econtainerd\u4f7f\u7528systemd cgroup\u9a71\u52a8"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u751f\u6210\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\ncontainerd config default | tee /etc/containerd/config.toml\n")),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822132245.png",alt:"image.png"}),"\n\u5927\u6982\u7b2c125\u884c\uff0c\u4fee\u6539   ",(0,s.kt)("inlineCode",{parentName:"p"},"SystemdCgroup")," \u4e3a",(0,s.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'vim /etc/containerd/config.toml\n# \u4fee\u6539\u9ed8\u8ba4\u7684pause\u5bb9\u5668\u955c\u50cf\u5730\u5740\u4e3a\u963f\u91cc\u4e91\u56fd\u5185\u6e90\nsandbox_image = "registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.9"\n')),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822132616.png",alt:"image.png"}),"\n\u5927\u6982\u7b2c61\u884c\u3002\n\u4fee\u6539\u5b8c\u4fdd\u5b58\u4e4b\u540e\uff0c\u91cd\u542f",(0,s.kt)("inlineCode",{parentName:"p"},"systemctl restart containerd"),".\n\u68c0\u67e5\u8fd0\u884c\u72b6\u6001\uff1a\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822132807.png",alt:"image.png"})),(0,s.kt)("h4",{id:"215-\u5b89\u88c5crictl\u5ba2\u6237\u7aef\u5de5\u5177"},"2.1.5 \u5b89\u88c5crictl\u5ba2\u6237\u7aef\u5de5\u5177"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'wget https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.28.0/crictl-v1.28.0-linux-amd64.tar.gz\ntar xf crictl-v1.28.0-linux-amd64.tar.gz -C /usr/local/bin\n# \u7f16\u5199\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\uff0c\u65b9\u4fbf\u5ba2\u6237\u7aef\u4f7f\u7528\nbash -c "cat > /etc/crictl.yaml"  <<EOF\nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 10\ndebug: false\nEOF\n')),(0,s.kt)("p",null,"\u68c0\u67e5\u662f\u5426\u5b89\u88c5\u6210\u529f",(0,s.kt)("inlineCode",{parentName:"p"},"crictl ps"),"\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822133349.png",alt:"image.png"})),(0,s.kt)("h3",{id:"22-\u5b89\u88c5harbor\u79c1\u6709\u4ed3"},"2.2 \u5b89\u88c5harbor\u79c1\u6709\u4ed3"),(0,s.kt)("p",null,"harbor\u5efa\u8bae\u90e8\u7f72\u5728\u5176\u4ed6\u4e3b\u673a\u4e0a\uff0c\u6bd4\u5982\u8bf4\u4e3b\u63a7\u673a\uff0c\u4e0ek8s\u96c6\u7fa4\u5206\u5272\u5f00\u6765\uff0c\u8fd9\u4e2a\u968f\u4fbf\uff0c\u770b\u4f60\u81ea\u5df1\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u4e0b\u8f7d\u79bb\u7ebf\u5b89\u88c5\u5305\nwget https://github.com/goharbor/harbor/releases/download/v2.8.4/harbor-offline-installer-v2.8.4.tgz\ntar xzvf harbor-offline-installer-v2.8.4.tgz\n# \u8fd0\u884c\u5b89\u88c5\u7a0b\u5e8f\u5373\u53ef\nsudo ./install.sh \n")),(0,s.kt)("p",null,"\u540e\u7eed\u6b65\u9aa4\u7565."),(0,s.kt)("h2",{id:"\u4e09\u4f7f\u7528cfssl\u751f\u6210\u8bc1\u4e66"},"\u4e09\u3001\u4f7f\u7528cfssl\u751f\u6210\u8bc1\u4e66"),(0,s.kt)("h3",{id:"31-\u5b89\u88c5cfssl"},"3.1 \u5b89\u88c5cfssl"),(0,s.kt)("p",null,"\u2139\u5728master\u8282\u70b9\u6216\u8005\u4e3b\u63a7\u673a\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\u4e0a\u5b89\u88c5cfssl\u5373\u53ef\uff0c\u5176\u4ed6\u4e3b\u673a\u4e0d\u9700\u8981\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://github.com/cloudflare/cfssl/releases/download/v1.6.4/cfssl_1.6.4_linux_amd64\nwget https://github.com/cloudflare/cfssl/releases/download/v1.6.4/cfssljson_1.6.4_linux_amd64\nwget https://github.com/cloudflare/cfssl/releases/download/v1.6.4/cfssl-certinfo_1.6.4_linux_amd64\ninstall -m 755 cfssl_1.6.4_linux_amd64 /usr/local/bin/cfssl\ninstall -m 755 cfssljson_1.6.4_linux_amd64 /usr/local/bin/cfssl-json\ninstall -m 755 cfssl-certinfo_1.6.4_linux_amd64 /usr/local/bin/cfssl-certinfo\n")),(0,s.kt)("p",null,"\u68c0\u67e5\u5b89\u88c5\uff1a\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822134549.png",alt:"image.png"})),(0,s.kt)("h3",{id:"32-\u521d\u59cb\u5316\u53ca\u8bf4\u660e"},"3.2 \u521d\u59cb\u5316\u53ca\u8bf4\u660e"),(0,s.kt)("p",null,"\u521b\u5efak8s\u96c6\u7fa4\u53caetcd\u6240\u9700\u8981\u7684\u8bc1\u4e66\u76ee\u5f55\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u4e0b\u9762\u4e00\u4e2a\u547d\u4ee4\u4e09\u4e2a\u4e3b\u673a\u90fd\u6267\u884c\u4e00\u4e0b\u3002\nmkdir -pv /etc/kubernetes/TLS/{etcd,k8s}\n")),(0,s.kt)("p",null,"\u8bf4\u660e\uff1a\u4e00\u5171\u521b\u5efa\u4e86\u4e09\u4e2aCA\uff0c\u5206\u522b\u7528\u4e8e\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"etcd\u96c6\u7fa4"),(0,s.kt)("li",{parentName:"ul"},"apiserver\u3001controller manager\u3001kubelet\u3001kube-scheduler\u7b49"),(0,s.kt)("li",{parentName:"ul"},"front-proxy")),(0,s.kt)("h2",{id:"\u56db\u90e8\u7f72master\u8282\u70b9"},"\u56db\u3001\u90e8\u7f72master\u8282\u70b9"),(0,s.kt)("h3",{id:"41-\u90e8\u7f72etcd\u96c6\u7fa4"},"4.1 \u90e8\u7f72etcd\u96c6\u7fa4"),(0,s.kt)("h4",{id:"411-\u4e0b\u8f7d\u5b89\u88c5etcd\u548cetcdctl\u4e8c\u8fdb\u5236\u6587\u4ef6"},"4.1.1 \u4e0b\u8f7d\u5b89\u88c5etcd\u548cetcdctl\u4e8c\u8fdb\u5236\u6587\u4ef6"),(0,s.kt)("p",null,"\u6211\u4eec\u9700\u8981\u5728157\uff0c158\u548c159\u4e09\u53f0\u673a\u5668\u4e2d\u90fd\u88c5\u4e0aetcd\uff0c\u4ee5\u7ec4\u6210etcd\u96c6\u7fa4\uff0c\u4fdd\u8bc1etcd\u7684\u9ad8\u53ef\u7528\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# 157\uff0c158\uff0c159\u673a\u5668\u4e0a\uff0c\u4e5f\u5c31\u662fmaster\u548cnode01\u3001node02\u8282\u70b9\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\n# \u521b\u5efaetcd\u7528\u6237\nuseradd -s /sbin/nologin -M etcd\nwget https://github.com/etcd-io/etcd/releases/download/v3.4.27/etcd-v3.4.27-linux-amd64.tar.gz\ntar xf etcd-v3.4.27-linux-amd64.tar.gz -C /usr/local\nmv /usr/local/etcd-v3.4.27-linux-amd64 /usr/local/etcd-v3.4.27\n# \u521b\u5efa\u8f6f\u8fde\u63a5\u65b9\u4fbf\u4f7f\u7528\nln -sv /usr/local/etcd-v3.4.27/etcd /usr/local/bin\nln -sv /usr/local/etcd-v3.4.27/etcdctl /usr/local/bin\n")),(0,s.kt)("p",null,"\u68c0\u67e5etcd\u5b89\u88c5\u7ed3\u679c\uff1a\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822141125.png",alt:"image.png"})),(0,s.kt)("h4",{id:"412-\u4e3aetcd\u5236\u4f5c\u8bc1\u4e66"},"4.1.2 \u4e3aetcd\u5236\u4f5c\u8bc1\u4e66"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'# \u4ec5\u5728master\u4e3b\u673a\u4e0a\u6267\u884c\ncd /etc/kubernetes/TLS/etcd\nvim ca-config.json\n{\n  "signing": {\n    "default": {\n      "expiry": "87600h"\n    },\n    "profiles": {\n      "etcd": {\n         "expiry": "87600h",\n         "usages": [\n            "signing",\n            "key encipherment",\n            "server auth",\n            "client auth"\n        ]\n      }\n    }\n  }\n}\n\n\nvim ca-csr.json\n{\n    "CN": "etcd CA",\n    "key": {\n        "algo": "rsa",\n        "size": 2048\n    },\n    "names": [\n        {\n            "C": "CN",\n            "L": "HangZhou",\n            "ST": "ZheJiang"\n        }\n    ]\n}\n\ncfssl gencert -initca ca-csr.json | cfssl-json -bare ca\n# \u68c0\u67e5ca\u751f\u6210\u7ed3\u679c\uff0c\u89c1\u4e0b\u56fe\n\ncd /etc/kubernetes/TLS/etcd\n# \u5c06\u53ef\u80fd\u7528\u5230\u7684IP\u52a0\u5230hosts\u5b57\u6bb5\u91cc\u9762\u3002\nvim etcd-server-csr.json\n{\n    "CN": "etcd",\n    "hosts": [\n        "172.19.82.157",\n        "172.19.82.158",\n        "172.19.82.159",\n        "192.168.3.28",\n        "127.0.0.1",\n        "10.96.0.1"\n    ],\n    "key": {\n        "algo": "rsa",\n        "size": 2048\n    },\n    "names": [\n        {\n            "C": "CN",\n            "L": "HangZhou",\n            "ST": "ZheJiang"\n        }\n    ]\n}\n# \u4f7f\u7528\u4e0a\u9762\u7684\u81ea\u7b7eCA\u7b7e\u53d1etcd\u8bc1\u4e66\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=etcd etcd-server-csr.json | cfssl-json -bare etcd-server\n')),(0,s.kt)("p",null," \u914d\u7f6e\u6587\u4ef6\u5b57\u6bb5\u89e3\u91ca\uff1a"),(0,s.kt)("blockquote",null,(0,s.kt)("ul",{parentName:"blockquote"},(0,s.kt)("li",{parentName:"ul"},"CN\uff1aCommon Name\uff0c\u6d4f\u89c8\u5668\u4f7f\u7528\u8be5\u5b57\u6bb5\u9a8c\u8bc1\u7f51\u5740\u662f\u5426\u5408\u6cd5\uff0c\u4e00\u822c\u5199\u57df\u540d\uff0c\u975e\u5e38\u91cd\u8981"),(0,s.kt)("li",{parentName:"ul"},"ST\uff1aState\uff0c\u7701"),(0,s.kt)("li",{parentName:"ul"},"L\uff1aLocality\uff0c\u5730\u533a"),(0,s.kt)("li",{parentName:"ul"},"O\uff1aOrganization Name\uff0c\u7ec4\u7ec7\u540d\u79f0"),(0,s.kt)("li",{parentName:"ul"},"OU\uff1aOrganization Unit Name\uff0c\u7ec4\u7ec7\u5355\u4f4d\u540d\u79f0"))),(0,s.kt)("p",null,"\u68c0\u67e5CA\u751f\u6210\u7ed3\u679c\uff1a\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230823104905.png",alt:"image.png"})),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"ca-config.json\u89e3\u6790\uff1a\n")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"expiry\uff1a\u6709\u6548\u671f\u4e3a200\u5e74\nprofiles-server\uff1a\u542f\u52a8server\u7684\u65f6\u5019\u9700\u8981\u914d\u7f6e\u8bc1\u4e66\nprofiles-client\uff1aclient\u53bb\u8fde\u63a5server\u7684\u65f6\u5019\u9700\u8981\u8bc1\u4e66\nprofiles-peer\uff1a\u53cc\u5411\u8bc1\u4e66\uff0c\u670d\u52a1\u7aef\u627e\u5ba2\u6237\u7aef\u9700\u8981\u8bc1\u4e66\uff0c\u5ba2\u6237\u7aef\u627e\u670d\u52a1\u7aef\u9700\u8981\u8bc1\u4e66\netcd-peer-csr\u89e3\u6790\uff1a"),(0,s.kt)("p",{parentName:"blockquote"},"hosts\uff1aetcd\u6709\u53ef\u80fd\u90e8\u7f72\u5230\u54ea\u4e9b\u7ec4\u4ef6\u7684IP\u90fd\u8981\u586b\u8fdb\u6765\ncfssl gencert\uff1a\u751f\u6210\u8bc1\u4e66\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230823105545.png",alt:"image.png"})),(0,s.kt)("h4",{parentName:"blockquote",id:"413-\u914d\u7f6e\u53ca\u542f\u52a8etcd\u96c6\u7fa4"},"4.1.3 \u914d\u7f6e\u53ca\u542f\u52a8etcd\u96c6\u7fa4"),(0,s.kt)("p",{parentName:"blockquote"},"\u590d\u5236\u8bc1\u4e66\u6587\u4ef6\uff1a"),(0,s.kt)("pre",{parentName:"blockquote"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u590d\u52363.3\u4e2d\u751f\u6210\u7684\u8bc1\u4e66\u5230certs\u76ee\u5f55\uff0c\u6ce8\u610f\uff0c\u4e09\u4e2a\u4e3b\u673a\u90fd\u8981\u6267\u884c\n# node01\uff0c\u81ea\u5df1\u505a\u514d\u5bc6\u54e6\uff0c\u8fd9\u91cc\u5c31\u4e0d\u6559\u4e86\u3002\nscp -r master:/etc/kubernetes/TLS/etcd/*.pem /etc/kubernetes/TLS/etcd\n# node02\nscp -r master:/etc/kubernetes/TLS/etcd/*.pem /etc/kubernetes/TLS/etcd\n")),(0,s.kt)("p",{parentName:"blockquote"},"\u7f16\u5199\u542f\u52a8\u811a\u672c\uff1a\n\u26a0\u6ce8\u610f\u4ee5\u4e0b\u811a\u672c\u4e2d\uff0cnode01\uff08158\uff09\uff0cnode02\uff08159\uff09\u4e3b\u673a\u4e0a\u90fd\u8981\u4fee\u6539\u5bf9\u5e94\u7684\u76d1\u542c\u5730\u5740\uff0c\u4e0d\u80fd\u7167\u642c.\n\u9700\u8981\u4fee\u6539\u7684\u5730\u65b9\u6709\u4ee5\u4e0b\u4e94\u5904\uff1a"),(0,s.kt)("ul",{parentName:"blockquote"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"--name")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"--advertise-client-urls ")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"--initial-advertise-peer-urls")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"--listen-peer-urls")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"--listen-client-urls"))),(0,s.kt)("pre",{parentName:"blockquote"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5728157 master\u4e3b\u673a\u4e0a\nvim /usr/local/etcd-v3.4.27/etcd-startup.sh\n#!/usr/bin/env sh\n./etcd --name=etcd-server-157 \\\n  --advertise-client-urls=https://172.19.82.157:2379 \\\n  --cert-file=/etc/kubernetes/TLS/etcd/etcd-server.pem \\\n  --client-cert-auth=true \\\n  --data-dir=/data/etcd \\\n  --experimental-initial-corrupt-check=true \\\n  --experimental-watch-progress-notify-interval=5s \\\n  --initial-advertise-peer-urls=https://172.19.82.157:2380 \\\n  --initial-cluster=etcd-server-157=https://172.19.82.157:2380,etcd-server-158=https://172.19.82.158:2380,etcd-server-159=https://172.19.82.159:2380 \\\n  --key-file=/etc/kubernetes/TLS/etcd/etcd-server-key.pem \\\n  --listen-client-urls=https://127.0.0.1:2379,https://172.19.82.157:2379 \\\n  --listen-metrics-urls=http://127.0.0.1:2381 \\\n  --listen-peer-urls=https://172.19.82.157:2380 \\\n  --peer-cert-file=/etc/kubernetes/TLS/etcd/etcd-server.pem \\\n  --peer-client-cert-auth=true \\\n  --peer-key-file=/etc/kubernetes/TLS/etcd/etcd-server-key.pem \\\n  --peer-trusted-ca-file=/etc/kubernetes/TLS/etcd/ca.pem \\\n  --snapshot-count=10000 \\\n  --trusted-ca-file=/etc/kubernetes/TLS/etcd/ca.pem\n")),(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230823111335.png",alt:"image.png"}),"\n\u4fee\u6539\u811a\u672c\u53ca\u76ee\u5f55\u6743\u9650\uff1a"),(0,s.kt)("pre",{parentName:"blockquote"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"chmod +x /usr/local/etcd-v3.4.27/etcd-startup.sh\nchown -R etcd:etcd /usr/local/etcd-v3.4.27/\nchown -R etcd:etcd /data/etcd/\nchown -R etcd:etcd /data/logs/etcd-server/\nchown -R etcd:etcd /etc/kubernetes/TLS/etcd/\n")),(0,s.kt)("p",{parentName:"blockquote"},"\u521b\u5efasupervisor\u914d\u7f6e\u6587\u4ef6\uff1a\n\u4e09\u4e2a\u4e3b\u673a\u90fd\u5f97\u6267\u884c\uff0c\u4e0d\u540c\u4e3b\u673a\u53ea\u9700\u8981\u4fee\u6539\u4e0b",(0,s.kt)("inlineCode",{parentName:"p"},"[program:etcd-server-157]"),"\u8fd9\u4e2a\u5373\u53ef\uff0c\u6362\u6210158\u548c159."),(0,s.kt)("pre",{parentName:"blockquote"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"vim /etc/supervisor/conf.d/etcd-server.conf\n[program:etcd-server-157]\ncommand=/usr/local/etcd-v3.4.27/etcd-startup.sh                 ; the program (relative uses PATH, can take args)\nnumprocs=1                                                      ; number of processes copies to start (def 1)\ndirectory=/usr/local/etcd-v3.4.27                               ; directory to cwd to before exec (def no cwd)\nautostart=true                                                  ; start at supervisord start (default: true)\nautorestart=true                                                ; retstart at unexpected quit (default: true)\nstartsecs=0                                                    ; number of secs prog must stay running (def. 1)\nstartretries=3                                                  ; max # of serial start failures (default 3)\nexitcodes=0,2                                                   ; 'expected' exit codes for process (default 0,2)\nstopsignal=QUIT                                                 ; signal used to kill process (default TERM)\nstopwaitsecs=10                                                 ; max num secs to wait b4 SIGKILL (default 10)\nuser=etcd                                                       ; setuid to this UNIX account to run the program\nredirect_stderr=true                                            ; redirect proc stderr to stdout (default false)\nstdout_logfile=/data/logs/etcd-server/etcd.stdout.log           ; stdout log path, NONE for none; default AUTO\nstdout_logfile_maxbytes=64MB                                    ; max # logfile bytes b4 rotation (default 50MB)\nstdout_logfile_backups=4                                        ; # of stdout logfile backups (default 10)\nstdout_capture_maxbytes=1MB                                     ; number of bytes in 'capturemode' (default 0)\nstdout_events_enabled=false                                     ; emit events on stdout writes (default false)\n")),(0,s.kt)("p",{parentName:"blockquote"},"\u91cd\u8f7dsupervisor\u914d\u7f6e\u6587\u4ef6\uff1a"),(0,s.kt)("pre",{parentName:"blockquote"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"supervisorctl update\nsupervisorctl status\n")),(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822151410.png",alt:"image.png"}),"\n\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u96c6\u7fa4\u72b6\u6001\uff08leader\u662f\u8c01\uff1f\uff09"),(0,s.kt)("pre",{parentName:"blockquote"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"etcdctl -w table --cacert=/etc/kubernetes/TLS/etcd/ca.pem --cert=/etc/kubernetes/TLS/etcd/etcd-server.pem --key=/etc/kubernetes/TLS/etcd/etcd-server-key.pem --endpoints https://172.19.82.157:2379 endpoint status --cluster\n"))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"![image.png](https://cdn.agou-ops.cn/others/20230823111655.png)\n```bash\netcdctl -w table --cacert=/etc/kubernetes/TLS/etcd/ca.pem --cert=/etc/kubernetes/TLS/etcd/etcd-server.pem --key=/etc/kubernetes/TLS/etcd/etcd-server-key.pem --endpoints https://172.19.82.157:2379 member list\n")),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230823111723.png",alt:"image.png"})),(0,s.kt)("h3",{id:"42-\u90e8\u7f72api-server"},"4.2 \u90e8\u7f72API server"),(0,s.kt)("p",null,"API server\u6211\u5c31\u4e0d\u505a\u96c6\u7fa4\u4e86\uff08\u5355\u8282\u70b9\uff09\uff0c\u65b9\u6cd5\u5176\u5b9e\u548cetcd\u5927\u5dee\u4e0d\u5dee."),(0,s.kt)("h4",{id:"421-\u4f7f\u7528cfssl\u751f\u6210\u8bc1\u4e66"},"4.2.1 \u4f7f\u7528cfssl\u751f\u6210\u8bc1\u4e66"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'# \u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528\u4e0a\u9762etcd\u7684\u81ea\u5efaCA\uff0c\u5982\u679cetcd\u90e8\u7f72\u5230\u96c6\u7fa4\u4e4b\u5916\u7684\u8bdd\uff0c\u53ef\u4ee5\u91cd\u65b0\u5efa\u4e2aCA\u4ee5\u4f5c\u533a\u5206\u3002\n# master\u4e3b\u673a\u4e0a\ncd /etc/kubernetes/TLS/k8s/\nvim ca-config.json\n{\n  "signing": {\n    "default": {\n      "expiry": "87600h"\n    },\n    "profiles": {\n      "kubernetes": {\n         "expiry": "87600h",\n         "usages": [\n            "signing",\n            "key encipherment",\n            "server auth",\n            "client auth"\n        ]\n      }\n    }\n  }\n}\n\n\nvim ca-csr.json\n{\n    "CN": "kubernetes",\n    "key": {\n        "algo": "rsa",\n        "size": 2048\n    },\n    "names": [\n        {\n            "C": "CN",\n            "L": "HangZhou",\n            "ST": "ZheJiang",\n            "O": "k8s",\n            "OU": "System"\n        }\n    ]\n}\n\n\ncfssl gencert -initca ca-csr.json | cfssl-json -bare ca -\n\nvim kube-apiserver-csr.json\n{\n    "CN": "kubernetes",\n    "hosts": [\n        "127.0.0.1",\n        "kubernetes",\n        "kubernetes.default",\n        "kubernetes.default.svc",\n        "kubernetes.default.svc.cluster",\n        "kubernetes.default.svc.cluster.local",\n        "172.19.82.157",\n        "172.19.82.158",\n        "172.19.82.159",\n        "192.168.3.28",\n        "10.96.0.1"\n    ],\n    "key": {\n        "algo": "rsa",\n        "size": 2048\n    },\n    "names": [\n        {\n            "C": "CN",\n            "L": "HangZhou",\n            "ST": "ZheJiang",\n            "O": "k8s",  \n            "OU": "System"\n        }\n    ]\n}\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-apiserver-csr.json | cfssl-json -bare kube-apiserver\n\n# \u751f\u6210sa key\uff0c\u540e\u9762\u4f1a\u7528\u5230\nopenssl genrsa -out sa.key 2048\nopenssl rsa -in sa.key -pubout -out sa.pub\n\nmkdir proxy-client\ncd proxy-client\n\nvim front-proxy-ca-csr.json\n{\n  "CA":{\n      "expiry":"87600h"\n  },\n  "CN": "kubernetes",\n  "key": {\n     "algo": "rsa",\n     "size": 2048\n  }\n}\n\ncfssl gencert -initca front-proxy-ca-csr.json | cfssl-json -bare front-proxy-ca\n\nvim front-proxy-client-csr.json\n{\n  "CN": "front-proxy-client",\n  "key": {\n     "algo": "rsa",\n     "size": 2048\n  }\n}\n\ncfssl gencert \\\n-ca=front-proxy-ca.pem \\\n-ca-key=front-proxy-ca-key.pem  \\\n-config=../ca-config.json   \\\n-profile=kubernetes front-proxy-client-csr.json | cfssl-json -bare front-proxy-client\n\n')),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230823114325.png",alt:"image.png"})),(0,s.kt)("h4",{id:"422-\u90e8\u7f72api-server"},"4.2.2 \u90e8\u7f72api-server"),(0,s.kt)("p",null,"\u4ed3\u5e93\u5730\u5740\uff1a",(0,s.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.25.md#v12512"},"https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.25.md#v12512")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://dl.k8s.io/v1.25.12/kubernetes-server-linux-amd64.tar.gz\ntar xf kubernetes-server-linux-amd64.tar.gz -C /usr/local/\ncd /usr/local/kubernetes\n# \u5220\u9664\u4e0d\u5fc5\u8981\u7684\u6e90\u7801\u548c\u6587\u4ef6\nrm -f kubernetes-src.tar.gz\nrm -rf server/bin/*.tar\nrm -rf server/bin/*_tag\n# \u6dfb\u52a0\u8f6f\u8fde\u63a5\u65b9\u4fbf\u4f7f\u7528\nln -sv /usr/local/kubernetes/server/bin/* /usr/local/bin/\n")),(0,s.kt)("p",null,"\u542f\u52a8\u811a\u672c\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir /etc/kubernetes/config\nvim /usr/local/kubernetes/server/bin/kube-apiserver-startup.sh\n#!/usr/bin/env sh\n# \u4e0b\u9762\u7684cert\u548ckey\u7edf\u7edf\u7528\u4e00\u5957\u5c31\u597d\u4e86\u3002\n#!/usr/bin/env sh\n./kube-apiserver \\\n  --v=2  \\\n  --logtostderr=true  \\\n  --allow-privileged=true  \\\n  --bind-address=172.19.82.157  \\\n  --secure-port=6443  \\\n  --advertise-address=157 \\\n  --service-cluster-ip-range=10.244.0.0/12 \\\n  --service-node-port-range=30000-40000  \\\n  --etcd-servers=https://172.19.82.157:2379,https://172.19.82.158:2379,https://172.19.82.159:2379 \\\n  --etcd-cafile=/etc/kubernetes/TLS/etcd/ca.pem \\\n  --etcd-certfile=/etc/kubernetes/TLS/etcd/etcd-server.pem \\\n  --etcd-keyfile=/etc/kubernetes/TLS/etcd/etcd-server-key.pem \\\n  --client-ca-file=/etc/kubernetes/TLS/k8s/ca.pem \\\n  --tls-cert-file=/etc/kubernetes/TLS/k8s/kube-apiserver.pem \\\n  --tls-private-key-file=/etc/kubernetes/TLS/k8s/kube-apiserver-key.pem\n  --kubelet-client-certificate=/etc/kubernetes/TLS/k8s/kube-apiserver.pem \\\n  --kubelet-client-key=/etc/kubernetes/TLS/k8s/kube-apiserver-key.pem \\\n  --service-account-key-file=/etc/kubernetes/TLS/k8s/sa.pub  \\\n  --service-account-signing-key-file=/etc/kubernetes/TLS/k8s/sa.key  \\\n  --service-account-issuer=https://kubernetes.default.svc.cluster.local \\\n  --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \\\n  --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \\\n  --authorization-mode=Node,RBAC  \\\n  --enable-bootstrap-token-auth=true  \\\n  --requestheader-client-ca-file=/etc/kubernetes/TLS/k8s/proxy-client/front-proxy-ca.pem  \\\n  --proxy-client-cert-file=/etc/kubernetes/TLS/k8s/proxy-client/front-proxy-client.pem  \\\n  --proxy-client-key-file=/etc/kubernetes/TLS/k8s/proxy-client/front-proxy-client-key.pem  \\\n  --requestheader-allowed-names=front-proxy-client  \\\n  --requestheader-group-headers=X-Remote-Group  \\\n  --requestheader-extra-headers-prefix=X-Remote-Extra-  \\\n  --requestheader-username-headers=X-Remote-User  \n\nchmod +x /usr/local/kubernetes/server/bin/kube-apiserver-startup.sh\nmkdir -pv /data/logs/kubernetes/kube-apiserver\n")),(0,s.kt)("p",null,"\u914d\u7f6esupervisor\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"vim /etc/supervisor/conf.d/apiserver.conf\n[program:apiserver-157]\ncommand=/usr/local/kubernetes/server/bin/kube-apiserver-startup.sh                 ; the program (relative uses PATH, can take args)\nnumprocs=1                                                      ; number of processes copies to start (def 1)\ndirectory=/usr/local/kubernetes/server/bin                               ; directory to cwd to before exec (def no cwd)\nautostart=true                                                  ; start at supervisord start (default: true)\nautorestart=true                                                ; retstart at unexpected quit (default: true)\nstartsecs=0                                                     ; number of secs prog must stay running (def. 1)\nstartretries=3                                                  ; max # of serial start failures (default 3)\nexitcodes=0,2                                                   ; 'expected' exit codes for process (default 0,2)\nstopsignal=QUIT                                                 ; signal used to kill process (default TERM)\nstopwaitsecs=10                                                 ; max num secs to wait b4 SIGKILL (default 10)\nuser=root                                                       ; setuid to this UNIX account to run the program\nredirect_stderr=true                                            ; redirect proc stderr to stdout (default false)\nstdout_logfile=/data/logs/kubernetes/kube-apiserver/apiserver.stdout.log           ; stdout log path, NONE for none; default AUTO\nstdout_logfile_maxbytes=64MB                                    ; max # logfile bytes b4 rotation (default 50MB)\nstdout_logfile_backups=4                                        ; # of stdout logfile backups (default 10)\nstdout_capture_maxbytes=1MB                                     ; number of bytes in 'capturemode' (default 0)\nstdout_events_enabled=false                                     ; emit events on stdout writes (default false)\n\n\n# \u91cd\u8f7dsupervisor\u914d\u7f6e\u6587\u4ef6\nsupervisorctl update\nss -tnulp  | grep 6443\n# output\ntcp   LISTEN 0      16384                                *:6443             *:*    users:((\"kube-apiserver\",pid=5989,fd=7))                                            \n")),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230822170053.png",alt:"image.png"})),(0,s.kt)("h3",{id:"43-\u90e8\u7f72controller-manager"},"4.3 \u90e8\u7f72controller-manager"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'cd /etc/kubernetes/TLS/k8s\nvim kube-controller-manager-csr.json\n{\n  "CN": "system:kube-controller-manager",\n  "hosts": [],\n  "key": {\n    "algo": "rsa",\n    "size": 2048\n  },\n    "names": [\n        {\n            "C": "CN",\n            "L": "HangZhou",\n            "ST": "ZheJiang",\n            "O": "system:kube-controller-manager",\n            "OU": "System"\n        }\n    ]\n}\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-controller-manager-csr.json | cfssl-json -bare kube-controller-manager\n\n# \u6dfb\u52a0\u96c6\u7fa4apiserver\u4fe1\u606f\nkubectl config set-cluster kubernetes \\\n  --certificate-authority=/etc/kubernetes/TLS/k8s/ca.pem \\\n  --embed-certs=true \\\n  --server="https://172.19.82.157:6443" \\\n  --kubeconfig=/etc/kubernetes/config/kube-controller-manager.kubeconfig\n# \u6dfb\u52a0\u8bc1\u4e66\u6587\u4ef6\u4fe1\u606f\nkubectl config set-credentials system:kube-controller-manager \\\n    --client-certificate=/etc/kubernetes/TLS/k8s/kube-controller-manager.pem \\\n    --client-key=/etc/kubernetes/TLS/k8s/kube-controller-manager-key.pem \\\n  --embed-certs=true \\\n  --kubeconfig=/etc/kubernetes/config/kube-controller-manager.kubeconfig\n# \u6dfb\u52a0\u7528\u6237\nkubectl config set-context default \\\n  --cluster=kubernetes \\\n  --user=system:kube-controller-manager \\\n  --kubeconfig=/etc/kubernetes/config/kube-controller-manager.kubeconfig\n# \u6307\u5b9a\u9ed8\u8ba4\u7684\u96c6\u7fa4\nkubectl config use-context default --kubeconfig=/etc/kubernetes/config/kube-controller-manager.kubeconfig\n\n\nvim /usr/local/kubernetes/server/bin/kube-controller-manager-startup.sh\n#!/usr/bin/env sh\n./kube-controller-manager \\\n  --v=2 \\\n  --root-ca-file=/etc/kubernetes/TLS/k8s/ca.pem \\\n  --cluster-signing-cert-file=/etc/kubernetes/TLS/k8s/ca.pem \\\n  --cluster-signing-key-file=/etc/kubernetes/TLS/k8s/ca-key.pem \\\n  --service-account-private-key-file=/etc/kubernetes/TLS/k8s/sa.key \\\n  --kubeconfig=/etc/kubernetes/config/kube-controller-manager.kubeconfig \\\n  --leader-elect=true \\\n  --use-service-account-credentials=true \\\n  --node-monitor-grace-period=40s \\\n  --node-monitor-period=5s \\\n  --pod-eviction-timeout=2m0s \\\n  --controllers=*,bootstrapsigner,tokencleaner \\\n  --allocate-node-cidrs=true \\\n  --cluster-cidr=10.244.0.0/12 \\\n  --requestheader-client-ca-file=/etc/kubernetes/TLS/k8s/proxy-client/front-proxy-ca.pem \\\n  --node-cidr-mask-size=24\n\nchmod +x /usr/local/kubernetes/server/bin/kube-controller-manager-startup.sh\nmkdir -pv /data/logs/kubernetes/kube-controller-manager/\n\nvim /etc/supervisor/conf.d/controller-manager.conf\n[program:kube-controller-manager-157]\ncommand=/usr/local/kubernetes/server/bin/kube-controller-manager-startup.sh                     ; the program (relative uses PATH, can take args)\nnumprocs=1                                                                        ; number of processes copies to start (def 1)\ndirectory=/usr/local/kubernetes/server/bin                                              ; directory to cwd to before exec (def no cwd)\nautostart=true                                                                    ; start at supervisord start (default: true)\nautorestart=true                                                                  ; retstart at unexpected quit (default: true)\nstartsecs=30                                                                      ; number of secs prog must stay running (def. 1)\nstartretries=3                                                                    ; max # of serial start failures (default 3)\nexitcodes=0,2                                                                     ; \'expected\' exit codes for process (default 0,2)\nstopsignal=QUIT                                                                   ; signal used to kill process (default TERM)\nstopwaitsecs=10                                                                   ; max num secs to wait b4 SIGKILL (default 10)\nuser=root                                                                         ; setuid to this UNIX account to run the program\nredirect_stderr=true                                                              ; redirect proc stderr to stdout (default false)\nstdout_logfile=/data/logs/kubernetes/kube-controller-manager/controller.stdout.log  ; stderr log path, NONE for none; default AUTO\nstdout_logfile_maxbytes=64MB                                                      ; max # logfile bytes b4 rotation (default 50MB)\nstdout_logfile_backups=4                                                          ; # of stdout logfile backups (default 10)\nstdout_capture_maxbytes=1MB                                                       ; number of bytes in \'capturemode\' (default 0)\nstdout_events_enabled=false                                                       ; emit events on stdout writes (default false)\n')),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230823134408.png",alt:"image.png"})),(0,s.kt)("h3",{id:"44-\u90e8\u7f72kube-scheduler"},"4.4 \u90e8\u7f72kube-scheduler"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'cd /etc/kubernetes/TLS/k8s\nvim kube-scheduler-csr.json\n{\n  "CN": "system:kube-scheduler",\n  "hosts": [],\n  "key": {\n    "algo": "rsa",\n    "size": 2048\n  },\n  "names": [\n        {\n            "C": "CN",\n            "L": "HangZhou",\n            "ST": "ZheJiang",\n            "O": "system:kube-scheduler",\n            "OU": "System"\n        }\n  ]\n}\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-scheduler-csr.json | cfssl-json -bare kube-scheduler\n\n# \u6dfb\u52a0\u96c6\u7fa4apiserver\u4fe1\u606f\nkubectl config set-cluster kubernetes \\\n  --certificate-authority=/etc/kubernetes/TLS/k8s/ca.pem \\\n  --embed-certs=true \\\n  --server="https://172.19.82.157:6443" \\\n  --kubeconfig=/etc/kubernetes/config/kube-scheduler.kubeconfig\n# \u6dfb\u52a0\u8bc1\u4e66\u6587\u4ef6\u4fe1\u606f\nkubectl config set-credentials system:kube-scheduler \\\n  --client-certificate=/etc/kubernetes/TLS/k8s/kube-scheduler.pem \\\n  --client-key=/etc/kubernetes/TLS/k8s/kube-scheduler-key.pem \\\n  --embed-certs=true \\\n  --kubeconfig=/etc/kubernetes/config/kube-scheduler.kubeconfig\n# \u6dfb\u52a0\u7528\u6237\nkubectl config set-context default \\\n  --cluster=kubernetes \\\n  --user=system:kube-scheduler \\\n  --kubeconfig=/etc/kubernetes/config/kube-scheduler.kubeconfig\n# \u6307\u5b9a\u9ed8\u8ba4\u7684\u96c6\u7fa4\nkubectl config use-context default --kubeconfig=/etc/kubernetes/config/kube-scheduler.kubeconfig\n\n\nvim /usr/local/kubernetes/server/bin/kube-scheduler-startup.sh\n#!/usr/bin/env sh\n./kube-scheduler \\\n  --v=2 \\\n  --leader-elect=true \\\n  --kubeconfig=/etc/kubernetes/config/kube-scheduler.kubeconfig\n\nchmod +x /usr/local/kubernetes/server/bin/kube-scheduler-startup.sh\nmkdir -pv /data/logs/kubernetes/kube-scheduler/\n\nvim /etc/supervisor/conf.d/scheduler.conf\n[program:kube-scheduler-157]\ncommand=/usr/local/kubernetes/server/bin/kube-scheduler-startup.sh                   ; the program (relative uses PATH, can take args)\nnumprocs=1                                                               ; number of processes copies to start (def 1)\ndirectory=/usr/local/kubernetes/server/bin                                  ; directory to cwd to before exec (def no cwd)\nautostart=true                                                           ; start at supervisord start (default: true)\nautorestart=true                                                         ; retstart at unexpected quit (default: true)\nstartsecs=0                                                             ; number of secs prog must stay running (def. 1)\nstartretries=3                                                           ; max # of serial start failures (default 3)\nexitcodes=0,2                                                            ; \'expected\' exit codes for process (default 0,2)\nstopsignal=QUIT                                                          ; signal used to kill process (default TERM)\nstopwaitsecs=10                                                          ; max num secs to wait b4 SIGKILL (default 10)\nuser=root                                                                ; setuid to this UNIX account to run the program\nredirect_stderr=true                                                     ; redirect proc stderr to stdout (default false)\nstdout_logfile=/data/logs/kubernetes/kube-scheduler/scheduler.stdout.log ; stderr log path, NONE for none; default AUTO\nstdout_logfile_maxbytes=64MB                                             ; max # logfile bytes b4 rotation (default 50MB)\nstdout_logfile_backups=4                                                 ; # of stdout logfile backups (default 10)\nstdout_capture_maxbytes=1MB                                              ; number of bytes in \'capturemode\' (default 0)\nstdout_events_enabled=false                                              ; emit events on stdout writes (default false)\n\nsupervisorctl update\n')),(0,s.kt)("p",null,"\u81f3\u6b64\uff0cmaster\u8282\u70b9\u7684\u6838\u5fc3\u7ec4\u4ef6\u57fa\u672c\u5b89\u88c5\u5b8c\u6210\u4e86\uff0c\u4f7f\u7528ss\u547d\u4ee4\u67e5\u770b\u670d\u52a1\u76d1\u542c\u72b6\u6001\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'> ss -tnulp | grep kube\ntcp   LISTEN 0      16384                        127.0.0.1:10259      0.0.0.0:*    users:(("kube-scheduler",pid=9385,fd=7))                                                                     \ntcp   LISTEN 0      16384                        127.0.0.1:10257      0.0.0.0:*    users:(("kube-controller",pid=9370,fd=7))                                                                    \ntcp   LISTEN 0      16384                                *:6443             *:*    users:(("kube-apiserver",pid=5989,fd=7))                                                                    \n')),(0,s.kt)("h3",{id:"45-\u914d\u7f6ekubectl\u6240\u9700\u8981\u7684kubeconfig"},"4.5 \u914d\u7f6ekubectl\u6240\u9700\u8981\u7684kubeconfig"),(0,s.kt)("p",null,"\u6b65\u9aa4\u5927\u4f53\u548c\u4e0a\u9762\u90fd\u662f\u4e00\u81f4\u7684\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'cd /etc/kubernetes/TLS/k8s\nvim kubectl-csr.json\n{\n  "CN": "kubectl",\n  "hosts": [],\n  "key": {\n    "algo": "rsa",\n    "size": 2048\n  },\n  "names": [\n        {\n            "C": "CN",\n            "L": "HangZhou",\n            "ST": "ZheJiang",\n            "O": "system:masters",  \n            "OU": "System"\n        }\n  ]\n}\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kubectl-csr.json | cfssl-json -bare kubectl\n\n# \u8fd9\u4e2a\u4f60\u653e\u5230\u548c\u4e0a\u9762\u540c\u6837\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u590d\u5236\u5230~/.kube\u91cc\u9762\u4e5f\u884c\uff0c\u8fd9\u91cc\u6211\u56fe\u4e2a\u65b9\u4fbf\n# \u6dfb\u52a0\u96c6\u7fa4apiserver\u4fe1\u606f\nkubectl config set-cluster kubernetes \\\n--certificate-authority=/etc/kubernetes/TLS/k8s/ca.pem \\\n--embed-certs=true \\\n--server="https://172.19.82.157:6443" \\\n--kubeconfig=/root/.kube/config\n# \u6dfb\u52a0\u8bc1\u4e66\u6587\u4ef6\u4fe1\u606f\nkubectl config set-credentials cluster-admin \\\n--client-certificate=/etc/kubernetes/TLS/k8s/kubectl.pem \\\n--client-key=/etc/kubernetes/TLS/k8s/kubectl-key.pem \\\n--embed-certs=true \\\n--kubeconfig=/root/.kube/config\n# \u6dfb\u52a0\u7528\u6237\nkubectl config set-context default \\\n--cluster=kubernetes \\\n--user=cluster-admin \\\n--kubeconfig=/root/.kube/config\n# \u6307\u5b9a\u9ed8\u8ba4\u7684\u96c6\u7fa4\nkubectl config use-context default --kubeconfig=/root/.kube/config\n')),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230823163202.png",alt:"image.png"})),(0,s.kt)("h3",{id:"46-\u90e8\u7f72node\u76f8\u5173\u7ec4\u4ef6kube-proxykubelet"},"4.6 \u90e8\u7f72node\u76f8\u5173\u7ec4\u4ef6kube-proxy\u3001kubelet"),(0,s.kt)("h4",{id:"461-bootstrap\u81ea\u52a8\u8ba4\u8bc1kubelet"},"4.6.1 bootstrap\u81ea\u52a8\u8ba4\u8bc1kubelet"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'cd /etc/kubernetes/config\n# \u751f\u6210\u968f\u673a\u8ba4\u8bc1tokenid\u548csecret\uff0c\u5e76\u8d4b\u4e88\u6743\u9650\uff0c\u4e0b\u9762\u76f4\u5230EOF\u4e00\u5757\u6267\u884c\u3002\nTOKEN_ID=`head -c 16 /dev/urandom | od -An -t x | tr -d \' \' | head -c6`\nTOKEN_SECRET=`head -c 16 /dev/urandom | od -An -t x | tr -d \' \' | head -c16`\ncat > bootstrap.secret.yaml <<EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: bootstrap-token-$a\n  namespace: kube-system\ntype: bootstrap.kubernetes.io/token\nstringData:\n  description: "The default bootstrap token generated by \'kubelet \'."\n  token-id: "$TOKEN_ID"\n  token-secret: "$TOKEN_SECRET"\n  usage-bootstrap-authentication: "true"\n  usage-bootstrap-signing: "true"\n  auth-extra-groups:  system:bootstrappers:default-node-token,system:bootstrappers:worker,system:bootstrappers:ingress\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubelet-bootstrap\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:node-bootstrapper\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:bootstrappers:default-node-token\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: node-autoapprove-bootstrap\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:certificates.k8s.io:certificatesigningrequests:nodeclient\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:bootstrappers:default-node-token\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: node-autoapprove-certificate-rotation\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:certificates.k8s.io:certificatesigningrequests:selfnodeclient\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:nodes\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: "true"\n  labels:\n    kubernetes.io/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - ""\n    resources:\n      - nodes/proxy\n      - nodes/stats\n      - nodes/log\n      - nodes/spec\n      - nodes/metrics\n    verbs:\n      - "*"\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: ""\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kube-apiserver\nEOF\n\n# \u6dfb\u52a0\u96c6\u7fa4apiserver\u4fe1\u606f\nkubectl config set-cluster kubernetes  \\\n  --certificate-authority=/etc/kubernetes/TLS/k8s/ca.pem \\\n  --embed-certs=true   \\\n  --server="https://172.19.82.157:6443" \\\n  --kubeconfig=/etc/kubernetes/config/kubelet-bootstrap.kubeconfig\n# \u6dfb\u52a0\u8bc1\u4e66\u6587\u4ef6\u4fe1\u606f\nkubectl config set-credentials kubelet-bootstrap-user  \\\n  --token=$TOKEN_ID.$TOKEN_SECRET \\\n  --kubeconfig=/etc/kubernetes/config/kubelet-bootstrap.kubeconfig\n# \u6dfb\u52a0\u7528\u6237\nkubectl config set-context kubelet-bootstrap-user@kubernetes \\\n  --cluster=kubernetes   \\\n  --user=kubelet-bootstrap-user \\\n  --kubeconfig=/etc/kubernetes/config/kubelet-bootstrap.kubeconfig\n# \u6307\u5b9a\u9ed8\u8ba4\u7684\u96c6\u7fa4\nkubectl config use-context kubelet-bootstrap-user@kubernetes  \\\n  --kubeconfig=/etc/kubernetes/config/kubelet-bootstrap.kubeconfig\n')),(0,s.kt)("h4",{id:"462-\u90e8\u7f72kubelet"},"4.6.2 \u90e8\u7f72kubelet"),(0,s.kt)("p",null,"\u26a0 \u7531\u4e8emaster\u8282\u70b9\u540c\u6837\u8981\u8fd0\u884c\u4e00\u4e9bpod\uff0c\u6bd4\u5982flannel\u3001calico\u7f51\u7edc\u7ec4\u4ef6\u7b49\uff0c\u6240\u4ee5\u5728master\u8282\u70b9\u4e5f\u9700\u8981\u5b89\u88c5Kubelet\u548cKube-proxy\u7ec4\u4ef6\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u53c2\u8003\uff1ahttps://kubernetes.io/zh-cn/docs/reference/config-api/kubelet-config.v1beta1/\nvim /etc/kubernetes/config/kubelet-conf.yml\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\naddress: 172.19.82.157\nport: 10250\nreadOnlyPort: 10255\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 2m0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/TLS/k8s/ca.pem\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 5m0s\n    cacheUnauthorizedTTL: 30s\ncgroupDriver: systemd\ncgroupsPerQOS: true\nclusterDNS:\n- 10.100.0.2\nclusterDomain: cluster.local\ncontainerLogMaxFiles: 5\ncontainerLogMaxSize: 10Mi\ncontentType: application/vnd.kubernetes.protobuf\ncpuCFSQuota: true\ncpuManagerPolicy: none\ncpuManagerReconcilePeriod: 10s\nenableControllerAttachDetach: true\nenableDebuggingHandlers: true\nenforceNodeAllocatable:\n- pods\neventBurst: 10\neventRecordQPS: 5\nevictionHard:\n  imagefs.available: 15%\n  memory.available: 100Mi\n  nodefs.available: 10%\n  nodefs.inodesFree: 5%\nevictionPressureTransitionPeriod: 5m0s\nfailSwapOn: true\nfileCheckFrequency: 20s\nhairpinMode: promiscuous-bridge\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 20s\nimageGCHighThresholdPercent: 85\nimageGCLowThresholdPercent: 80\nimageMinimumGCAge: 2m0s\niptablesDropBit: 15\niptablesMasqueradeBit: 14\nkubeAPIBurst: 10\nkubeAPIQPS: 5\nmakeIPTablesUtilChains: true\nmaxOpenFiles: 1000000\nmaxPods: 110\nnodeStatusUpdateFrequency: 10s\noomScoreAdj: -999\npodPidsLimit: -1\nregistryBurst: 10\nregistryPullQPS: 5\nresolvConf: /etc/resolv.conf\nrotateCertificates: true\nruntimeRequestTimeout: 2m0s\nserializeImagePulls: true\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 4h0m0s\nsyncFrequency: 1m0s\nvolumeStatsAggPeriod: 1m0s\n\n\nvim /usr/local/kubernetes/server/bin/kubelet-startup.sh\n#!/usr/bin/env sh\n./kubelet \\\n  --bootstrap-kubeconfig=/etc/kubernetes/config/kubelet-bootstrap.kubeconfig \\\n  --kubeconfig=/etc/kubernetes/config/kubelet.kubeconfig \\\n  --config=/etc/kubernetes/config/kubelet-conf.yml \\\n  --hostname-override=master0 \\\n  --node-labels=node.kubernetes.io/node='' \\\n  --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock\n\n\n# \u6dfb\u52a0\u96c6\u7fa4apiserver\u4fe1\u606f\nkubectl config set-cluster kubernetes \\\n--certificate-authority=/etc/kubernetes/TLS/k8s/ca.pem \\\n--embed-certs=true \\\n--server=\"https://172.19.82.157:6443\" \\\n--kubeconfig=/etc/kubernetes/config/kubelet-bootstrap.kubeconfig\n# \u6dfb\u52a0\u8bc1\u4e66\u6587\u4ef6\u4fe1\u606f\uff0c\u4e0b\u9762\u8fd9\u4e2atoken\u662f\u4e4b\u524d\u751f\u6210\u7684\uff0c\u4e5f\u5c31\u662f/etc/kubernetes/config/token.csv\nkubectl config set-credentials kubelet-bootstrap \\\n--token=8d435b925863119020c4da4d16e064c8 \\\n--kubeconfig=/etc/kubernetes/config/kubelet-bootstrap.kubeconfig\n# \u6dfb\u52a0\u7528\u6237\nkubectl config set-context default \\\n--cluster=kubernetes \\\n--user=kubelet-bootstrap \\\n--kubeconfig=/etc/kubernetes/config/kubelet-bootstrap.kubeconfig\n# \u6307\u5b9a\u9ed8\u8ba4\u7684\u96c6\u7fa4\nkubectl config use-context default --kubeconfig=/etc/kubernetes/config/kubelet-bootstrap.kubeconfig\n\n\nchmod +x /usr/local/kubernetes/server/bin/kubelet-startup.sh\nmkdir -pv /data/logs/kubernetes/kubelet/ /etc/kubernetes/manifests/\n\nvim /etc/supervisor/conf.d/kubelet.conf\n[program:kubelet-157]\ncommand=/usr/local/kubernetes/server/bin/kubelet-startup.sh\n                  ; the program (relative uses PATH, can take args)\nnumprocs=1                                                               ; number of processes copies to start (def 1)\ndirectory=/usr/local/kubernetes/server/bin                                  ; directory to cwd to before exec (def no cwd)\nautostart=true                                                           ; start at supervisord start (default: true)\nautorestart=true                                                         ; retstart at unexpected quit (default: true)\nstartsecs=0                                                             ; number of secs prog must stay running (def. 1)\nstartretries=3                                                           ; max # of serial start failures (default 3)\nexitcodes=0,2                                                            ; 'expected' exit codes for process (default 0,2)\nstopsignal=QUIT                                                          ; signal used to kill process (default TERM)\nstopwaitsecs=10                                                          ; max num secs to wait b4 SIGKILL (default 10)\nuser=root                                                                ; setuid to this UNIX account to run the program\nredirect_stderr=true                                                     ; redirect proc stderr to stdout (default false)\nstdout_logfile=/data/logs/kubernetes/kubelet/kubelet.stdout.log ; stderr log path, NONE for none; default AUTO\nstdout_logfile_maxbytes=64MB                                             ; max # logfile bytes b4 rotation (default 50MB)\nstdout_logfile_backups=4                                                 ; # of stdout logfile backups (default 10)\nstdout_capture_maxbytes=1MB                                              ; number of bytes in 'capturemode' (default 0)\nstdout_events_enabled=false                                              ; emit events on stdout writes (default false)\n\nsupervisorctl update\n")),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230824111121.png",alt:"image.png"})),(0,s.kt)("h4",{id:"463-\u5c06master\u8282\u70b9\u4f5c\u4e3anode\u52a0\u5165\u5230\u96c6\u7fa4\u5185\u90e8"},"4.6.3 \u5c06master\u8282\u70b9\u4f5c\u4e3anode\u52a0\u5165\u5230\u96c6\u7fa4\u5185\u90e8"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u26a0 \u6ce8\u610f\uff1a\u8fd9\u4e2a\u6b65\u9aa4\u5982\u679c\u505a\u4e86bootstrap kubelet\uff0c\u5219\u4e0d\u9700\u8981\u624b\u52a8\u6388\u6743\uff0c\u53ef\u76f4\u63a5\u5ffd\u7565\u6539\u6b65\u9aa4\u3002")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"}," \u4ee5\u4e0b\u6765\u6e90\u4e8e\u7f51\u7edc\uff1a\n\u5f53kubelet\u7ec4\u4ef6\u542f\u52a8\u6210\u529f\u540e\uff0c\u5c31\u4f1a\u60f3apiserver\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42\u52a0\u5165\u96c6\u7fa4\u7684\u4fe1\u606f\uff0c\u53ea\u6709\u5f53master\u8282\u70b9\u6388\u6743\u540c\u610f\u540e\uff0c\u624d\u53ef\u4ee5\u6b63\u5e38\u52a0\u5165\uff0c\u867d\u7136\u662fmaster\u8282\u70b9\u90e8\u7f72\u7684node\u7ec4\u4ef6\uff0c> \u4f46\u662f\u4e5f\u4f1a\u53d1\u751f\u4e00\u4e2a\u52a0\u5165\u96c6\u7fa4\u7684\u4fe1\u606f\uff0c\u9700\u8981master\u540c\u610f\u3002"),(0,s.kt)("p",{parentName:"blockquote"},"\u5f53kubelet\u542f\u52a8\u4e4b\u540e\uff0c\u9996\u5148\u4f1a\u5728\u8bc1\u4e66\u76ee\u5f55\u751f\u6210\u4e00\u4e2akubelet-client.key.tmp\u8fd9\u4e2a\u6587\u4ef6\uff0c\u5f53\u4f7f\u7528kubectl certificate approve\u547d\u4ee4\u6388\u6743\u6210\u529fnode\u7684\u8bf7\u6c42\u4e4b\u540e\uff0ckubele> t-client.key.tmp\u5c0f\u65f6\uff0c\u968f\u4e4b\u4f1a\u751f\u6210\u4e00\u4e2akubelet-client-current.pem\u7684\u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e\u4e0eapiserver\u5efa\u7acb\u8fde\u63a5\uff0c\u6b64\u65f6\u518d\u4f7f\u7528kubectl get > node\u5c31\u4f1a\u770b\u5230\u8282\u70b9\u4fe1\u606f\u4e86\u3002"),(0,s.kt)("p",{parentName:"blockquote"},"\u6269\u5c55\uff1a\u5982\u679c\u540e\u671f\u60f3\u8981\u4fee\u6539node\u7684\u540d\u79f0\uff0c\u90a3\u4e48\u5c31\u628a\u751f\u6210\u7684kubelet\u8bc1\u4e66\u6587\u4ef6\u5168\u90e8\u5220\u9664\uff0c\u7136\u540e\u4f7f\u7528kubectl delete > node\u5220\u9664\u8be5\u8282\u70b9\uff0c\u5728\u4fee\u6539kubelet\u914d\u7f6e\u6587\u4ef6\u4e2d\u8be5\u8282\u70b9\u7684\u540d\u79f0\uff0c\u7136\u540e\u4f7f\u7528kubectl delete > csr\u5220\u9664\u6388\u6743\u4fe1\u606f\uff0c\u518d\u91cd\u542fkubelet\u751f\u6210\u65b0\u7684\u6388\u6743\u4fe1\u606f\uff0c\u7136\u540e\u6388\u6743\u901a\u8fc7\u5373\u53ef\u770b\u5230\u65b0\u7684\u540d\u5b57\u7684node\u8282\u70b9\u3002"),(0,s.kt)("p",{parentName:"blockquote"},"\u53ea\u6709\u5f53\u6388\u6743\u901a\u8fc7\u540e\uff0ckubelet\u751f\u6210\u4e86\u8bc1\u4e66\u6587\u4ef6\uff0ckubelet\u7684\u7aef\u53e3\u624d\u4f1a\u88ab\u542f\u52a8"),(0,s.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\uff1a\u5f53kubelet\u7684\u6388\u6743\u88abmaster\u8bf7\u6c42\u901a\u540e\uff0ckube-proxy\u542f\u52a8\u6210\u529f\u540e\uff0c\u8282\u70b9\u624d\u4f1a\u6b63\u771f\u7684\u52a0\u5165\u96c6\u7fa4\uff0c\u5373\u4f7fkubectl get > node\u770b\u5230\u7684\u8282\u70b9\u662fReady\uff0c\u8be5\u8282\u70b9\u4e5f\u662f\u4e0d\u53ef\u7528\u7684\uff0c\u5fc5\u987b\u5f53kube-proxy\u542f\u52a8\u5b8c\u6bd5\u540e\uff0c\u8fd9\u4e2a\u8282\u70b9\u624d\u7b97\u6b63\u771f\u7684\u542f\u52a8\u5b8c\u6bd5.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# master\u8282\u70b9\u4e0a\uff0c\u83b7\u53d6\u8bf7\u6c42\u5217\u8868\n> kubectl get csr\n# output\nNAME                                                   AGE     SIGNERNAME                                    REQUESTOR           REQUESTEDDURATION   CONDITION\nnode-csr-VVgl1LpQ91JlbJLifEJIy_0KlbQ1mih6GPaGfaykQ-I   2m46s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   <none>              Pending\n\n\n# \u51c6\u8bb8\u8be5\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\n> kubectl certificate approve node-csr-VVgl1LpQ91JlbJLifEJIy_0KlbQ1mih6GPaGfaykQ-I\n# output\ncertificatesigningrequest.certificates.k8s.io/node-csr-VVgl1LpQ91JlbJLifEJIy_0KlbQ1mih6GPaGfaykQ-I approved\n")),(0,s.kt)("p",null,"\u8282\u70b9\u52a0\u5165\u7ed3\u679c",(0,s.kt)("inlineCode",{parentName:"p"},"kubectl get nodes"),"\uff1a\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230824113851.png",alt:"image.png"})),(0,s.kt)("h4",{id:"463-\u90e8\u7f72kube-proxy"},"4.6.3 \u90e8\u7f72kube-proxy"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'cat > kube-proxy.yml << EOF\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-proxy\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:node-proxier\nsubjects:\n- kind: ServiceAccount\n  name: kube-proxy\n  namespace: kube-system\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  annotations:\n    kubernetes.io/service-account.name: "kube-proxy"\ntype: kubernetes.io/service-account-token\nEOF\n\nkubectl apply -f kube-proxy.yml\n# \u83b7\u53d6token\nJWT_TOKEN=$(kubectl -n kube-system get secret/kube-proxy \\\n--output=jsonpath=\'{.data.token}\' | base64 -d)\n\n# \u6dfb\u52a0\u96c6\u7fa4apiserver\u4fe1\u606f\nkubectl config set-cluster kubernetes   \\\n  --certificate-authority=/etc/kubernetes/TLS/k8s/ca.pem \\\n  --embed-certs=true    \\\n  --server="https://172.19.82.157:6443" \\\n  --kubeconfig=/etc/kubernetes/config/kube-proxy.kubeconfig\n# \u6dfb\u52a0token\nkubectl config set-credentials system:kube-proxy    \\\n  --token=${JWT_TOKEN}   \\\n  --kubeconfig=/etc/kubernetes/config/kube-proxy.kubeconfig\n# \u6dfb\u52a0\u7528\u6237\nkubectl config set-context default    \\\n  --cluster=kubernetes   \\\n  --user=system:kube-proxy   \\\n  --kubeconfig=/etc/kubernetes/config/kube-proxy.kubeconfig\n# \u6307\u5b9a\u9ed8\u8ba4\u7684\u96c6\u7fa4\nkubectl config use-context default   \\\n  --kubeconfig=/etc/kubernetes/config/kube-proxy.kubeconfig\n\n\n# \u53c2\u8003\uff1ahttps://kubernetes.io/zh-cn/docs/reference/config-api/kube-proxy-config.v1alpha1/\nvim /etc/kubernetes/config/kube-proxy-conf.yml\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nbindAddress: 172.19.82.157\nclientConnection:\n  acceptContentTypes: ""\n  burst: 10\n  contentType: application/vnd.kubernetes.protobuf\n  kubeconfig: /etc/kubernetes/config/kube-proxy.kubeconfig\n  qps: 5\nclusterCIDR: 10.244.0.0/16\nconfigSyncPeriod: 15m0s\nconntrack:\n  max: null\n  maxPerCore: 32768\n  min: 131072\n  tcpCloseWaitTimeout: 1h0m0s\n  tcpEstablishedTimeout: 24h0m0s\nenableProfiling: false\nhealthzBindAddress: 0.0.0.0:10256\nhostnameOverride: "$a"\niptables:\n  masqueradeAll: false\n  masqueradeBit: 14\n  minSyncPeriod: 0s\n  syncPeriod: 30s\nipvs:\n  masqueradeAll: true\n  minSyncPeriod: 5s\n  scheduler: "rr"\n  syncPeriod: 30s\nkind: KubeProxyConfiguration\nmetricsBindAddress: 127.0.0.1:10249\nmode: "ipvs"\nnodePortAddresses: null\noomScoreAdj: -999\nportRange: ""\nudpIdleTimeout: 250ms\n\n\nvim /usr/local/kubernetes/server/bin/kube-proxy-startup.sh\n#!/usr/bin/env sh\n./kube-proxy \\\n  --config=/etc/kubernetes/config/kube-proxy-conf.yml \\\n  --v=2\n\nchmod +x /usr/local/kubernetes/server/bin/kube-proxy-startup.sh\nmkdir -pv /data/logs/kubernetes/kube-proxy/\n\nvim /etc/supervisor/conf.d/kube-proxy.conf\n[program:kube-proxy-157]\ncommand=/usr/local/kubernetes/server/bin/kube-proxy-startup.sh     ; the program (relative uses PATH, can take args)\nnumprocs=1                                                               ; number of processes copies to start (def 1)\ndirectory=/usr/local/kubernetes/server/bin                                  ; directory to cwd to before exec (def no cwd)\nautostart=true                                                           ; start at supervisord start (default: true)\nautorestart=true                                                         ; retstart at unexpected quit (default: true)\nstartsecs=0                                                             ; number of secs prog must stay running (def. 1)\nstartretries=3                                                           ; max # of serial start failures (default 3)\nexitcodes=0,2                                                            ; \'expected\' exit codes for process (default 0,2)\nstopsignal=QUIT                                                          ; signal used to kill process (default TERM)\nstopwaitsecs=10                                                          ; max num secs to wait b4 SIGKILL (default 10)\nuser=root                                                                ; setuid to this UNIX account to run the program\nredirect_stderr=true                                                     ; redirect proc stderr to stdout (default false)\nstdout_logfile=/data/logs/kubernetes/kube-proxy/kube-proxy.stdout.log ; stderr log path, NONE for none; default AUTO\nstdout_logfile_maxbytes=64MB                                             ; max # logfile bytes b4 rotation (default 50MB)\nstdout_logfile_backups=4                                                 ; # of stdout logfile backups (default 10)\nstdout_capture_maxbytes=1MB                                              ; number of bytes in \'capturemode\' (default 0)\nstdout_events_enabled=false                                              ; emit events on stdout writes (default false)\n\nsupervisorctl update\n')),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230824115519.png",alt:"image.png"})),(0,s.kt)("h4",{id:"464-\u6388\u6743apiserver\u8bbf\u95eekubelet"},"4.6.4 \u6388\u6743apiserver\u8bbf\u95eekubelet"),(0,s.kt)("p",null,"\u5982\u679c\u4e0d\u505a\u8be5\u6388\u6743\u7684\u8bdd\uff0c\u4f1a\u5bfc\u81f4kubectl\u65e0\u6cd5\u83b7\u53d6\u5230\u96c6\u7fa4\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u6bd4\u5982logs.\n\u521b\u5efa\u4e00\u4e2aRBAC\u8d44\u6e90\u4f7f\u5f97apiserver\u80fd\u591f\u8bbf\u95eekubelet\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'cd /etc/kubernetes/config\nvim apiserver2kubelet-rbac.yaml\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: "true"\n  labels:\n    kubernetes.io/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - ""\n    resources:\n      - nodes/proxy\n      - nodes/stats\n      - nodes/log\n      - nodes/spec\n      - nodes/metrics\n      - pods/log\n    verbs:\n      - "*"\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: ""\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\n\n\nkubectl apply -f apiserver2kubelet-rbac.yaml\n# output\nclusterrole.rbac.authorization.k8s.io/system:apiserver2kubelet created\nclusterrolebinding.rbac.authorization.k8s.io/system:kube-apiserver created\n')),(0,s.kt)("h4",{id:"465-\u90e8\u7f72flannel\u7f51\u7edc\u7ec4\u4ef6"},"4.6.5 \u90e8\u7f72flannel\u7f51\u7edc\u7ec4\u4ef6"),(0,s.kt)("p",null,"\u90e8\u7f72\u5b8c\u4ee5\u4e0a\u7ec4\u4ef6\u4e4b\u540e\uff0c\u4f7f\u7528",(0,s.kt)("inlineCode",{parentName:"p"},"kubectl get nodes"),"\u53d1\u73b0\u65b0\u52a0\u8fdb\u6765\u7684master\u8282\u70b9\u5904\u4e8e",(0,s.kt)("inlineCode",{parentName:"p"},"NotReady"),"\u72b6\u6001\uff0c\u539f\u56e0\u662f\u6ca1\u6709\u7f51\u7edc\u7ec4\u4ef6\uff0c\u4e00\u65e6\u5b89\u88c5\u597d\u7f51\u7edc\u7ec4\u4ef6\u4f1a\u7acb\u5373\u53d8\u4e3a",(0,s.kt)("inlineCode",{parentName:"p"},"Ready"),"\u72b6\u6001\u3002"),(0,s.kt)("p",null,"\u914d\u7f6econtainerd\u4f7f\u7528\u4ee3\u7406\u548c\u79c1\u6709\u4ed3\uff08\u4e0d\u7136\u955c\u50cf\u62c9\u4e0d\u4e0b\u6765\u5594\uff09\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'# \u914d\u7f6e\u4ee3\u7406\nvim /lib/systemd/system/containerd.service\n# \u5728Services\u914d\u7f6e\u6bb5\u6dfb\u52a0\n[Service]\n...\nEnvironment="HTTP_PROXY=172.19.82.100:7891"\nEnvironment="HTTPS_PROXY=172.19.82.100:7891"\n...\n\nsystemctl daemon-reload\n\n# \u914d\u7f6e\u79c1\u6709\u4ed3\nvim /etc/containerd/config.toml\n# \u5927\u6982\u7b2c149\u884c\u5f00\u59cb\n...\n      [plugins."io.containerd.grpc.v1.cri".registry.configs]\n        [plugins."io.containerd.grpc.v1.cri".registry.configs."harbor.xxx.local".auth]\n        username = "al-admin"\n        password = "52PXZ2IDNWzk"\n        [plugins."io.containerd.grpc.v1.cri".registry.configs."harbor.xxx.local".tls]\n        insecure_skip_verify = true\n      [plugins."io.containerd.grpc.v1.cri".registry.mirrors]\n        [plugins."io.containerd.grpc.v1.cri".registry.mirrors."harbor.xxx.local"]\n         endpoint = ["https://harbor.xxx.local"]\n\n...\n\nsystemctl restart containerd\n')),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230824134826.png",alt:"image.png"})),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'cd /etc/kubernetes/config\nwget https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml\n# \u5982\u679c\u4f60\u7528\u7684\u4e0d\u662f10.244.0.0/16\u8fd9\u4e2a\u7f51\u6bb5\uff0c\u5219\u9700\u8981\u624b\u52a8\u4fee\u6539kube-flannel.yml\u8d44\u6e90\u914d\u7f6e\u6587\u4ef6\u3002\n# \u5982\nvim kube-flannel.yml\n...\n  net-conf.json: |\n    {\n      "Network": "10.96.0.0/16",   # \u6539\u8fd9\u91cc\n      "Backend": {\n        "Type": "vxlan"\n      }\n    }\n...\n\nkubectl apply -f kube-flannel.yml\n')),(0,s.kt)("p",null,"\u68c0\u67e5flannel\u8fd0\u884c\u72b6\u6001",(0,s.kt)("inlineCode",{parentName:"p"},"kubectl get po -n kube-flannel"),"\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230825141026.png",alt:"image.png"})),(0,s.kt)("h3",{id:"47-\u68c0\u67e5master\u8282\u70b9\u90e8\u7f72\u7ed3\u679c"},"4.7 \u68c0\u67e5master\u8282\u70b9\u90e8\u7f72\u7ed3\u679c"),(0,s.kt)("h4",{id:"471-\u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001"},"4.7.1 \u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u670d\u52a1\u8fd0\u884c\u72b6\u6001\uff08",(0,s.kt)("inlineCode",{parentName:"li"},"supervisorctl status"),"\uff09\uff1a\n",(0,s.kt)("img",{parentName:"li",src:"https://cdn.agou-ops.cn/others/20230825141505.png",alt:"image.png"})),(0,s.kt)("li",{parentName:"ul"},"\u7ec4\u4ef6\u72b6\u6001\uff08",(0,s.kt)("inlineCode",{parentName:"li"},"kubectl get cs"),"\uff09\uff1a\n",(0,s.kt)("img",{parentName:"li",src:"https://cdn.agou-ops.cn/others/20230825141536.png",alt:"image.png"})),(0,s.kt)("li",{parentName:"ul"},"master\u8282\u70b9\u72b6\u6001(",(0,s.kt)("inlineCode",{parentName:"li"},"kubectl get node -owide"),")\n",(0,s.kt)("img",{parentName:"li",src:"https://cdn.agou-ops.cn/others/20230825141605.png",alt:"image.png"}),"\n\u5982\u679c\u4ee5\u4e0a\u6709\u62a5\u9519\uff0c\u5c31\u56de\u5934\u68c0\u67e5\u6216\u8005\u91cd\u65b0\u90e8\u7f72\u4e00\u4e0b\u6709\u95ee\u9898\u7684\u670d\u52a1\u5373\u53ef\u3002")),(0,s.kt)("h4",{id:"472-\u9644\u6587\u4ef6\u5217\u8868\u53ca\u7b80\u4ecb"},"4.7.2 \u9644\uff1a\u6587\u4ef6\u5217\u8868\u53ca\u7b80\u4ecb"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u8bc1\u4e66\u53ca\u914d\u7f6e\u6587\u4ef6\u4e00\u89c8\uff1a")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"}," tree /etc/kubernetes/\n/etc/kubernetes/             # \u8be5\u76ee\u5f55\u4e3ak8s\u96c6\u7fa4\u7684\u6240\u6709\u8bc1\u4e66\u548c\u914d\u7f6e\u6587\u4ef6\u5b58\u653e\u76ee\u5f55\n\u251c\u2500\u2500 TLS                      # \u8bc1\u4e66\u5b58\u653e\u76ee\u5f55\n\u2502\xa0\xa0 \u251c\u2500\u2500 etcd                 # etcd\u8bc1\u4e66\u5b58\u653e\u76ee\u5f55\uff0c\u5355\u72ec\u7684\u4e00\u4e2aCA\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca-config.json   # ca\u914d\u7f6e\u6587\u4ef6\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca-csr.json      # ca\u8bf7\u6c42\u914d\u7f6e\u6587\u4ef6\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca-key.pem       # ca\u79c1\u94a5\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca.csr\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca.pem\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 etcd-server-csr.json\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 etcd-server-key.pem\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 etcd-server.csr\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 etcd-server.pem\n\u2502\xa0\xa0 \u2514\u2500\u2500 k8s                  # k8s\u96c6\u7fa4\u7ec4\u4ef6\u8bc1\u4e66\u76ee\u5f55\n\u2502\xa0\xa0     \u251c\u2500\u2500 ca-config.json\n\u2502\xa0\xa0     \u251c\u2500\u2500 ca-csr.json\n\u2502\xa0\xa0     \u251c\u2500\u2500 ca-key.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 ca.csr\n\u2502\xa0\xa0     \u251c\u2500\u2500 ca.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-apiserver-csr.json\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-apiserver-key.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-apiserver.csr\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-apiserver.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-controller-manager-csr.json\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-controller-manager-key.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-controller-manager.csr\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-controller-manager.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-scheduler-csr.json\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-scheduler-key.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-scheduler.csr\n\u2502\xa0\xa0     \u251c\u2500\u2500 kube-scheduler.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 kubectl-csr.json\n\u2502\xa0\xa0     \u251c\u2500\u2500 kubectl-key.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 kubectl.csr\n\u2502\xa0\xa0     \u251c\u2500\u2500 kubectl.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 proxy-client\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 front-proxy-ca-csr.json\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 front-proxy-ca-key.pem\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 front-proxy-ca.csr\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 front-proxy-ca.pem\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 front-proxy-client-csr.json\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 front-proxy-client-key.pem\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 front-proxy-client.csr\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 front-proxy-client.pem\n\u2502\xa0\xa0     \u251c\u2500\u2500 sa.key\n\u2502\xa0\xa0     \u2514\u2500\u2500 sa.pub\n\u251c\u2500\u2500 config               # \u6240\u6709\u914d\u7f6e\uff0c\u5305\u62ec\u8ba4\u8bc1\u548c\u5404\u79cdkubeconfig\n\u2502\xa0\xa0 \u251c\u2500\u2500 apiserver2kubelet-rbac.yaml\n\u2502\xa0\xa0 \u251c\u2500\u2500 bootstrap.secret.yaml\n\u2502\xa0\xa0 \u251c\u2500\u2500 kube-controller-manager.kubeconfig\n\u2502\xa0\xa0 \u251c\u2500\u2500 kube-flannel.yml\n\u2502\xa0\xa0 \u251c\u2500\u2500 kube-proxy-config.yml\n\u2502\xa0\xa0 \u251c\u2500\u2500 kube-proxy-scret.yml\n\u2502\xa0\xa0 \u251c\u2500\u2500 kube-proxy.kubeconfig\n\u2502\xa0\xa0 \u251c\u2500\u2500 kube-scheduler.kubeconfig\n\u2502\xa0\xa0 \u251c\u2500\u2500 kubelet-bootstrap.kubeconfig\n\u2502\xa0\xa0 \u251c\u2500\u2500 kubelet-conf.yml\n\u2502\xa0\xa0 \u2514\u2500\u2500 kubelet.kubeconfig\n\u2514\u2500\u2500 manifests\n\n7 directories, 51 files\n\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"k8s\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u4ee5\u53ca\u542f\u52a8\u811a\u672c\u4e00\u89c8\uff1a")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u4ee5.sh\u7ed3\u5c3e\u7684\u5c31\u662f\u5bf9\u5e94\u670d\u52a1\u7684\u542f\u52a8\u811a\u672c\n tree /usr/local/kubernetes/server/bin/\n/usr/local/kubernetes/server/bin/\n\u251c\u2500\u2500 apiextensions-apiserver\n\u251c\u2500\u2500 kube-aggregator\n\u251c\u2500\u2500 kube-apiserver\n\u251c\u2500\u2500 kube-apiserver-startup.sh\n\u251c\u2500\u2500 kube-controller-manager\n\u251c\u2500\u2500 kube-controller-manager-startup.sh\n\u251c\u2500\u2500 kube-log-runner\n\u251c\u2500\u2500 kube-proxy\n\u251c\u2500\u2500 kube-proxy-startup.sh\n\u251c\u2500\u2500 kube-scheduler\n\u251c\u2500\u2500 kube-scheduler-startup.sh\n\u251c\u2500\u2500 kubeadm\n\u251c\u2500\u2500 kubectl\n\u251c\u2500\u2500 kubectl-convert\n\u251c\u2500\u2500 kubelet\n\u251c\u2500\u2500 kubelet-startup.sh\n\u2514\u2500\u2500 mounter\n\n1 directory, 17 files\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"supervisor\u914d\u7f6e\u6587\u4ef6\u4e00\u89c8\uff1a")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# k8s\u5404\u7ec4\u4ef6\u7684supervisor\u914d\u7f6e\n tree /etc/supervisor/conf.d/\n/etc/supervisor/conf.d/\n\u251c\u2500\u2500 apiserver.conf\n\u251c\u2500\u2500 controller-manager.conf\n\u251c\u2500\u2500 etcd-server.conf\n\u251c\u2500\u2500 kube-proxy.conf\n\u251c\u2500\u2500 kubelet.conf\n\u2514\u2500\u2500 scheduler.conf\n\n1 directory, 6 files\n")),(0,s.kt)("h2",{id:"\u4e94\u90e8\u7f72node\u8282\u70b9"},"\u4e94\u3001\u90e8\u7f72node\u8282\u70b9"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u5176\u5b9e\u5b8c\u5168\u53ef\u4ee5\u5408\u5e76\u6210\u4e00\u4e2a\uff0c\u4f46\u662f\u4e3a\u4e86\u6761\u7406\u6e05\u6670\uff0c\u6240\u4ee5\u62c6\u5f00\u5355\u72ec\u5f04\u3002"),"\n\u5728master\u4e0a\u5c06kubelet\u548ckube-proxy\u4e8c\u8fdb\u5236\u6587\u4ef6\u5206\u53d1\u4e0b\u53bb\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'for i in node01 node02; do\n  # \u521b\u5efa\u7a0b\u5e8f\u76ee\u5f55\n  ssh $i "mkdir -pv /usr/local/kubernetes/server/bin"\n  # \u5206\u53d1bootstrap\u8ba4\u8bc1\u6587\u4ef6\n scp -r /usr/local/kubernetes/server/bin/kubelet* /usr/local/kubernetes/server/bin/kube-proxy* $i:/usr/local/kubernetes/server/bin\n  # \u589e\u52a0\u53ef\u6267\u884c\u6743\u9650\n  ssh $i "chmod +x /usr/local/kubernetes/server/bin/*"\ndone\n')),(0,s.kt)("h3",{id:"51-\u90e8\u7f72kubelet"},"5.1 \u90e8\u7f72kubelet"),(0,s.kt)("p",null,"\u5728master\u8282\u70b9\u4e0a\u5206\u53d1\u8ba4\u8bc1\u6587\u4ef6\u53cakubelet\u914d\u7f6e\u6587\u4ef6\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'for i in node01 node02; do\n  # \u914d\u7f6e\u8bc1\u4e66\u53ca\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\n  ssh $i "mkdir -pv /etc/kubernetes/{TLS,config,manifests}"\n  # \u5206\u53d1bootstrap\u8ba4\u8bc1\u6587\u4ef6\n  scp /etc/kubernetes/config/kubelet-bootstrap.kubeconfig $i:/etc/kubernetes/config/kubelet-bootstrap.kubeconfig\n  # \u590d\u5236\u914d\u7f6e\u6587\u4ef6\n  scp /etc/kubernetes/config/kubelet-conf.yml $i:/etc/kubernetes/config/kubelet-conf.yml\n  scp /etc/kubernetes/TLS/k8s/ca.pem $i:/etc/kubernetes/TLS/k8s/ca.pem\ndone\n')),(0,s.kt)("p",null,"\u914d\u7f6esupervisor\uff08\u548cmaster\u8282\u70b9\u7c7b\u4f3c\uff0c\u6240\u4ee5\u76f4\u63a5\u590d\u5236\u8fc7\u53bb\u597d\u4e86\uff09\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'for i in node01 node02; do\n  # \u521b\u5efa\u65e5\u5fd7\u76ee\u5f55\n  ssh $i "mkdir -pv /data/logs/kubernetes/kubelet"\n  # \u590d\u5236kubelet\u7684supervisor\u914d\u7f6e\u6587\u4ef6\n  scp /etc/supervisor/conf.d/kubelet.conf $i:/etc/supervisor/conf.d/kubelet.conf\n  # \u4fee\u6539id\uff0c\u65b9\u4fbf\u533a\u5206\uff0c\u8fd9\u91cc\u4e0d\u77e5\u4e3a\u4f55\u4e0b\u9762\u547d\u4ee4\u4e0d\u80fd\u7528\u3002\u3002\uff08\u624b\u52a8\u6539\u4e00\u4e0b\u5427\n  # ssh $i "id=`ip a show dev eth0 | grep -w inet | awk \'{print $2}\' | sed -e \'s/.*\\.\\([0-9]\\+\\)\\/.*/\\1/\'` ; sed -i "s/157/$id/" /etc/supervisor/conf.d/kubelet.conf"\ndone\n')),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230825150503.png",alt:"image.png"}),"\n\u6539\u5b8c\u4e4b\u540e\u5728node01\u548cnode02\u5206\u522b\u6267\u884c\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# node01\nIP=`ip a show dev eth0 | grep -w inet | awk '{print $2}' | cut -d '/' -f 1`\nsed -i \"s/172.19.82.157/$IP/\" /etc/kubernetes/config/kubelet-conf.yml\nsed -i \"s/master0/node01/\" /usr/local/kubernetes/server/bin/kubelet-startup.sh\nsupervisor update\n\n# node02\nIP=`ip a show dev eth0 | grep -w inet | awk '{print $2}' | cut -d '/' -f 1`\nsed -i \"s/172.19.82.157/$IP\" /etc/kubernetes/config/kubelet-conf.yml\nsed -i \"s/master0/node02/\" /usr/local/kubernetes/server/bin/kubelet-startup.sh\nsupervisor update\n")),(0,s.kt)("p",null,"\u542f\u52a8\u5b8c\u6210\u4e4b\u540e\u5728master\u8282\u70b9\u4e0a\u53ef\u4ee5\u770b\u5230\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get nodes\n# output\nNAME      STATUS     ROLES    AGE     VERSION\nmaster0   Ready      <none>   125m    v1.25.12\nnode01    NotReady   <none>   12s     v1.25.12\nnode02    NotReady   <none>   3m27s   v1.25.12\n")),(0,s.kt)("h3",{id:"52-\u90e8\u7f72kube-proxy"},"5.2 \u90e8\u7f72kube-proxy"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5728master\u8282\u70b9\u4e0a\u6267\u884c\nfor i in node01 node02; do\n  ssh $i \"mkdir -pv /data/logs/kubernetes/kube-proxy/\"\n  # \u62f7\u8d1dkube-proxy\u914d\u7f6e\u5230node\u8282\u70b9\n  scp /etc/kubernetes/config/kube-proxy.kubeconfig $i:/etc/kubernetes/config/kube-proxy.kubeconfig\n  scp /etc/kubernetes/config/kube-proxy-conf.yml $i:/etc/kubernetes/config/kube-proxy-conf.yml\n  scp /etc/supervisor/conf.d/kube-proxy.conf $i:/etc/supervisor/conf.d/kube-proxy.conf\ndone\n\n# \u5728node01\u8282\u70b9\u4e0a\u6267\u884c\nIP=`ip a show dev eth0 | grep -w inet | awk '{print $2}' | cut -d '/' -f 1`\nsed -i \"s/172.19.82.157/$IP/\" /etc/kubernetes/config/kube-proxy-conf.yml\nsupervisor update\n\n# \u5728node02\u8282\u70b9\u4e0a\u6267\u884c\nIP=`ip a show dev eth0 | grep -w inet | awk '{print $2}' | cut -d '/' -f 1`\nsed -i \"s/172.19.82.157/$IP/\" /etc/kubernetes/config/kube-proxy-conf.yml\nsupervisor update\n\n")),(0,s.kt)("h3",{id:"53-\u68c0\u67e5node\u8282\u70b9\u90e8\u7f72\u7ed3\u679c"},"5.3 \u68c0\u67e5node\u8282\u70b9\u90e8\u7f72\u7ed3\u679c"),(0,s.kt)("h4",{id:"531-\u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001"},"5.3.1 \u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"supervisor\u670d\u52a1\u8fd0\u884c\u72b6\u6001\uff08",(0,s.kt)("inlineCode",{parentName:"li"},"sueprvisorctl status"),"\uff09\uff1a\n",(0,s.kt)("img",{parentName:"li",src:"https://cdn.agou-ops.cn/others/20230825154847.png",alt:"image.png"})),(0,s.kt)("li",{parentName:"ul"},"\u7f51\u7edc\u7ec4\u4ef6\u4ee5\u53ca\u8282\u70b9\u72b6\u6001\uff1a(",(0,s.kt)("inlineCode",{parentName:"li"},"kubectl get node -owide/kubectl get po -A -owide"),")\uff1a\n",(0,s.kt)("img",{parentName:"li",src:"https://cdn.agou-ops.cn/others/20230825155014.png",alt:"image.png"}))),(0,s.kt)("h4",{id:"532-\u9644\u6587\u4ef6\u5217\u8868\u53ca\u7b80\u4ecb"},"5.3.2 \u9644\uff1a\u6587\u4ef6\u5217\u8868\u53ca\u7b80\u4ecb"),(0,s.kt)("p",null,"\u4ee5node01\u8282\u70b9\u4e3a\u4f8b\uff0c\u5176\u4ed6node\u8282\u70b9\u90fd\u4e00\u6837\u3002"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u8bc1\u4e66\u53ca\u914d\u7f6e\u6587\u4ef6\u4e00\u89c8\uff1a")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"}," tree /etc/kubernetes/\n/etc/kubernetes/\n\u251c\u2500\u2500 TLS\n\u2502\xa0\xa0 \u251c\u2500\u2500 etcd\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca-key.pem\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca.pem\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 etcd-server-key.pem\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 etcd-server.pem\n\u2502\xa0\xa0 \u2514\u2500\u2500 k8s\n\u2502\xa0\xa0     \u2514\u2500\u2500 ca.pem\n\u251c\u2500\u2500 config\n\u2502\xa0\xa0 \u251c\u2500\u2500 kube-proxy-conf.yml\n\u2502\xa0\xa0 \u251c\u2500\u2500 kube-proxy-config.yml\n\u2502\xa0\xa0 \u251c\u2500\u2500 kube-proxy.kubeconfig\n\u2502\xa0\xa0 \u251c\u2500\u2500 kubelet-bootstrap.kubeconfig\n\u2502\xa0\xa0 \u251c\u2500\u2500 kubelet-conf.yml\n\u2502\xa0\xa0 \u2514\u2500\u2500 kubelet.kubeconfig\n\u2514\u2500\u2500 manifests\n\n6 directories, 11 files\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"supervisor\u914d\u7f6e\u6587\u4ef6\u4e00\u89c8\uff1a")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"tree /etc/supervisor/conf.d/\n/etc/supervisor/conf.d/\n\u251c\u2500\u2500 etcd-server.conf\n\u251c\u2500\u2500 kube-proxy.conf\n\u2514\u2500\u2500 kubelet.conf\n\n1 directory, 3 files\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"k8s\u7ec4\u4ef6\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u53ca\u5bf9\u5e94\u542f\u52a8\u811a\u672c\u4e00\u89c8\uff1a")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"tree /usr/local/kubernetes/server/bin/\n/usr/local/kubernetes/server/bin/\n\u251c\u2500\u2500 kube-proxy\n\u251c\u2500\u2500 kube-proxy-startup.sh\n\u251c\u2500\u2500 kubelet\n\u2514\u2500\u2500 kubelet-startup.sh\n\n1 directory, 4 files\n")),(0,s.kt)("h2",{id:"\u516d\u5176\u4ed6\u53ef\u9009\u7ec4\u4ef6\u5b89\u88c5"},"\u516d\u3001\u5176\u4ed6\u53ef\u9009\u7ec4\u4ef6\u5b89\u88c5"),(0,s.kt)("h3",{id:"61-coredns"},"6.1 coredns"),(0,s.kt)("h4",{id:"611-\u90e8\u7f72coredns"},"6.1.1 \u90e8\u7f72coredns"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5728master\u8282\u70b9\u4e0a\u6267\u884c\ncd /etc/kubernetes/config\nwget https://raw.githubusercontent.com/coredns/deployment/master/kubernetes/coredns.yaml.sed -O coredns.yaml\n\n# \u4fee\u6539\u8d44\u6e90\u6e05\u5355\u91cc\u9762\u7684Corefile\u548cclusterIP\nvim coredns.yaml\n# \u7b2c\u4e00\u5904\n...\n  Corefile: |\n    .:53 {\n        errors\n        health {\n          lameduck 5s\n        }\n        ready\n        kubernetes cluster.local in-addr.arpa ip6.arpa {  # \u4fee\u6539\u53cd\u5411\u89e3\u6790\n          fallthrough in-addr.arpa ip6.arpa\n        }\n        prometheus :9153\n        forward . 8.8.8.8 {          # \u4fee\u6539\u4e3a\u5916\u90e8dns\u89e3\u6790\u5730\u5740\uff0c\u5f53coredns\u89e3\u6790\u4e0d\u5230\u65f6\u4f1a\u4f20\u7ed9\u8be5dns\n          max_concurrent 1000\n        }\n        cache 30\n        loop\n        reload\n        loadbalance\n    }                           # \u8fd9\u540e\u9762\u6709\u4e2aSTUBDOMAINS\u53bb\u6389\n...\n\n# \u7b2c\u4e8c\u5904\uff0c\u5927\u6982191\u884c\n...\n  clusterIP: 10.100.0.2\n...\n\n# \u4fee\u6539\u5b8c\u6210\u4e4b\u540e\nkubectl apply -f coredns.yaml\n")),(0,s.kt)("p",null,"\u68c0\u67e5coredns\u8fd0\u884c\u72b6\u6001\uff1a\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230825162329.png",alt:"image.png"})),(0,s.kt)("h4",{id:"\u6d4b\u8bd5coredns"},"\u6d4b\u8bd5coredns"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"vim helloworld.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: helloworld\nspec:\n  selector:\n    matchLabels:\n      app: helloworld\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: helloworld\n    spec:\n      containers:\n      - name: helloworld\n        image: karthequian/helloworld:latest\n        ports:\n        - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: helloworld-service\nspec:\n  selector:\n    app: helloworld\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 80\n  type: ClusterIP\n\nkubectl apply -f helloworld.yaml\n\n# \u8fd0\u884c\u7f51\u7edc\u6d4b\u8bd5\u5bb9\u5668\nkubectl run tmp-shell --rm -i --tty --image nicolaka/netshoot\ntmp-shell \ue0b0 ~ \ue0b0 dig kubernetes.default.svc.cluster.local +short\n10.96.0.1\ntmp-shell2 \ue0b0 ~ \ue0b0 dig helloworld-service.default.svc.cluster.local +short\n10.105.77.246\n")),(0,s.kt)("h3",{id:"62-nginx-ingress"},"6.2 nginx ingress"),(0,s.kt)("p",null,"\u53c2\u8003\u94fe\u63a5\uff1a",(0,s.kt)("a",{parentName:"p",href:"https://kubernetes.github.io/ingress-nginx/"},"https://kubernetes.github.io/ingress-nginx/")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.1/deploy/static/provider/baremetal/deploy.yaml -O nginx-ingress.yaml\n\nkubectl apply -f nginx-ingress.yaml\n")),(0,s.kt)("h3",{id:"63-\u9762\u677f"},"6.3 \u9762\u677f"),(0,s.kt)("h4",{id:"631-dashboard"},"6.3.1 dashboard"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'wget https://raw.githubusercontent.com/kubernetes/dashboard/v3.0.0-alpha0/charts/kubernetes-dashboard.yaml\n\nkubectl apply -f kubernetes-dashboard.yaml\n\n# \u4fee\u6539dashboard\u7684Services\u7c7b\u578b\u4e3anodeport\uff0c\u65b9\u4fbf\u8bbf\u95ee\nkubectl --namespace kubernetes-dashboard patch svc kubernetes-dashboard -p \'{"spec": {"type": "NodePort"}}\'\n\n')),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230825180332.png",alt:"image.png"}),"\n\u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\uff0c\u4f7f\u7528\u4e00\u4e0b\u547d\u4ee4\u83b7\u53d6\u81ea\u52a8\u5206\u914d\u7684nodeport\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get svc/kubernetes-dashboard -n kubernetes-dashboard -owide\n# output\nNAME                   TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE     SELECTOR\nkubernetes-dashboard   NodePort   10.99.165.217   <none>        443:36046/TCP   3m54s   k8s-app=kubernetes-dashboard\n")),(0,s.kt)("p",null,"\u8bbf\u95ee\u4efb\u4e00\u8282\u70b9\u7684IP\u52a0\u4e0a\u9762\u7684nodeport\u5373\u53ef\uff0c\u6bd4\u5982\uff1a",(0,s.kt)("a",{parentName:"p",href:"https://172.19.82.157:36046/#/login"},"https://172.19.82.157:36046/#/login"),"\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230827094647.png",alt:"image.png"}),"\n\u521b\u5efasa\u4f7f\u7528token\u767b\u5f55dashboard\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"vim dashboard-sa.yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: dashboard-admin\n  namespace: kubernetes-dashboard\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: dashboard-admin-rolebinding\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: dashboard-admin\n  namespace: kubernetes-dashboard\n---\n# \u6ce8\u610f\u8f83\u65b0\u7248\u672c\u7684k8s\u4e0d\u4f1a\u81ea\u52a8\u521b\u5efasecret\napiVersion: v1\nkind: Secret\nmetadata:\n  name: dashboard-admin-secret\n  namespace: kubernetes-dashboard\n  annotations:\n    kubernetes.io/service-account.name: dashboard-admin\ntype: kubernetes.io/service-account-token\n\nkubectl apply -f dashboard-sa.yaml\n\n# \u83b7\u53d6token\n kubectl describe secret dashboard-admin-secret -n kubernetes-dashboard\n# output\n\nName:         dashboard-admin-secret\nNamespace:    kubernetes-dashboard\nLabels:       <none>\nAnnotations:  kubernetes.io/service-account.name: dashboard-admin\n              kubernetes.io/service-account.uid: 80bf284e-06e7-4ea4-b747-0a2e77f0ed1f\n\nType:  kubernetes.io/service-account-token\n\nData\n====\nca.crt:     1314 bytes\nnamespace:  20 bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6IlhYRkQ2bmRNc0s2WktiWHYxT044M1ZfWTQ2UWRxZk81U3Q4TFJnRFo2QncifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tc2VjcmV0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImRhc2hib2FyZC1hZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjgwYmYyODRlLTA2ZTctNGVhNC1iNzQ3LTBhMmU3N2YwZWQxZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDpkYXNoYm9hcmQtYWRtaW4ifQ.RN82A652pjg5PSoIfVCrzj6b6irTQAaHP4Sr-ROf2LCA3A-GttYaH3Tq0pNQx3x2lfhEK2wqWjmKUtcP7yCfoemkXNdAHV_XOnM1qJ86crv-DHkbaqc8JikwyPOucwex8pZ-EeblDpNUyD-QKbImWRmE3XF09g3tBgRrqANFBKbJd82ABKg_BZyQV1iLEz0wN1Int3uk4f8nm19_YoPfjJPE1UcmKcI0m44aqqANSYNU4e6gej4d-YkBHvaIUZ0-9j9r7t_dKS1qVQiqcAwxdFlt0Tjxbi2KurOIAtazQriHaSbe7VhDJa_v-WYfzcZuHgoWpAELyAR9rbcyScgMbw\n")),(0,s.kt)("p",null,"\u4f7f\u7528\u4e0a\u9762\u8f93\u51fa\u7684token\u5373\u53ef\u767b\u5f55dashboard.\n",(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20230827100314.png",alt:"image.png"})),(0,s.kt)("h4",{id:"632-rancher"},"6.3.2 rancher"),(0,s.kt)("p",null,"\u7565\uff0c\u53c2\u8003\uff1a",(0,s.kt)("a",{parentName:"p",href:"https://ranchermanager.docs.rancher.com/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster#install-the-rancher-helm-chart"},"\u4f7f\u7528helm\u5feb\u901f\u5b89\u88c5rancher")),(0,s.kt)("h2",{id:"\u4e03\u672a\u5b8c\u5f85\u7eed"},"\u4e03\u3001\u672a\u5b8c\u5f85\u7eed"),(0,s.kt)("p",null,"To Be Continued..."))}p.isMDXComponent=!0}}]);