"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[7502],{3905:(e,n,t)=>{t.d(n,{Zo:()=>k,kt:()=>m});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),i=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},k=function(e){var n=i(e.components);return r.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,k=l(e,["components","mdxType","originalType","parentName"]),p=i(t),m=a,d=p["".concat(c,".").concat(m)]||p[m]||u[m]||s;return t?r.createElement(d,o(o({ref:n},k),{},{components:t})):r.createElement(d,o({ref:n},k))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,o=new Array(s);o[0]=p;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var i=2;i<s;i++)o[i]=t[i];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},37883:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>i});var r=t(87462),a=(t(67294),t(3905));const s={},o="\uff08\u4e00\uff09\u901a\u8fc7\u7528\u6237\u8d26\u53f7\u7684\u65b9\u5f0f\u5206\u914d\u5355\u72ecNamespace\u7684\u6743\u9650",l={unversionedId:"CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/RBAC \u5b9e\u6218\u6848\u4f8b",id:"CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/RBAC \u5b9e\u6218\u6848\u4f8b",title:"\uff08\u4e00\uff09\u901a\u8fc7\u7528\u6237\u8d26\u53f7\u7684\u65b9\u5f0f\u5206\u914d\u5355\u72ecNamespace\u7684\u6743\u9650",description:"1.\u6848\u4f8b\u63cf\u8ff0",source:"@site/docs/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/RBAC \u5b9e\u6218\u6848\u4f8b.md",sourceDirName:"CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b",slug:"/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/RBAC \u5b9e\u6218\u6848\u4f8b",permalink:"/docs/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/RBAC \u5b9e\u6218\u6848\u4f8b",draft:!1,editUrl:"https://github.com/AGou-ops/myDocsv4/edit/main/docs/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/RBAC \u5b9e\u6218\u6848\u4f8b.md",tags:[],version:"current",frontMatter:{},sidebar:"cloudNative",previous:{title:"\u5b9e\u6218\u6848\u4f8b",permalink:"/docs/category/\u5b9e\u6218\u6848\u4f8b"},next:{title:"SpringCloud\u5fae\u670d\u52a1\u7535\u5546\u7cfb\u7edf\u5728Kubernetes\u96c6\u7fa4\u4e2d\u4e0a\u7ebf\u8be6\u7ec6\u6559\u7a0b",permalink:"/docs/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/SpringCloud\u5fae\u670d\u52a1\u7535\u5546\u7cfb\u7edf\u5728Kubernetes\u96c6\u7fa4\u4e2d\u4e0a\u7ebf\u8be6\u7ec6\u6559\u7a0b"}},c={},i=[{value:"1.\u6848\u4f8b\u63cf\u8ff0",id:"1\u6848\u4f8b\u63cf\u8ff0",level:2},{value:"2.\u521b\u5efa\u7528\u6237\u8d26\u53f7",id:"2\u521b\u5efa\u7528\u6237\u8d26\u53f7",level:2},{value:"3.\u521b\u5efaClusterRole\u8d44\u6e90\u8bbe\u7f6e\u6743\u9650",id:"3\u521b\u5efaclusterrole\u8d44\u6e90\u8bbe\u7f6e\u6743\u9650",level:2},{value:"4.\u521b\u5efaRoleBinding\u8d44\u6e90\u5c06\u7528\u6237\u548c\u89d2\u8272\u7ed1\u5b9a",id:"4\u521b\u5efarolebinding\u8d44\u6e90\u5c06\u7528\u6237\u548c\u89d2\u8272\u7ed1\u5b9a",level:2},{value:"5.\u5207\u6362knowman\u7528\u6237\u67e5\u770b\u6743\u9650",id:"5\u5207\u6362knowman\u7528\u6237\u67e5\u770b\u6743\u9650",level:2},{value:"1.\u6848\u4f8b\u63cf\u8ff0",id:"1\u6848\u4f8b\u63cf\u8ff0-1",level:2},{value:"2.\u51c6\u5907cfssl\u5de5\u5177\u547d\u4ee4",id:"2\u51c6\u5907cfssl\u5de5\u5177\u547d\u4ee4",level:2},{value:"3.\u5229\u7528k8s\u6839\u8bc1\u4e66\u7b7e\u53d1\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bc1\u4e66",id:"3\u5229\u7528k8s\u6839\u8bc1\u4e66\u7b7e\u53d1\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bc1\u4e66",level:2},{value:"4.\u751f\u6210kubeconfig\u6388\u6743\u6587\u4ef6",id:"4\u751f\u6210kubeconfig\u6388\u6743\u6587\u4ef6",level:2},{value:"5.\u6267\u884ckubectl\u547d\u4ee4\u65f6\u6307\u5b9a\u6388\u6743\u6587\u4ef6",id:"5\u6267\u884ckubectl\u547d\u4ee4\u65f6\u6307\u5b9a\u6388\u6743\u6587\u4ef6",level:2},{value:"6.\u914d\u7f6erbac\u7b56\u7565\u6388\u6743kubeconfig\u76f8\u5e94\u7684\u6743\u9650",id:"6\u914d\u7f6erbac\u7b56\u7565\u6388\u6743kubeconfig\u76f8\u5e94\u7684\u6743\u9650",level:2},{value:"7.\u9a8c\u8bc1kubeconfig\u6388\u6743\u6587\u4ef6\u662f\u5426\u6709\u4e86\u5bf9\u5e94\u7684\u6743\u9650",id:"7\u9a8c\u8bc1kubeconfig\u6388\u6743\u6587\u4ef6\u662f\u5426\u6709\u4e86\u5bf9\u5e94\u7684\u6743\u9650",level:2},{value:"1.\u521b\u5efa\u4e00\u4e2asa\u8d26\u53f7",id:"1\u521b\u5efa\u4e00\u4e2asa\u8d26\u53f7",level:2},{value:"2.\u7f16\u5199rbac\u8d44\u6e90\u6388\u6743yaml\u6587\u4ef6",id:"2\u7f16\u5199rbac\u8d44\u6e90\u6388\u6743yaml\u6587\u4ef6",level:2},{value:"3.\u7f16\u5199nginx pod\u8d44\u6e90\u5e76\u4f7f\u7528sa\u8d26\u53f7",id:"3\u7f16\u5199nginx-pod\u8d44\u6e90\u5e76\u4f7f\u7528sa\u8d26\u53f7",level:2},{value:"4.\u521b\u5efa\u6240\u6709\u8d44\u6e90\u5e76\u67e5\u770b",id:"4\u521b\u5efa\u6240\u6709\u8d44\u6e90\u5e76\u67e5\u770b",level:2}],k={toc:i};function u(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},k,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u4e00\u901a\u8fc7\u7528\u6237\u8d26\u53f7\u7684\u65b9\u5f0f\u5206\u914d\u5355\u72ecnamespace\u7684\u6743\u9650"},"\uff08\u4e00\uff09\u901a\u8fc7\u7528\u6237\u8d26\u53f7\u7684\u65b9\u5f0f\u5206\u914d\u5355\u72ecNamespace\u7684\u6743\u9650"),(0,a.kt)("h2",{id:"1\u6848\u4f8b\u63cf\u8ff0"},"1.\u6848\u4f8b\u63cf\u8ff0"),(0,a.kt)("p",null,"\u521b\u5efa\u4e00\u4e2a\u7528\u6237\uff0c\u4ec5\u62e5\u6709\u5bf9know-system\u547d\u540d\u7a7a\u95f4\u4e0b\u7684pods\u3001deployments\u8d44\u6e90\u64cd\u4f5c\u6743\u9650\uff0c\u91c7\u7528RoleBinding\u7ed1\u5b9aClusterRole\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u3002"),(0,a.kt)("p",null,"\u5927\u81f4\u5b9e\u73b0\u601d\u8def\uff1a"),(0,a.kt)("p",null," 1.\u751f\u6210\u7528\u6237\u7684\u8bc1\u4e66\u6587\u4ef6key"),(0,a.kt)("p",null," 2.\u901a\u8fc7apiserver\u751f\u6210\u8bc1\u4e66\u8bf7\u6c42"),(0,a.kt)("p",null," 3.\u901a\u8fc7k8s\u7684api\u7684ca\u8bc1\u4e66\u7b7e\u53d1\u7528\u6237\u7684\u8bc1\u4e66\u8bf7\u6c42"),(0,a.kt)("p",null," 4.\u914d\u7f6ek8s\u8bbe\u7f6e\u96c6\u7fa4\u3001\u521b\u5efa\u7528\u6237\u3001\u914d\u7f6e\u4e0a\u4e0b\u6587\u4fe1\u606f"),(0,a.kt)("p",null," 5.\u521b\u5efaClusterRole\u3001RoleBinding\u8d44\u6e90"),(0,a.kt)("h2",{id:"2\u521b\u5efa\u7528\u6237\u8d26\u53f7"},"2.\u521b\u5efa\u7528\u6237\u8d26\u53f7"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u521b\u5efa\u8bc1\u4e66\u6587\u4ef6\n[root@k8s-master ~]\\# cd /etc/kubernetes/pki/\n[root@k8s-master /etc/kubernetes/pki]\\# (umask 077;openssl genrsa -out knowman.key 2048)\nGenerating RSA private key, 2048 bit long modulus\n....................................................................................+++\n................+++\ne is 65537 (0x10001)\n\n2.\u4f7f\u7528apiserver\u7684\u8bc1\u4e66\u7b7e\u53d1\u8bc1\u4e66\u8bf7\u6c42\n\n2-1.\u7533\u8bf7\u7b7e\u540d\uff0c\u8bc1\u4e66\u8bf7\u6c42\uff0c\u7533\u8bf7\u7684\u7528\u6237\u540d\u662fknowman\uff0c\u7ec4\u662fknowgroup\n[root@k8s-master /etc/kubernetes/pki]\\# openssl req -new -key knowman.key -out knowman.csr -subj "/CN=knowman/O=knowgroup"\n[root@k8s-master /etc/kubernetes/pki]\\# ll knowman.*\n-rw-r--r-- 1 root root  915 4\u6708  20 13:27 knowman.csr\n-rw------- 1 root root 1679 4\u6708  20 13:25 knowman.key\n\n2-2.\u7b7e\u53d1\u8bc1\u4e66(\u4f7f\u7528apiserver\u7684ca\u8bc1\u4e66\u7b7e\u53d1\u7528\u6237\u8bc1\u4e66)\n[root@k8s-master /etc/kubernetes/pki]\\# openssl x509 -req -in knowman.csr -CA ca.crt  -CAkey ca.key  -CAcreateserial -out knowman.crt -days 3650\nSignature ok\nsubject=/CN=knowman/O=knowgroup\nGetting CA Private Key\n\n0.3 \ud83d\udc40 \u5148\u67e5\u770b\u4e00\u4e0b\u96c6\u7fa4apiserver\u7684\u76d1\u542c\u5730\u5740\uff0c\u786e\u4fdd\u76d1\u542c\u7684\u8be5\u5730\u5740\u53ef\u4ee5\u8bbf\u95ee\u5230kubernetes\uff08\u8fd9\u91cc\u6211\u505a\u4e86\u4ee3\u7406\u3002\u3002\uff09\n\u276f kubectl cluster-info\nKubernetes control plane is running at https://127.0.0.1:52520\nCoreDNS is running at https://127.0.0.1:52520/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use \'kubectl cluster-info dump\'.\n\n3.\u914d\u7f6e\u96c6\u7fa4\u3001\u7528\u6237\u3001\u4e0a\u4e0b\u6587\u4fe1\u606f\n#\u914d\u7f6e\u96c6\u7fa4\n[root@k8s-master /etc/kubernetes/pki]\\# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.81.210:6443\nCluster "kubernetes" set.\n\n#\u914d\u7f6e\u7528\u6237\u4fe1\u606f\n[root@k8s-master /etc/kubernetes/pki]\\# kubectl config set-credentials knowman --embed-certs=true --client-certificate=/etc/kubernetes/pki/knowman.crt --client-key=/etc/kubernetes/pki/knowman.key \nUser "knowman" set.\n\n#\u914d\u7f6e\u4e0a\u4e0b\u6587\u4fe1\u606f\n[root@k8s-master /etc/kubernetes/pki]\\# kubectl config set-context knowman@kubernetes --cluster=kubernetes --user=knowman\nContext "knowman@kubernetes" created.\n\n4.\u67e5\u770b\u914d\u7f6e\u7684\u96c6\u7fa4\u4fe1\u606f\n[root@k8s-master /etc/kubernetes/pki]\\# kubectl config view\n')),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616085930486.png",alt:"Kubernetes\u96c6\u7fa4RBAC\u6388\u6743\u6848\u4f8b\uff08\u4e00\uff09\u901a\u8fc7\u7528\u6237\u8d26\u53f7\u7684\u65b9\u5f0f\u5206\u914d\u5355\u72ecNamespace\u7684\u6743\u9650\uff08\u56db\u5341\uff09_\u7528\u6237\u8d26\u53f7"})),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'5\uff09\u5207\u6362\u5230knowman\u7528\u6237\n[root@k8s-master /etc/kubernetes/pki]\\# kubectl config use-context knowman@kubernetes\nSwitched to context "knowman@kubernetes".\n\n6\uff09\u8bd5\u7740\u67e5\u770b\u4e0bknow-system\u547d\u540d\u7a7a\u95f4\u4e0b\u7684\u8d44\u6e90\n[root@k8s-master /etc/kubernetes/pki]\\# kubectl get pod -n know-system\nError from server (Forbidden): pods is forbidden: User "knowman" cannot list resource "pods" in API group "" in the namespace "know-system"\n#\u53ef\u4ee5\u770b\u5230\u6ca1\u6709\u6743\u9650\u8bbf\u95ee\n\n7\uff09\u5207\u6362\u5230admin\u7528\u6237\u8fdb\u884c\u6388\u6743\n[root@k8s-master ~]\\# kubectl config use-context kubernetes-admin@kubernetes \nSwitched to context "kubernetes-admin@kubernetes"\n')),(0,a.kt)("h2",{id:"3\u521b\u5efaclusterrole\u8d44\u6e90\u8bbe\u7f6e\u6743\u9650"},"3.\u521b\u5efaClusterRole\u8d44\u6e90\u8bbe\u7f6e\u6743\u9650"),(0,a.kt)("p",null,"\u521b\u5efa\u4e00\u4e2aClusterRole\uff0c\u9488\u5bf9\u8d44\u6e90\u505a\u4e00\u4e9b\u6388\u6743\uff0c\u7531\u4e8eClusterRole\u662f\u96c6\u7fa4\u7ea7\u522b\u7684\u89d2\u8272\u6388\u6743\uff0c\u53ef\u4ee5\u591a\u6b21\u590d\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u7f16\u5199ClusterRole\u8d44\u6e90\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# vim knowman-clusterrole.yaml\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: knowman-clusterrole\nrules:                                          #\u5b9a\u4e49\u89d2\u8272\n- apiGroups: ["","apps"]                        #\u5bf9\u54ea\u4e2aapi\u7ec4\u8fdb\u884c\u6388\u6743\uff0c""\u6838\u5fc3\u8d44\u6e90\u7ec4\uff0capps\u7ec4\u662fdeployment\u63a7\u5236\u5668\u6240\u5728\u7684api\u7ec4\n  resources: ["pods","deployments"]               #\u5bf9\u4ec0\u4e48\u8d44\u6e90\u8fdb\u884c\u6388\u6743\n  verbs:                                        #\u5177\u4f53\u7684\u6743\u9650\u5217\u8868\n  - get\n  - list\n  - watch\n\n2.\u521b\u5efa\u8d44\u6e90\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# kubectl create -f knowman-clusterrole.yaml\nclusterrole.rbac.authorization.k8s.io/knowman-clusterrole created\n\n3.\u67e5\u770b\u8d44\u6e90\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# kubectl get clusterrole knowman-clusterrole\nNAME                  CREATED AT\nknowman-clusterrole   2021-04-20T06:26:20Z\n\n4.\u67e5\u770b\u8d44\u6e90\u7684\u8be6\u7ec6\u4fe1\u606f\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# kubectl describe clusterrole knowman-clusterrole\n')),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616085930519.png",alt:"Kubernetes\u96c6\u7fa4RBAC\u6388\u6743\u6848\u4f8b\uff08\u4e00\uff09\u901a\u8fc7\u7528\u6237\u8d26\u53f7\u7684\u65b9\u5f0f\u5206\u914d\u5355\u72ecNamespace\u7684\u6743\u9650\uff08\u56db\u5341\uff09_docker_02"})),(0,a.kt)("h2",{id:"4\u521b\u5efarolebinding\u8d44\u6e90\u5c06\u7528\u6237\u548c\u89d2\u8272\u7ed1\u5b9a"},"4.\u521b\u5efaRoleBinding\u8d44\u6e90\u5c06\u7528\u6237\u548c\u89d2\u8272\u7ed1\u5b9a"),(0,a.kt)("p",null,"\u901a\u8fc7RoleBinding\u89d2\u8272\u7ed1\u5b9a\u5c06\u7528\u6237\u4e0e\u96c6\u7fa4\u89d2\u8272\u8fdb\u884c\u7ed1\u5b9a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"1.\u7f16\u5199yaml\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# vim knowman-rolebinding.yaml\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: knowman-rolebinding\n  namespace: know-system\nsubjects:                                               #\u5173\u8054\u7528\u6237\u4fe1\u606f\n- kind: User                                            #\u7c7b\u578b\u4e3a\u7528\u6237\n  name: knowman                                         #\u7528\u6237\u540d\u79f0\n  namespace: know-system                                #\u89d2\u8272\u6240\u80fd\u63a7\u5236\u7684\u547d\u540d\u7a7a\u95f4\n  apiGroup: rbac.authorization.k8s.io\nroleRef:                                            #\u5173\u8054\u89d2\u8272\u4fe1\u606f\n  kind: ClusterRole                                  #\u7c7b\u578b\u4e3aClusterRole\n  name: knowman-clusterrole                           #\u89d2\u8272\u540d\u79f0\n  apiGroup: rbac.authorization.k8s.io\n\n2.\u521b\u5efa\u8d44\u6e90\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# kubectl create -f knowman-rolebinding.yaml\nrolebinding.rbac.authorization.k8s.io/knowman-rolebinding created\n\n3.\u67e5\u770b\u8d44\u6e90\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# kubectl get rolebinding knowman-rolebinding -n know-system\nNAME                  ROLE                              AGE\nknowman-rolebinding   ClusterRole/knowman-clusterrole   17s\n\n4.\u67e5\u770b\u8d44\u6e90\u7684\u8be6\u7ec6\u4fe1\u606f\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# kubectl describe rolebinding knowman-rolebinding -n know-system\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616085930655.png",alt:"Kubernetes\u96c6\u7fa4RBAC\u6388\u6743\u6848\u4f8b\uff08\u4e00\uff09\u901a\u8fc7\u7528\u6237\u8d26\u53f7\u7684\u65b9\u5f0f\u5206\u914d\u5355\u72ecNamespace\u7684\u6743\u9650\uff08\u56db\u5341\uff09_nginx_03"})),(0,a.kt)("h2",{id:"5\u5207\u6362knowman\u7528\u6237\u67e5\u770b\u6743\u9650"},"5.\u5207\u6362knowman\u7528\u6237\u67e5\u770b\u6743\u9650"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u5207\u6362\u7528\u6237\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# kubectl config use-context knowman@kubernetes \nSwitched to context "knowman@kubernetes".\n\n2.\u67e5\u770b\u53ef\u4ee5\u64cd\u4f5c\u7684pod/deployment\u8d44\u6e90\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# kubectl get pod,deployment -n know-system\nNAME                                READY   STATUS    RESTARTS   AGE\npod/deploy-nginx-5cfd6fd7bd-79z4t   1/1     Running   1          6d3h\npod/deploy-nginx-5cfd6fd7bd-b67wf   1/1     Running   1          6d3h\npod/deploy-nginx-5cfd6fd7bd-qpl2w   1/1     Running   1          6d3h\n\nNAME                           READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/deploy-nginx   3/3     3            3           6d5h\n\n3.\u5220\u9664pod\u67e5\u770b\u662f\u5426\u6709\u6743\u9650\n[root@k8s-master ~/k8s_1.19_yaml/rbac]\\# kubectl delete pod deploy-nginx-5cfd6fd7bd-79z4t -n know-system\nError from server (Forbidden): pods "deploy-nginx-5cfd6fd7bd-79z4t" is forbidden: User "knowman" cannot delete resource "pods" in API group "" in the namespace "know-system"\n#\u65e0\u6743\u5220\u9664\n')),(0,a.kt)("p",null,"\u9664\u4e86deployment\u3001pod\u8d44\u6e90\u4e4b\u524d\u65e0\u6743\u64cd\u4f5c\u5176\u4ed6\u8d44\u6e90"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616085930822.png",alt:"Kubernetes\u96c6\u7fa4RBAC\u6388\u6743\u6848\u4f8b\uff08\u4e00\uff09\u901a\u8fc7\u7528\u6237\u8d26\u53f7\u7684\u65b9\u5f0f\u5206\u914d\u5355\u72ecNamespace\u7684\u6743\u9650\uff08\u56db\u5341\uff09_nginx_04"})),(0,a.kt)("h1",{id:"\u4e8c\u901a\u8fc7kubeconfig\u6388\u6743\u6587\u4ef6\u5b9e\u73b0\u7279\u5b9a\u8d44\u6e90\u7684\u6743\u9650\u5206\u914d"},"\uff08\u4e8c\uff09\u901a\u8fc7kubeconfig\u6388\u6743\u6587\u4ef6\u5b9e\u73b0\u7279\u5b9a\u8d44\u6e90\u7684\u6743\u9650\u5206\u914d"),(0,a.kt)("h2",{id:"1\u6848\u4f8b\u63cf\u8ff0-1"},"1.\u6848\u4f8b\u63cf\u8ff0"),(0,a.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6839\u8bc1\u4e66\u7b7e\u53d1\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bc1\u4e66\uff0c\u5728\u5ba2\u6237\u7aef\u8bc1\u4e66\u91cc\u9762\u6307\u5b9a\u7528\u6237\u540d\uff0c\u7136\u540e\u5728\u901a\u8fc7kubectl config\u547d\u4ee4\u751f\u6210\u4e00\u4e2akubeconfig\u6388\u6743\u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u4e2d\u5305\u62ec\u4e86\u96c6\u7fa4\u4fe1\u606f\u3001\u7528\u6237\u4fe1\u606f\u3001\u5ba2\u6237\u7aef\u8bc1\u4e66\u4fe1\u606f\uff0c\u7136\u540e\u518d\u521b\u5efa\u4e00\u4e2arbac\u7b56\u7565\uff0c\u5c06\u8bc1\u4e66\u4e2d\u7684\u7528\u6237\u4e0e\u521b\u5efa\u7684role\u89d2\u8272\u8fdb\u884c\u7ed1\u5b9a\uff0c\u5373\u53ef\u5b9e\u73b0\u901a\u8fc7\u6388\u6743\u6587\u4ef6\u7684\u65b9\u5f0f\u53bb\u8bbf\u95ee\u96c6\u7fa4\u7684\u7279\u5b9a\u8d44\u6e90"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6700\u7ec8\u5b9e\u73b0\u76ee\u7684\uff1a")," \u5c06\u6388\u6743\u6587\u4ef6\u53d1\u7ed9\u5bf9\u5e94\u7684\u4eba\u5458\uff0c\u8ba9\u4eba\u5458\u53ea\u9700kubectl\u547d\u4ee4\u7684\u65f6\u5019\u6307\u5b9akubeconfig\u6587\u4ef6\u7684\u8def\u5f84\u5373\u53ef\u8bf7\u6c42\u96c6\u7fa4\u8d44\u6e90"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5b9e\u73b0\u6b65\u9aa4\uff1a")),(0,a.kt)("p",null,"1.\u5b89\u88c5cfssl\u5de5\u5177\uff0c\u7528k8s ca\u6839\u8bc1\u4e66\u7b7e\u53d1\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bc1\u4e66"),(0,a.kt)("p",null,"2.\u7528kubectl config\u751f\u6210\u6388\u6743\u6587\u4ef6"),(0,a.kt)("p",null,"3.\u521b\u5efarbac\u6388\u6743\u7b56\u7565"),(0,a.kt)("h2",{id:"2\u51c6\u5907cfssl\u5de5\u5177\u547d\u4ee4"},"2.\u51c6\u5907cfssl\u5de5\u5177\u547d\u4ee4"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"1.\u7f16\u5199\u811a\u672c\n[root@k8s-master 1 rbac]\\# cat cfssl.sh \nwget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64\nwget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\nwget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64\nchmod +x cfssl*\nmv cfssl_linux-amd64 /usr/bin/cfssl\nmv cfssljson_linux-amd64 /usr/bin/cfssljson\nmv cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo\n\n2.\u6267\u884c\u811a\u672c\n[root@k8s-master1 rbac]\\# sh cfssl.sh \n\n3.\u67e5\u770b\u662f\u5426\u5b89\u88c5\u6210\u529f\n[root@k8s-master1 rbac]\\# ll /usr/bin/cfssl* /usr/local/bin/cfssl\n-rwxr-xr-x 1 root root  6595195 4\u6708  17 03:17 /usr/bin/cfssl-certinfo\n-rwxr-xr-x 1 root root  2277873 4\u6708  17 03:17 /usr/bin/cfssljson\n-rwxr-xr-x 1 root root 10376657 5\u6708  11 10:17 /usr/local/bin/cfssl\n")),(0,a.kt)("h2",{id:"3\u5229\u7528k8s\u6839\u8bc1\u4e66\u7b7e\u53d1\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bc1\u4e66"},"3.\u5229\u7528k8s\u6839\u8bc1\u4e66\u7b7e\u53d1\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bc1\u4e66"),(0,a.kt)("p",null,"\u5229\u7528k8s\u7684ca\u6839\u8bc1\u4e66\u7b7e\u53d1\u4e00\u4e2a\u4e13\u95e8\u7ed9\u67d0\u4e2a\u5ba2\u6237\u7aef\u4f7f\u7528\u7684\u8bc1\u4e66"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u7f16\u5199\u811a\u672c\n[root@k8s-master1 rbac]\\# vim cert.sh\ncat > ca-config.json <<EOF\n{\n  "signing": {\n    "default": {\n      "expiry": "87600h"            #\u8bc1\u4e66\u7684\u6709\u6548\u671f\n    },\n    "profiles": {\n      "kubernetes": {\n        "usages": [\n            "signing",\n            "key encipherment",\n            "server auth",\n            "client auth"\n        ],\n        "expiry": "87600h"\n      }\n    }\n  }\n}\nEOF\n\ncat > jiangxl-csr.json <<EOF\n{\n  "CN": "jiangxl",                  #\u53ef\u4ee5\u7406\u89e3\u4e3a\u662f\u7528\u6237\u540d\uff0crbac\u6388\u6743\u7684\u65f6\u5019\u4e5f\u662f\u6839\u636e\u8fd9\u4e2a\u503c\u6765\u6388\u6743\n  "hosts": [],\n  "key": {\n    "algo": "rsa",\n    "size": 2048\n  },\n  "names": [\n    {\n      "C": "CN",\n      "ST": "BeiJing",\n      "L": "BeiJing",\n      "O": "k8s",\n      "OU": "System"\n    }\n  ]\n}\nEOF\n\ncfssl gencert -ca=/etc/kubernetes/pki/ca.crt -ca-key=/etc/kubernetes/pki/ca.key -config=ca-config.json -profile=kubernetes jiangxl-csr.json | cfssljson -bare jiangxl           #\u901a\u8fc7cfssl\u751f\u6210\u8bc1\u4e66\uff0c\u8981\u6307\u5b9ak8s\u6839\u8bc1\u4e66\u7684\u8def\u5f84\n\n2.\u751f\u6210\u8bc1\u4e66\n[root@k8s-master1 rbac]\\# sh cert.sh\n2021/07/06 14:52:58 [INFO] generate received request\n2021/07/06 14:52:58 [INFO] received CSR\n2021/07/06 14:52:58 [INFO] generating key: rsa-2048\n2021/07/06 14:52:58 [INFO] encoded CSR\n2021/07/06 14:52:58 [INFO] signed certificate with serial number 104120417046794075592128325952316827755218120119\n2021/07/06 14:52:58 [WARNING] This certificate lacks a "hosts" field. This makes it unsuitable for\nwebsites. For more information see the Baseline Requirements for the Issuance and Management\nof Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum (https://cabforum.org);\nspecifically, section 10.2.3 ("Information Requirements")\n\n3.\u67e5\u770b\u751f\u6210\u7684\u8bc1\u4e66\u6587\u4ef6\n[root@k8s-master1 rbac]\\# ll ca-config.json jiangxl*\n-rw-r--r-- 1 root root  292 7\u6708   6 14:52 ca-config.json\n-rw-r--r-- 1 root root  997 7\u6708   6 14:52 jiangxl.csr\n-rw-r--r-- 1 root root  220 7\u6708   6 14:52 jiangxl-csr.json\n-rw------- 1 root root 1679 7\u6708   6 14:52 jiangxl-key.pem\n-rw-r--r-- 1 root root 1281 7\u6708   6 14:52 jiangxl.pem\n#\u4e3b\u8981\u6709\u7528\u7684\u5c31\u662fjiangxl.pem jiangxl-key.pem\n')),(0,a.kt)("h2",{id:"4\u751f\u6210kubeconfig\u6388\u6743\u6587\u4ef6"},"4.\u751f\u6210kubeconfig\u6388\u6743\u6587\u4ef6"),(0,a.kt)("p",null,"\u751f\u6210\u4e00\u4e2akubeconfig\u6388\u6743\u6587\u4ef6\uff0c\u6587\u4ef6\u7684\u5185\u5bb9\u548c/root/.kube/config\u6587\u4ef6\u57fa\u672c\u662f\u4e00\u81f4\u7684\uff0c\u53ea\u662f\u8bc1\u4e66\u5185\u5bb9\u4e0d\u4e00\u6837\uff0c\u8bc1\u4e66\u5185\u5bb9\u4e0d\u540c\u6240\u5c5e\u7684\u6743\u9650\u4e5f\u4e0d\u540c\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9akubeconfig\u6587\u4ef6\u53bb\u6267\u884ck8s\u547d\u4ee4"),(0,a.kt)("p",null,"\u751f\u6210\u6388\u6743\u6587\u4ef6\u9700\u8981\u5206\u4e3a\u4e09\u4e2a\u6b65\u9aa4\uff1a\u8bbe\u7f6e\u96c6\u7fa4\u3001\u8bbe\u7f6e\u8bc1\u4e66\u79c1\u94a5\u6587\u4ef6\u8def\u5f84\u3001\u6307\u5b9a\u7528\u6237\u540d\uff0c\u6bcf\u5f53\u6267\u884c\u4e00\u4e2a\u6b65\u9aa4\uff0ckubeconfig\u7684\u5185\u5bb9\u5c31\u4f1a\u589e\u52a0\u4e0a\u76f8\u5e94\u7684\u914d\u7f6e"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"1.\u751f\u6210\u6388\u6743\u6587\u4ef6\u8bbe\u7f6e\u96c6\u7fa4\u4fe1\u606f\uff1a\u6307\u5b9a\u6839\u8bc1\u4e66\u8def\u5f84\u3001k8sapi\u5730\u5740\u3001\u6388\u6743\u6587\u4ef6\u540d\u79f0")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl config set-cluster kubernetes \\\n  --certificate-authority=/etc/kubernetes/pki/ca.crt \\\n  --embed-certs=true \\\n  --server=https://192.168.16.106:6443 \\\n  --kubeconfig=jiangxl.kubeconfig\n\n#set-cluster kubernetes\uff1a\u8bbe\u7f6e\u96c6\u7fa4\u540d\u79f0\u4e3akubernetes\n#--certificate-authority\uff1a\u6307\u5b9a\u6839\u8bc1\u4e66\u8def\u5f84\n#--server\uff1a\u6307\u5b9ak8sapi\u5730\u5740\n#--kubeconfig\uff1a\u6307\u5b9a\u6388\u6743\u6587\u4ef6\u540d\u79f0  \n")),(0,a.kt)("p",null,"\u5f53\u6267\u884c\u4e86\u7b2c\u4e00\u6b65\u8bbe\u7f6e\u96c6\u7fa4\u4fe1\u606f\u540e\uff0c\u67e5\u770bkubeconfig\u7684\u6587\u4ef6\u5185\u5bb9\uff0c\u4f1a\u53d1\u73b0\u6587\u4ef6\u91cc\u9762\u591a\u4e86\u6839\u8bc1\u4e66ca\u7684\u6587\u4ef6\u5185\u5bb9\u4ee5\u53ca\u96c6\u7fa4apiserver\u7684\u5730\u5740\n",(0,a.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616090418303.png",alt:"Kubernetes\u96c6\u7fa4RBAC\u6388\u6743\u6848\u4f8b\uff08\u4e8c\uff09\u901a\u8fc7kubeconfig\u6388\u6743\u6587\u4ef6\u5b9e\u73b0\u7279\u5b9a\u8d44\u6e90\u7684\u6743\u9650\u5206\u914d\uff08\u56db\u5341\u4e00\uff09_linux"})),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2.\u8bbe\u7f6e\u5ba2\u6237\u7aef\u8ba4\u8bc1\uff1a\u6307\u5b9a\u5ba2\u6237\u7aef\u8bc1\u4e66\u6587\u4ef6\u8def\u5f84\u548c\u79c1\u94a5\u6587\u4ef6\u8def\u5f84")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl config set-credentials jiangxl \\\n  --client-key=jiangxl-key.pem \\\n  --client-certificate=jiangxl.pem \\\n  --embed-certs=true \\\n  --kubeconfig=jiangxl.kubeconfig\n\n#--client-key\uff1a\u6307\u5b9a\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u79c1\u94a5\u6587\u4ef6\n#--client-certificate\uff1a\u6307\u5b9a\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u8bc1\u4e66\u6587\u4ef6\n#--kubeconfig\uff1a\u6307\u5b9a\u6388\u6743\u6587\u4ef6\u540d\u79f0\n#set-credentials jiangxl\uff1a\u8bbe\u7f6e\u8bc1\u4e66\u7684\u540d\u79f0\u4e3ajiangxl\n")),(0,a.kt)("p",null,"\u5f53\u7b2c\u4e8c\u6b65\u8bbe\u7f6e\u5ba2\u6237\u7aef\u8bc1\u4e66\u8ba4\u8bc1\u5b8c\u6210\u540e\uff0ckubeconfig\u6587\u4ef6\u5c31\u4f1a\u589e\u52a0\u5ba2\u6237\u7aef\u8bc1\u4e66\u6587\u4ef6\u7684\u5185\u5bb9\n",(0,a.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616090418664.png",alt:"Kubernetes\u96c6\u7fa4RBAC\u6388\u6743\u6848\u4f8b\uff08\u4e8c\uff09\u901a\u8fc7kubeconfig\u6388\u6743\u6587\u4ef6\u5b9e\u73b0\u7279\u5b9a\u8d44\u6e90\u7684\u6743\u9650\u5206\u914d\uff08\u56db\u5341\u4e00\uff09_\u5ba2\u6237\u7aef_02"})),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"3.\u8bbe\u7f6e\u9ed8\u8ba4\u4e0a\u4e0b\u6587\uff1a\u6307\u5b9a\u7528\u6237\u540d\u662f\u4ec0\u4e48")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl config set-context kubernetes \\\n  --cluster=kubernetes \\\n  --user=jiangxl \\\n  --kubeconfig=jiangxl.kubeconfig\n")),(0,a.kt)("p",null,"\u7b2c\u4e09\u6b65\u6267\u884c\u5b8c\u6210\u540e\uff0ckubeconfig\u6587\u4ef6\u91cc\u9762\u4f1a\u589e\u52a0\u7528\u6237\u4fe1\u606f\u914d\u7f6e\uff0crbac\u6388\u6743\u4e5f\u662f\u5c06\u8fd9\u4e2a\u7528\u6237\u548c\u67d0\u4e2arole\u8fdb\u884c\u7ed1\u5b9a\n",(0,a.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616090418987.png",alt:"Kubernetes\u96c6\u7fa4RBAC\u6388\u6743\u6848\u4f8b\uff08\u4e8c\uff09\u901a\u8fc7kubeconfig\u6388\u6743\u6587\u4ef6\u5b9e\u73b0\u7279\u5b9a\u8d44\u6e90\u7684\u6743\u9650\u5206\u914d\uff08\u56db\u5341\u4e00\uff09_\u5bb9\u5668_03"})),(0,a.kt)("h2",{id:"5\u6267\u884ckubectl\u547d\u4ee4\u65f6\u6307\u5b9a\u6388\u6743\u6587\u4ef6"},"5.\u6267\u884ckubectl\u547d\u4ee4\u65f6\u6307\u5b9a\u6388\u6743\u6587\u4ef6"),(0,a.kt)("p",null,"\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"--kubeconfig"),"\u53c2\u6570\u53bb\u6307\u5b9a\u4f7f\u7528\u54ea\u4e2a\u6388\u6743\u6587\u4ef6\uff0c\u5230\u6b64\u65f6\u4e5f\u5c31\u53ef\u4ee5\u628a\u6388\u6743\u6587\u4ef6\u53d1\u9001\u7ed9\u9700\u8981\u4f7f\u7528\u8fd9\u4e2a\u6388\u6743\u7684\u4eba\uff0c\u867d\u7136\u73b0\u5728\u8fd8\u662f\u65e0\u6743\u9650\u83b7\u53d6\u8d44\u6e90\u7684\u72b6\u6001\uff0c\u4f46\u662f\u5df2\u7ecf\u53ef\u4ee5\u8fde\u63a5\u5230k8s\u96c6\u7fa4\u4e86\uff0c\u53ea\u9700\u8981\u914d\u7f6e\u597drbac\u7b56\u7565\uff0c\u5373\u53ef\u6709\u6743\u9650\u8bbf\u95ee\u8d44\u6e90"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'[root@k8s-master1 rbac]\\# kubectl --kubeconfig=jiangxl.kubeconfig get pod\nError from server (Forbidden): pods is forbidden: User "jiangxl" cannot list resource "pods" in API group "" in the namespace "default"\n')),(0,a.kt)("h2",{id:"6\u914d\u7f6erbac\u7b56\u7565\u6388\u6743kubeconfig\u76f8\u5e94\u7684\u6743\u9650"},"6.\u914d\u7f6erbac\u7b56\u7565\u6388\u6743kubeconfig\u76f8\u5e94\u7684\u6743\u9650"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"1.\u7f16\u5199rbac yaml\u8d44\u6e90\u6587\u4ef6")),(0,a.kt)("p",null,"\u521b\u5efa\u4e00\u4e2arole\uff0c\u6388\u6743\u5bf9default\u547d\u540d\u7a7a\u95f4\u4e0bpod\u3001deployment\u3001svc\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u5e76\u5c06\u8be5role\u4e0ejiangxl\u7528\u6237\u8fdb\u884c\u7ed1\u5b9a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'[root@k8s-master1 rbac]\\# vim rbac.yaml \napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  namespace: default\n  name: pod-reader\nrules:\n- apiGroups: ["","apps"]\n  resources: ["pods","deployments","services"]\n  verbs: ["get", "watch", "list"]\n\n---\n\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: read-pods\n  namespace: default\nsubjects:\n- kind: User\n  name: jiangxl\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: pod-reader\n  apiGroup: rbac.authorization.k8s.io\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2.\u521b\u5efarbac\u8d44\u6e90")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master1 rbac]\\# kubectl apply -f rbac.yaml\nrole.rbac.authorization.k8s.io/pod-reader created\nrolebinding.rbac.authorization.k8s.io/read-pods created\n")),(0,a.kt)("h2",{id:"7\u9a8c\u8bc1kubeconfig\u6388\u6743\u6587\u4ef6\u662f\u5426\u6709\u4e86\u5bf9\u5e94\u7684\u6743\u9650"},"7.\u9a8c\u8bc1kubeconfig\u6388\u6743\u6587\u4ef6\u662f\u5426\u6709\u4e86\u5bf9\u5e94\u7684\u6743\u9650"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master1 rbac]\\# kubectl --kubeconfig=jiangxl.kubeconfig get pod,deployment,svc\nNAME                         READY   STATUS    RESTARTS   AGE\npod/jenkins-0                1/1     Running   0          38s\npod/tools-696bf5cc5c-z2znw   1/1     Running   0          103s\n\nNAME                    READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/tools   1/1     1            1           27d\n\nNAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE\nservice/jenkins      ClusterIP   None         <none>        42/TCP    15d\nservice/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   59d\nservice/tools        ClusterIP   None         <none>        42/TCP    27d\n\n#\u5df2\u7ecf\u5bf9default\u547d\u540d\u7a7a\u95f4\u4e0b\u7684pod\u3001deployment\u3001svc\u8d44\u6e90\u6709\u4e86\u8bfb\u53d6\u6743\u9650\n")),(0,a.kt)("h1",{id:"\u4e09\u901a\u8fc7service-account\u8d26\u53f7\u6388\u6743\u5b9e\u73b0\u7279\u5b9a\u8d44\u6e90\u7684\u6743\u9650\u5206\u914d"},"\uff08\u4e09\uff09\u901a\u8fc7Service Account\u8d26\u53f7\u6388\u6743\u5b9e\u73b0\u7279\u5b9a\u8d44\u6e90\u7684\u6743\u9650\u5206\u914d"),(0,a.kt)("h2",{id:"1\u521b\u5efa\u4e00\u4e2asa\u8d26\u53f7"},"1.\u521b\u5efa\u4e00\u4e2asa\u8d26\u53f7"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'[root@k8s-master1 sa]\\# vim nginx-sa.yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nginx-sa\n  namespace: rbac\n  labels:\n    kubernetes.io/cluster-service: "true"\n    addonmanager.kubernetes.io/mode: Reconcile\n')),(0,a.kt)("h2",{id:"2\u7f16\u5199rbac\u8d44\u6e90\u6388\u6743yaml\u6587\u4ef6"},"2.\u7f16\u5199rbac\u8d44\u6e90\u6388\u6743yaml\u6587\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'[root@k8s-master1 sa]\\# vim nginx-rbac.yaml \nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  namespace: rbac\n  name: pod-reader\nrules:\n- apiGroups: ["","apps"]\n  resources: ["pods","deployments","services"]\n  verbs: ["get", "watch", "list"]\n\n---\n\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: read-pods\n  namespace: rbac\nsubjects:\n- kind: ServiceAccount        #\u7c7b\u578b\u586b\u5199ServiceAccount\n  name: nginx-sa\n  namespace: rbac\nroleRef:\n  kind: Role\n  name: pod-reader\n  apiGroup: rbac.authorization.k8s.io\n')),(0,a.kt)("h2",{id:"3\u7f16\u5199nginx-pod\u8d44\u6e90\u5e76\u4f7f\u7528sa\u8d26\u53f7"},"3.\u7f16\u5199nginx pod\u8d44\u6e90\u5e76\u4f7f\u7528sa\u8d26\u53f7"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: web\n  namespace: stat`\nspec:\n  serviceName: "web"            #\u6307\u5b9a\u4f7f\u7528\u54ea\u4e2aheadless service\u8d44\u6e90\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx    \n    spec:\n      serviceAccountName: nginx-sa\n      containers:\n      - name: nginx\n        image: nginx:1.17\n        ports:\n        - name: web\n          containerPort: 80\n')),(0,a.kt)("h2",{id:"4\u521b\u5efa\u6240\u6709\u8d44\u6e90\u5e76\u67e5\u770b"},"4.\u521b\u5efa\u6240\u6709\u8d44\u6e90\u5e76\u67e5\u770b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"1.\u521b\u5efa\u6240\u6709\u8d44\u6e90\n[root@k8s-master1 sa]\\# kubectl apply -f ./\nrole.rbac.authorization.k8s.io/pod-reader created\nrolebinding.rbac.authorization.k8s.io/read-pods created\nserviceaccount/nginx-sa created\nstatefulset.apps/web created\n\n2.\u67e5\u770bsa\u8d26\u53f7\n#sa\u8d26\u53f7\u4f1a\u751f\u6210\u4e00\u4e2atoken\uff0c\u8fd9\u4e2atoken\u4e2d\u4fdd\u5b58\u8fd9\u6839\u8bc1\u4e66ca\u4ee5\u53casa\u7528\u6237\u7684\u8bc1\u4e66kube   \n\n:q\n\uff0c\u7528\u4e8e\u8fde\u63a5\u5230k8s\u96c6\u7fa4\n[root@k8s-master1 sa]\\# kubectl get sa -n rbac\nNAME       SECRETS   AGE\ndefault    1         4m48s\nnginx-sa   1         103s\n[root@k8s-master1 sa]\\# kubectl get secret -n rbac\nNAME                   TYPE                                  DATA   AGE\ndefault-token-4fkpj    kubernetes.io/service-account-token   3      5m14s\nnginx-sa-token-vcrmv   kubernetes.io/service-account-token   3      2m9s\n\n3.\u67e5\u770bnginx\u8d44\u6e90\u4e2d\u662f\u5426\u5173\u8054sa\n[root@k8s-master1 sa]\\# kubectl describe statefulset -n rbac\nName:               web\n\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\nPod Template:\n  Labels:           app=nginx\n  Service Account:  nginx-sa\n\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u6587\u7ae0\u6765\u6e90\u4e8e\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://blog.51cto.com/jiangxl/5076630"},"https://blog.51cto.com/jiangxl/5076630")),(0,a.kt)("p",{parentName:"blockquote"},"\u4ec5\u505a\u4e2a\u4eba\u5907\u4efd\u5b66\u4e60\u4f7f\u7528.")))}u.isMDXComponent=!0}}]);