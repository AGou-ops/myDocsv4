"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[6726],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>c});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i=r.createContext({}),m=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=m(e.components);return r.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},g=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),g=m(t),c=a,d=g["".concat(i,".").concat(c)]||g[c]||u[c]||o;return t?r.createElement(d,l(l({ref:n},p),{},{components:t})):r.createElement(d,l({ref:n},p))}));function c(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,l=new Array(o);l[0]=g;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s.mdxType="string"==typeof e?e:a,l[1]=s;for(var m=2;m<o;m++)l[m]=t[m];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}g.displayName="MDXCreateElement"},14973:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>m});var r=t(87462),a=(t(67294),t(3905));const o={},l=void 0,s={unversionedId:"ProgramLang/Golang/gorm\u5305",id:"ProgramLang/Golang/gorm\u5305",title:"gorm\u5305",description:"\u6765\u81ea\uff1ahttps://www.cnblogs.com/rickiyang/p/14517120.html",source:"@site/docs/ProgramLang/Golang/gorm\u5305.md",sourceDirName:"ProgramLang/Golang",slug:"/ProgramLang/Golang/gorm\u5305",permalink:"/docs/ProgramLang/Golang/gorm\u5305",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/ProgramLang/Golang/gorm\u5305.md",tags:[],version:"current",frontMatter:{},sidebar:"programLang",previous:{title:"\u5b57\u7b26\u4e32\u5904\u7406",permalink:"/docs/ProgramLang/Golang/String Operate"},next:{title:"Lua Basic",permalink:"/docs/ProgramLang/Lua/Lua Baisc"}},i={},m=[{value:"GORM \u7ea6\u5b9a\u914d\u7f6e#",id:"gorm-\u7ea6\u5b9a\u914d\u7f6e",level:4},{value:"\u6a21\u578b\u5b9a\u4e49",id:"\u6a21\u578b\u5b9a\u4e49",level:5},{value:"GORM \u6807\u7b7e",id:"gorm-\u6807\u7b7e",level:5},{value:"\u9ed8\u8ba4\u6a21\u578b",id:"\u9ed8\u8ba4\u6a21\u578b",level:5},{value:"\u8868\u540d",id:"\u8868\u540d",level:5},{value:"\u5217\u540d\u8986\u76d6",id:"\u5217\u540d\u8986\u76d6",level:5},{value:"\u65e5\u671f\u5b57\u6bb5\u65f6\u95f4\u7c7b\u578b\u8bbe\u7f6e",id:"\u65e5\u671f\u5b57\u6bb5\u65f6\u95f4\u7c7b\u578b\u8bbe\u7f6e",level:5},{value:"\u5d4c\u5165\u7ed3\u6784\u4f53",id:"\u5d4c\u5165\u7ed3\u6784\u4f53",level:5},{value:"CRUD\u64cd\u4f5c#",id:"crud\u64cd\u4f5c",level:4},{value:"\u65b0\u589e\u76f8\u5173",id:"\u65b0\u589e\u76f8\u5173",level:5},{value:"\u5220\u9664\u76f8\u5173",id:"\u5220\u9664\u76f8\u5173",level:5},{value:"\u66f4\u65b0\u64cd\u4f5c",id:"\u66f4\u65b0\u64cd\u4f5c",level:5},{value:"\u67e5\u8be2\u64cd\u4f5c",id:"\u67e5\u8be2\u64cd\u4f5c",level:5},{value:"\u4e8b\u52a1\u64cd\u4f5c#",id:"\u4e8b\u52a1\u64cd\u4f5c",level:4}],p={toc:m};function u(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u6765\u81ea\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/rickiyang/p/14517120.html"},"https://www.cnblogs.com/rickiyang/p/14517120.html"))),(0,a.kt)("p",null,"\u4eca\u5929\u804a\u804a\u76ee\u524d\u4e1a\u754c\u4f7f\u7528\u6bd4\u8f83\u591a\u7684 ORM \u6846\u67b6\uff1aGORM\u3002GORM \u76f8\u5173\u7684\u6587\u6863\u539f\u4f5c\u8005\u5df2\u7ecf\u5199\u5f97\u975e\u5e38\u7684\u8be6\u7ec6\uff0c\u5177\u4f53\u53ef\u4ee5\u770b",(0,a.kt)("a",{parentName:"p",href:"https://gorm.io/zh_CN/docs/connecting_to_the_database.html"},"\u8fd9\u91cc"),"\uff0c\u8fd9\u4e00\u7bc7\u4e3b\u8981\u505a\u4e00\u4e9b GORM \u4f7f\u7528\u8fc7\u7a0b\u4e2d\u5173\u952e\u529f\u80fd\u7684\u4ecb\u7ecd\uff0cGORM \u7ea6\u5b9a\u7684\u4e00\u4e9b\u914d\u7f6e\u4fe1\u606f\u8bf4\u660e\uff0c\u9632\u6b62\u5927\u5bb6\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u8e29\u5751\u3002"),(0,a.kt)("p",null,"\u4ee5\u4e0b\u793a\u4f8b\u4ee3\u7801\u90fd\u53ef\u4ee5\u5728 Github \uff1a ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/rickiyang/gorm-demo"},"gorm-demo")," \u4e2d\u627e\u5230\u3002"),(0,a.kt)("hr",null),(0,a.kt)("p",null,"GORM \u5b98\u65b9\u652f\u6301\u7684\u6570\u636e\u5e93\u7c7b\u578b\u6709\uff1a MySQL, PostgreSQL, SQlite, SQL Server\u3002"),(0,a.kt)("p",null,"\u8fde\u63a5 MySQL \u7684\u793a\u4f8b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copyimport (\n  "gorm.io/driver/mysql"\n  "gorm.io/gorm"\n)\n\nfunc main() {\n  // \u53c2\u8003 https://github.com/go-sql-driver/mysql#dsn-data-source-name \u83b7\u53d6\u8be6\u60c5\n  dsn := "user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local"\n  db, err := gorm.Open(mysql.Open(dsn), &gorm.Config{})\n}\n')),(0,a.kt)("p",null,"MySQl \u9a71\u52a8\u7a0b\u5e8f\u63d0\u4f9b\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u914d\u7f6e\u53ef\u4ee5\u5728\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u4f7f\u7528\uff0c\u4f8b\u5982\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copydb, err := gorm.Open(mysql.New(mysql.Config{\n  DSN: "gorm:gorm@tcp(127.0.0.1:3306)/gorm?charset=utf8&parseTime=True&loc=Local", // DSN data source name\n  DefaultStringSize: 256, // string \u7c7b\u578b\u5b57\u6bb5\u7684\u9ed8\u8ba4\u957f\u5ea6\n  DisableDatetimePrecision: true, // \u7981\u7528 datetime \u7cbe\u5ea6\uff0cMySQL 5.6 \u4e4b\u524d\u7684\u6570\u636e\u5e93\u4e0d\u652f\u6301\n  DontSupportRenameIndex: true, // \u91cd\u547d\u540d\u7d22\u5f15\u65f6\u91c7\u7528\u5220\u9664\u5e76\u65b0\u5efa\u7684\u65b9\u5f0f\uff0cMySQL 5.7 \u4e4b\u524d\u7684\u6570\u636e\u5e93\u548c MariaDB \u4e0d\u652f\u6301\u91cd\u547d\u540d\u7d22\u5f15\n  DontSupportRenameColumn: true, // \u7528 `change` \u91cd\u547d\u540d\u5217\uff0cMySQL 8 \u4e4b\u524d\u7684\u6570\u636e\u5e93\u548c MariaDB \u4e0d\u652f\u6301\u91cd\u547d\u540d\u5217\n  SkipInitializeWithVersion: false, // \u6839\u636e\u5f53\u524d MySQL \u7248\u672c\u81ea\u52a8\u914d\u7f6e\n}), &gorm.Config{})\n')),(0,a.kt)("p",null,"\u6ce8\u610f\u5230 ",(0,a.kt)("em",{parentName:"p"},"gorm.Open(dialector Dialector, opts ...Option)")," \u51fd\u6570\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u63a5\u6536\u4e00\u4e2a ",(0,a.kt)("em",{parentName:"p"},"gorm.Config{}")," \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u8fd9\u91cc\u5c31\u662f gorm \u5728\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\u540e\u6846\u67b6\u672c\u8eab\u505a\u7684\u4e00\u4e9b\u9ed8\u8ba4\u914d\u7f6e\uff0c",(0,a.kt)("strong",{parentName:"p"},"\u8bf7\u6ce8\u610f\u8fd9\u91cc\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u597d\uff0c\u540e\u9762\u4f60\u7684\u6570\u636e\u5e93\u64cd\u4f5c\u5c06\u4f1a\u5f88\u75db\u82e6\uff01")),(0,a.kt)("p",null,"GORM \u63d0\u4f9b\u7684\u914d\u7f6e\u53ef\u4ee5\u5728\u521d\u59cb\u5316\u65f6\u4f7f\u7528\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"Copytype Config struct {\n  SkipDefaultTransaction   bool\n  NamingStrategy           schema.Namer\n  Logger                   logger.Interface\n  NowFunc                  func() time.Time\n  DryRun                   bool\n  PrepareStmt              bool\n  DisableNestedTransaction bool\n  AllowGlobalUpdate        bool\n  DisableAutomaticPing     bool\n  DisableForeignKeyConstraintWhenMigrating bool\n}\n")),(0,a.kt)("p",null,"\u8fd9\u4e9b\u53c2\u6570\u6211\u4eec\u4e00\u4e2a\u4e00\u4e2a\u6765\u8bf4\uff1a"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"SkipDefaultTransaction")),(0,a.kt)("p",null,"\u8df3\u8fc7\u9ed8\u8ba4\u5f00\u542f\u4e8b\u52a1\u6a21\u5f0f\u3002\u4e3a\u4e86\u786e\u4fdd\u6570\u636e\u4e00\u81f4\u6027\uff0cGORM \u4f1a\u5728\u4e8b\u52a1\u91cc\u6267\u884c\u5199\u5165\u64cd\u4f5c\uff08\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\uff09\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u65b9\u9762\u7684\u8981\u6c42\uff0c\u53ef\u4ee5\u5728\u521d\u59cb\u5316\u65f6\u7981\u7528\u5b83\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copydb, err := gorm.Open(sqlite.Open("gorm.db"), &gorm.Config{\n  SkipDefaultTransaction: true,\n})\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"NamingStrategy")),(0,a.kt)("p",null,"\u8868\u540d\u79f0\u7684\u547d\u540d\u7b56\u7565\uff0c\u4e0b\u9762\u4f1a\u8bf4\u3002GORM \u5141\u8bb8\u7528\u6237\u901a\u8fc7\u8986\u76d6\u9ed8\u8ba4\u7684",(0,a.kt)("inlineCode",{parentName:"p"},"NamingStrategy"),"\u6765\u66f4\u6539\u547d\u540d\u7ea6\u5b9a\uff0c\u8fd9\u9700\u8981\u5b9e\u73b0\u63a5\u53e3 ",(0,a.kt)("inlineCode",{parentName:"p"},"Namer"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"Copytype Namer interface {\n    TableName(table string) string\n    ColumnName(table, column string) string\n    JoinTableName(table string) string\n    RelationshipFKName(Relationship) string\n    CheckerName(table, column string) string\n    IndexName(table, column string) string\n}\n")),(0,a.kt)("p",null,"\u9ed8\u8ba4 ",(0,a.kt)("inlineCode",{parentName:"p"},"NamingStrategy")," \u4e5f\u63d0\u4f9b\u4e86\u51e0\u4e2a\u9009\u9879\uff0c\u5982\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copydb, err := gorm.Open(sqlite.Open("gorm.db"), &gorm.Config{\n  NamingStrategy: schema.NamingStrategy{\n    TablePrefix: "t_",   // \u8868\u540d\u524d\u7f00\uff0c`User`\u8868\u4e3a`t_users`\n    SingularTable: true, // \u4f7f\u7528\u5355\u6570\u8868\u540d\uff0c\u542f\u7528\u8be5\u9009\u9879\u540e\uff0c`User` \u8868\u5c06\u662f`user`\n    NameReplacer: strings.NewReplacer("CID", "Cid"), // \u5728\u8f6c\u4e3a\u6570\u636e\u5e93\u540d\u79f0\u4e4b\u524d\uff0c\u4f7f\u7528NameReplacer\u66f4\u6539\u7ed3\u6784/\u5b57\u6bb5\u540d\u79f0\u3002\n  },\n})\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4e00\u822c\u6765\u8bf4\u8fd9\u91cc\u662f\u4e00\u5b9a\u8981\u914d\u7f6e ","*","SingularTable: true","*"," \u8fd9\u4e00\u9879\u7684\u3002")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Logger")),(0,a.kt)("p",null,"\u5141\u8bb8\u901a\u8fc7\u8986\u76d6\u6b64\u9009\u9879\u66f4\u6539 GORM \u7684\u9ed8\u8ba4 logger\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"NowFunc")),(0,a.kt)("p",null,"\u66f4\u6539\u521b\u5efa\u65f6\u95f4\u4f7f\u7528\u7684\u51fd\u6570:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copydb, err := gorm.Open(sqlite.Open("gorm.db"), &gorm.Config{\n  NowFunc: func() time.Time {\n    return time.Now().Local()\n  },\n})\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"DryRun")),(0,a.kt)("p",null,"\u751f\u6210 ",(0,a.kt)("inlineCode",{parentName:"p"},"SQL")," \u4f46\u4e0d\u6267\u884c\uff0c\u53ef\u4ee5\u7528\u4e8e\u51c6\u5907\u6216\u6d4b\u8bd5\u751f\u6210\u7684 SQL\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copydb, err := gorm.Open(sqlite.Open("gorm.db"), &gorm.Config{\n  DryRun: false,\n})\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"PrepareStmt")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"PreparedStmt")," \u5728\u6267\u884c\u4efb\u4f55 SQL \u65f6\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a prepared statement \u5e76\u5c06\u5176\u7f13\u5b58\uff0c\u4ee5\u63d0\u9ad8\u540e\u7eed\u7684\u6548\u7387\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copydb, err := gorm.Open(sqlite.Open("gorm.db"), &gorm.Config{\n  PrepareStmt: false,\n})\n')),(0,a.kt)("h4",{id:"gorm-\u7ea6\u5b9a\u914d\u7f6e"},"GORM \u7ea6\u5b9a\u914d\u7f6e",(0,a.kt)("a",{parentName:"h4",href:"https://www.cnblogs.com/rickiyang/p/14517120.html#936638098"},"#")),(0,a.kt)("p",null,"\u4f7f\u7528\u522b\u4eba\u7684\u6846\u67b6\u5c31\u8981\u53d7\u5236\u522b\u4eba\u7684\u7ea6\u675f\uff0c\u5728 GORM \u4e2d\u6709\u5f88\u591a\u7684\u7ea6\u5b9a\uff0c\u5982\u679c\u4f60\u6ca1\u6709\u9075\u5faa\u8fd9\u4e9b\u7ea6\u5b9a\u53ef\u80fd\u4f60\u8ba4\u4e3a\u6b63\u5e38\u7684\u4ee3\u7801\u8dd1\u8d77\u6765\u4f1a\u53d1\u751f\u610f\u60f3\u4e0d\u5230\u7684\u95ee\u9898\u3002"),(0,a.kt)("h5",{id:"\u6a21\u578b\u5b9a\u4e49"},"\u6a21\u578b\u5b9a\u4e49"),(0,a.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cGORM \u4f1a\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"ID")," \u4f5c\u4e3a\u8868\u7684\u4e3b\u952e\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"Copytype User struct {\n  ID   string // \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u540d\u4e3a `ID` \u7684\u5b57\u6bb5\u4f1a\u4f5c\u4e3a\u8868\u7684\u4e3b\u952e\n  Name string\n}\n")),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u5f53\u524d\u7684\u8868\u4e3b\u952e\u4e0d\u662f id \u5b57\u6bb5\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"primaryKey"),"\u6807\u7b7e\u5c06\u5176\u5b83\u5b57\u6bb5\u8bbe\u4e3a\u4e3b\u952e\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// \u5c06 `UUID` \u8bbe\u4e3a\u4e3b\u952e\ntype Animal struct {\n  ID     int64\n  UUID   string `gorm:"primaryKey"`\n  Name   string\n  Age    int64\n}\n')),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u7684\u8868\u91c7\u7528\u4e86\u590d\u5408\u4e3b\u952e\uff0c\u90a3\u4e5f\u6ca1\u5173\u7cfb\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copytype Product struct {\n  ID           string `gorm:"primaryKey"`\n  LanguageCode string `gorm:"primaryKey"`\n  Code         string\n  Name         string\n}\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6ce8\u610f\uff1a"),"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6574\u578b ",(0,a.kt)("inlineCode",{parentName:"p"},"PrioritizedPrimaryField")," \u542f\u7528\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"AutoIncrement"),"\uff0c\u8981\u7981\u7528\u5b83\uff0c\u60a8\u9700\u8981\u4e3a\u6574\u578b\u5b57\u6bb5\u5173\u95ed ",(0,a.kt)("inlineCode",{parentName:"p"},"autoIncrement"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copytype Product struct {\n  CategoryID uint64 `gorm:"primaryKey;autoIncrement:false"`\n  TypeID     uint64 `gorm:"primaryKey;autoIncrement:false"`\n}\n')),(0,a.kt)("h5",{id:"gorm-\u6807\u7b7e"},"GORM \u6807\u7b7e"),(0,a.kt)("p",null,"GORM \u901a\u8fc7\u5728 struct \u4e0a\u5b9a\u4e49\u81ea\u5b9a\u4e49\u7684 gorm \u6807\u7b7e\u6765\u5b9e\u73b0\u81ea\u52a8\u5316\u521b\u5efa\u8868\u7684\u529f\u80fd\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copytype User struct {\n    Name string  `gorm:"size:255"` //string\u9ed8\u8ba4\u957f\u5ea6255,size\u91cd\u8bbe\u957f\u5ea6\n    Age int `gorm:"column:my_age"` //\u8bbe\u7f6e\u5217\u540d\u4e3amy_age\n    Num int  `gorm:"AUTO_INCREMENT"` //\u81ea\u589e\n    IgnoreMe int `gorm:"-"` // \u5ffd\u7565\u5b57\u6bb5\n    Email string `gorm:"type:varchar(100);unique_index"` //type\u8bbe\u7f6esql\u7c7b\u578b\uff0cunique_index\u4e3a\u8be5\u5217\u8bbe\u7f6e\u552f\u4e00\u7d22\u5f15\n    Address string `gorm:"not null;unique"` //\u975e\u7a7a\n    No string `gorm:"index:idx_no"` // \u521b\u5efa\u7d22\u5f15\u5e76\u547d\u540d\uff0c\u5982\u679c\u6709\u5176\u4ed6\u540c\u540d\u7d22\u5f15\uff0c\u5219\u521b\u5efa\u7ec4\u5408\u7d22\u5f15\n    Remark string `gorm:"default:\'\'"` //\u9ed8\u8ba4\u503c\n}\n')),(0,a.kt)("p",null,"\u5b9a\u4e49\u5b8c\u8fd9\u4e9b\u6807\u7b7e\u4e4b\u540e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("em",{parentName:"p"},"AutoMigrate")," \u5728 MySQL \u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\u521b\u5efa\u8868\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copyfunc main() {\n    db, err := gorm.Open("mysql", "root:123456789@/test_db?charset=utf8&parseTime=True&loc=Local")\n    if err != nil {\n        fmt.Println("connect db error: ", err)\n    }\n    db.AutoMigrate(&model.User{})\n}\n')),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"AutoMigrate")," \u7528\u4e8e\u81ea\u52a8\u8fc1\u79fb\u4f60\u7684 schema\uff0c\u4fdd\u6301 schema \u662f\u6700\u65b0\u7684\u3002 \u8be5 API \u4f1a\u521b\u5efa\u8868\u3001\u7f3a\u5931\u7684\u5916\u952e\u3001\u7ea6\u675f\u3001\u5217\u548c\u7d22\u5f15\u3002 \u5982\u679c\u5927\u5c0f\u3001\u7cbe\u5ea6\u3001\u662f\u5426\u4e3a\u7a7a\u53ef\u4ee5\u66f4\u6539\uff0c\u5219 ",(0,a.kt)("em",{parentName:"p"},"AutoMigrate")," \u4f1a\u6539\u53d8\u5217\u7684\u7c7b\u578b\u3002"),(0,a.kt)("p",null,"\u51fa\u4e8e\u4fdd\u62a4\u6570\u636e\u7684\u76ee\u7684\uff0c\u5b83 ",(0,a.kt)("strong",{parentName:"p"},"\u4e0d\u4f1a")," \u5220\u9664\u672a\u4f7f\u7528\u7684\u5217\u3002"),(0,a.kt)("h5",{id:"\u9ed8\u8ba4\u6a21\u578b"},"\u9ed8\u8ba4\u6a21\u578b"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"GORM \u5b9a\u4e49\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"strong"},"gorm.Model")," \u7ed3\u6784\u4f53\uff0c\u5176\u5305\u62ec\u5b57\u6bb5 ",(0,a.kt)("inlineCode",{parentName:"strong"},"ID"),"\u3001",(0,a.kt)("inlineCode",{parentName:"strong"},"CreatedAt"),"\u3001",(0,a.kt)("inlineCode",{parentName:"strong"},"UpdatedAt"),"\u3001",(0,a.kt)("inlineCode",{parentName:"strong"},"DeletedAt"),"\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// gorm.Model \u7684\u5b9a\u4e49\ntype Model struct {\n  ID        uint           `gorm:"primaryKey"`\n  CreatedAt time.Time\n  UpdatedAt time.Time\n  DeletedAt gorm.DeletedAt `gorm:"index"`\n}\n')),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u89c9\u5f97\u4e0a\u9762\u8fd9\u51e0\u4e2a\u5b57\u6bb5\u540d\u5b57\u6bb5\u540d\u662f\u4f60\u60f3\u8981\u7684\uff0c\u90a3\u4e48\u4f60\u5b8c\u5168\u53ef\u4ee5\u5728\u4f60\u7684\u6a21\u578b\u4e2d\u5f15\u5165\u5b83\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copytype User struct {\n    gorm.Model\n    Id    int64  `json:"id"`\n    Name  string `json:"name"`\n    Age   int32  `json:"age"`\n    Sex   int8   `json:"sex"`\n    Phone string `json:"phone"`\n}\n')),(0,a.kt)("p",null,"\u53cd\u4e4b\u5982\u679c\u4e0d\u662f\u4f60\u9700\u8981\u7684\uff0c\u5c31\u6ca1\u5fc5\u8981\u591a\u6b64\u4e00\u4e3e\u3002"),(0,a.kt)("h5",{id:"\u8868\u540d"},"\u8868\u540d"),(0,a.kt)("p",null,"\u8fd9\u91cc\u662f\u4e00\u4e2a\u5f88\u5927\u7684\u5751\u3002",(0,a.kt)("strong",{parentName:"p"},"GORM \u4f7f\u7528\u7ed3\u6784\u4f53\u540d\u7684 ",(0,a.kt)("inlineCode",{parentName:"strong"},"\u86c7\u5f62\u547d\u540d")," \u4f5c\u4e3a\u8868\u540d\u3002\u5bf9\u4e8e\u7ed3\u6784\u4f53 ",(0,a.kt)("inlineCode",{parentName:"strong"},"User"),"\uff0c\u6839\u636e\u7ea6\u5b9a\uff0c\u5176\u8868\u540d\u4e3a ",(0,a.kt)("inlineCode",{parentName:"strong"},"users")),"\u3002"),(0,a.kt)("p",null,"\u5f53\u7136\u6211\u4eec\u7684\u8868\u540d\u80af\u5b9a\u4e0d\u4f1a\u662f\u8fd9\u6837\u8bbe\u7f6e\u7684\uff0c\u6240\u4ee5\u4e3a\u4ec0\u4e48\u4f5c\u8005\u8981\u91c7\u7528\u8fd9\u79cd\u8bbe\u5b9a\u5b9e\u5728\u662f\u96be\u4ee5\u6349\u6478\u3002"),(0,a.kt)("p",null,"\u8fd9\u91cc\u6709\u4e24\u79cd\u65b9\u5f0f\u53bb\u4fee\u6539\u8868\u540d\uff1a\u7b2c\u4e00\u79cd\u5c31\u662f\u53bb\u6389\u8fd9\u4e2a\u9ed8\u8ba4\u8bbe\u7f6e\uff1b\u7b2c\u4e8c\u79cd\u5c31\u662f\u5728\u4fdd\u7559\u9ed8\u8ba4\u8bbe\u7f6e\u7684\u57fa\u7840\u4e0a\u901a\u8fc7\u91cd\u65b0\u8bbe\u5b9a\u8868\u540d\u6765\u66ff\u6362\u3002"),(0,a.kt)("p",null,"\u5148\u8bf4\u5982\u4f55\u901a\u8fc7\u91cd\u65b0\u8bbe\u5b9a\u8868\u540d\u6765\u66ff\u6362\uff0c\u53ef\u4ee5\u5b9e\u73b0 ",(0,a.kt)("inlineCode",{parentName:"p"},"Tabler")," \u63a5\u53e3\u6765\u66f4\u6539\u9ed8\u8ba4\u8868\u540d\uff0c\u4f8b\u5982\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copytype Tabler interface {\n    TableName() string\n}\n\n// TableName \u4f1a\u5c06 User \u7684\u8868\u540d\u91cd\u5199\u4e3a `user_new_name`\nfunc (User) TableName() string {\n  return "user_new_name"\n}\n')),(0,a.kt)("p",null,"\u901a\u8fc7\u53bb\u6389\u9ed8\u8ba4\u914d\u7f6e\u4e0a\u9762\u5df2\u7ecf\u6709\u63d0\uff0c\u914d\u7f6e ",(0,a.kt)("em",{parentName:"p"},"SingularTable: true")," \u8fd9\u9009\u9879\u5373\u53ef\u3002"),(0,a.kt)("h5",{id:"\u5217\u540d\u8986\u76d6"},"\u5217\u540d\u8986\u76d6"),(0,a.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5217\u540d\u9075\u5faa\u666e\u901a struct \u7684\u89c4\u5219\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"Copytype User struct {\n  ID        uint      // \u5217\u540d\u662f `id`\n  Name      string    // \u5217\u540d\u662f `name`\n  Birthday  time.Time // \u5217\u540d\u662f `birthday`\n  CreatedAt time.Time // \u5217\u540d\u662f `created_at`\n}\n")),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u7684\u5217\u540d\u548c\u5b57\u6bb5\u4e0d\u5339\u914d\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u91cd\u65b0\u6307\u5b9a\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copytype Animal struct {\n  AnimalID int64     `gorm:"column:beast_id"`         // \u5c06\u5217\u540d\u8bbe\u4e3a `beast_id`\n  Birthday time.Time `gorm:"column:day_of_the_beast"` // \u5c06\u5217\u540d\u8bbe\u4e3a `day_of_the_beast`\n  Age      int64     `gorm:"column:age_of_the_beast"` // \u5c06\u5217\u540d\u8bbe\u4e3a `age_of_the_beast`\n}\n')),(0,a.kt)("h5",{id:"\u65e5\u671f\u5b57\u6bb5\u65f6\u95f4\u7c7b\u578b\u8bbe\u7f6e"},"\u65e5\u671f\u5b57\u6bb5\u65f6\u95f4\u7c7b\u578b\u8bbe\u7f6e"),(0,a.kt)("p",null,"GORM \u7ea6\u5b9a\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"CreatedAt"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"UpdatedAt")," \u8ffd\u8e2a\u521b\u5efa/\u66f4\u65b0\u65f6\u95f4\u3002\u5982\u679c\u4f60\u5b9a\u4e49\u4e86\u8fd9\u79cd\u5b57\u6bb5\uff0cGORM \u5728\u521b\u5efa\u3001\u66f4\u65b0\u65f6\u4f1a\u81ea\u52a8\u586b\u5145\u3002"),(0,a.kt)("p",null,"\u5982\u679c\u60f3\u8981\u4fdd\u5b58 UNIX\uff08\u6beb/\u7eb3\uff09\u79d2\u65f6\u95f4\u6233\u800c\u4e0d\u662f time\uff0c\u53ea\u9700\u7b80\u5355\u5730\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"time.Time")," \u4fee\u6539\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"int")," \u5373\u53ef\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copytype User struct {\n  CreatedAt time.Time // \u5728\u521b\u5efa\u65f6\uff0c\u5982\u679c\u8be5\u5b57\u6bb5\u503c\u4e3a\u96f6\u503c\uff0c\u5219\u4f7f\u7528\u5f53\u524d\u65f6\u95f4\u586b\u5145\n  UpdatedAt int       // \u5728\u521b\u5efa\u65f6\u8be5\u5b57\u6bb5\u503c\u4e3a\u96f6\u503c\u6216\u8005\u5728\u66f4\u65b0\u65f6\uff0c\u4f7f\u7528\u5f53\u524d\u65f6\u95f4\u6233\u79d2\u6570\u586b\u5145\n  Updated   int64 `gorm:"autoUpdateTime:nano"` // \u4f7f\u7528\u65f6\u95f4\u6233\u586b\u7eb3\u79d2\u6570\u5145\u66f4\u65b0\u65f6\u95f4\n  Updated   int64 `gorm:"autoUpdateTime:milli"` // \u4f7f\u7528\u65f6\u95f4\u6233\u6beb\u79d2\u6570\u586b\u5145\u66f4\u65b0\u65f6\u95f4\n  Created   int64 `gorm:"autoCreateTime"`      // \u4f7f\u7528\u65f6\u95f4\u6233\u79d2\u6570\u586b\u5145\u521b\u5efa\u65f6\u95f4\n}\n')),(0,a.kt)("h5",{id:"\u5d4c\u5165\u7ed3\u6784\u4f53"},"\u5d4c\u5165\u7ed3\u6784\u4f53"),(0,a.kt)("p",null,"\u5bf9\u4e8e\u533f\u540d\u5b57\u6bb5\uff0cGORM \u4f1a\u5c06\u5176\u5b57\u6bb5\u5305\u542b\u5728\u7236\u7ed3\u6784\u4f53\u4e2d\uff0c\u4f8b\u5982\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copytype User struct {\n  gorm.Model\n  Name string\n}\n// \u7b49\u6548\u4e8e\ntype User struct {\n  ID        uint           `gorm:"primaryKey"`\n  CreatedAt time.Time\n  UpdatedAt time.Time\n  DeletedAt gorm.DeletedAt `gorm:"index"`\n  Name string\n}\n')),(0,a.kt)("p",null,"\u5bf9\u4e8e\u6b63\u5e38\u7684\u7ed3\u6784\u4f53\u5b57\u6bb5\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6807\u7b7e ",(0,a.kt)("inlineCode",{parentName:"p"},"embedded")," \u5c06\u5176\u5d4c\u5165\uff0c\u4f8b\u5982\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copytype Author struct {\n    Name  string\n    Email string\n}\n\ntype Blog struct {\n  ID      int\n  Author  Author `gorm:"embedded"`\n  Upvotes int32\n}\n// \u7b49\u6548\u4e8e\ntype Blog struct {\n  ID    int64\n    Name  string\n    Email string\n  Upvotes  int32\n}\n')),(0,a.kt)("h4",{id:"crud\u64cd\u4f5c"},"CRUD\u64cd\u4f5c",(0,a.kt)("a",{parentName:"h4",href:"https://www.cnblogs.com/rickiyang/p/14517120.html#3942833062"},"#")),(0,a.kt)("h5",{id:"\u65b0\u589e\u76f8\u5173"},"\u65b0\u589e\u76f8\u5173"),(0,a.kt)("p",null,"\u5355\u884c\u63d2\u5165\uff0cgorm \u4f1a\u8fd4\u56de\u63d2\u5165\u4e4b\u540e\u7684\u4e3b\u952e\u4fe1\u606f\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copyfunc InsertOneUser(user model.User) (id int64, err error) {\n    tx := constants.GVA_DB.Create(&user)\n    if tx.Error != nil {\n        constants.GVA_LOG.Error("InsertOne err", zap.Any("err", tx.Error))\n        return 0, tx.Error\n    }\n    return user.Id, nil\n}\n')),(0,a.kt)("p",null,"\u6279\u91cf\u63d2\u5165\uff0c\u6279\u91cf\u63d2\u5165\u4e5f\u4f1a\u540c\u6b65\u8fd4\u56de\u63d2\u5165\u4e4b\u540e\u7684\u4e3b\u952e\u4fe1\u606f\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copyfunc BatchInsertUsers(users []model.User) (ids []int64, err error) {\n    tx := constants.GVA_DB.CreateInBatches(users, len(users))\n    if tx.Error != nil {\n        constants.GVA_LOG.Error("BatchInsert err", zap.Any("err", tx.Error))\n        return []int64{}, tx.Error\n    }\n    ids = []int64{}\n    for idx, user := range users {\n        ids[idx] = user.Id\n    }\n    return ids, nil\n}\n')),(0,a.kt)("p",null,"\u63d2\u5165\u51b2\u7a81\u64cd\u4f5c-Upsert\uff1a"),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u7684\u8868\u8bbe\u7f6e\u4e86\u552f\u4e00\u7d22\u5f15\u7684\u60c5\u51b5\u4e0b\uff0c\u63d2\u5165\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e3b\u952e\u51b2\u7a81\u7684\u60c5\u51b5\uff0cMySQL \u672c\u8eab\u662f\u63d0\u4f9b\u4e86\u76f8\u5173\u7684\u64cd\u4f5c\u547d\u4ee4 ",(0,a.kt)("em",{parentName:"p"},"ON DUPLICATE KEY UPDATE"),"\uff0c\u90a3\u4e48\u5bf9\u5e94\u5230 Gorm \u4e2d\u7684\u51fd\u6570\u662f Upsert\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// \u5728\u51b2\u7a81\u65f6\uff0c\u4ec0\u4e48\u90fd\u4e0d\u505a\nconstants.GVA_DB.Clauses(clause.OnConflict{DoNothing: true}).Create(&user)\n\n// \u5728`id`\u51b2\u7a81\u65f6\uff0c\u5c06\u5217\u66f4\u65b0\u4e3a\u9ed8\u8ba4\u503c\nconstants.GVA_DB.Clauses(clause.OnConflict{\n  Columns:   []clause.Column{{Name: "id"}},\n  DoUpdates: clause.Assignments(map[string]interface{}{"name": "","age":0, "sex": 1}),\n}).Create(&user)\n\n// \u5728`id`\u51b2\u7a81\u65f6\uff0c\u5c06\u5217\u66f4\u65b0\u4e3a\u65b0\u503c\nconstants.GVA_DB.Clauses(clause.OnConflict{\n  Columns:   []clause.Column{{Name: "id"}},\n  DoUpdates: clause.AssignmentColumns([]string{"name", "age", "sex", "phone"}),\n}).Create(&user)\n\n// \u5728\u51b2\u7a81\u65f6\uff0c\u66f4\u65b0\u9664\u4e3b\u952e\u4ee5\u5916\u7684\u6240\u6709\u5217\u5230\u65b0\u503c\u3002\nconstants.GVA_DB.Clauses(clause.OnConflict{UpdateAll: true,}).Create(&user)\n')),(0,a.kt)("h5",{id:"\u5220\u9664\u76f8\u5173"},"\u5220\u9664\u76f8\u5173"),(0,a.kt)("p",null,"\u6839\u636e\u4e3b\u952e\u5220\u9664\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy//\u6839\u636e id \u5220\u9664\u6570\u636e\nfunc DeleteUserById(id int64) (err error) {\n    user := model.User{Id: id}\n    err = constants.GVA_DB.Delete(&user).Error\n    if err != nil {\n        constants.GVA_LOG.Error("DeleteUserById err", zap.Any("err", err))\n        return err\n    }\n    return nil\n}\n')),(0,a.kt)("p",null,"\u6839\u636e\u6761\u4ef6\u5220\u9664\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copyconstants.GVA_DB.Where("sex = ?", 0).Delete(model.User{})\n')),(0,a.kt)("p",null,"\u6279\u91cf\u5220\u9664\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy//\u6839\u636e id \u6279\u91cf\u5220\u9664\u6570\u636e\nfunc BatchDeleteUserByIds(ids []int64) (err error) {\n    if ids == nil || len(ids) == 0 {\n        return\n    }\n    //\u5220\u9664\u65b9\u5f0f1\n    err = constants.GVA_DB.Where("id in ?", ids).Delete(model.User{}).Error\n    if err != nil {\n        constants.GVA_LOG.Error("DeleteUserById err", zap.Any("err", err))\n        return err\n    }\n\n    //\u5220\u9664\u65b9\u5f0f 2\n    //constants.GVA_DB.Delete(model.User{}, "id in ?", ids)\n\n    return nil\n}\n')),(0,a.kt)("p",null,"\u5bf9\u4e8e\u5168\u5c40\u5220\u9664\u7684\u963b\u6b62\u8bbe\u5b9a"),(0,a.kt)("p",null,"\u5982\u679c\u5728\u6ca1\u6709\u4efb\u4f55\u6761\u4ef6\u7684\u60c5\u51b5\u4e0b\u6267\u884c\u6279\u91cf\u5220\u9664\uff0cGORM \u4e0d\u4f1a\u6267\u884c\u8be5\u64cd\u4f5c\uff0c\u5e76\u8fd4\u56de ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrMissingWhereClause")," \u9519\u8bef\u3002\u5bf9\u6b64\uff0c\u4f60\u5fc5\u987b\u52a0\u4e00\u4e9b\u6761\u4ef6\uff0c\u6216\u8005\u4f7f\u7528\u539f\u751f SQL\uff0c\u6216\u8005\u542f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"AllowGlobalUpdate")," \u6a21\u5f0f\uff0c\u4f8b\u5982\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// DELETE FROM `user` WHERE 1=1\nconstants.GVA_DB.Where("1 = 1").Delete(&model.User{})\n\n//\u539f\u751fsql\u5220\u9664\nconstants.GVA_DB.Exec("DELETE FROM user")\n\n//\u8df3\u8fc7\u8bbe\u5b9a\nconstants.GVA_DB.Session(&gorm.Session{AllowGlobalUpdate: true}).Delete(&model.User{})\n')),(0,a.kt)("h5",{id:"\u66f4\u65b0\u64cd\u4f5c"},"\u66f4\u65b0\u64cd\u4f5c"),(0,a.kt)("p",null,"\u5168\u91cf\u66f4\u65b0 struct \u7684\u6240\u6709\u5b57\u6bb5\uff0c\u5305\u62ec\u96f6\u503c\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy//\u6839\u636eid\u66f4\u65b0\u6570\u636e\uff0c\u5168\u91cf\u5b57\u6bb5\u66f4\u65b0\uff0c\u5373\u4f7f\u5b57\u6bb5\u662f0\u503c\nfunc UpdateUserById(user model.User) (err error) {\n    err = constants.GVA_DB.Save(&user).Error\n    if err != nil {\n        constants.GVA_LOG.Error("UpdateUserById err", zap.Any("err", err))\n        return err\n    }\n    return nil\n}\n')),(0,a.kt)("p",null,"\u66f4\u65b0\u6307\u5b9a\u5217\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy//\u66f4\u65b0\u6307\u5b9a\u5217\n//update user set `columnName` = v where id = id;\nfunc UpdateSpecialColumn(id int64, columnName string, v interface{}) (err error) {\n    err = constants.GVA_DB.Model(&model.User{Id: id}).Update(columnName, v).Error\n    if err != nil {\n        constants.GVA_LOG.Error("UpdateSpecialColumn err", zap.Any("err", err))\n        return err\n    }\n    return nil\n}\n')),(0,a.kt)("p",null,"\u66f4\u65b0\u975e0\u503c\u7684\u5b57\u6bb5\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"Copy//\u66f4\u65b0- \u6839\u636e `struct` \u66f4\u65b0\u5c5e\u6027\uff0c\u53ea\u4f1a\u66f4\u65b0\u975e\u96f6\u503c\u7684\u5b57\u6bb5\n//update user set `columnName` = v where id = id;\n//\u5f53\u901a\u8fc7 struct \u66f4\u65b0\u65f6\uff0cGORM \u53ea\u4f1a\u66f4\u65b0\u975e\u96f6\u5b57\u6bb5\u3002 \u5982\u679c\u60a8\u60f3\u786e\u4fdd\u6307\u5b9a\u5b57\u6bb5\u88ab\u66f4\u65b0\uff0c\u4f60\u5e94\u8be5\u4f7f\u7528 Select \u66f4\u65b0\u9009\u5b9a\u5b57\u6bb5\uff0c\u6216\u4f7f\u7528 map \u6765\u5b8c\u6210\u66f4\u65b0\u64cd\u4f5c\nfunc UpdateSelective(user model.User) (effected int64, err error) {\n    tx := constants.GVA_DB.Model(&user).Updates(&model.User{\n        Id:    user.Id,\n        Name:  user.Name,\n        Age:   user.Age,\n        Sex:   user.Sex,\n        Phone: user.Phone,\n    })\n}\n")),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u60f3\u66f4\u65b00\u503c\u7684\u5b57\u6bb5\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528 Select \u51fd\u6570\u5148\u9009\u62e9\u6307\u5b9a\u7684\u5217\u540d\uff0c\u6216\u8005\u4f7f\u7528 map \u6765\u5b8c\u6210\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy//map \u65b9\u5f0f\u4f1a\u66f4\u65b00\u503c\u5b57\u6bb5\ntx = constants.GVA_DB.Model(&user).Updates(map[string]interface{}{\n  "Id":    user.Id,\n  "Name":  user.Name,\n  "Age":   user.Age,\n  "Sex":   user.Sex,\n  "Phone": user.Phone,\n})\n')),(0,a.kt)("p",null,"Select \u65b9\u5f0f\u6307\u5b9a\u5217\u540d\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy//Select \u65b9\u5f0f\u6307\u5b9a\u5217\u540d\ntx = constants.GVA_DB.Model(&user).Select("Name", "Age", "Phone").Updates(&model.User{\n  Id:    user.Id,\n  Name:  user.Name,\n  Age:   user.Age,\n  Sex:   user.Sex,\n  Phone: user.Phone,\n})\n')),(0,a.kt)("p",null,"Select \u9009\u5b9a\u6240\u6709\u5217\u540d\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// Select \u6240\u6709\u5b57\u6bb5\uff08\u67e5\u8be2\u5305\u62ec\u96f6\u503c\u5b57\u6bb5\u7684\u6240\u6709\u5b57\u6bb5\uff09\ntx = constants.GVA_DB.Model(&user).Select("*").Updates(&model.User{\n  Id:    user.Id,\n  Name:  user.Name,\n  Age:   user.Age,\n  Sex:   user.Sex,\n  Phone: user.Phone,\n})\n')),(0,a.kt)("p",null,"Select \u6392\u9664\u6307\u5b9a\u5217\u540d\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// Select \u9664 Phone \u5916\u7684\u6240\u6709\u5b57\u6bb5\uff08\u5305\u62ec\u96f6\u503c\u5b57\u6bb5\u7684\u6240\u6709\u5b57\u6bb5\uff09\ntx = constants.GVA_DB.Model(&user).Select("*").Omit("Phone").Updates(&model.User{\n  Id:    user.Id,\n  Name:  user.Name,\n  Age:   user.Age,\n  Sex:   user.Sex,\n  Phone: user.Phone,\n})\n')),(0,a.kt)("p",null,"\u6839\u636e\u6761\u4ef6\u6279\u91cf\u66f4\u65b0\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy//\u6839\u636e \u6761\u4ef6 \u6279\u91cf\u66f4\u65b0\nfunc BatchUpdateByIds(ids []int64, user model.User) (effected int64, err error) {\n  if ids == nil || len(ids) == 0 {\n    return\n  }\n  tx := constants.GVA_DB.Model(model.User{}).Where("id in ?", ids).Updates(&user)\n  if tx.Error != nil {\n    return 0, tx.Error\n  }\n  return tx.RowsAffected, nil\n}\n')),(0,a.kt)("h5",{id:"\u67e5\u8be2\u64cd\u4f5c"},"\u67e5\u8be2\u64cd\u4f5c"),(0,a.kt)("p",null,"\u67e5\u8be2\u662f\u91cd\u5934\u620f\u653e\u5728\u6700\u540e\u3002"),(0,a.kt)("p",null,"Gorm \u63d0\u4f9b\u7684\u4fbf\u6377\u67e5\u8be2\uff1a"),(0,a.kt)("p",null,"First:\u83b7\u53d6\u7b2c\u4e00\u6761\u8bb0\u5f55\uff08\u4e3b\u952e\u5347\u5e8f\uff09"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"Copy// SELECT * FROM user ORDER BY id LIMIT 1;\nconstants.GVA_DB.First(&user)\n")),(0,a.kt)("p",null,"\u83b7\u53d6\u4e00\u6761\u8bb0\u5f55\uff0c\u6ca1\u6709\u6307\u5b9a\u6392\u5e8f\u5b57\u6bb5\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"Copy// SELECT * FROM user LIMIT 1;\nconstants.GVA_DB.Take(&user)\n")),(0,a.kt)("p",null,"\u83b7\u53d6\u6700\u540e\u4e00\u6761\u8bb0\u5f55\uff08\u4e3b\u952e\u964d\u5e8f\uff09:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"Copy// SELECT * FROM user ORDER BY id DESC LIMIT 1;\nconstants.GVA_DB.Last(&user)\n")),(0,a.kt)("p",null,"\u4f7f\u7528\u4e3b\u952e\u7684\u65b9\u5f0f\u67e5\u8be2\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// SELECT * FROM user WHERE id = 10;\nconstants.GVA_DB.First(&user, 10)\n\n// SELECT * FROM user WHERE id = 10;\nconstants.GVA_DB.First(&user, "10")\n\n// SELECT * FROM user WHERE id IN (1,2,3);\nconstants.GVA_DB.Find(&user, []int{1,2,3})\n')),(0,a.kt)("p",null,"\u6761\u4ef6\u67e5\u8be2\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// \u83b7\u53d6\u7b2c\u4e00\u6761\u5339\u914d\u7684\u8bb0\u5f55\n// SELECT * FROM user WHERE name = \'xiaoming\' ORDER BY id LIMIT 1;\nconstants.GVA_DB.Where("name = ?", "xiaoming").First(&user)\n\n// \u83b7\u53d6\u5168\u90e8\u5339\u914d\u7684\u8bb0\u5f55\n// SELECT * FROM user WHERE name <> \'xiaoming\';\nconstants.GVA_DB.Where("name <> ?", "xiaoming").Find(&user)\n\n// IN\n// SELECT * FROM user WHERE name IN (\'xiaoming\',\'xiaohong\');\nconstants.GVA_DB.Where("name IN ?", []string{"xiaoming", "xiaohong"}).Find(&user)\n\n// LIKE\n// SELECT * FROM user WHERE name LIKE \'%ming%\';\nconstants.GVA_DB.Where("name LIKE ?", "%ming%").Find(&user)\n\n// AND\n// SELECT * FROM user WHERE name = \'xiaoming\' AND age >= 33;\nconstants.GVA_DB.Where("name = ? AND age >= ?", "xiaoming", 33).Find(&user)\n\n// Time\n// SELECT * FROM user WHERE updated_at > \'2021-03-10 15:44:23\';\nconstants.GVA_DB.Where("updated_at > ?", "2021-03-10 15:44:23").Find(&user)\n\n// BETWEEN\n// SELECT * FROM user WHERE created_at BETWEEN \'\'2021-03-07 15:44:23\' AND \'2021-03-10 15:44:23\';\nconstants.GVA_DB.Where("created_at BETWEEN ? AND ?", "2021-03-07 15:44:23", "2021-03-10 15:44:23").Find(&user)\n')),(0,a.kt)("p",null,"not \u6761\u4ef6\u64cd\u4f5c\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// SELECT * FROM user WHERE NOT name = "xiaoming" ORDER BY id LIMIT 1;\nconstants.GVA_DB.Not("name = ?", "xiaoming").First(&user)\n\n// Not In\n// SELECT * FROM user WHERE name NOT IN ("xiaoming", "xiaohong");\nconstants.GVA_DB.Not(map[string]interface{}{"name": []string{"xiaoming", "xiaohong"}}).Find(&user)\n\n// Struct\n// SELECT * FROM user WHERE name <> "xiaoming" AND age <> 20 ORDER BY id LIMIT 1;\nconstants.GVA_DB.Not(model.User{Name: "xiaoming", Age: 20}).First(&user)\n\n// \u4e0d\u5728\u4e3b\u952e\u5207\u7247\u4e2d\u7684\u8bb0\u5f55\n// SELECT * FROM user WHERE id NOT IN (1,2,3) ORDER BY id LIMIT 1;\nconstants.GVA_DB.Not([]int64{1,2,3}).First(&user)\n')),(0,a.kt)("p",null,"or \u64cd\u4f5c\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// SELECT * FROM user WHERE name = \'xiaoming\' OR name = \'xiaohong\';\nconstants.GVA_DB.Where("name = ?", "xiaoming").Or("name = ?", "xiaohong").Find(&user)\n\n// Struct\n// SELECT * FROM user WHERE name = \'xiaoming\' OR (name = \'xiaohong\' AND age = 20);\nconstants.GVA_DB.Where("name = \'xiaoming\'").Or(model.User{Name: "xiaohong", Age: 20}).Find(&user)\n\n// Map\n// SELECT * FROM user WHERE name = \'xiaoming\' OR (name = \'xiaohong\' AND age = 20);\nconstants.GVA_DB.Where("name = \'xiaoming\'").Or(map[string]interface{}{"name": "xiaohong", "age": 20}).Find(&user)\n')),(0,a.kt)("p",null,"\u67e5\u8be2\u8fd4\u56de\u6307\u5b9a\u5b57\u6bb5\uff1a"),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u53ea\u8981\u8981\u67e5\u8be2\u7279\u5b9a\u7684\u5b57\u6bb5\uff0c\u53ef\u4ee5\u4f7f\u7528 Select \u6765\u6307\u5b9a\u8fd4\u56de\u5b57\u6bb5\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// SELECT name, age FROM user;\nconstants.GVA_DB.Select("name", "age").Find(&user)\n\n// SELECT name, age FROM user;\nconstants.GVA_DB.Select([]string{"name", "age"}).Find(&user)\n\n// SELECT COALESCE(age,\'20\') FROM user;\nconstants.GVA_DB.Table("user").Select("COALESCE(age,?)", 20).Rows()\n')),(0,a.kt)("p",null,"\u6307\u5b9a\u6392\u5e8f\u65b9\u5f0f\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// SELECT * FROM users ORDER BY age desc, name;\nconstants.GVA_DB.Order("age desc, name").Find(&users)\n\n// \u591a\u4e2a order\n// SELECT * FROM users ORDER BY age desc, name;\nconstants.GVA_DB.Order("age desc").Order("name").Find(&users)\n\n// SELECT * FROM users ORDER BY FIELD(id,1,2,3)\nconstants.GVA_DB.Clauses(clause.OrderBy{\n  Expression: clause.Expr{SQL: "FIELD(id,?)", Vars: []interface{}{[]int{1, 2, 3}}, WithoutParentheses: true},\n}).Find(&model.User{})\n')),(0,a.kt)("p",null,"\u5206\u9875\u67e5\u8be2\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"Copy// SELECT * FROM user LIMIT 10;\nconstants.GVA_DB.Limit(10).Find(&user)\n\n// SELECT * FROM user OFFSET 10;\nconstants.GVA_DB.Offset(10).Find(&user)\n\n// SELECT * FROM user OFFSET 0 LIMIT 10;\nconstants.GVA_DB.Limit(10).Offset(0).Find(&user)\n")),(0,a.kt)("p",null,"\u5206\u7ec4\u67e5\u8be2-Group & Having\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy// SELECT name, sum(age) as total FROM `users` WHERE name LIKE "ming%" GROUP BY `name`\nconstants.GVA_DB.Model(&model.User{}).Select("name, sum(age) as total").Where("name LIKE ?", "group%").Group("name").First(&result)\n\n\n// SELECT name, sum(age) as total FROM `users` GROUP BY `name` HAVING name = "group"\nconstants.GVA_DB.Model(&model.User{}).Select("name, sum(age) as total").Group("name").Having("name = ?", "group").Find(&result)\n')),(0,a.kt)("p",null,"Distinct \u4f7f\u7528\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy//SELECT distinct(name, age) from user order by name, age desc\nconstants.GVA_DB.Distinct("name", "age").Order("name, age desc").Find(&user)\n')),(0,a.kt)("h4",{id:"\u4e8b\u52a1\u64cd\u4f5c"},"\u4e8b\u52a1\u64cd\u4f5c",(0,a.kt)("a",{parentName:"h4",href:"https://www.cnblogs.com/rickiyang/p/14517120.html#2315536209"},"#")),(0,a.kt)("p",null,"\u5982\u540c\u5728 MySQL \u4e2d\u64cd\u4f5c\u4e8b\u52a1\u4e00\u6837\uff0c\u4e8b\u52a1\u7684\u5f00\u59cb\u662f\u4ee5 Begin \u5f00\u59cb\uff0c\u4ee5 Commit \u7ed3\u675f\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'Copy//\u4e8b\u52a1\u6d4b\u8bd5\nfunc TestGormTx(user model.User) (err error) {\n    tx := constants.GVA_DB.Begin()\n    // \u6ce8\u610f\uff0c\u4e00\u65e6\u4f60\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c\u4f7f\u7528tx\u4f5c\u4e3a\u6570\u636e\u5e93\u53e5\u67c4\n    if err := tx.Create(&model.User{\n        Name:  "liliya",\n        Age:   13,\n        Sex:   0,\n        Phone: "15543212346",\n    }).Error; err != nil {\n        tx.Rollback()\n        return err\n    }\n    \n    if err := tx.Updates(&model.User{\n        Id:    user.Id,\n        Name:  user.Name,\n        Age:   user.Age,\n        Sex:   user.Sex,\n        Phone: user.Phone,\n    }).Error; err != nil {\n        tx.Rollback()\n        return err\n    }\n\n    tx.Commit()\n    return nil\n}\n')),(0,a.kt)("p",null,"\u4ee5\u4e0a\u5c31\u662f\u5173\u4e8e GORM \u4f7f\u7528\u76f8\u5173\u7684\u64cd\u4f5c\u8bf4\u660e\u4ee5\u53ca\u53ef\u80fd\u4f1a\u51fa\u73b0\u7684\u95ee\u9898\uff0c\u5173\u4e8e Gorm \u7684\u4f7f\u7528\u8fd8\u6709\u4e00\u4e9b\u9ad8\u7ea7\u7279\u6027\uff0c\u8fd9\u91cc\u5c31\u4e0d\u505a\u5168\u9762\u7684\u6f14\u793a\uff0c\u8fd8\u662f\u5148\u719f\u6089\u57fa\u672c api \u7684\u64cd\u4f5c\u7b49\u9700\u8981\u7528\u5230\u9ad8\u7ea7\u7279\u6027\u7684\u65f6\u5019\u518d\u53bb\u770b\u770b\u4e5f\u4e0d\u8fdf\u3002\u793a\u4f8b\u4ee3\u7801\u90fd\u5df2\u7ecf\u4e0a\u4f20\u5230 Github\uff0c\u5927\u5bb6\u53ef\u4ee5\u4e0b\u8f7d\u4e0b\u6765\u7ec3\u4e60\u4e00\u4e0b\u3002"))}u.isMDXComponent=!0}}]);