"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[8406],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>g});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=c(t),g=a,d=m["".concat(l,".").concat(g)]||m[g]||u[g]||s;return t?r.createElement(d,i(i({ref:n},p),{},{components:t})):r.createElement(d,i({ref:n},p))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,i=new Array(s);i[0]=m;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var c=2;c<s;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},880:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var r=t(87462),a=(t(67294),t(3905));const s={},i="https \u914d\u7f6e\u53ca\u4f18\u5316",o={unversionedId:"LinuxBasics/Web-Servers/Nginx/HTTPS  \u914d\u7f6e\u53ca\u4f18\u5316",id:"LinuxBasics/Web-Servers/Nginx/HTTPS  \u914d\u7f6e\u53ca\u4f18\u5316",title:"https \u914d\u7f6e\u53ca\u4f18\u5316",description:"NGX\u914d\u7f6eHTTPS",source:"@site/docs/LinuxBasics/Web-Servers/Nginx/HTTPS  \u914d\u7f6e\u53ca\u4f18\u5316.md",sourceDirName:"LinuxBasics/Web-Servers/Nginx",slug:"/LinuxBasics/Web-Servers/Nginx/HTTPS  \u914d\u7f6e\u53ca\u4f18\u5316",permalink:"/docs/LinuxBasics/Web-Servers/Nginx/HTTPS  \u914d\u7f6e\u53ca\u4f18\u5316",draft:!1,editUrl:"https://github.com/AGou-ops/myDocsv4/edit/main/docs/LinuxBasics/Web-Servers/Nginx/HTTPS  \u914d\u7f6e\u53ca\u4f18\u5316.md",tags:[],version:"current",frontMatter:{},sidebar:"linuxBasics",previous:{title:"rewrite\u53c2\u6570\u5904\u7406\u95ee\u9898",permalink:"/docs/LinuxBasics/Web-Servers/Nginx/Problems/rewrite\u53c2\u6570\u5904\u7406\u95ee\u9898"},next:{title:"Nginx+uWSGI\u90e8\u7f72Django\u9879\u76ee",permalink:"/docs/LinuxBasics/Web-Servers/Nginx/Nginx - uWSGI \u90e8\u7f72Django"}},l={},c=[{value:"NGX\u914d\u7f6eHTTPS",id:"ngx\u914d\u7f6ehttps",level:2},{value:"\u5355\u673a\u5feb\u901f\u751f\u6210\u6d4b\u8bd5",id:"\u5355\u673a\u5feb\u901f\u751f\u6210\u6d4b\u8bd5",level:3},{value:"easyrsa \u5feb\u901f\u751f\u6210",id:"easyrsa-\u5feb\u901f\u751f\u6210",level:3},{value:"nginx \u8d1f\u8f7d\u5747\u8861 https",id:"nginx-\u8d1f\u8f7d\u5747\u8861-https",level:2},{value:"\u4f18\u5316 HTTPS",id:"\u4f18\u5316-https",level:2},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}],p={toc:c};function u(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"https-\u914d\u7f6e\u53ca\u4f18\u5316"},"https \u914d\u7f6e\u53ca\u4f18\u5316"),(0,a.kt)("h2",{id:"ngx\u914d\u7f6ehttps"},"NGX\u914d\u7f6eHTTPS"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u9996\u5148\u68c0\u67e5\u5f53\u524dnginx\u662f\u5426\u5df2\u7ecf\u88c5\u8f7d",(0,a.kt)("inlineCode",{parentName:"li"},"http_ssl_module"),"\u6a21\u5757")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"[root@master ~]\\# nginx -V\nnginx version: nginx/1.16.1\nbuilt by gcc 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC) \nbuilt with OpenSSL 1.0.2k-fips  26 Jan 2017\nTLS SNI support enabled\nconfigure arguments: --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/lib/nginx/tmp/client_body --http-proxy-temp-path=/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi` --with-http_ssl_module` --with-http_v2_module ...\n")),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\u6bb5")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'    server {\n        listen       443 ssl http2 default_server;\n        listen       [::]:443 ssl http2 default_server;\n        server_name  _;\n        root         /usr/share/nginx/html/ssl;\n\n        ssl_certificate "/etc/pki/nginx/ngx.crt";       \n        ssl_certificate_key "/etc/pki/nginx/private/ngx.key";\n        ssl_session_cache shared:SSL:1m;\n        ssl_session_timeout  10m;\n        ssl_ciphers HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers on;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n    }\n')),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"\u521b\u5efa\u672c\u5730CA")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# CA\u670d\u52a1\u5668\u4e0a\n[root@ca-server ~]\\# cd /etc/pki/CA/\n[root@ca-server CA]\\# (umask 077;openssl genrsa -out private/cakey.pem 2048)\nGenerating RSA private key, 2048 bit long modulus\n..................................................+++\n..............+++\ne is 65537 (0x10001)\n[root@ca-server CA]\\# openssl req -new -x509 -key private/cakey.pem -out cacert.pem -days 365\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:CN\nState or Province Name (full name) []:Jinan\nLocality Name (eg, city) [Default City]:Jinan\nOrganization Name (eg, company) [Default Company Ltd]:agou\nOrganizational Unit Name (eg, section) []:agou\nCommon Name (eg, your name or your server's hostname) []:ca.agou-ops.com\nEmail Address []:\n[root@ca-server CA]\\# touch index.txt\n[root@ca-server CA]\\# echo 01 > serial\n\n# \u5728\u5ba2\u6237\u673a\u4e0a\n[root@master /]\\# cd /etc/pki/nginx/private/\n[root@master private]\\# (umask 077;openssl genrsa -out ngx.key 2048)    # \u751f\u6210\u79c1\u94a5\nGenerating RSA private key, 2048 bit long modulus\n...........................................................................................+++\n..................+++\ne is 65537 (0x10001)\n[root@master private]\\# openssl req -new -key ngx.key -out ngx.csr\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:CN\nState or Province Name (full name) []:Jinan\nLocality Name (eg, city) [Default City]:Jinan\nOrganization Name (eg, company) [Default Company Ltd]:agou\nOrganizational Unit Name (eg, section) []:agou\nCommon Name (eg, your name or your server's hostname) []:www.agou-ops.com\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n[root@master private]\\# scp ngx.csr root@172.16.1.135:/root     # \u53d1\u9001\u5230ca\u4e3b\u673a\u7b7e\u7f72\nngx.csr                                                                                          100% 1001   541.8KB/s   00:00    \n# \u5728CA\u4e3b\u673a\u4e0a\u7b7e\u7f72\n[root@ca-server ~]\\# openssl ca -in ngx.csr -out /etc/pki/CA/certs/ngx.crt -days 365\nUsing configuration from /etc/pki/tls/openssl.cnf\nCheck that the request matches the signature\nSignature ok\nCertificate Details:\n        Serial Number: 1 (0x1)\n        Validity\n            Not Before: Apr  4 12:36:18 2020 GMT\n            Not After : Apr  4 12:36:18 2021 GMT\n        Subject:\n            countryName               = CN\n            stateOrProvinceName       = Jinan\n            organizationName          = agou\n            organizationalUnitName    = agou\n            commonName                = www.agou-ops.com\n        X509v3 extensions:\n            X509v3 Basic Constraints: \n                CA:FALSE\n            Netscape Comment: \n                OpenSSL Generated Certificate\n            X509v3 Subject Key Identifier: \n                8B:23:27:C4:7C:B0:A3:71:72:00:88:1E:9D:8F:BA:B6:52:DC:30:3C\n            X509v3 Authority Key Identifier: \n                keyid:19:60:32:59:F6:8A:49:04:C9:A6:07:41:62:DF:7B:3A:3D:FC:83:86\n\nCertificate is to be certified until Apr  4 12:36:18 2021 GMT (365 days)\nSign the certificate? [y/n]:y\n\n1 out of 1 certificate requests certified, commit? [y/n]y\nWrite out database with 1 new entries\nData Base Updated\n[root@ca-server ~]\\# scp /etc/pki/CA/certs/ngx.crt root@172.16.1.134:/etc/pki/nginx/    # \u5c06\u751f\u6210\u7684crt\u53d1\u9001\u7ed9\u5ba2\u6237\u673a\nngx.crt                                                                                          100% 4450     2.3MB/s   00:00    \n")),(0,a.kt)("h3",{id:"\u5355\u673a\u5feb\u901f\u751f\u6210\u6d4b\u8bd5"},"\u5355\u673a\u5feb\u901f\u751f\u6210\u6d4b\u8bd5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# \u521b\u5efa\u5b58\u653essl\u8bc1\u4e66\u7684\u8def\u5f84\n[root@web03 ~]\\# mkdir -p /etc/nginx/ssl_key\n[root@web03 ~]\\# cd /etc/nginx/ssl_key\n\n[root@web03 ssl_key]\\# openssl genrsa -idea -out server.key 2048\n\n[root@web03 ssl_key]\\# openssl req -days 36500 -x509 \\\n-sha256 -nodes -newkey rsa:2048 -keyout server.key -out server.crt\n\n")),(0,a.kt)("h3",{id:"easyrsa-\u5feb\u901f\u751f\u6210"},"easyrsa \u5feb\u901f\u751f\u6210"),(0,a.kt)("p",null,"\u53c2\u8003\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://gist.github.com/marcopaganini/0823d31d43557f9711e21b43a3223fce"},"https://gist.github.com/marcopaganini/0823d31d43557f9711e21b43a3223fce")),(0,a.kt)("h2",{id:"nginx-\u8d1f\u8f7d\u5747\u8861-https"},"nginx \u8d1f\u8f7d\u5747\u8861 https"),(0,a.kt)("p",null,"\u5916\u7f51\u8fde\u63a5nginx\u4f7f\u7528 https\uff0c\u5185\u7f51nginx\u8d1f\u8f7d\u5747\u8861\u540e\u7aef\u670d\u52a1\u5668\u4f7f\u7528 http\u3002"),(0,a.kt)("p",null,"\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-nginx"},"# \u5728 nginx lb \u4e3b\u673a\u4e0b\n$ cat proxy_ssl.conf \nupstream website {\n        server 172.16.1.8:80;\n        server 172.16.1.9:80;\n}\n\nserver {\n        listen 443 ssl;\n        server_name example.com;\n        ssl_certificate   ssl_key/server.crt;\n        ssl_certificate_key  ssl_key/server.key;\n        location / {\n            proxy_pass http://website;\n            proxy_set_header Host $http_host;\n        }\n}\n\nserver {\n        listen 80;\n        server_name example.com;\n        return 302 https://$server_name$request_uri;\n}\n")),(0,a.kt)("h2",{id:"\u4f18\u5316-https"},"\u4f18\u5316 HTTPS"),(0,a.kt)("p",null,"\u53c2\u6570\u4f18\u5316\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-nginx"},"server {\n    listen 443 default_server;\n    server_name example.com;\n    ssl on;\n    root /var/www/wordpress;\n    index index.php index.html index.htm;\n    ssl_certificate   ssl/example.com.pem;\n    ssl_certificate_key  ssl/example.com.key;\n    \n    ssl_session_cache shared:SSL:10m; #\u5728 \u5efa\u7acb\u5b8cssl\u63e1\u624b\u540e\u5982\u679c\u65ad\u5f00\u8fde\u63a5\uff0c\u5728session_timeout\u65f6\u95f4\u5185\u518d\u6b21\u8fde\u63a5\uff0c\u662f\u4e0d\u9700\u8981\u518d\u6b21\u83b7\u53d6\u516c\u94a5\u5efa\u7acb\u63e1\u624b\u7684\uff0c\u53ef\u4ee5\u670d\u7528\u4e4b\u524d\u7684\u8fde\u63a5\n    ssl_session_timeout 1440m;  # ssl\u8fde\u63a5\u65ad\u5f00\u540e\u7684\u8d85\u65f6\u65f6\u95f4\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;  #\u914d \u7f6e\u52a0\u5bc6\u5957\u63a5\u534f\u8bae\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;  # \u4f7f\u7528TLS\u7248\u672c\u534f\u8bae\n    ssl_prefer_server_ciphers on;  # nginx\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e9b\u534f\u8bae\u4e0e\u6d4f\u89c8\u5668\u901a\u4fe1\n    \n    ...\n}\n")),(0,a.kt)("h2",{id:"\u53c2\u8003\u94fe\u63a5"},"\u53c2\u8003\u94fe\u63a5"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Ningx HTTPS \u5b9e\u8df5\uff1a",(0,a.kt)("a",{parentName:"li",href:"https://blog.driverzeng.com/zenglaoshi/2315.html"},"https://blog.driverzeng.com/zenglaoshi/2315.html"))))}u.isMDXComponent=!0}}]);