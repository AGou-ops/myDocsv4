"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[3871],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>k});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),m=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=m(e.components);return n.createElement(p.Provider,{value:t},e.children)},i={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=m(a),k=r,d=c["".concat(p,".").concat(k)]||c[k]||i[k]||s;return a?n.createElement(d,l(l({ref:t},u),{},{components:a})):n.createElement(d,l({ref:t},u))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,l=new Array(s);l[0]=c;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var m=2;m<s;m++)l[m]=a[m];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},40369:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>i,frontMatter:()=>s,metadata:()=>o,toc:()=>m});var n=a(87462),r=(a(67294),a(3905));const s={},l="Prometheus+Grafana\u5168\u65b9\u4f4d\u76d1\u63a7Kubernetes\u96c6\u7fa4",o={unversionedId:"CloudNative/k8s/Prometheus-Grafana\u5168\u65b9\u4f4d\u76d1\u63a7Kubernetes\u96c6\u7fa4",id:"CloudNative/k8s/Prometheus-Grafana\u5168\u65b9\u4f4d\u76d1\u63a7Kubernetes\u96c6\u7fa4",title:"Prometheus+Grafana\u5168\u65b9\u4f4d\u76d1\u63a7Kubernetes\u96c6\u7fa4",description:"\u6587\u7ae0\u76ee\u5f55",source:"@site/docs/CloudNative/k8s/Prometheus-Grafana\u5168\u65b9\u4f4d\u76d1\u63a7Kubernetes\u96c6\u7fa4.md",sourceDirName:"CloudNative/k8s",slug:"/CloudNative/k8s/Prometheus-Grafana\u5168\u65b9\u4f4d\u76d1\u63a7Kubernetes\u96c6\u7fa4",permalink:"/docs/CloudNative/k8s/Prometheus-Grafana\u5168\u65b9\u4f4d\u76d1\u63a7Kubernetes\u96c6\u7fa4",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CloudNative/k8s/Prometheus-Grafana\u5168\u65b9\u4f4d\u76d1\u63a7Kubernetes\u96c6\u7fa4.md",tags:[],version:"current",frontMatter:{},sidebar:"cloudNative",previous:{title:"Minikube Basic",permalink:"/docs/CloudNative/k8s/Minikube Basic"},next:{title:"kubectl\u8fdc\u7a0b\u8fde\u63a5k8s",permalink:"/docs/CloudNative/k8s/Remote access k8s"}},p={},m=[{value:"\u6587\u7ae0\u76ee\u5f55",id:"\u6587\u7ae0\u76ee\u5f55",level:3},{value:"1.k8s\u76d1\u63a7\u6307\u6807",id:"1k8s\u76d1\u63a7\u6307\u6807",level:2},{value:"2.k8s\u57fa\u7840\u73af\u5883\u51c6\u5907",id:"2k8s\u57fa\u7840\u73af\u5883\u51c6\u5907",level:2},{value:"2.1.\u73af\u5883\u51c6\u5907",id:"21\u73af\u5883\u51c6\u5907",level:3},{value:"2.2.\u90e8\u7f72nfs\u4f5c\u4e3aprometheus\u5b58\u50a8",id:"22\u90e8\u7f72nfs\u4f5c\u4e3aprometheus\u5b58\u50a8",level:3},{value:"2.3.\u83b7\u53d6prometheus yaml\u6587\u4ef6",id:"23\u83b7\u53d6prometheus-yaml\u6587\u4ef6",level:3},{value:"2.4.\u521b\u5efa\u547d\u540d\u7a7a\u95f4prometheus",id:"24\u521b\u5efa\u547d\u540d\u7a7a\u95f4prometheus",level:3},{value:"3.\u5728k8s\u4e2d\u90e8\u7f72prometheus",id:"3\u5728k8s\u4e2d\u90e8\u7f72prometheus",level:2},{value:"3.1.prometheus-yaml\u51c6\u5907",id:"31prometheus-yaml\u51c6\u5907",level:3},{value:"3.2.\u521b\u5efarbac\u8d44\u6e90",id:"32\u521b\u5efarbac\u8d44\u6e90",level:3},{value:"3.3.\u521b\u5efaconfigmap\u8d44\u6e90",id:"33\u521b\u5efaconfigmap\u8d44\u6e90",level:3},{value:"3.4.\u521b\u5efastatefulset\u8d44\u6e90",id:"34\u521b\u5efastatefulset\u8d44\u6e90",level:3},{value:"3.4.1.\u6539\u9020statefulst\u8d44\u6e90\u652f\u6301\u9759\u6001pv",id:"341\u6539\u9020statefulst\u8d44\u6e90\u652f\u6301\u9759\u6001pv",level:4},{value:"3.4.2.\u521b\u5efastatefulset\u8d44\u6e90",id:"342\u521b\u5efastatefulset\u8d44\u6e90",level:4},{value:"3.5.\u521b\u5efaservice\u8d44\u6e90",id:"35\u521b\u5efaservice\u8d44\u6e90",level:3},{value:"3.5.1.\u4fee\u6539service\u8d44\u6e90\u652f\u6301nodeport",id:"351\u4fee\u6539service\u8d44\u6e90\u652f\u6301nodeport",level:4},{value:"3.5.2.\u521b\u5efaservice\u8d44\u6e90",id:"352\u521b\u5efaservice\u8d44\u6e90",level:4},{value:"3.6.\u67e5\u770b\u521b\u5efa\u7684prometheus\u6240\u6709\u8d44\u6e90\u7c7b\u578b",id:"36\u67e5\u770b\u521b\u5efa\u7684prometheus\u6240\u6709\u8d44\u6e90\u7c7b\u578b",level:3},{value:"3.7.\u8bbf\u95eeprometheus",id:"37\u8bbf\u95eeprometheus",level:3},{value:"3.8.prometheus\u914d\u7f6e\u6587\u4ef6\u89e3\u91ca",id:"38prometheus\u914d\u7f6e\u6587\u4ef6\u89e3\u91ca",level:3},{value:"3.8.1.\u8fdb\u5165prometheus\u5bb9\u5668",id:"381\u8fdb\u5165prometheus\u5bb9\u5668",level:4},{value:"3.8.2.\u914d\u7f6e\u6587\u4ef6\u89e3\u91ca",id:"382\u914d\u7f6e\u6587\u4ef6\u89e3\u91ca",level:4},{value:"3.9.k8s metrics\u9875\u9762",id:"39k8s-metrics\u9875\u9762",level:3},{value:"4.\u5728k8s\u4e2d\u90e8\u7f72grafana",id:"4\u5728k8s\u4e2d\u90e8\u7f72grafana",level:2},{value:"4.1.\u7f16\u5199granfana-pv-pvc\u8d44\u6e90",id:"41\u7f16\u5199granfana-pv-pvc\u8d44\u6e90",level:3},{value:"4.2.\u7f16\u5199granfana-statefulset\u8d44\u6e90",id:"42\u7f16\u5199granfana-statefulset\u8d44\u6e90",level:3},{value:"4.3.\u7f16\u5199granfana-svc\u8d44\u6e90",id:"43\u7f16\u5199granfana-svc\u8d44\u6e90",level:3},{value:"4.4.k8s\u521b\u5efagrafana",id:"44k8s\u521b\u5efagrafana",level:3},{value:"4.5.\u67e5\u770b\u8d44\u6e90\u8fd0\u884c\u72b6\u6001",id:"45\u67e5\u770b\u8d44\u6e90\u8fd0\u884c\u72b6\u6001",level:3},{value:"4.6.\u767b\u9646grafana",id:"46\u767b\u9646grafana",level:3},{value:"4.7.\u5bfc\u5165k8s\u8d44\u6e90\u76d1\u63a7pod\u8d44\u6e90\u6a21\u677f",id:"47\u5bfc\u5165k8s\u8d44\u6e90\u76d1\u63a7pod\u8d44\u6e90\u6a21\u677f",level:3},{value:"4.8.\u89e3\u51b3\u6a21\u677f\u8868\u8fbe\u5f0f\u95ee\u9898\u65e0\u6cd5\u5c55\u73b0\u6240\u6709pod",id:"48\u89e3\u51b3\u6a21\u677f\u8868\u8fbe\u5f0f\u95ee\u9898\u65e0\u6cd5\u5c55\u73b0\u6240\u6709pod",level:3},{value:"4.8.1.\u95ee\u9898\u63cf\u8ff0",id:"481\u95ee\u9898\u63cf\u8ff0",level:4},{value:"4.8.2.\u95ee\u9898\u89e3\u51b3",id:"482\u95ee\u9898\u89e3\u51b3",level:4},{value:"5.\u76d1\u63a7k8s node\u8282\u70b9",id:"5\u76d1\u63a7k8s-node\u8282\u70b9",level:2},{value:"5.1.\u7f16\u5199\u4e00\u952e\u90e8\u7f72node_exporter\u811a\u672c",id:"51\u7f16\u5199\u4e00\u952e\u90e8\u7f72node_exporter\u811a\u672c",level:3},{value:"5.2.\u5bf9k8s\u7684node\u8fdb\u884c\u6267\u884cnode_exporter\u811a\u672c",id:"52\u5bf9k8s\u7684node\u8fdb\u884c\u6267\u884cnode_exporter\u811a\u672c",level:3},{value:"5.3.\u5728prometheus\u7684configmap\u8d44\u6e90\u4e2d\u589e\u52a0node\u8282\u70b9\u914d\u7f6e",id:"53\u5728prometheus\u7684configmap\u8d44\u6e90\u4e2d\u589e\u52a0node\u8282\u70b9\u914d\u7f6e",level:3},{value:"5.4.\u5bfc\u5165k8s node\u4e3b\u673a\u76d1\u63a7\u6a21\u677f",id:"54\u5bfc\u5165k8s-node\u4e3b\u673a\u76d1\u63a7\u6a21\u677f",level:3},{value:"6.k8s\u4f7f\u7528kube-state-metrics-\u76d1\u63a7\u8d44\u6e90\u72b6\u6001",id:"6k8s\u4f7f\u7528kube-state-metrics-\u76d1\u63a7\u8d44\u6e90\u72b6\u6001",level:2},{value:"6.1.\u521b\u5efarbac\u8d44\u6e90",id:"61\u521b\u5efarbac\u8d44\u6e90",level:3},{value:"6.2.\u521b\u5efadeployment\u8d44\u6e90",id:"62\u521b\u5efadeployment\u8d44\u6e90",level:3},{value:"6.3.\u521b\u5efaservice\u8d44\u6e90",id:"63\u521b\u5efaservice\u8d44\u6e90",level:3},{value:"6.4.\u8d44\u6e90\u51c6\u5907\u5c31\u7eea",id:"64\u8d44\u6e90\u51c6\u5907\u5c31\u7eea",level:3},{value:"6.5.\u5728prometheus\u67e5\u770b\u662f\u5426\u83b7\u53d6\u76d1\u63a7\u6307\u6807",id:"65\u5728prometheus\u67e5\u770b\u662f\u5426\u83b7\u53d6\u76d1\u63a7\u6307\u6807",level:3},{value:"6.6.\u5bfc\u5165k8s \u8d44\u6e90\u72b6\u6001\u6a21\u677f",id:"66\u5bfc\u5165k8s-\u8d44\u6e90\u72b6\u6001\u6a21\u677f",level:3},{value:"7.\u5728k8s\u4e2d\u90e8\u7f72alertmanager\u5b9e\u73b0\u544a\u8b66\u7cfb\u7edf",id:"7\u5728k8s\u4e2d\u90e8\u7f72alertmanager\u5b9e\u73b0\u544a\u8b66\u7cfb\u7edf",level:2},{value:"7.1.\u521b\u5efaalertmanager-pv-pvc\u8d44\u6e90",id:"71\u521b\u5efaalertmanager-pv-pvc\u8d44\u6e90",level:3},{value:"7.2.\u521b\u5efaalertmanager-cm\u8d44\u6e90\u589e\u52a0\u5fae\u4fe1\u544a\u8b66\u914d\u7f6e",id:"72\u521b\u5efaalertmanager-cm\u8d44\u6e90\u589e\u52a0\u5fae\u4fe1\u544a\u8b66\u914d\u7f6e",level:3},{value:"7.3.\u521b\u5efaalertmanager-deployment\u8d44\u6e90",id:"73\u521b\u5efaalertmanager-deployment\u8d44\u6e90",level:3},{value:"7.4.\u521b\u5efaalertmanager-service\u8d44\u6e90",id:"74\u521b\u5efaalertmanager-service\u8d44\u6e90",level:3},{value:"7.5\u67e5\u770balertmanager\u6240\u6709\u8d44\u6e90",id:"75\u67e5\u770balertmanager\u6240\u6709\u8d44\u6e90",level:3},{value:"7.6.\u8bbf\u95eealertmanager",id:"76\u8bbf\u95eealertmanager",level:3},{value:"8.\u914d\u7f6ealertmanager\u5b9e\u73b0k8s\u544a\u8b66\u7cfb\u7edf",id:"8\u914d\u7f6ealertmanager\u5b9e\u73b0k8s\u544a\u8b66\u7cfb\u7edf",level:2},{value:"8.1.\u5728NFS\u4e0a\u51c6\u5907\u4e24\u4e2a\u544a\u8b66\u89c4\u5219\u6587\u4ef6",id:"81\u5728nfs\u4e0a\u51c6\u5907\u4e24\u4e2a\u544a\u8b66\u89c4\u5219\u6587\u4ef6",level:3},{value:"8.2.\u7f16\u5199rules\u544a\u8b66\u89c4\u5219\u7684pv\u3001pvcyaml\u6587\u4ef6",id:"82\u7f16\u5199rules\u544a\u8b66\u89c4\u5219\u7684pvpvcyaml\u6587\u4ef6",level:3},{value:"8.3.\u4fee\u6539prometheus\u7684statefulset\u8d44\u6e90\u96c6\u6210rules",id:"83\u4fee\u6539prometheus\u7684statefulset\u8d44\u6e90\u96c6\u6210rules",level:3},{value:"8.4.\u66f4\u65b0prometheus-statefulset\u8d44\u6e90",id:"84\u66f4\u65b0prometheus-statefulset\u8d44\u6e90",level:3},{value:"8.5.\u4fee\u6539prometheus-configmap\u8d44\u6e90\u914d\u7f6ealertmanager\u5730\u5740",id:"85\u4fee\u6539prometheus-configmap\u8d44\u6e90\u914d\u7f6ealertmanager\u5730\u5740",level:3},{value:"8.5.\u67e5\u770b\u9875\u9762\u662f\u5426\u589e\u52a0\u544a\u8b66\u89c4\u5219",id:"85\u67e5\u770b\u9875\u9762\u662f\u5426\u589e\u52a0\u544a\u8b66\u89c4\u5219",level:3},{value:"8.6.\u6a21\u62dfnode\u4e3b\u673a\u5b95\u673a\u5e76\u67e5\u770b\u5fae\u4fe1\u544a\u8b66\u5185\u5bb9",id:"86\u6a21\u62dfnode\u4e3b\u673a\u5b95\u673a\u5e76\u67e5\u770b\u5fae\u4fe1\u544a\u8b66\u5185\u5bb9",level:3}],u={toc:m};function i(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"prometheusgrafana\u5168\u65b9\u4f4d\u76d1\u63a7kubernetes\u96c6\u7fa4"},"Prometheus+Grafana\u5168\u65b9\u4f4d\u76d1\u63a7Kubernetes\u96c6\u7fa4"),(0,r.kt)("h3",{id:"\u6587\u7ae0\u76ee\u5f55"},"\u6587\u7ae0\u76ee\u5f55"),(0,r.kt)("p",null,"[toc]"),(0,r.kt)("h2",{id:"1k8s\u76d1\u63a7\u6307\u6807"},"1.k8s\u76d1\u63a7\u6307\u6807"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"kubernetes\u672c\u8eab\u76d1\u63a7")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Node\u8d44\u6e90\u5229\u7528\u7387"),(0,r.kt)("li",{parentName:"ul"},"Node\u6570\u91cf"),(0,r.kt)("li",{parentName:"ul"},"Pods\u6570\u91cf"),(0,r.kt)("li",{parentName:"ul"},"\u8d44\u6e90\u5bf9\u8c61\u72b6\u6001")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Pod\u76d1\u63a7")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"pod\u6570\u91cf"),(0,r.kt)("li",{parentName:"ul"},"\u5bb9\u5668\u8d44\u6e90\u5229\u7528\u7387"),(0,r.kt)("li",{parentName:"ul"},"\u5e94\u7528\u7a0b\u5e8f")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5b9e\u73b0\u601d\u8def")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"pod\u6027\u80fd",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528cadvisor\u8fdb\u884c\u5b9e\u73b0\uff0c\u76d1\u63a7\u5bb9\u5668\u7684CPU\u3001\u5185\u5b58\u5229\u7528\u7387"))),(0,r.kt)("li",{parentName:"ul"},"Node\u6027\u80fd",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528node-exporter\u5b9e\u73b0\uff0c\u4e3b\u8981\u76d1\u63a7\u8282\u70b9CPU\u3001\u5185\u5b58\u5229\u7528\u7387"))),(0,r.kt)("li",{parentName:"ul"},"K8S\u8d44\u6e90\u5bf9\u8c61",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528kube-state-metrics\u5b9e\u73b0\uff0c\u4e3b\u8981\u7528\u4e8e\u76d1\u63a7pod\u3001deployment\u3001service")))),(0,r.kt)("p",null,"k8s\u670d\u52a1\u53d1\u73b0\u53c2\u8003\u6587\u6863\uff1a ",(0,r.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config"},"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config")),(0,r.kt)("p",null,"\u672c\u6587\u5c06\u4f1a\u5b9e\u73b0k8s\u5168\u65b9\u4f4d\u76d1\u63a7\uff0c\u5e76\u914d\u5408grafana\u5c55\u793ak8s\u8d44\u6e90\u5bf9\u8c61\u7684\u4f7f\u7528\u72b6\u6001\uff0c\u4ee5\u53ca\u914d\u5408alertmanager\u544a\u8b66"),(0,r.kt)("h2",{id:"2k8s\u57fa\u7840\u73af\u5883\u51c6\u5907"},"2.k8s\u57fa\u7840\u73af\u5883\u51c6\u5907"),(0,r.kt)("h3",{id:"21\u73af\u5883\u51c6\u5907"},"2.1.\u73af\u5883\u51c6\u5907"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"IP"),(0,r.kt)("th",{parentName:"tr",align:null},"\u89d2\u8272"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"192.168.16.106"),(0,r.kt)("td",{parentName:"tr",align:null},"k8s-master")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"192.168.16.104"),(0,r.kt)("td",{parentName:"tr",align:null},"k8s-node1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"192.168.16.107"),(0,r.kt)("td",{parentName:"tr",align:null},"k8s-node2")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"192.168.16.105"),(0,r.kt)("td",{parentName:"tr",align:null},"nfs")))),(0,r.kt)("h3",{id:"22\u90e8\u7f72nfs\u4f5c\u4e3aprometheus\u5b58\u50a8"},"2.2.\u90e8\u7f72nfs\u4f5c\u4e3aprometheus\u5b58\u50a8"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@nfs ~]\\# mkdir /data/prometheus\n\n[root@nfs ~]\\# yum -y install nfs-utils\n\n[root@nfs ~]\\# vim /etc/exports\n/data/prometheus   192.168.16.0/24(rw,sync,no_root_squash)\n\n[root@nfs ~]\\# systemctl restart nfs\n\n[root@nfs ~]\\# showmount -e\nExport list for nfs:\n/data/prometheus 192.168.16.0/24\n\n[root@nfs ~]\\# chomd -R 777 /data\n")),(0,r.kt)("h3",{id:"23\u83b7\u53d6prometheus-yaml\u6587\u4ef6"},"2.3.\u83b7\u53d6prometheus yaml\u6587\u4ef6"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5728\u8fd9\u91cc\u4e0b\u8f7d"),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/kubernetes/tree/release-1.16/cluster/addons/prometheus"},"https://github.com/kubernetes/kubernetes/tree/release-1.16/cluster/addons/prometheus")),(0,r.kt)("p",{parentName:"blockquote"},"\u76f4\u63a5\u514b\u9686\u5b8c\u6574\u76ee\u5f55\u4e5f\u53ef\u4ee5"),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/kubernetes.git"},"https://github.com/kubernetes/kubernetes.git")),(0,r.kt)("p",{parentName:"blockquote"},"\u26a0\ufe0f\u4fee\u6539\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://gitlab.com/AGou-ops/k8s_prometheus_yaml.git"},"https://gitlab.com/AGou-ops/k8s_prometheus_yaml.git")),(0,r.kt)("p",{parentName:"blockquote"},"prometheus\u5728github\u7684k8s\u76ee\u5f55\u4e2dmaster\u5206\u652f\u5df2\u7ecf\u627e\u4e0d\u5230\u4e86\uff0c\u53ef\u4ee5\u5728release-1.16\u8fd9\u91cc\u627e\u5230")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"1.\u62c9\u53d6prometheus yaml\u6587\u4ef6\n[root@k8s-master ~/k8s]\\# git clone https://github.com/kubernetes/kubernetes.git\n\n2.\u5c06prometheus yaml\u6587\u4ef6\u590d\u5236\u5230\u5176\u4ed6\u76ee\u5f55\n[root@k8s-master ~/k8s]\\# cp -rp kubernetes/cluster/addons/prometheus/ . \n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u672c\u4eba\u7684yaml\u6587\u4ef6")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106165528931.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5b98\u65b9yaml\u6587\u4ef6")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106165536705.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6587\u4ef6\u8bf4\u660e")),(0,r.kt)("p",null,"\u4e3b\u8981\u5206\u4e3a\u56db\u90e8\u5206\uff1aprometheus\u90e8\u7f72\u3001alertmanager\u90e8\u7f72\u3001kube-state-metrics\u90e8\u7f72\u3001node-exporter\u90e8\u7f72"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u6587\u4ef6\u540d"),(0,r.kt)("th",{parentName:"tr",align:null},"\u4f5c\u7528"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"alertmanager-configmap.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"alertmanager\u914d\u7f6e\u96c6\u5408\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"alertmanager-deployment.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"alertmanager\u521b\u5efapod\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"alertmanager-pvc.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"alertmanager\u6302\u8f7d\u5b58\u50a8\u5377\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"alertmanager-service.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"alertmanager\u5bf9\u5916\u66b4\u9732\u7aef\u53e3\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"grafana_pv_pvc.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"grafana\u6302\u8f7d\u5b58\u50a8\u5377\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"grafana_statefulset.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"grafana\u53d1\u5e03pod\u7684yaml\u6587\u4ef6\uff0c\u91c7\u7528statefulset\u8d44\u6e90")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"grafana_svc.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"grafana\u5bf9\u5916\u66b4\u9732\u7aef\u53e3\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"install_node_exportes.sh"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6279\u91cf\u5728node\u8282\u70b9\u5b89\u88c5node_exporter\u7684\u811a\u672c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"k8s_time.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"k8s\u540c\u6b65\u5bbf\u4e3b\u673a\u65f6\u95f4\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kube-state-metrics-deployment.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"k8s\u91c7\u96c6\u8d44\u6e90\u72b6\u6001\u6307\u6807\u7a0b\u5e8f\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kube-state-metrics-rbac.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"8s\u91c7\u96c6\u7a0b\u5e8f\u6388\u6743\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kube-state-metrics-service.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"k8s\u91c7\u96c6\u7a0b\u5e8f\u5bf9\u5916\u66b4\u9732\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node-exporter-ds.yml"),(0,r.kt)("td",{parentName:"tr",align:null},"node_exporter\u90e8\u7f72\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node-exporter-service.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"node_exporter\u5bf9\u5916\u66b4\u9732\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"prometheus-configmap.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"prometheus\u7684\u914d\u7f6e\u6587\u4ef6\u96c6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"prometheus-pv-pvc.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"prometheus\u6302\u8f7d\u5b58\u50a8\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"prometheus-rbac.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"prometheus\u6388\u6743\u8bbf\u95eeapi\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"prometheus-rules-pvc.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"prometheus\u544a\u8b66\u89c4\u5219\u5b58\u50a8\u5377\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"prometheus-rules.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"prometheus\u5c06rule\u505a\u6210cm\u8d44\u6e90\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"prometheus-service.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"prometheus\u5bf9\u5916\u63d0\u4f9b\u8bbf\u95ee\u7684yaml\u6587\u4ef6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"prometheus-statefulset-static-pv.yaml"),(0,r.kt)("td",{parentName:"tr",align:null},"prometheus\u7a0b\u5e8f\u90e8\u7f72\u7684yaml\u6587\u4ef6")))),(0,r.kt)("h3",{id:"24\u521b\u5efa\u547d\u540d\u7a7a\u95f4prometheus"},"2.4.\u521b\u5efa\u547d\u540d\u7a7a\u95f4prometheus"),(0,r.kt)("p",null,"\u521b\u5efa\u4e00\u4e2ans\u4e3aprometheus\uff0c\u5c06\u9664\u4e86kube-state-metrics\u5916\u7684yaml\u4e2d\u7684namespace\u4fee\u6539\u4e3aprometheus"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"1.\u521b\u5efans\n[root@k8s-master ~/k8s/prometheus]\\# kubectl create namespace prometheus\nnamespace/prometheus created\n\n2.\u4fee\u6539\n\u7528vim\u6253\u5f00\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\n:%s/namespace: kube-system/namespace: prometheus/g\n")),(0,r.kt)("h2",{id:"3\u5728k8s\u4e2d\u90e8\u7f72prometheus"},"3.\u5728k8s\u4e2d\u90e8\u7f72prometheus"),(0,r.kt)("h3",{id:"31prometheus-yaml\u51c6\u5907"},"3.1.prometheus-yaml\u51c6\u5907"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"\u4e3b\u8981\u7528\u5230\u4ee5\u4e0b\u51e0\u4e2ayaml\n[root@k8s-master ~/k8s/prometheus]\\# ls prometheus-*\nprometheus-configmap.yaml  prometheus-rbac.yaml  prometheus-service.yaml  prometheus-statefulset.yaml\n")),(0,r.kt)("p",null,"\u521b\u5efa\u987a\u5e8f"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5148\u521b\u5efaprometheus-rbac.yaml"),(0,r.kt)("p",{parentName:"blockquote"},"\u5728\u521b\u5efaprometheus-configmap.yaml"),(0,r.kt)("p",{parentName:"blockquote"},"\u5728\u521b\u5efaprometheus-statefulset.yaml"),(0,r.kt)("p",{parentName:"blockquote"},"\u6700\u540e\u521b\u5efaprometheus-service.yaml")),(0,r.kt)("h3",{id:"32\u521b\u5efarbac\u8d44\u6e90"},"3.2.\u521b\u5efarbac\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus]\\# kubectl create -f prometheus-rbac.yaml \nserviceaccount/prometheus created\nclusterrole.rbac.authorization.k8s.io/prometheus created\nclusterrolebinding.rbac.authorization.k8s.io/prometheus created\n")),(0,r.kt)("h3",{id:"33\u521b\u5efaconfigmap\u8d44\u6e90"},"3.3.\u521b\u5efaconfigmap\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus]\\# kubectl create -f prometheus-configmap.yaml \nconfigmap/prometheus-config created\n")),(0,r.kt)("h3",{id:"34\u521b\u5efastatefulset\u8d44\u6e90"},"3.4.\u521b\u5efastatefulset\u8d44\u6e90"),(0,r.kt)("p",null,"github\u4e0a\u7684statefulset\u8d44\u6e90\u4f7f\u7528\u7684\u662fstorageclasee\u52a8\u6001\u521b\u5efapv\uff0c\u7531\u4e8e\u4e0d\u4f1a\u4f7f\u7528storageclass\uff0c\u56e0\u6b64\u5c06statefulset\u8d44\u6e90\u8fdb\u884c\u6539\u9020\uff0c\u4f7f\u7528\u9759\u6001pv\u505a\u5b58\u50a8"),(0,r.kt)("h4",{id:"341\u6539\u9020statefulst\u8d44\u6e90\u652f\u6301\u9759\u6001pv"},"3.4.1.\u6539\u9020statefulst\u8d44\u6e90\u652f\u6301\u9759\u6001pv"),(0,r.kt)("p",null,"\u6539\u9020\u601d\u8def\uff1a\u5728yaml\u4e2d\u589e\u52a0pv\u3001pvc\u7684\u914d\u7f6e\uff0c\u5728\u5c06\u539f\u6765\u7684storageclass\u914d\u7f6e\u9879\u5220\u9664\uff0c\u5728120\u884c\u7684volume\u4e2d\u589e\u52a0pvc\u7684\u914d\u7f6e\u5373\u53ef"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'[root@k8s-master ~/k8s/prometheus]\\# vim prometheus-statefulset-static-pv.yaml \napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: prometheus-data\n  namespace: prometheus\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 16Gi\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-prometheus\nspec:\n  capacity:\n    storage: 16Gi\n  accessModes:\n    - ReadWriteOnce\n  nfs:\n    path: /data/prometheus/prometheus_data\n    server: 192.168.16.105\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: prometheus\n  namespace: kube-system\n  labels:\n    k8s-app: prometheus\n    kubernetes.io/cluster-service: "true"\n    addonmanager.kubernetes.io/mode: Reconcile\n    version: v2.2.1\nspec:\n  serviceName: "prometheus"\n  replicas: 1\n  podManagementPolicy: "Parallel"\n  updateStrategy:\n   type: "RollingUpdate"\n  selector:\n    matchLabels:\n      k8s-app: prometheus\n  template:\n    metadata:\n      labels:\n        k8s-app: prometheus\n    spec:\n      priorityClassName: system-cluster-critical\n      serviceAccountName: prometheus\n      initContainers:\n      - name: "init-chown-data"\n        image: "busybox:latest"\n        imagePullPolicy: "IfNotPresent"\n        command: ["chown", "-R", "65534:65534", "/data"]\n        volumeMounts:\n        - name: prometheus-data\n          mountPath: /data\n          subPath: ""\n      containers:\n        - name: prometheus-server-configmap-reload\n          image: "jimmidyson/configmap-reload:v0.1"\n          imagePullPolicy: "IfNotPresent"\n          args:\n            - --volume-dir=/etc/config\n            - --webhook-url=http://127.0.0.1:9090/-/reload\n          volumeMounts:\n            - name: config-volume\n              mountPath: /etc/config\n              readOnly: true\n          resources:\n            limits:\n              cpu: 10m\n              memory: 10Mi\n            requests:\n              cpu: 10m\n              memory: 10Mi\n\n        - name: prometheus-server\n          image: "prom/prometheus:v2.23.0"\n          imagePullPolicy: "IfNotPresent"\n          args:\n            - --config.file=/etc/config/prometheus.yml\n            - --storage.tsdb.path=/data\n            - --web.console.libraries=/etc/prometheus/console_libraries\n            - --web.console.templates=/etc/prometheus/consoles\n            - --web.enable-lifecycle\n          ports:\n            - containerPort: 9090\n          readinessProbe:\n            httpGet:\n              path: /-/ready\n              port: 9090\n            initialDelaySeconds: 30\n            timeoutSeconds: 30\n          livenessProbe:\n            httpGet:\n              path: /-/healthy\n              port: 9090\n            initialDelaySeconds: 30\n            timeoutSeconds: 30\n          # based on 10 running nodes with 30 pods each\n          resources:\n            limits:\n              cpu: 200m\n              memory: 1000Mi\n            requests:\n              cpu: 200m\n              memory: 1000Mi\n\n          volumeMounts:\n            - name: config-volume\n              mountPath: /etc/config\n            - name: prometheus-data\n              mountPath: /data\n              subPath: ""\n      terminationGracePeriodSeconds: 300\n      volumes:\n        - name: config-volume\n          configMap:\n            name: prometheus-config\n        - name: prometheus-data\n          persistentVolumeClaim:\n            claimName: prometheus-data\n')),(0,r.kt)("h4",{id:"342\u521b\u5efastatefulset\u8d44\u6e90"},"3.4.2.\u521b\u5efastatefulset\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus]\\# kubectl create -f  prometheus-statefulset-static-pv.yaml \npersistentvolumeclaim/prometheus-data created\npersistentvolume/pv-prometheus created\nstatefulset.apps/prometheus created\n")),(0,r.kt)("h3",{id:"35\u521b\u5efaservice\u8d44\u6e90"},"3.5.\u521b\u5efaservice\u8d44\u6e90"),(0,r.kt)("h4",{id:"351\u4fee\u6539service\u8d44\u6e90\u652f\u6301nodeport"},"3.5.1.\u4fee\u6539service\u8d44\u6e90\u652f\u6301nodeport"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'[root@k8s-master ~/k8s/prometheus]\\# vim prometheus-service.yaml \nkind: Service\napiVersion: v1\nmetadata:\n  name: prometheus\n  namespace: prometheus\n  labels:\n    kubernetes.io/name: "Prometheus"\n    kubernetes.io/cluster-service: "true"\n    addonmanager.kubernetes.io/mode: Reconcile\nspec:\n  type: NodePort\n  ports:\n    - name: http\n      port: 9090\n      protocol: TCP\n      targetPort: 9090\n  selector:\n    k8s-app: prometheus\n')),(0,r.kt)("h4",{id:"352\u521b\u5efaservice\u8d44\u6e90"},"3.5.2.\u521b\u5efaservice\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus]\\# kubectl create -f prometheus-service.yaml \nservice/prometheus created\n")),(0,r.kt)("h3",{id:"36\u67e5\u770b\u521b\u5efa\u7684prometheus\u6240\u6709\u8d44\u6e90\u7c7b\u578b"},"3.6.\u67e5\u770b\u521b\u5efa\u7684prometheus\u6240\u6709\u8d44\u6e90\u7c7b\u578b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus]\\# kubectl get pod,svc,pv,pvc -n prometheus -o wide\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106171837694.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,"\u4e3b\u8981\u8bbf\u95ee30387\u7aef\u53e3\u770b\u5230prometheus"),(0,r.kt)("h3",{id:"37\u8bbf\u95eeprometheus"},"3.7.\u8bbf\u95eeprometheus"),(0,r.kt)("p",null,"\u4f7f\u7528\u4efb\u610fnode\u8282\u70b9\u7684ip\u52a030387\u7aef\u53e3\u5373\u53ef\u8bbf\u95ee\uff1a",(0,r.kt)("a",{parentName:"p",href:"http://192.168.16.106:30387/"},"http://192.168.16.106:30387/")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106171846551.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,"\u67e5\u770b\u76d1\u63a7\u4e3b\u673a"),(0,r.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u6709\u5f88\u591a\u4e86\uff0c\u8fd9\u4e9b\u914d\u7f6e\u90fd\u662fconfigmap\u8d44\u6e90\u4e2d\u914d\u7f6e\u7684\n",(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106171854253.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"38prometheus\u914d\u7f6e\u6587\u4ef6\u89e3\u91ca"},"3.8.prometheus\u914d\u7f6e\u6587\u4ef6\u89e3\u91ca"),(0,r.kt)("h4",{id:"381\u8fdb\u5165prometheus\u5bb9\u5668"},"3.8.1.\u8fdb\u5165prometheus\u5bb9\u5668"),(0,r.kt)("p",null,"\u8bed\u6cd5\uff1akubectl exec -it pod\u540d \u8fdb\u5165\u7684\u73af\u5883 -c \u5bb9\u5668\u540d\u79f0 -n \u547d\u540d\u7a7a\u95f4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus]\\# kubectl exec -it prometheus-0 sh -c prometheus-server -n prometheus\n/prometheus $ \n")),(0,r.kt)("p",null,"\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e:/etc/config/prometheus.yml"),(0,r.kt)("p",null,"tsdb\u5b58\u50a8\u4f4d\u4e8e:/data"),(0,r.kt)("h4",{id:"382\u914d\u7f6e\u6587\u4ef6\u89e3\u91ca"},"3.8.2.\u914d\u7f6e\u6587\u4ef6\u89e3\u91ca"),(0,r.kt)("p",null,"/prometheus $ more /etc/config/prometheus.yml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"scrape_configs:\n- job_name: prometheus\n  static_configs:\n  - targets:\n    - localhost:9090\n    \n\u9759\u6001\u914d\u7f6e\uff0c\u5c06\u672c\u673a\u52a0\u5230\u4e86prometheus\u76d1\u63a7\uff0c\u8fd9\u4e2alocalhost\u5c31\u662f\u8fd0\u884cprometheus\u5bb9\u5668\u7684\u5730\u5740\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"kubernetes-apiservers\u81ea\u52a8\u53d1\u73b0")),(0,r.kt)("p",null,"\u5c06apiserver\u7684\u5730\u5740\u8fdb\u884c\u66b4\u9732\u5e76\u83b7\u53d6\u76d1\u63a7\u6307\u6807"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- job_name: kubernetes-apiservers\n  kubernetes_sd_configs:\n  - role: endpoints\n  relabel_configs:\n  - action: keep\n    regex: default;kubernetes;https\n    source_labels:\n    - __meta_kubernetes_namespace\n    - __meta_kubernetes_service_name\n    - __meta_kubernetes_endpoint_port_name\n  scheme: https\n  tls_config:\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n    insecure_skip_verify: true\n  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106171909965.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"k8s\u7684node\u8282\u70b9\u81ea\u52a8\u53d1\u73b0")),(0,r.kt)("p",null,"\u81ea\u52a8\u53d1\u73b0k8s\u4e2d\u7684\u6240\u6709node\u8282\u70b9\u5e76\u8fdb\u884c\u76d1\u63a7"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"- job_name: kubernetes-nodes-cadvisor\n  kubernetes_sd_configs:\n  - role: node\n  relabel_configs:\n  - action: labelmap\n    regex: __meta_kubernetes_node_label_(.+)\n  - target_label: __metrics_path__\n    replacement: /metrics/cadvisor\n  scheme: https\n  tls_config:\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n    insecure_skip_verify: true\n  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106171919584.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u53d1\u73b0endpoint\u7684\u8d44\u6e90")),(0,r.kt)("p",null,"\u4e3b\u8981\u662f\u53d1\u73b0endpoint\u8d44\u6e90\u7c7b\u578b\u7684pod\uff0c\u53ef\u4ee5\u901a\u8fc7kubectl get ep\u67e5\u770b\u8c01\u662fendpoint\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- job_name: kubernetes-service-endpoints\n  kubernetes_sd_configs:\n  - role: endpoints\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_scrape\n  - action: replace\n    regex: (https?)\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_scheme\n    target_label: __scheme__\n  - action: replace\n    regex: (.+)\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_path\n    target_label: __metrics_path__\n  - action: replace\n    regex: ([^:]+)(?::\\d+)?;(\\d+)\n    replacement: $1:$2\n    source_labels:\n    - __address__\n    - __meta_kubernetes_service_annotation_prometheus_io_port\n    target_label: __address__\n  - action: labelmap\n    regex: __meta_kubernetes_service_label_(.+)\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_service_name\n    target_label: kubernetes_name\n\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106171929948.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u53d1\u73b0services")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- job_name: kubernetes-services\n  kubernetes_sd_configs:\n  - role: service\n  metrics_path: /probe\n  params:\n    module:\n    - http_2xx\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_probe\n  - source_labels:\n    - __address__\n    target_label: __param_target\n  - replacement: blackbox\n    target_label: __address__\n  - source_labels:\n    - __param_target\n    target_label: instance\n  - action: labelmap\n    regex: __meta_kubernetes_service_label_(.+)\n  - source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - source_labels:\n    - __meta_kubernetes_service_name\n    target_label: kubernetes_name\n\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u53d1\u73b0pod")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"- job_name: kubernetes-pods\n  kubernetes_sd_configs:\n  - role: pod\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_pod_annotation_prometheus_io_scrape\n  - action: replace\n    regex: (.+)\n    source_labels:\n    - __meta_kubernetes_pod_annotation_prometheus_io_path\n    target_label: __metrics_path__\n  - action: replace\n    regex: ([^:]+)(?::\\d+)?;(\\d+)\n    replacement: $1:$2\n    source_labels:\n    - __address__\n    - __meta_kubernetes_pod_annotation_prometheus_io_port\n    target_label: __address__\n  - action: labelmap\n    regex: __meta_kubernetes_pod_label_(.+)\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_pod_name\n    target_label: kubernetes_pod_name\n\n")),(0,r.kt)("h3",{id:"39k8s-metrics\u9875\u9762"},"3.9.k8s metrics\u9875\u9762"),(0,r.kt)("p",null,"metrics\u9875\u9762\u8bbf\u95ee\u5982\u4e0b\u4e5f\u6ca1\u5173\u7cfb\uff0cmetrics\u8c8c\u4f3c\u53ea\u80fd\u96c6\u7fa4\u5185\u90e8\u8fdb\u884c\u8bbf\u95ee"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106171942988.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,"\u53ea\u8981\u80fd\u5728prometheus\u641c\u7d22\u5230container\u6570\u636e\u5c31\u53ef\u4ee5"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106171951255.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h2",{id:"4\u5728k8s\u4e2d\u90e8\u7f72grafana"},"4.\u5728k8s\u4e2d\u90e8\u7f72grafana"),(0,r.kt)("h3",{id:"41\u7f16\u5199granfana-pv-pvc\u8d44\u6e90"},"4.1.\u7f16\u5199granfana-pv-pvc\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"1.\u7f16\u5199\u8d44\u6e90\n[root@k8s-master ~/k8s/prometheus3]\\# vim grafana_pv_pvc.yaml \napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: grafana-ui-data\n  namespace: grafana-ui\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 3Gi\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-grafana-ui-data\n  namespace: grafana-ui\nspec:\n  capacity:\n    storage: 3Gi\n  accessModes:\n    - ReadWriteOnce\n  nfs:\n    path: /data/prometheus/grafana\n    server: 192.168.16.105\n    \n2.\u5728nfs\u4e0a\u521b\u5efa\u5bf9\u5e94\u7684\u6302\u8f7d\u70b9\n[root@nfs ~]\\# mkdir /data/prometheus/grafana\n")),(0,r.kt)("h3",{id:"42\u7f16\u5199granfana-statefulset\u8d44\u6e90"},"4.2.\u7f16\u5199granfana-statefulset\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'[root@k8s-master ~/k8s/prometheus3]\\# vim grafana_statefulset.yaml \napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: grafana-ui\n  namespace: grafana-ui\nspec:\n  serviceName: "grafana-ui"\n  replicas: 1\n  selector:\n    matchLabels:\n      app: grafana-ui\n  template:\n    metadata:\n      labels:\n        app: grafana-ui\n    spec:\n      containers:\n      - name: grafana-ui\n        image: grafana/grafana:6.6.2\n        imagePullPolicy: "IfNotPresent"\n        ports:\n          - containerPort: 3000\n            protocol: TCP\n        resources:\n          limits:\n            cpu: 100m\n            memory: 256Mi\n          requests:\n            cpu: 100m\n            memory: 256Mi\n        volumeMounts:\n          - name: grafana-ui-data\n            mountPath: /var/lib/grafana\n            subPath: ""\n      securityContext:\n        fsGroup: 472\n        runAsUser: 472\n      volumes:\n        - name: grafana-ui-data\n          persistentVolumeClaim:\n            claimName: grafana-ui-data\n')),(0,r.kt)("h3",{id:"43\u7f16\u5199granfana-svc\u8d44\u6e90"},"4.3.\u7f16\u5199granfana-svc\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# vim grafana_svc.yaml \napiVersion: v1\nkind: Service\nmetadata:\n  name: grafana-ui\n  namespace: grafana-ui\nspec:\n  type: NodePort\n  ports:\n    - name: http\n      port: 3000\n      protocol: TCP\n      targetPort: 3000\n  selector:\n    app: grafana-ui\n\n")),(0,r.kt)("h3",{id:"44k8s\u521b\u5efagrafana"},"4.4.k8s\u521b\u5efagrafana"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'[root@k8s-master ~/k8s/prometheus3]\\# kubectl create -f grafana_pv_pvc.yaml \npersistentvolumeclaim "grafana-ui-data" created\npersistentvolume "pv-grafana-ui-data" created\n[root@k8s-master ~/k8s/prometheus3]\\# kubectl create -f prometheus-statefulset-static-pv.yaml\npersistentvolumeclaim/prometheus-data created\npersistentvolume/pv-prometheus created\nstatefulset.apps/prometheus created\n[root@k8s-master ~/k8s/prometheus3]\\# kubectl create -f grafana_svc.yaml \nservice/grafana-ui created\n')),(0,r.kt)("h3",{id:"45\u67e5\u770b\u8d44\u6e90\u8fd0\u884c\u72b6\u6001"},"4.5.\u67e5\u770b\u8d44\u6e90\u8fd0\u884c\u72b6\u6001"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# kubectl get pv,pvc,pod,statefulset,svc -n grafana-ui\nNAME                                  CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS        CLAIM                         STORAGECLASS   REASON   AGE\npersistentvolume/pv-grafana-ui-data   3Gi        RWO            Retain           Terminating   grafana-ui/grafana-ui-data                            151m\npersistentvolume/pv-prometheus        16Gi       RWO            Retain           Bound         kube-system/prometheus-data                           47m\n\nNAME                                    STATUS        VOLUME               CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npersistentvolumeclaim/grafana-ui-data   Terminating   pv-grafana-ui-data   3Gi        RWO                           151m\n\nNAME               READY   STATUS    RESTARTS   AGE\npod/grafana-ui-0   1/1     Running   0          16m\n\nNAME                          READY   AGE\nstatefulset.apps/grafana-ui   1/1     16m\n\nNAME                 TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE\nservice/grafana-ui   NodePort   10.96.170.142   <none>        3000:32040/TCP   85m\n\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172010434.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"46\u767b\u9646grafana"},"4.6.\u767b\u9646grafana"),(0,r.kt)("p",null,"\u8bbf\u95ee\uff1a\u96c6\u7fa4\u4efb\u610fip\u548c32040\u7aef\u53e3\u5373\u53ef\u8bbf\u95ee"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172018940.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"47\u5bfc\u5165k8s\u8d44\u6e90\u76d1\u63a7pod\u8d44\u6e90\u6a21\u677f"},"4.7.\u5bfc\u5165k8s\u8d44\u6e90\u76d1\u63a7pod\u8d44\u6e90\u6a21\u677f"),(0,r.kt)("p",null,"\u63a8\u8350\u6a21\u677f\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u96c6\u7fa4\u8d44\u6e90\u76d1\u63a7\uff1a3119"),(0,r.kt)("li",{parentName:"ul"},"\u8d44\u6e90\u72b6\u6001\u76d1\u63a7\uff1a6417"),(0,r.kt)("li",{parentName:"ul"},"node\u76d1\u63a7\uff1a9276")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172028210.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,"\u5bfc\u5165\u6210\u529f"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172037255.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"48\u89e3\u51b3\u6a21\u677f\u8868\u8fbe\u5f0f\u95ee\u9898\u65e0\u6cd5\u5c55\u73b0\u6240\u6709pod"},"4.8.\u89e3\u51b3\u6a21\u677f\u8868\u8fbe\u5f0f\u95ee\u9898\u65e0\u6cd5\u5c55\u73b0\u6240\u6709pod"),(0,r.kt)("h4",{id:"481\u95ee\u9898\u63cf\u8ff0"},"4.8.1.\u95ee\u9898\u63cf\u8ff0"),(0,r.kt)("p",null,"\u6a21\u677f\u4e2d\u7684\u56fe\u5f62\u5173\u4e8epod\u548cdocker\u7684\u5168\u90e8\u6709\u95ee\u9898\uff0c\u4ec5\u5355\u5355\u663e\u793a\u4e00\u4e2apod"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172046186.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h4",{id:"482\u95ee\u9898\u89e3\u51b3"},"4.8.2.\u95ee\u9898\u89e3\u51b3"),(0,r.kt)("p",null,"\u4fee\u6539\u4ed6\u4eec\u7684\u8868\u8fbe\u5f0f\u5c31\u53ef\u4ee5\u4e86\uff0c\u5c06pod_name\u4fee\u6539\u4e3apod"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172056945.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,"\u4fee\u6539\u4e3a\u7acb\u9a6c\u663e\u793a\u51fa\u6240\u6709pod\uff0c\u6240\u6709\u5173\u4e8epod\u548cdocker\u7684\u90fd\u662f\u8fd9\u4e48\u6539"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172106157.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,"\u6700\u7ec8\u5c55\u793a\u6548\u679c"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172114765.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h2",{id:"5\u76d1\u63a7k8s-node\u8282\u70b9"},"5.\u76d1\u63a7k8s node\u8282\u70b9"),(0,r.kt)("p",null,"\u5bf9\u4e8enode\u8282\u70b9\u7684\u76d1\u63a7\u6211\u4eec\u4e0d\u7528\u90e8\u7f72\u5728k8s\u91cc\uff0c\u76f4\u63a5\u5728\u6bcf\u53f0node\u673a\u5668\u4e0a\u5b89\u88c5node_exporter\u5373\u53ef"),(0,r.kt)("h3",{id:"51\u7f16\u5199\u4e00\u952e\u90e8\u7f72node_exporter\u811a\u672c"},"5.1.\u7f16\u5199\u4e00\u952e\u90e8\u7f72node_exporter\u811a\u672c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'[root@k8s-master ~/k8s/prometheus3]\\# vim install_node_exportes.sh \n#!/bin/bash\n#\u6279\u91cf\u5b89\u88c5node_exporter\nsoft_dir=/root/soft\nif [ ! -e $soft_dir ];then\n        mkdir $soft_dir\nfi\n\nnetstat -lnpt | grep 9100\nif [ $? -eq 0 ];then\n        use=`netstat -lnpt | grep 9100 | awk -F/ \'{print $NF}\'`\n        echo "9100\u7aef\u53e3\u5df2\u7ecf\u88ab\u5360\u7528\uff0c\u5360\u7528\u8005\u662f $use"\n        exit 1\nfi\n\ncd $soft_dir\nwget http://192.168.16.106:888/prometheus/node_exporter-1.0.1.linux-amd64.tar.gz\ntar xf node_exporter-1.0.1.linux-amd64.tar.gz\nmv node_exporter-1.0.1.linux-amd64 /usr/local/node_exporter\n\ncat <<EOF >/usr/lib/systemd/system/node_exporter.service\n[Unit]\nDescription=https://prometheus.io\n\n[Service]\nRestart=on-failure\nExecStart=/usr/local/node_exporter/node_exporter --collector.systemd --collector.systemd.unit-whitelist=(docker|kubelet|node_exporter).service\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter\nsystemctl restart node_exporter\n\nnetstat -lnpt | grep 9100\n\nif [ $? -eq 0 ];then\n        ehoc "node_eporter install finish..."\nfi\n\n')),(0,r.kt)("h3",{id:"52\u5bf9k8s\u7684node\u8fdb\u884c\u6267\u884cnode_exporter\u811a\u672c"},"5.2.\u5bf9k8s\u7684node\u8fdb\u884c\u6267\u884cnode_exporter\u811a\u672c"),(0,r.kt)("p",null,"\u5728\u8fd9\u91cc\u4e0b\u8f7d\u811a\u672c\u7528\u5c31\u884c\u4e86"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172136934.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-node1 ~]\\# wget http://192.168.16.106:888/install_node_exportes.sh\n\n[root@k8s-node1 ~]\\# sh install_node_exportes.sh \n\n[root@k8s-node1 ~]\\#  netstat -lnpt | grep 9100\ntcp6       0      0 :::9100                 :::*                    LISTEN      14906/node_exporter \n")),(0,r.kt)("h3",{id:"53\u5728prometheus\u7684configmap\u8d44\u6e90\u4e2d\u589e\u52a0node\u8282\u70b9\u914d\u7f6e"},"5.3.\u5728prometheus\u7684configmap\u8d44\u6e90\u4e2d\u589e\u52a0node\u8282\u70b9\u914d\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"[root@k8s-master ~/k8s/prometheus3]\\# vim prometheus-configmap.yaml \n    - job_name: k8s-node\n      static_configs:\n      - targets:\n        - 192.168.16.104:9100\n        - 192.168.16.107:9100\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172150508.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u66f4\u65b0\u914d\u7f6e")),(0,r.kt)("p",null,"\u66f4\u65b0\u5b8c\u914d\u7f6e\uff0cprometheus\u9875\u9762\u4f1a\u7acb\u9a6c\u663e\u793a\uff0c\u56e0\u6b64\u6bcf\u5f53configmap\u4e00\u4fee\u6539\uff0cprometheus\u5bb9\u5668\u5c31\u4f1a\u91cd\u8f7d"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# kubectl apply -f prometheus-configmap.yaml\nconfigmap/prometheus-config created\n")),(0,r.kt)("p",null,"\u6210\u529f\u6dfb\u52a0node\u76d1\u63a7"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172200609.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"54\u5bfc\u5165k8s-node\u4e3b\u673a\u76d1\u63a7\u6a21\u677f"},"5.4.\u5bfc\u5165k8s node\u4e3b\u673a\u76d1\u63a7\u6a21\u677f"),(0,r.kt)("p",null,"node\u76d1\u63a7\uff1a9276"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172210569.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u586b\u5199\u4fe1\u606f")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172219328.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"}),"\n",(0,r.kt)("strong",{parentName:"p"},"\u67e5\u770b\u56fe\u5f62"),"\n",(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172235454.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h2",{id:"6k8s\u4f7f\u7528kube-state-metrics-\u76d1\u63a7\u8d44\u6e90\u72b6\u6001"},"6.k8s\u4f7f\u7528kube-state-metrics-\u76d1\u63a7\u8d44\u6e90\u72b6\u6001"),(0,r.kt)("h3",{id:"61\u521b\u5efarbac\u8d44\u6e90"},"6.1.\u521b\u5efarbac\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# kubectl create kube-state-metrics-rbac.yaml \n")),(0,r.kt)("h3",{id:"62\u521b\u5efadeployment\u8d44\u6e90"},"6.2.\u521b\u5efadeployment\u8d44\u6e90"),(0,r.kt)("p",null,"deployment\u8d44\u6e90\u91cc\u9762\u7ed3\u5408\u4e86configmap\u8d44\u6e90"),(0,r.kt)("p",null,"\u9700\u8981\u628a\u955c\u50cf\u7684\u5730\u5740\u4fee\u6539\u6210lizhenliang/kube-state-metrics:v1.8.0\u3001lizhenliang/addon-resizer:1.8.6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# kubectl create -f kube-state-metrics-deployment.yaml \n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172259875.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"63\u521b\u5efaservice\u8d44\u6e90"},"6.3.\u521b\u5efaservice\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# kubectl create -f kube-state-metrics-service.yaml \n")),(0,r.kt)("h3",{id:"64\u8d44\u6e90\u51c6\u5907\u5c31\u7eea"},"6.4.\u8d44\u6e90\u51c6\u5907\u5c31\u7eea"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# kubectl get all -n kube-system | grep kube-state\n\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172316131.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"65\u5728prometheus\u67e5\u770b\u662f\u5426\u83b7\u53d6\u76d1\u63a7\u6307\u6807"},"6.5.\u5728prometheus\u67e5\u770b\u662f\u5426\u83b7\u53d6\u76d1\u63a7\u6307\u6807"),(0,r.kt)("p",null,"\u5b89\u88c5\u5b8ckube-state-metrics\u4e4b\u540e\uff0c\u76f4\u63a5\u5c31\u53ef\u4ee5\u5728prometheus\u4e0a\u67e5\u8be2\u76d1\u63a7\u6307\u6807\uff0c\u90fd\u662f\u4ee5kube\u5f00\u5934\u7684"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172326163.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"66\u5bfc\u5165k8s-\u8d44\u6e90\u72b6\u6001\u6a21\u677f"},"6.6.\u5bfc\u5165k8s \u8d44\u6e90\u72b6\u6001\u6a21\u677f"),(0,r.kt)("p",null,"\u8d44\u6e90\u72b6\u6001\u76d1\u63a7\uff1a6417"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/2021010617233747.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,"\u67e5\u770b\u56fe\u5f62\uff0c\u4e5f\u662f\u6709\u5f88\u591a\u76d1\u63a7\u4e0d\u5230"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172345276.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h2",{id:"7\u5728k8s\u4e2d\u90e8\u7f72alertmanager\u5b9e\u73b0\u544a\u8b66\u7cfb\u7edf"},"7.\u5728k8s\u4e2d\u90e8\u7f72alertmanager\u5b9e\u73b0\u544a\u8b66\u7cfb\u7edf"),(0,r.kt)("h3",{id:"71\u521b\u5efaalertmanager-pv-pvc\u8d44\u6e90"},"7.1.\u521b\u5efaalertmanager-pv-pvc\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u7f16\u5199yaml\n[root@k8s-master ~/k8s/prometheus3]\\# vim alertmanager-pvc.yaml \napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: alertmanager-data\n  namespace: alertmanager\n  labels:\n    kubernetes.io/cluster-service: "true"\n    addonmanager.kubernetes.io/mode: EnsureExists\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: "2Gi"\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-alertmanager-data\n  namespace: alertmanager\nspec:\n  capacity:\n    storage: 2Gi\n  accessModes:\n    - ReadWriteOnce\n  nfs:\n    path: /data/prometheus/alertmanager\n    server: 192.168.16.105\n\n2.\u521b\u5efa\n[root@k8s-master ~/k8s/prometheus3]\\# kubectl create -f alertmanager-pvc.yaml\npersistentvolumeclaim/alertmanager created\npersistentvolume/pv-alertmanager-data create\n')),(0,r.kt)("h3",{id:"72\u521b\u5efaalertmanager-cm\u8d44\u6e90\u589e\u52a0\u5fae\u4fe1\u544a\u8b66\u914d\u7f6e"},"7.2.\u521b\u5efaalertmanager-cm\u8d44\u6e90\u589e\u52a0\u5fae\u4fe1\u544a\u8b66\u914d\u7f6e"),(0,r.kt)("p",null,"\u589e\u52a0\u5fae\u4fe1\u62a5\u8b66"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"1.\u589e\u52a0\u5fae\u4fe1\u544a\u8b66\u914d\u7f6e\n[root@k8s-master ~/k8s/prometheus3]\\# vim alertmanager-configmap.yaml \napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: alertmanager-config\n  namespace: alertmanager\n  labels:\n    kubernetes.io/cluster-service: \"true\"\n    addonmanager.kubernetes.io/mode: EnsureExists\ndata:\n  alertmanager.yml: |\n    global:\n      resolve_timeout: 5m\n\n    receivers:\n    - name: 'wechat'\n      wechat_configs:\n        - corp_id: 'ww48f74fc8ed3a07ba'\n          to_party: '1'\n          agent_id: '1000003'\n          api_secret: 'j3ocaGJJM7KejlqzBIJ38b6D6t9QhqlIAh7k4fA1cT0'\n          send_resolved: true\n\n    route:\n      group_interval: 1m\n      group_wait: 10s\n      receiver: wechat\n      repeat_interval: 1m\n\n2.\u521b\u5efa\u8d44\u6e90\n[root@k8s-master ~/k8s/prometheus3]\\# kubectl create -f alertmanager-configmap.yaml \nconfigmap/alertmanager-config created\n")),(0,r.kt)("h3",{id:"73\u521b\u5efaalertmanager-deployment\u8d44\u6e90"},"7.3.\u521b\u5efaalertmanager-deployment\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# kubectl create -f alertmanager-deployment.yaml \ndeployment.apps/alertmanager created\n")),(0,r.kt)("h3",{id:"74\u521b\u5efaalertmanager-service\u8d44\u6e90"},"7.4.\u521b\u5efaalertmanager-service\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# kubectl create -f alertmanager-service.yaml\nservice/alertmanager created\n")),(0,r.kt)("h3",{id:"75\u67e5\u770balertmanager\u6240\u6709\u8d44\u6e90"},"7.5\u67e5\u770balertmanager\u6240\u6709\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# kubectl get all,pv,pvc,cm -n alertmanager\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172401946.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"76\u8bbf\u95eealertmanager"},"7.6.\u8bbf\u95eealertmanager"),(0,r.kt)("p",null,"\u4efb\u610fnode\u8282\u70b9+31831\u7aef\u53e3\u5373\u53ef"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172410897.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,"\u914d\u7f6e\u6587\u4ef6\u5df2\u7ecf\u652f\u6301\u5fae\u4fe1\u62a5\u8b66"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172419513.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h2",{id:"8\u914d\u7f6ealertmanager\u5b9e\u73b0k8s\u544a\u8b66\u7cfb\u7edf"},"8.\u914d\u7f6ealertmanager\u5b9e\u73b0k8s\u544a\u8b66\u7cfb\u7edf"),(0,r.kt)("h3",{id:"81\u5728nfs\u4e0a\u51c6\u5907\u4e24\u4e2a\u544a\u8b66\u89c4\u5219\u6587\u4ef6"},"8.1.\u5728NFS\u4e0a\u51c6\u5907\u4e24\u4e2a\u544a\u8b66\u89c4\u5219\u6587\u4ef6"),(0,r.kt)("p",null,"\u6211\u4eec\u5bf9\u4e8e\u544a\u8b66\u89c4\u5219\u6587\u4ef6\u4e0d\u91c7\u7528configmap\u7684\u65b9\u5f0f\u800c\u662f\u91c7\u7528pv\u3001pvc\u7684\u65b9\u5f0f\u628a\u544a\u8b66\u89c4\u5219\u6302\u8f7d\u5230\u5bb9\u5668\u91cc"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u5728nfs\u4e0a\u521b\u5efapv\u5b58\u50a8\u8def\u5f84\n[root@nfs ~]\\# mkdir /data/prometheus/rules\n[root@nfs ~]\\# chmod -R 777 /data\n[root@nfs ~]\\# cd /data/prometheus/rules\n\n2.\u51c6\u5907\u4e3b\u673a\u5b95\u673a\u7684\u544a\u8b66\u89c4\u5219\u6587\u4ef6\n[root@nfs rules]\\# vim hostdown.yml \ngroups:\n- name: general.rules\n  rules:\n  - alert: \u4e3b\u673a\u5b95\u673a\n    expr: up == 0\n    for: 1m\n    labels:\n      serverity: error\n    annotations:\n      summary: "\u4e3b\u673a {{ $labels.instance }} \u505c\u6b62\u5de5\u4f5c"\n      description: "{{ $labels.instance }} job {{ $labels.job }} \u5df2\u7ecf\u5b95\u673a5\u5206\u949f\u4ee5\u4e0a!"\n      \n3.\u51c6\u5907\u4e3b\u673a\u57fa\u7840\u76d1\u63a7\u544a\u8b66\u89c4\u5219\u6587\u4ef6      \n[root@nfs rules]\\# vim node.yml \ngroups:\n- name: node.rules\n  rules:\n  - alert: NodeFilessystemUsage\n    expr: 100 - (node_filesystem_free_bytes{fstype=~"ext4|xfs",mountpoint="/"} / node_filesystem_size_bytes{fstype=~"ext4|xfs",mountpoint="/"} *100) > 80\n    for: 1m\n    labels:\n      serverity: warning\n    annotations:\n      summary: "\u4e3b\u673a {{ $labels.instance }} : {{ $labels.mountpoint }} \u78c1\u76d8\u4f7f\u7528\u7387\u8fc7\u9ad8"\n      description: "{{ $labels.instance }} : {{ $labels.mountpoint }} \u78c1\u76d8\u4f7f\u7528\u7387\u8d85\u8fc780% (\u5f53\u524d\u503c: {{ $value }}) "\n\n  - alert: NodeMemoryUsage\n    expr: 100 - ((node_memory_MemFree_bytes+node_memory_Cached_bytes+node_memory_Buffers_bytes) / node_memory_MemTotal_bytes * 100) > 80\n    for: 1m\n    labels:\n      serverity: warning\n    annotations:\n      summary: "\u4e3b\u673a {{ $labels.instance }} \u5185\u5b58\u4f7f\u7528\u7387\u8fc7\u9ad8"\n      description: "{{ $labels.instance }} \u5185\u5b58\u4f7f\u7528\u7387\u8d85\u8fc780% (\u5f53\u524d\u503c: {{ $value }}) "\n\n  - alert: NodeCpuUsage\n    expr: 100 - (avg(irate(node_cpu_seconds_total{mode=\'idle\'}[5m])) by (instance) *100) > 80\n    for: 1m\n    labels:\n      serverity: warning\n    annotations:\n      summary: "\u4e3b\u673a {{ $labels.instance }} CPU\u4f7f\u7528\u7387\u8fc7\u9ad8"\n      description: "{{ $labels.instance }} CPU\u4f7f\u7528\u7387\u8d85\u8fc780% (\u5f53\u524d\u503c: {{ $value }}) "\n')),(0,r.kt)("h3",{id:"82\u7f16\u5199rules\u544a\u8b66\u89c4\u5219\u7684pvpvcyaml\u6587\u4ef6"},"8.2.\u7f16\u5199rules\u544a\u8b66\u89c4\u5219\u7684pv\u3001pvcyaml\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u7f16\u5199\u8d44\u6e90\u6587\u4ef6\n[root@k8s-master ~/k8s/prometheus3]\\# vim prometheus-rules-pvc.yaml \napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: prometheus-rules\n  namespace: kube-system\n  labels:\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: "2Gi"\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-prometheus-rules\nspec:\n  capacity:\n    storage: 2Gi\n  accessModes:\n    - ReadWriteOnce\n  nfs:\n    path: /data/prometheus/rules\n    server: 192.168.16.105\n\n2.\u521b\u5efa\u8d44\u6e90\n[root@k8s-master ~/k8s/prometheus3]\\# kubectl create -f prometheus-rules-pvc.yaml\npersistentvolumeclaim/prometheus-rules created\npersistentvolume/pv-prometheus-rules created\n\n')),(0,r.kt)("h3",{id:"83\u4fee\u6539prometheus\u7684statefulset\u8d44\u6e90\u96c6\u6210rules"},"8.3.\u4fee\u6539prometheus\u7684statefulset\u8d44\u6e90\u96c6\u6210rules"),(0,r.kt)("p",null,"\u5728prometheus\u7684statefulset\u8d44\u6e90\u4e2d\u589e\u52a0rules\u7684pvc\u6302\u8f7d\u8def\u5f84"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'[root@k8s-master ~/k8s/prometheus3]\\# vim prometheus-statefulset-static-pv.yaml \n          volumeMounts:\n            - name: config-volume\n              mountPath: /etc/config\n            - name: prometheus-rules\n              mountPath: /etc/config/rules\n            - name: prometheus-data\n              mountPath: /data\n              subPath: ""\n      terminationGracePeriodSeconds: 300\n      volumes:\n        - name: config-volume\n          configMap:\n            name: prometheus-config\n        - name: prometheus-rules\n          persistentVolumeClaim:\n            claimName: prometheus-rules\n        - name: prometheus-data\n          persistentVolumeClaim:\n            claimName: prometheus-data\n\n')),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172451817.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"84\u66f4\u65b0prometheus-statefulset\u8d44\u6e90"},"8.4.\u66f4\u65b0prometheus-statefulset\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"[root@k8s-master ~/k8s/prometheus3]\\# kubectl apply -f prometheus-statefulset-static-pv.yaml \n")),(0,r.kt)("h3",{id:"85\u4fee\u6539prometheus-configmap\u8d44\u6e90\u914d\u7f6ealertmanager\u5730\u5740"},"8.5.\u4fee\u6539prometheus-configmap\u8d44\u6e90\u914d\u7f6ealertmanager\u5730\u5740"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"1.\u4fee\u6539\u914d\u7f6e\u589e\u52a0alertmanager\u5730\u5740\n[root@k8s-master ~/k8s/prometheus3]\\# vim prometheus-configmap.yaml \n    alerting:\n      alertmanagers:\n      - static_configs:\n        - targets:\n          - 192.168.16.106:31831\n\n2.\u66f4\u65b0\u8d44\u6e90\n[root@k8s-master ~/k8s/prometheus3]\\# kubectl apply -f prometheus-configmap.yaml\nconfigmap/prometheus-config configured      \n")),(0,r.kt)("h3",{id:"85\u67e5\u770b\u9875\u9762\u662f\u5426\u589e\u52a0\u544a\u8b66\u89c4\u5219"},"8.5.\u67e5\u770b\u9875\u9762\u662f\u5426\u589e\u52a0\u544a\u8b66\u89c4\u5219"),(0,r.kt)("p",null,"\u5df2\u7ecf\u6210\u529f\u586b\u52a0rules\u544a\u8b66\u89c4\u5219"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172502911.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("h3",{id:"86\u6a21\u62dfnode\u4e3b\u673a\u5b95\u673a\u5e76\u67e5\u770b\u5fae\u4fe1\u544a\u8b66\u5185\u5bb9"},"8.6.\u6a21\u62dfnode\u4e3b\u673a\u5b95\u673a\u5e76\u67e5\u770b\u5fae\u4fe1\u544a\u8b66\u5185\u5bb9"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6a21\u62df\u89e6\u53d1\u544a\u8b66")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"\u5c06\u4efb\u610f\u4e00\u4e2anode\u8282\u70b9\u7684node_exporter\u505c\u6389\u5373\u53ef\n[root@k8s-node1 ~]\\# systemctl stop node_exporter\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u544a\u8b66\u5df2\u7ecf\u4ea7\u751f")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172537744.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u544a\u8b66\u6d88\u606f\u5df2\u7ecf\u53d1\u9001")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172545238.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u67e5\u770b\u544a\u8b66\u5185\u5bb9")),(0,r.kt)("p",null,"\u5df2\u7ecf\u6210\u529f\u6536\u5230\u544a\u8b66\uff0ck8s\u76d1\u63a7\u7cfb\u5217\u7bc7\u5230\u6b64\u7ed3\u675f"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/20210106172554537.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u8be5\u6587\u7ae0\u4e3a\u8f6c\u8f7d\u5185\u5bb9\uff0c\u4ec5\u505a\u5907\u4efd\u79c1\u4eba\u5b66\u4e60\u4f7f\u7528\uff0c\u539f\u6587\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://jiangxl.blog.csdn.net/article/details/112283085"},"https://jiangxl.blog.csdn.net/article/details/112283085"))))}i.isMDXComponent=!0}}]);