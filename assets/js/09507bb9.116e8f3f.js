"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[5780],{3905:(e,n,a)=>{a.d(n,{Zo:()=>p,kt:()=>y});var t=a(67294);function s(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function l(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function r(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?l(Object(a),!0).forEach((function(n){s(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,s=function(e,n){if(null==e)return{};var a,t,s={},l=Object.keys(e);for(t=0;t<l.length;t++)a=l[t],n.indexOf(a)>=0||(s[a]=e[a]);return s}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)a=l[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var i=t.createContext({}),m=function(e){var n=t.useContext(i),a=n;return e&&(a="function"==typeof e?e(n):r(r({},n),e)),a},p=function(e){var n=m(e.components);return t.createElement(i.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var a=e.components,s=e.mdxType,l=e.originalType,i=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=m(a),y=s,k=u["".concat(i,".").concat(y)]||u[y]||c[y]||l;return a?t.createElement(k,r(r({ref:n},p),{},{components:a})):t.createElement(k,r({ref:n},p))}));function y(e,n){var a=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var l=a.length,r=new Array(l);r[0]=u;var o={};for(var i in n)hasOwnProperty.call(n,i)&&(o[i]=n[i]);o.originalType=e,o.mdxType="string"==typeof e?e:s,r[1]=o;for(var m=2;m<l;m++)r[m]=a[m];return t.createElement.apply(null,r)}return t.createElement.apply(null,a)}u.displayName="MDXCreateElement"},91166:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>m});var t=a(87462),s=(a(67294),a(3905));const l={},r="MySQL Cluster",o={unversionedId:"LinuxBasics/DataBases/MySQL/MySQL Cluster",id:"LinuxBasics/DataBases/MySQL/MySQL Cluster",title:"MySQL Cluster",description:"MySQL \u4e3b\u4ece\u590d\u5236\u539f\u7406",source:"@site/docs/LinuxBasics/DataBases/MySQL/MySQL Cluster.md",sourceDirName:"LinuxBasics/DataBases/MySQL",slug:"/LinuxBasics/DataBases/MySQL/MySQL Cluster",permalink:"/docs/LinuxBasics/DataBases/MySQL/MySQL Cluster",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/LinuxBasics/DataBases/MySQL/MySQL Cluster.md",tags:[],version:"current",frontMatter:{},sidebar:"linuxBasics",previous:{title:"MySQL BackUP & Client Tools",permalink:"/docs/LinuxBasics/DataBases/MySQL/MySQL BackUP - Client Tools"},next:{title:"MySQL \u914d\u7f6e\u6587\u4ef6my.cnf",permalink:"/docs/LinuxBasics/DataBases/MySQL/MySQL Configuration"}},i={},m=[{value:"MySQL \u4e3b\u4ece\u590d\u5236\u539f\u7406",id:"mysql-\u4e3b\u4ece\u590d\u5236\u539f\u7406",level:2},{value:"MySQL \u4e3b\u4ece\u540c\u6b65",id:"mysql-\u4e3b\u4ece\u540c\u6b65",level:2},{value:"\u5728 Master \u4e3b\u670d\u52a1\u4e0a",id:"\u5728-master-\u4e3b\u670d\u52a1\u4e0a",level:3},{value:"\u5728 Slave \u4ece\u670d\u52a1\u5668\u4e0a",id:"\u5728-slave-\u4ece\u670d\u52a1\u5668\u4e0a",level:3},{value:"\u6d4b\u8bd5\u540c\u6b65",id:"\u6d4b\u8bd5\u540c\u6b65",level:3},{value:"MySQL \u53cc\u4e3b\u540c\u6b65",id:"mysql-\u53cc\u4e3b\u540c\u6b65",level:2},{value:"\u57fa\u4e8e SSL \u52a0\u5bc6\u4f20\u8f93(\u4e3b\u4ece)",id:"\u57fa\u4e8e-ssl-\u52a0\u5bc6\u4f20\u8f93\u4e3b\u4ece",level:2},{value:"\u9884\u5148\u51c6\u5907",id:"\u9884\u5148\u51c6\u5907",level:3},{value:"\u914d\u7f6e\u4e3b\u4ece\u670d\u52a1\u7684 SSL \u529f\u80fd",id:"\u914d\u7f6e\u4e3b\u4ece\u670d\u52a1\u7684-ssl-\u529f\u80fd",level:3},{value:"\u914d\u7f6e CA \u548c\u9881\u53d1\u8bc1\u4e66",id:"\u914d\u7f6e-ca-\u548c\u9881\u53d1\u8bc1\u4e66",level:4},{value:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6",id:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6",level:4},{value:"\u57fa\u4e8e SSL \u52a0\u5bc6\u4f20\u8f93(\u53cc\u4e3b)",id:"\u57fa\u4e8e-ssl-\u52a0\u5bc6\u4f20\u8f93\u53cc\u4e3b",level:2}],p={toc:m};function c(e){let{components:n,...a}=e;return(0,s.kt)("wrapper",(0,t.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"mysql-cluster"},"MySQL Cluster"),(0,s.kt)("h2",{id:"mysql-\u4e3b\u4ece\u590d\u5236\u539f\u7406"},"MySQL \u4e3b\u4ece\u590d\u5236\u539f\u7406"),(0,s.kt)("p",null,"\u53c2\u8003\uff1a",(0,s.kt)("a",{parentName:"p",href:"https://zhuanlan.zhihu.com/p/96212530"},"https://zhuanlan.zhihu.com/p/96212530")),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/blog-images/mysql/mysql-1.jpg",alt:"\u539f\u7406"})),(0,s.kt)("h2",{id:"mysql-\u4e3b\u4ece\u540c\u6b65"},"MySQL \u4e3b\u4ece\u540c\u6b65"),(0,s.kt)("p",null,"\u73af\u5883(MySQL5.7)\uff1a"),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:null},"\u89d2\u8272"),(0,s.kt)("th",{parentName:"tr",align:null},"IP"))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"Master"),(0,s.kt)("td",{parentName:"tr",align:null},"172.16.1.128")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"Slave"),(0,s.kt)("td",{parentName:"tr",align:null},"172.16.1.136")))),(0,s.kt)("p",null,"\u5728\u9ed8\u8ba4\u5b89\u88c5\u7684",(0,s.kt)("inlineCode",{parentName:"p"},"test"),"\u6570\u636e\u5e93\u4e2d\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u8868\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mariadb root@172.16.1.128:test> SHOW CREATE TABLE test\\G\n***************************[ 1. row ]***************************\nTable        | test\nCreate Table | CREATE TABLE `test` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `name` varchar(32) NOT NULL COMMENT '\u59d3\u540d',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u6d4b\u8bd5\u8868'\n\n1 row in set\nTime: 0.004s\n")),(0,s.kt)("h3",{id:"\u5728-master-\u4e3b\u670d\u52a1\u4e0a"},"\u5728 Master \u4e3b\u670d\u52a1\u4e0a"),(0,s.kt)("p",null,"\u5728\u4e3b\u670d\u52a1\u5668\u4e0a\u4e3a\u4ece\u670d\u52a1\u5668\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\u5e10\u6237\uff0c\u5e76\u6388\u4e88",(0,s.kt)("inlineCode",{parentName:"p"},"REPLICATION SLAVE"),"\u6743\u9650\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> grant replication slave on *.* to 'backup'@'172.16.1.136' identified by '123';\nmysql> flush privileges;\n")),(0,s.kt)("p",null,"\u521b\u5efa\u597d\u7528\u6237\u4e4b\u540e\uff0c\u5728\u4ece\u670d\u52a1\u5668\u8fdb\u884c\u767b\u5f55\u6d4b\u8bd5\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"mysql -ubackup -p123 -h172.16.1.128\n")),(0,s.kt)("p",null,"\u4fee\u6539 mysql \u914d\u7f6e\u6587\u4ef6\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"/etc/my.cnf"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'# \u5728[mysqld]\u914d\u7f6e\u6bb5\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\nserver-id=1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# mysql\u4e3b\u4ece\u91cc\uff0cid\u5fc5\u987b\u552f\u4e00\uff0c\u8303\u56f4\uff1a1~255\nlog-bin=master-bin       # \u5176\u4e2d\u8fd9\u4e24\u884c\u662f\u672c\u6765\u5c31\u6709\u7684\uff0c\u53ef\u4ee5\u4e0d\u7528\u52a8\uff0c\u6dfb\u52a0\u4e0b\u9762\u4e24\u884c\u5373\u53ef.\u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\nbinlog_format="mixed"\nbinlog-do-db=test\u3000\u3000\u3000\u3000# \u8bb0\u5f55\u65e5\u5fd7\u7684\u6570\u636e\u5e93\nbinlog-ignore-db=mysql   # \u4e0d\u8bb0\u5f55\u65e5\u5fd7\u7684\u6570\u636e\u5e93\n')),(0,s.kt)("p",null,"\u4fee\u6539\u5b8c\u4fdd\u5b58\u9000\u51fa\uff0c\u7136\u540e\u91cd\u542f\u670d\u52a1\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"systemctl restart mariadb")),(0,s.kt)("p",null,"\u67e5\u770b\u4e3b\u670d\u52a1\u5668\u72b6\u6001\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> flush tables with read lock;\nmysql> show master status\\G\n*************************** 1. row ***************************\n            File: master-bin.000003\n        Position: 2007\n    Binlog_Do_DB: \nBinlog_Ignore_DB: \n1 row in set (0.00 sec)\n")),(0,s.kt)("p",null,"\u9501\u8868\uff0c\u4e3a\u4e86\u4ea7\u751f\u73af\u5883\u4e2d\u4e0d\u8ba9\u8fdb\u65b0\u7684\u6570\u636e\uff0c\u597d\u8ba9\u4ece\u670d\u52a1\u5668\u5b9a\u4f4d\u540c\u6b65\u4f4d\u7f6e\uff0c\u521d\u6b21\u540c\u6b65\u5b8c\u6210\u540e\uff0c\u8bb0\u5f97\u89e3\u9501\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> unlock tables;\n")),(0,s.kt)("h3",{id:"\u5728-slave-\u4ece\u670d\u52a1\u5668\u4e0a"},"\u5728 Slave \u4ece\u670d\u52a1\u5668\u4e0a"),(0,s.kt)("p",null,"\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6",(0,s.kt)("inlineCode",{parentName:"p"},"my.cnf"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5728[mysqld]\u914d\u7f6e\u6bb5\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\nserver-id=2\nlog-bin=master-bin\nreplicate-do-db=test\nreplicate-ignore-db=mysql,information_schema,performance_schema\n")),(0,s.kt)("p",null,"\u4fee\u6539\u5b8c\u4fdd\u5b58\u9000\u51fa\uff0c\u7136\u540e\u91cd\u542f\u670d\u52a1\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"systemctl restart mariadb")),(0,s.kt)("p",null,"\u4f7f\u7528",(0,s.kt)("inlineCode",{parentName:"p"},"change master"),"\u547d\u4ee4\u6307\u5b9a\u540c\u6b65\u4f4d\u7f6e\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> stop slave;\n# \u5982\u679c\u53d1\u751f\u9519\u8bef\uff0c\u9700\u8981\u4f7f\u7528 `reset slave;` \u6765\u8fdb\u884c\u91cd\u7f6e\nmysql> change master to master_host='172.16.1.128',master_user='backup',master_password='123', master_log_file='master-bin.000003',master_log_pos=2007;\n")),(0,s.kt)("p",null,"\u26a0\ufe0f\u6ce8\u610f\uff1a\u4e0a\u9762\u7684",(0,s.kt)("inlineCode",{parentName:"p"},"master_log_file"),"\u548c",(0,s.kt)("inlineCode",{parentName:"p"},"master_log_pos"),"\u503c\u8981\u4e0e Master \u4e3b\u673a\u4e00\u81f4\u3002"),(0,s.kt)("p",null,"\u67e5\u770b Slave \u72b6\u6001\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> show slave status\\G;\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: 172.16.1.128\n                  Master_User: backup\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: master-bin.000003\n          Read_Master_Log_Pos: 1024\n               Relay_Log_File: mariadb-relay-bin.000002\n                Relay_Log_Pos: 783\n        Relay_Master_Log_File: master-bin.000003\n             Slave_IO_Running: Yes      # \u5982\u679c\u770b\u5230\u8fd9\u4e00\u9879\u548c\u4e0b\u9762\u4e00\u9879\u5747\u4e3a Yes\uff0c\u5219\u8868\u660e\u4ece\u670d\u52a1\u5668\u914d\u7f6e\u5b8c\u6210\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB: test\n          Replicate_Ignore_DB: mysql,information_schema,performance_schema\n           Replicate_Do_Table: \n ...\n")),(0,s.kt)("h3",{id:"\u6d4b\u8bd5\u540c\u6b65"},"\u6d4b\u8bd5\u540c\u6b65"),(0,s.kt)("p",null,"\u5728 Master \u670d\u52a1\u5668\u4e2d\u5411\u4e4b\u524d\u521b\u5efa\u597d\u7684",(0,s.kt)("inlineCode",{parentName:"p"},"test"),"\u7a7a\u8868\u63d2\u5165\u6570\u636e\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> insert into test.test(id,name) value(2,'suofeiya');\n")),(0,s.kt)("p",null,"\u5728 Slave \u7aef\u8fdb\u884c\u67e5\u770b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> select *  from test.test;\n+----+-----------+\n| id | name      |\n+----+-----------+\n|  2 | suofeiya  |\n+----+-----------+\n")),(0,s.kt)("h2",{id:"mysql-\u53cc\u4e3b\u540c\u6b65"},"MySQL \u53cc\u4e3b\u540c\u6b65"),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:null},"\u89d2\u8272"),(0,s.kt)("th",{parentName:"tr",align:null},"IP"))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"Master/Slave(server1)"),(0,s.kt)("td",{parentName:"tr",align:null},"172.16.1.128")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"Slave/Master(server2)"),(0,s.kt)("td",{parentName:"tr",align:null},"172.16.1.136")))),(0,s.kt)("p",null,"\u540c\u65f6\u5728\u4e3b\u670d\u52a1\u5668\u4e0a\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\u7528\u6237\uff0c\u5e76\u6388\u4e88",(0,s.kt)("inlineCode",{parentName:"p"},"REPLIATION SLAVE"),"\u6743\u9650\uff0c\u8fd9\u91cc\u670d\u52a1\u56681\u548c\u670d\u52a1\u56682\u90fd\u4e92\u4e3a\u4e3b\u4ece\uff0c\u6240\u4ee5\u9700\u8981\u5206\u522b\u5efa\u7acb\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"# \u5728 server1 \u4e0a\nmysql> grant replication slave on *.* to 'backup'@'172.16.1.136' identified by '123';\nmysql> flush privileges;\n# \u5728 server2 \u4e0a\nmysql> grant replication slave on *.* to 'backup'@'172.16.1.128' identified by '123';\nmysql> flush privileges;\n")),(0,s.kt)("p",null,"\u53cc\u65b9\u6d4b\u8bd5\u8fde\u63a5\uff0c\u786e\u4fdd\u540c\u6b65\u80fd\u591f\u6b63\u5e38\u8fdb\u884c"),(0,s.kt)("p",null,"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6",(0,s.kt)("inlineCode",{parentName:"p"},"/etc/my.cnf"),"\u7684",(0,s.kt)("inlineCode",{parentName:"p"},"[mysqld]"),"\u914d\u7f6e\u6bb5(\u4ec5\u4f5c\u4e3a\u53c2\u8003)\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"# --------- server1 --------- \nserver-id=1\nlog-bin=mysql-bin \nbinlog-do-db=test\nbinlog-ignore-db=mysql\n# \u4e3b\uff0d\u4e3b\u5f62\u5f0f\u9700\u8981\u591a\u6dfb\u52a0\u7684\u90e8\u5206\nlog-slave-updates\nsync_binlog=1\nauto_increment_offset=1\nauto_increment_increment=2\nreplicate-do-db=test\nreplicate-ignore-db=mysql,information_schema\n\n#  --------- server2 ---------\nserver-id=2\nlog-bin=mysql-bin \nreplicate-do-db=test\nreplicate-ignore-db=mysql,information_schema,performance_schema\n# \u4e3b\uff0d\u4e3b\u5f62\u5f0f\u9700\u8981\u591a\u6dfb\u52a0\u7684\u90e8\u5206\nbinlog-do-db=test\nbinlog-ignore-db=mysql\nlog-slave-updates\nsync_binlog=1\nauto_increment_offset=2\nauto_increment_increment=2\n")),(0,s.kt)("p",null,"\u4fee\u6539\u5b8c\u4fdd\u5b58\u9000\u51fa\uff0c\u968f\u540e\u91cd\u542f server1 \u548cserver2 \u7684\u670d\u52a1\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"systemctl restart mariadb")),(0,s.kt)("p",null,"\u67e5\u770b server1 \u548c server2 \u4e24\u4e3b\u673a\u4f5c\u4e3a\u4e3b\u670d\u52a1\u5668\u7684\u72b6\u6001\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"-- server1\nmysql> show master status\\G\n*************************** 1. row ***************************\n            File: mysql-bin.000001\n        Position: 245\n    Binlog_Do_DB: test\nBinlog_Ignore_DB: mysql\n1 row in set (0.00 sec)\n\n-- server2\nmysql> show master status\\G\n*************************** 1. row ***************************\n            File: mysql-bin.000001\n        Position: 245\n    Binlog_Do_DB: test\nBinlog_Ignore_DB: mysql\n1 row in set (0.00 sec)\n")),(0,s.kt)("p",null,"\u5206\u522b\u5728\u4e24\u4e3b\u673a\u4e0a\u4f7f\u7528",(0,s.kt)("inlineCode",{parentName:"p"},"change master to"),"\u6307\u5b9a\u540c\u6b65\u4f4d\u7f6e\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"-- server1\nmysql> change master to master_host='172.16.1.136',master_user='backup',master_password='123', master_log_file='mysql-bin.000001',master_log_pos=245;\n-- server2\nmysql> change master to master_host='172.16.1.128',master_user='backup',master_password='123', master_log_file='mysql-bin.000001',master_log_pos=245;\n")),(0,s.kt)("p",null,"\u7136\u540e\uff0c\u5206\u522b\u5728\u4e24\u4e3b\u673a\u4e0a\u542f\u52a8\u4ece\u670d\u52a1\u5668\u7ebf\u7a0b\u5e76\u67e5\u770b\u5176\u72b6\u6001\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"-- server1\nmysql> start slave;\nmysql> show slave status\\G;\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: 172.16.1.136\n                  Master_User: backup\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: mysql-bin.000001\n          Read_Master_Log_Pos: 245\n               Relay_Log_File: mariadb-relay-bin.000002\n                Relay_Log_Pos: 529\n        Relay_Master_Log_File: mysql-bin.000001\n             Slave_IO_Running:` Yes`        # \u770b\u5230\u8fd9\u4e24\u4e2aYes\u5373\u8868\u793a\u6210\u529f\u542f\u52a8\n            Slave_SQL_Running:` Yes`\n              Replicate_Do_DB: test\n          Replicate_Ignore_DB: mysql,information_schema\n...\n-- server2\nmysql>start slave;\nmysql> show slave status\\G;\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: 172.16.1.128\n                  Master_User: backup\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: mysql-bin.000001\n          Read_Master_Log_Pos: 245\n               Relay_Log_File: mariadb-relay-bin.000002\n                Relay_Log_Pos: 529\n        Relay_Master_Log_File: mysql-bin.000001\n             Slave_IO_Running: `Yes`\n            Slave_SQL_Running: `Yes`\n              Replicate_Do_DB: test\n          Replicate_Ignore_DB: mysql,information_schema,performance_schema\n           Replicate_Do_Table: \n...\n")),(0,s.kt)("p",null,"\u6d4b\u8bd5\u53cc\u4e3b\u540c\u6b65\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u5728 server1 \u4e0a\u63d2\u5165\u4e00\u6761\u6570\u636e\uff0c\u770b server2 \u662f\u5426\u6210\u529f\u540c\u6b65\nmysql> insert into test.test(id,name) value(3,'agou-ops');\n-- \u5728 server2 \u4e0a\u8fdb\u884c\u67e5\u770b\nmysql> select * from test.test;\n+----+-----------+\n| id | name      |\n+----+-----------+\n|  2 | suofeiya  |\n`|  3 | agou-ops  | `\n+----+-----------+\n\n-- \u5728 server2 \u4e0a\u521b\u5efa\u4e00\u5f20\u6d4b\u8bd5\u6570\u636e\u8868xxx\uff0c\u770b server1 \u662f\u5426\u6210\u529f\u540c\u6b65\nmysql> create table test.xxx(id INT(10),name VARCHAR(25));\n-- \u5728 server1 \u4e0a\u8fdb\u884c\u67e5\u770b\nmysql> show tables;\n+----------------+\n| Tables_in_test |\n+----------------+\n| test           |\n| xxx            |\n+----------------+\n")),(0,s.kt)("p",null,"\u81f3\u6b64\uff0c\u53cc\u4e3b\u540c\u6b65\u5df2\u7ecf\u6210\u529f\u642d\u5efa\u3002"),(0,s.kt)("h2",{id:"\u57fa\u4e8e-ssl-\u52a0\u5bc6\u4f20\u8f93\u4e3b\u4ece"},"\u57fa\u4e8e SSL \u52a0\u5bc6\u4f20\u8f93(\u4e3b\u4ece)"),(0,s.kt)("p",null,"\u7531\u4e8e mysql \u5728\u590d\u5236\u8fc7\u7a0b\u4e2d\u662f\u660e\u6587\u7684\uff0c\u6240\u4ee5\u5c31\u5927\u5927\u964d\u4f4e\u4e86\u5b89\u5168\u6027\uff0c\u56e0\u6b64\u9700\u8981\u501f\u52a9\u4e8essl\u52a0\u5bc6\u6765\u589e\u52a0\u5176\u590d\u5236\u7684\u5b89\u5168\u6027\u3002"),(0,s.kt)("h3",{id:"\u9884\u5148\u51c6\u5907"},"\u9884\u5148\u51c6\u5907"),(0,s.kt)("p",null,"\u5728\u914d\u7f6e ssl \u524d\u6211\u4eec\u5148\u770b\u4e0b\u4e00\u4e0b ssl \u7684\u72b6\u6001\u4fe1\u606f\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> show variables like '%ssl%';\n+---------------+----------+\n| Variable_name | Value    |\n+---------------+----------+\n| have_openssl  | DISABLED |\n| have_ssl      | DISABLED |\n| ssl_ca        |          |\n| ssl_capath    |          |\n| ssl_cert      |          |\n| ssl_cipher    |          |\n| ssl_key       |          |\n+---------------+----------+\n7 rows in set (0.01 sec)\n")),(0,s.kt)("p",null,"\u53ef\u4ee5\u770b\u5230 SSL \u5904\u4e8e ",(0,s.kt)("inlineCode",{parentName:"p"},"DISABLED"),"\u72b6\u6001\uff0c\u8868\u793a\u672a\u5f00\u542f\u3002"),(0,s.kt)("p",null,"\u8981\u5f00\u542f SSL \u53ea\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6",(0,s.kt)("inlineCode",{parentName:"p"},"/etc/my.cnf"),"\u4e2d\u52a0\u5165 ssl \u5373\u53ef\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5728 [mysqld] \u914d\u7f6e\u6bb5\nssl\n")),(0,s.kt)("p",null,"\u968f\u540e\u4fdd\u5b58\u9000\u51fa\uff0c\u91cd\u542f\u670d\u52a1\u5373\u53ef\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"systemctl restart mariadb")),(0,s.kt)("p",null,"\u67e5\u770b\u786e\u8ba4\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> show variables like '%ssl%';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| have_openssl  | YES   |\n| have_ssl      | YES   |\n| ssl_ca        |       |\n| ssl_capath    |       |\n| ssl_cert      |       |\n| ssl_cipher    |       |\n| ssl_key       |       |\n+---------------+-------+\n7 rows in set (0.00 sec)\n")),(0,s.kt)("h3",{id:"\u914d\u7f6e\u4e3b\u4ece\u670d\u52a1\u7684-ssl-\u529f\u80fd"},"\u914d\u7f6e\u4e3b\u4ece\u670d\u52a1\u7684 SSL \u529f\u80fd"),(0,s.kt)("h4",{id:"\u914d\u7f6e-ca-\u548c\u9881\u53d1\u8bc1\u4e66"},"\u914d\u7f6e CA \u548c\u9881\u53d1\u8bc1\u4e66"),(0,s.kt)("p",null,"\u5728",(0,s.kt)("inlineCode",{parentName:"p"},"Master"),"\u4e3b\u673a\u4e0a\uff0c\u914d\u7f6e ",(0,s.kt)("inlineCode",{parentName:"p"},"CA"),"\u670d\u52a1\u5668\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"cd /etc/pki/CA\ntouch index.txt\necho 01 > serial\n(umask 077;openssl genrsa -out private/cakey.pem 1024)\nopenssl req -x509 -new -key private/cakey.pem -out cacert.pem -days 365\n")),(0,s.kt)("p",null,"\u4e3a",(0,s.kt)("inlineCode",{parentName:"p"},"Master"),"\u51c6\u5907\u79c1\u94a5\u5e76\u9881\u53d1\u8bc1\u4e66\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u521b\u5efa\u5b58\u653e\u8bc1\u4e66\u7684\u76ee\u5f55\nmkdir /usr/local/mysql/ssl -pv\ncd /usr/local/mysql/ssl\n\n# \u521b\u5efa\u6240\u9700\u8981\u7684\u8bc1\u4e66\n(umask 077;openssl genrsa 1024 > master.key)\nopenssl req -new -key master.key -out master.csr\nopenssl ca -in master.csr -out master.crt -days 365\ncp /etc/pki/CA/cacert.pem /usr/local/mysql/ssl\nchown -R mysql:mysql /usr/local/mysql/ssl\n")),(0,s.kt)("p",null,"\u5728",(0,s.kt)("inlineCode",{parentName:"p"},"Slave"),"\u4e3b\u673a\u4e0a\uff0c\u51c6\u5907\u79c1\u94a5\u5e76\u7533\u8bf7\u8bc1\u4e66\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u521b\u5efa\u5b58\u653e\u8bc1\u4e66\u7684\u76ee\u5f55\nmkdir /usr/local/mysql/ssl -pv\ncd /usr/local/mysql/ssl\n\n# \u521b\u5efa\u6240\u9700\u8981\u7684\u8bc1\u4e66\n(umask 077;openssl genrsa 1024 > slave.key)\nopenssl req -new -key slave.key -out slave.csr\n scp ./slave.csr 172.16.1.128:/root\n")),(0,s.kt)("p",null,"\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"Master"),"(\u4e3b\u670d\u52a1\u5668)\u4e0a\u4e3a Slave (\u4ece\u670d\u52a1\u5668)\u7b7e\u53d1\u8bc1\u4e66\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"openssl ca -in slave.csr -out slave.crt\nscp slave.crt /etc/pki/CA/cacert.pem 172.16.1.136:/usr/local/mysql/ssl\n")),(0,s.kt)("p",null,"\u5230\u6b64\u4e3a\u6b62\u8bc1\u4e66\u5df2\u7ecf\u51c6\u5907\u5b8c\u6210\uff0c\u8bf7\u786e\u4fdd",(0,s.kt)("inlineCode",{parentName:"p"},"Master"),"\u548c",(0,s.kt)("inlineCode",{parentName:"p"},"Slave"),"\u4e3b\u673a\u4e0a\u6709\u5982\u4e0b\u6587\u4ef6\uff0c\u5e76\u4e14\u5c5e\u4e3b\u548c\u5c5e\u7ec4\u4e3amysql\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# master \u4e3b\u673a\u4e0a\n[root@stor1 ssl]\\# ll\ntotal 16\n-rw-r--r-- 1 mysql mysql  960 May 12 00:05 cacert.pem\n-rw-r--r-- 1 mysql mysql 3065 May 12 00:05 master.crt\n-rw-r--r-- 1 mysql mysql  647 May 12 00:05 master.csr\n-rw------- 1 mysql mysql  887 May 12 00:04 master.key\n# slave \u4e3b\u673a\u4e0a\n[root@stor2 ssl]\\# ll\ntotal 12\n-rw-r--r-- 1 mysql mysql 960 May 12 00:10 cacert.pem\n-rw-r--r-- 1 mysql mysql   0 May 12 00:10 slave.crt\n-rw-r--r-- 1 mysql mysql 647 May 12 00:09 slave.csr\n-rw------- 1 mysql mysql 891 May 12 00:06 slave.key\n")),(0,s.kt)("h4",{id:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"),(0,s.kt)("p",null,"\u4fee\u6539",(0,s.kt)("inlineCode",{parentName:"p"},"Master"),"\u548c",(0,s.kt)("inlineCode",{parentName:"p"},"Slave"),"\u4e3b\u673a\u914d\u7f6e\u6587\u4ef6\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"# \u5728 [mysqld] \u6bb5\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\n# ------------ Master \u4e3b\u673a ------------\nserver-id=1\nlog-bin=mysql-bin\nbinlog-do-db=test\nbinlog-ignore-db=mysql\nrelay-log=mysql-relay\nauto-increment-increment=2\nauto-increment-offset=1\n\n\nssl\nssl-ca=/usr/local/mysql/ssl/cacert.pem\nssl-cert=/usr/local/mysql/ssl/master.crt\nssl-key=/usr/local/mysql/ssl/master.key\n\n# ------------ Slave \u4e3b\u673a ------------\nserver-id=2\nlog-bin=mysql-bin\nrelay-log=mysql-relay\nskip-slave-start=1\nssl\n")),(0,s.kt)("p",null,"\u5b8c\u6210\u540e\u4fdd\u5b58\u9000\u51fa\uff0c\u7136\u540e\u90fd\u91cd\u542f\u670d\u52a1\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"systemctl restart mariadb")),(0,s.kt)("p",null,"\u5728",(0,s.kt)("inlineCode",{parentName:"p"},"Master"),"\u4e3b\u673a\u8fdb\u884c\u67e5\u770b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> show variables like '%ssl%';\n+---------------+---------------------------------+\n| Variable_name | Value                           |\n+---------------+---------------------------------+\n| have_openssl  | YES                             |\n| have_ssl      | YES                             |\n| ssl_ca        | /usr/local/mysql/ssl/cacert.pem |\n| ssl_capath    |                                 |\n| ssl_cert      | /usr/local/mysql/ssl/master.crt |\n| ssl_cipher    |                                 |\n| ssl_key       | /usr/local/mysql/ssl/master.key |\n+---------------+---------------------------------+\n7 rows in set (0.01 sec)\n")),(0,s.kt)("p",null,"\u5728",(0,s.kt)("inlineCode",{parentName:"p"},"Master"),"\u4e3b\u673a\u4e0a\u521b\u5efa\u5177\u6709\u590d\u5236\u6743\u9650\u7684\u7528\u6237\u5e76\u6388\u6743\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u53c2\u8003\u4e0a\u9762\u7684\u4e3b\u4ece\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0\u3002"),(0,s.kt)("p",null,"\u67e5\u770b",(0,s.kt)("inlineCode",{parentName:"p"},"Master"),"\u4e3b\u673a\u72b6\u6001\u4fe1\u606f\u5e76\u8bb0\u5f55\u4e0b\u6765\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> show master status\\G\n*************************** 1. row ***************************\n            File: mysql-bin.000005\n        Position: 245\n    Binlog_Do_DB: test\nBinlog_Ignore_DB: mysql\n1 row in set (0.00 sec)\n")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u914d\u7f6e",(0,s.kt)("inlineCode",{parentName:"strong"},"Slave"),"\u7aef\uff1a")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> CHANGE MASTER TO MASTER_HOST='172.16.1.128',\nMASTER_USER='backup',\nMASTER_PASSWORD='123',\nMASTER_LOG_FILE='mysql-bin.000005',\nMASTER_LOG_POS=245,\nMASTER_SSL=1,\nMASTER_SSL_CA='/usr/local/mysql/ssl/cacert.pem',\nMASTER_SSL_CERT='/usr/local/mysql/ssl/slave.crt',\nMASTER_SSL_KEY='/usr/local/mysql/ssl/slave.key';\n")),(0,s.kt)("p",null,"\u26a0\ufe0f\u6ce8\u610f\uff1a\u5982\u679c\u4e4b\u524d\u5df2\u7ecf\u542f\u52a8\u8fc7",(0,s.kt)("inlineCode",{parentName:"p"},"slave"),"\u548c\u914d\u7f6e\u8fc7",(0,s.kt)("inlineCode",{parentName:"p"},"slave"),"\u9700\u8981\u5c06\u5176\u505c\u6389\uff0c\u5e76\u91cd\u7f6e\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> stop slave;\nQuery OK, 0 rows affected, 1 warning (0.00 sec)\n\nmysql> reset slave;\nQuery OK, 0 rows affected (0.03 sec)\n")),(0,s.kt)("p",null,"\u5728",(0,s.kt)("inlineCode",{parentName:"p"},"slave"),"\u5ba2\u6237\u7aef\u4f7f\u7528 SSL \u8fdb\u884c\u6d4b\u8bd5\u8fde\u63a5\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"[root@stor2 ssl]\\# mysql --ssl-ca=/usr/local/mysql/ssl/cacert.pem --ssl-cert=/usr/local/mysql/ssl/slave.crt --ssl-key=/usr/local/mysql/ssl/slave.key -ubackup -h172.16.1.128 -p123\n...\nmysql> \\s\n--------------\nmysql  Ver 15.1 Distrib 5.5.65-MariaDB, for Linux (x86_64) using readline 5.1\n\nConnection id:          5\nCurrent database:\nCurrent user:           backup@172.16.1.136\nSSL:                    Cipher in use is DHE-RSA-AES256-GCM-SHA384\nCurrent pager:          stdout\nUsing outfile:          ''\nUsing delimiter:        ;\nServer:                 MariaDB\nServer version:         5.5.65-MariaDB MariaDB Server\nProtocol version:       10\nConnection:             172.16.1.128 via TCP/IP\nServer characterset:    latin1\nDb     characterset:    latin1\nClient characterset:    utf8\nConn.  characterset:    utf8\nTCP port:               3306\nUptime:                 3 min 40 sec\n\nThreads: 2  Questions: 16  Slow queries: 0  Opens: 0  Flush tables: 2  Open tables: 26  Queries per second avg: 0.072\n--------------\n")),(0,s.kt)("p",null,"\u542f\u52a8",(0,s.kt)("inlineCode",{parentName:"p"},"slave"),"\u5e76\u67e5\u770b\u72b6\u6001\u4fe1\u606f\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> start slave;\nmysql> show slave status\\G\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: 172.16.1.128\n                  Master_User: backup\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: mysql-bin.000006\n          Read_Master_Log_Pos: 245\n               Relay_Log_File: mysql-relay.000003\n                Relay_Log_Pos: 529\n        Relay_Master_Log_File: mysql-bin.000006\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n...\n")),(0,s.kt)("p",null,"\u6d4b\u8bd5\u4e3b\u4ece\u540c\u6b65\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u5728 Master \u4e3b\u673a\u4e0a\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u8868yyy\nmysql> create table test.yyy(id INT(12),name VARCHAR(25));\n-- \u5728 Slave \u7aef\u8fdb\u884c\u67e5\u770b\nmysql> show tables;\n+----------------+\n| Tables_in_test |\n+----------------+\n| tb_mobile      |\n| test           |\n| xxx            |\n| `yyy`            |\n+----------------+\n4 rows in set (0.00 sec)\n")),(0,s.kt)("h2",{id:"\u57fa\u4e8e-ssl-\u52a0\u5bc6\u4f20\u8f93\u53cc\u4e3b"},"\u57fa\u4e8e SSL \u52a0\u5bc6\u4f20\u8f93(\u53cc\u4e3b)"),(0,s.kt)("p",null,"\u53c2\u8003","[\u57fa\u4e8e SSL \u52a0\u5bc6\u4f20\u8f93(\u4e3b\u4ece)]","(#\u57fa\u4e8e SSL \u52a0\u5bc6\u4f20\u8f93(\u4e3b\u4ece))"))}c.isMDXComponent=!0}}]);