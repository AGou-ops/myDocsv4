"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[3256],{3905:(e,n,a)=>{a.d(n,{Zo:()=>c,kt:()=>A});var t=a(67294);function s(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function l(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function r(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?l(Object(a),!0).forEach((function(n){s(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function E(e,n){if(null==e)return{};var a,t,s=function(e,n){if(null==e)return{};var a,t,s={},l=Object.keys(e);for(t=0;t<l.length;t++)a=l[t],n.indexOf(a)>=0||(s[a]=e[a]);return s}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)a=l[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var o=t.createContext({}),i=function(e){var n=t.useContext(o),a=n;return e&&(a="function"==typeof e?e(n):r(r({},n),e)),a},c=function(e){var n=i(e.components);return t.createElement(o.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var a=e.components,s=e.mdxType,l=e.originalType,o=e.parentName,c=E(e,["components","mdxType","originalType","parentName"]),p=i(a),A=s,T=p["".concat(o,".").concat(A)]||p[A]||m[A]||l;return a?t.createElement(T,r(r({ref:n},c),{},{components:a})):t.createElement(T,r({ref:n},c))}));function A(e,n){var a=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var l=a.length,r=new Array(l);r[0]=p;var E={};for(var o in n)hasOwnProperty.call(n,o)&&(E[o]=n[o]);E.originalType=e,E.mdxType="string"==typeof e?e:s,r[1]=E;for(var i=2;i<l;i++)r[i]=a[i];return t.createElement.apply(null,r)}return t.createElement.apply(null,a)}p.displayName="MDXCreateElement"},90203:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>m,frontMatter:()=>l,metadata:()=>E,toc:()=>i});var t=a(87462),s=(a(67294),a(3905));const l={},r="MySQL\u5feb\u901f\u624b\u518c",E={unversionedId:"LinuxBasics/DataBases/MySQL/MySQL \u5feb\u901f\u624b\u518c",id:"LinuxBasics/DataBases/MySQL/MySQL \u5feb\u901f\u624b\u518c",title:"MySQL\u5feb\u901f\u624b\u518c",description:"SQL Commands",source:"@site/docs/LinuxBasics/DataBases/MySQL/MySQL \u5feb\u901f\u624b\u518c.md",sourceDirName:"LinuxBasics/DataBases/MySQL",slug:"/LinuxBasics/DataBases/MySQL/MySQL \u5feb\u901f\u624b\u518c",permalink:"/docs/LinuxBasics/DataBases/MySQL/MySQL \u5feb\u901f\u624b\u518c",draft:!1,editUrl:"https://github.com/AGou-ops/myDocsv4/edit/main/docs/LinuxBasics/DataBases/MySQL/MySQL \u5feb\u901f\u624b\u518c.md",tags:[],version:"current",frontMatter:{},sidebar:"linuxBasics",previous:{title:"MySQL\u5c0f\u6280\u5de7\u6c47\u603b",permalink:"/docs/LinuxBasics/DataBases/MySQL/MySQL \u5c0f\u6280\u5de7"},next:{title:"MySQL\u7ea6\u675f",permalink:"/docs/LinuxBasics/DataBases/MySQL/MySQL \u7ea6\u675f"}},o={},i=[{value:"\u57fa\u7840",id:"\u57fa\u7840",level:2},{value:"CRUD",id:"crud",level:3},{value:"SELECT",id:"select",level:4},{value:"\u7528\u6237\u6743\u9650",id:"\u7528\u6237\u6743\u9650",level:3},{value:"\u5b57\u7b26\u96c6\u7f16\u7801",id:"\u5b57\u7b26\u96c6\u7f16\u7801",level:3},{value:"\u4fee\u6539\u5bc6\u7801",id:"\u4fee\u6539\u5bc6\u7801",level:3},{value:"\u89c6\u56fe",id:"\u89c6\u56fe",level:3},{value:"\u7d22\u5f15",id:"\u7d22\u5f15",level:3},{value:"\u53d8\u91cf",id:"\u53d8\u91cf",level:3},{value:"\u884c\u6570",id:"\u884c\u6570",level:3},{value:"\u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570",id:"\u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570",level:3},{value:"\u89e6\u53d1\u5668\uff0c\u6570\u636e\u5e93\u5927\u5c0f",id:"\u89e6\u53d1\u5668\u6570\u636e\u5e93\u5927\u5c0f",level:3},{value:"\u662f\u5426\u5f00\u542f\u4fdd\u62a4",id:"\u662f\u5426\u5f00\u542f\u4fdd\u62a4",level:3},{value:"\u6b7b\u9501",id:"\u6b7b\u9501",level:3},{value:"sql",id:"sql",level:3},{value:"MySQL\u5ef6\u8fdf\u590d\u5236",id:"mysql\u5ef6\u8fdf\u590d\u5236",level:3},{value:"\u4e3b\u4ece",id:"\u4e3b\u4ece",level:2},{value:"xtrabackup\u65b9\u5f0f\u5907\u4efd",id:"xtrabackup\u65b9\u5f0f\u5907\u4efd",level:2}],c={toc:i};function m(e){let{components:n,...a}=e;return(0,s.kt)("wrapper",(0,t.Z)({},c,a,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"mysql\u5feb\u901f\u624b\u518c"},"MySQL\u5feb\u901f\u624b\u518c"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"mysql -h <mysql_server_addr> -P <PORT> -u <USER> -p <PASSWORD>\n")),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/SQL-Commands-1-700x470.png",alt:"SQL Commands"})),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"DDL\uff08",(0,s.kt)("strong",{parentName:"li"},"Data Definition Languages"),"\uff09\uff1a\u6570\u636e\u5e93\u5b9a\u4e49\u8bed\u53e5\uff1a\u7528\u6765\u521b\u5efa\u6570\u636e\u5e93\u4e2d\u7684\u8868\u3001\u7d22\u5f15\u3001\u89c6\u56fe\u3001\u5b58\u50a8\u8fc7\u7a0b\u3001\u89e6\u53d1\u5668\u7b49"),(0,s.kt)("li",{parentName:"ul"},"DML\uff08",(0,s.kt)("strong",{parentName:"li"},"Data Manipulation Language"),"\uff09\uff1a\u6570\u636e\u64cd\u7eb5\u8bed\u53e5\uff1a\u7528\u6765\u67e5\u8be2\u3001\u6dfb\u52a0\u3001\u66f4\u65b0\u3001\u5220\u9664\u7b49"),(0,s.kt)("li",{parentName:"ul"},"DCL\uff08",(0,s.kt)("strong",{parentName:"li"},"Data Control Language"),"\uff09\uff1a\u6570\u636e\u63a7\u5236\u8bed\u53e5\uff1a\u7528\u4e8e\u6388\u6743/\u64a4\u9500\u6570\u636e\u5e93\u53ca\u5176\u5b57\u6bb5\u7684\u6743\u9650"),(0,s.kt)("li",{parentName:"ul"},"TCL\uff08",(0,s.kt)("strong",{parentName:"li"},"Transaction Control Language"),"\uff09\uff1a\u4e8b\u52a1\u63a7\u5236\u8bed\u53e5\uff1a\u7528\u4e8e\u63a7\u5236\u4e8b\u52a1"),(0,s.kt)("li",{parentName:"ul"},"DQL\uff08",(0,s.kt)("strong",{parentName:"li"},"Data Query Language"),"\uff09\uff1a\u6570\u636e\u67e5\u8be2\u8bed\u8a00\uff0cselect\uff0c from\uff0c where\uff0corder by\uff0c having\uff0casc|desc")),(0,s.kt)("p",null,"MySQL\u7684\u51e0\u4e2a\u9ed8\u8ba4\u5e93\u53ca\u4f5c\u7528\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"information_schema"),": \u4fdd\u5b58\u4e86MySQl\u670d\u52a1\u6240\u6709\u6570\u636e\u5e93\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5177\u4f53MySQL\u670d\u52a1\u6709\u591a\u5c11\u4e2a\u6570\u636e\u5e93\uff0c\u5404\u4e2a\u6570\u636e\u5e93\u6709\u54ea\u4e9b\u8868\uff0c\u5404\u4e2a\u8868\u4e2d\u7684\u5b57\u6bb5\u662f\u4ec0\u4e48\u6570\u636e\u7c7b\u578b\uff0c\u5404\u4e2a\u8868\u4e2d\u6709\u54ea\u4e9b\u7d22\u5f15\uff0c\u5404\u4e2a\u6570\u636e\u5e93\u8981\u4ec0\u4e48\u6743\u9650\u624d\u80fd\u8bbf\u95ee\u3002"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"sys"),": \u5176\u6240\u6709\u7684\u6570\u636e\u6e90\u5747\u6765\u81ea",(0,s.kt)("inlineCode",{parentName:"li"},"performance_schema"),"\uff0c\u76ee\u6807\u662f\u628a\u8be5\u8868\u7684\u590d\u6742\u6027\u964d\u4f4e\u3002"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"mysql"),": \u4fdd\u5b58MySQL\u7684\u6743\u9650\u3001\u53c2\u6570\u3001\u5bf9\u8c61\u548c\u72b6\u6001\u4fe1\u606f\uff0c\u5982\u54ea\u4e9buser\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u6570\u636e\u3001DB\u53c2\u6570\u3001\u63d2\u4ef6\u3001\u4e3b\u4ece\u3002(\u5e38\u7528\u7684\uff0c\u5728mysql.user\u8868\u4e2d\u4fee\u6539root\u7528\u6237\u7684\u5bc6\u7801)"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"performance_schema"),": \u4e3b\u8981\u7528\u4e8e\u6536\u96c6\u6570\u636e\u5e93\u670d\u52a1\u5668\u6027\u80fd\u53c2\u6570\u3002")),(0,s.kt)("h2",{id:"\u57fa\u7840"},"\u57fa\u7840"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u5168\u5c40 --\nSHOW processlist;        -- \u663e\u793a\u54ea\u4e9b\u7ebf\u7a0b\u6b63\u5728\u8fd0\u884c\nSHOW master status\\G;\nSHOW variables like 'server_id';        -- \u663e\u793a\u7cfb\u7edf\u53d8\u91cf\nSHOW GLOBAL variables like '%log_warning%';\nSELECT @@global.autocommit;     -- \u663e\u793a\u5168\u5c40\u53d8\u91cf\nSHOW ENGINES;\nSHOW ENGINES <ENGINE_NAME> <LOGS|StATUS>;       -- \u663e\u793a\u5b58\u50a8\u5f15\u64ce\u7684\u65e5\u5fd7\u6216\u8005\u72b6\u6001\u4fe1\u606f\nSELECT now(),user(),version();\nSELECT * from information_schema.VIEWS;     -- \u67e5\u770b\u89c6\u56fe\nSELECT * from information_schema.TABLES;        -- \u67e5\u770b\u6570\u636e\u5e93\u6240\u6709\u8868\nEXPLAIN <sql\u8bed\u53e5>;        -- \nshow variables like 'log_bin';   -- \u67e5\u770b\u662f\u5426\u542f\u7528binlog\u65e5\u5fd7\nshow binary logs;        -- \u67e5\u770b\u5f53\u524d\u670d\u52a1\u5668\u4f7f\u7528\u7684biglog\u6587\u4ef6\u4e2a\u6570\u53ca\u5927\u5c0f show binary logs;\n\n-- \u6162\u65e5\u5fd7\u76f8\u5173\nshow variables  like '%slow_query_log%';\n\n-- \u5e93\u7ea7 --\nCREATE DATABASE IF NOT EXISTS <DATABASE_NAME> DEFAULT CHARSET utf8 COLLATE utf8_general_ci;     -- \u521b\u5efa\u6570\u636e\u5e93\u5e76\u6307\u5b9a\u5b57\u7b26\u96c6\nSHOW CREATE DATABASE <DATABASE>;\nFLUSH PRIVILEGES;       -- \u5237\u65b0\u6743\u9650\nSELECT database();       -- \u5f53\u524d\u9009\u62e9\u7684\u6570\u636e\u5e93\nDROP DATABASE <DATABASE>;  -- \u5220\u9664\u6570\u636e\u5e93\n\n-- \u8868\u7ea7 -- \nDESC <TABLE_NAME>;      -- \u8868\u7ed3\u6784\u3001\u4f7f\u7528describe\u3001show columns from <table_name>\u80fd\u8fbe\u5230\u76f8\u540c\u6548\u679c\nSELECT user,host,password FROM mysql.user;      -- \u663e\u793a\u8868\u4e2d\u7684\u5236\u5b9a\u5b57\u6bb5\nSHOW TABLES FROM <TABLE_NAME>;      -- \u663e\u793a\u6240\u6709\u8868\nSHOW TABLE STATUS [FROM <DATABASE_NAME>] [LIKE 'PATTERN'];      -- \u663e\u793a\u8868\u72b6\u6001\nALTER TABLE <TABLE_NAME> <...OPTIONS...>        -- \u4fee\u6539\u8868\u9009\u9879\uff0calter table test ENGINE=MYISAM;\nRENAME TABLE <old_TABLE_NAME> TO <new_TABLE_NAME>;\nRENAME TABLE <old_TABLE_NAME> TO <DATABASE_NAME.TABLE_NAME>;        -- \u53ef\u4ee5\u5c06\u8868\u79fb\u52a8\u5230\u53e6\u5916\u4e00\u4e2a\u6570\u636e\u5e93\n\nCREATE TABLE <TABLE_NAME> LIKE <TABLE_NAME>;        -- \u590d\u5236\u8868\u7ed3\u6784\nCREATE TABLE <TABLE_NAME> AS SELECT * FROM <TABLE_NAME>;        -- \u590d\u5236\u8868\u7ed3\u6784\u53ca\u8868\u6570\u636e\nCREATE TABLE IF NOT EXISTS `test_table`(\n   `id` INT UNSIGNED AUTO_INCREMENT,\n   `name` VARCHAR(100) NOT NULL,\n   `addr` VARCHAR(40) NOT NULL,\n   `date` DATE,\n   PRIMARY KEY ( `id` )\n)ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\nALTER TABLE <TABLE_NAME> <...OPTIONS...>;\n/* \u64cd\u4f5c\u540d\n            ADD COLUMN \u5b57\u6bb5\u5b9a\u4e49       -- \u589e\u52a0\u5b57\u6bb5\n                AFTER \u5b57\u6bb5\u540d          -- \u8868\u793a\u589e\u52a0\u5728\u8be5\u5b57\u6bb5\u540d\u540e\u9762\n                FIRST               -- \u8868\u793a\u589e\u52a0\u5728\u7b2c\u4e00\u4e2a\n            ADD PRIMARY KEY(\u5b57\u6bb5\u540d)   -- \u521b\u5efa\u4e3b\u952e\n            ADD UNIQUE [\u7d22\u5f15\u540d] (\u5b57\u6bb5\u540d)-- \u521b\u5efa\u552f\u4e00\u7d22\u5f15\n            ADD INDEX [\u7d22\u5f15\u540d] (\u5b57\u6bb5\u540d) -- \u521b\u5efa\u666e\u901a\u7d22\u5f15\n            DROP [COLUMN] \u5b57\u6bb5\u540d      -- \u5220\u9664\u5b57\u6bb5\n            MODIFY [COLUMN] \u5b57\u6bb5\u540d \u5b57\u6bb5\u5c5e\u6027     -- \u652f\u6301\u5bf9\u5b57\u6bb5\u5c5e\u6027\u8fdb\u884c\u4fee\u6539\uff0c\u4e0d\u80fd\u4fee\u6539\u5b57\u6bb5\u540d(\u6240\u6709\u539f\u6709\u5c5e\u6027\u4e5f\u9700\u5199\u4e0a)\n            CHANGE [COLUMN] \u539f\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u5b57\u6bb5\u5c5e\u6027      -- \u652f\u6301\u5bf9\u5b57\u6bb5\u540d\u4fee\u6539\n             * DROP PRIMARY KEY    -- \u5220\u9664\u4e3b\u952e(\u5220\u9664\u4e3b\u952e\u524d\u9700\u5220\u9664\u5176AUTO_INCREMENT\u5c5e\u6027)\n            DROP INDEX \u7d22\u5f15\u540d -- \u5220\u9664\u7d22\u5f15\n            DROP FOREIGN KEY \u5916\u952e    -- \u5220\u9664\u5916\u952e\n*/\n\nDROP TABLE [IF EXISTS] <TABLE_NAME...>;     -- \u5220\u9664\u8868\nTRUNCATE TABLE <TABLE_NAME>;        -- \u6e05\u7a7a\u8868\u6570\u636e\uff0c\u4e0d\u5220\u9664\u8868\u7ed3\u6784\uff0c\u4e0eDELETE\u4e0d\u540c\u7684\u662f\uff0c\u8be5\u64cd\u4f5c\u65e0\u6cd5\u6062\u590d\uff0cDELETE\u53ef\u4ee5\u901a\u8fc7\u56de\u6eda\u64cd\u4f5c\u8fdb\u884c\u6062\u590d\nDELETE FROM <TABLE_NAME>;       -- \u6e05\u7a7a\u8868\u6570\u636e\uff0c\u4e0d\u5220\u9664\u8868\u7ed3\u6784\n\n-- \u68c0\u67e5\u8868\u662f\u5426\u6709\u9519\u8bef\nCHECK TABLE <TABLE_NAME1>,<TBL_NAME2>...;\n\n-- \u5237\u65b0\u8868\u6570\u636e\nFLUSH TABLES WITH READ LOCK;\nUNLOCK TABLES;\n\n-- \u91ca\u653e\u8868\u7a7a\u95f4\uff0c\u4f7f\u7528delete\u65f6\u672a\u91ca\u653e\u78c1\u76d8\u7a7a\u95f4\uff0c\u4f46\u662f\u4e0b\u6b21\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u4ecd\u7136\u53ef\u4ee5\u4f7f\u7528\u8fd9\u90e8\u5206\u7a7a\u95f4\u3002\nOPTIMIZE TABLE <TABLE_NAME1>,<TBL_NAME2> <...OPTIONS...>;\n-- \u5206\u6790\u8868\nANALYZE TABLE <TABLE_NAME1>,<TBL_NAME2> <...OPTIONS...>;\n-- \u4fee\u590d\u8868\nREPAIR TABLE <TABLE_NAME1>,<TBL_NAME2> <...OPTIONS...>;\n")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"\u62d3\u5c55\uff1a"),(0,s.kt)("ol",{parentName:"blockquote"},(0,s.kt)("li",{parentName:"ol"},"\u67e5\u770b\u67d0\u8868\u4e2d\u7684\u5b57\u6bb5\u662f\u5426\u5b58\u5728")),(0,s.kt)("pre",{parentName:"blockquote"},(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT \n    IF(count(*) = 1, 'Exist','Not Exist') AS result\nFROM\n    information_schema.columns\nWHERE\n    table_schema = '<DB_NAME>'\n        AND table_name = '<TABLE_NAME>'\n        AND column_name = '<COLUMN_NAME>';\n")),(0,s.kt)("ol",{parentName:"blockquote",start:2},(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("inlineCode",{parentName:"li"},"DELETE"),"\u548c",(0,s.kt)("inlineCode",{parentName:"li"},"TRUNCATE"),"\u7684\u533a\u522b")),(0,s.kt)("p",{parentName:"blockquote"},"a. \u4e0d\u5e26where\u53c2\u6570\u7684",(0,s.kt)("inlineCode",{parentName:"p"},"delete"),"\u8bed\u53e5\u53ef\u4ee5\u5220\u9664mysql\u8868\u4e2d\u6240\u6709\u5185\u5bb9\uff0c\u4f7f\u7528",(0,s.kt)("inlineCode",{parentName:"p"},"truncate table"),"\u4e5f\u53ef\u4ee5\u6e05\u7a7amysql\u8868\u4e2d\u6240\u6709\u5185\u5bb9\u3002"),(0,s.kt)("p",{parentName:"blockquote"},"b. \u6548\u7387\u4e0a",(0,s.kt)("inlineCode",{parentName:"p"},"truncate"),"\u6bd4",(0,s.kt)("inlineCode",{parentName:"p"},"delete"),"\u5feb\uff0c\u4f46",(0,s.kt)("inlineCode",{parentName:"p"},"truncate"),"\u5220\u9664\u540e\u4e0d\u8bb0\u5f55mysql\u65e5\u5fd7\uff0c\u4e0d\u53ef\u4ee5\u6062\u590d\u6570\u636e\u3002"),(0,s.kt)("p",{parentName:"blockquote"},"c.",(0,s.kt)("inlineCode",{parentName:"p"},"delete"),"\u8bed\u53e5\u662f\u6570\u636e\u5e93\u64cd\u4f5c\u8bed\u8a00(dml)\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u653e\u5230 ",(0,s.kt)("inlineCode",{parentName:"p"},"rollback segement")," \u4e2d\uff0c\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\u624d\u751f\u6548\uff1b\u5982\u679c\u6709\u76f8\u5e94\u7684 trigger\uff0c\u6267\u884c\u7684\u65f6\u5019\u5c06\u88ab\u89e6\u53d1\u3002",(0,s.kt)("inlineCode",{parentName:"p"},"truncate"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"drop "),"\u662f\u6570\u636e\u5e93\u5b9a\u4e49\u8bed\u8a00(ddl)\uff0c\u64cd\u4f5c\u7acb\u5373\u751f\u6548\uff0c\u539f\u6570\u636e\u4e0d\u653e\u5230 rollback segment \u4e2d\uff0c\u4e0d\u80fd\u56de\u6eda\uff0c\u64cd\u4f5c\u4e0d\u89e6\u53d1 trigger\u3002"),(0,s.kt)("p",{parentName:"blockquote"},"d. ",(0,s.kt)("inlineCode",{parentName:"p"},"delete"),"\u7684\u6548\u679c\u6709\u70b9\u50cf\u5c06mysql\u8868\u4e2d\u6240\u6709\u8bb0\u5f55\u4e00\u6761\u4e00\u6761\u5220\u9664\u5230\u5220\u5b8c\uff0c\u800c",(0,s.kt)("inlineCode",{parentName:"p"},"truncate"),"\u76f8\u5f53\u4e8e\u4fdd\u7559mysql\u8868\u7684\u7ed3\u6784\uff0c\u91cd\u65b0\u521b\u5efa\u4e86\u8fd9\u4e2a\u8868\uff0c\u6240\u6709\u7684\u72b6\u6001\u90fd\u76f8\u5f53\u4e8e\u65b0\u8868\u3002")),(0,s.kt)("h3",{id:"crud"},"CRUD"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u589e\nINSERT INTO <TABLE_NAME> [(\u5b57\u6bb5\u5217\u8868)] VALUES (\u503c\u5217\u8868)[, (\u503c\u5217\u8868), ...]\n    -- \u5982\u679c\u8981\u63d2\u5165\u7684\u503c\u5217\u8868\u5305\u542b\u6240\u6709\u5b57\u6bb5\u5e76\u4e14\u987a\u5e8f\u4e00\u81f4\uff0c\u5219\u53ef\u4ee5\u7701\u7565\u5b57\u6bb5\u5217\u8868\u3002\n    -- \u53ef\u540c\u65f6\u63d2\u5165\u591a\u6761\u6570\u636e\u8bb0\u5f55\uff01\n\n/* REPLACE \u4e0e INSERT \u4f7f\u7528\u8bed\u6cd5\u5b8c\u5168\u4e00\u6837\uff0c\u5176\u533a\u522b\u5c31\u662f\u524d\u8005\u53d1\u73b0\u5982\u679c\u8868\u4e2d\u5b58\u5728\u8be5\u6570\u636e\uff0c\u5219\u4f1a\u5148\u5220\u9664\u8be5\u6570\u636e\uff0c\u7136\u540e\u518d\u8fdb\u884c\u63d2\u5165\uff0c\u800c\u540e\u8005\u5982\u82e5\u53d1\u73b0\u6570\u636e\u91cd\u590d\uff0c\u5219\u4f1a\u62a5\u9519\u3002\n*/\n\nINSERT INTO <TABLE_NAME> SET \u5b57\u6bb5\u540d=\u503c[, \u5b57\u6bb5\u540d=\u503c, ...]\n-- \u5220\nDELETE FROM <TABLE_NAME> [\u5220\u9664\u6761\u4ef6\u5b50\u53e5]\n    \u6ca1\u6709\u6761\u4ef6\u5b50\u53e5\uff0c\u5219\u4f1a\u5220\u9664\u5168\u90e8\n-- \u6539\nUPDATE <TABLE_NAME> SET \u5b57\u6bb5\u540d=\u65b0\u503c[,\u5b57\u6bb5\u540d=\u65b0\u503c] [\u66f4\u65b0\u6761\u4ef6]\n-- \u67e5\nSELECT \u5b57\u6bb5\u5217\u8868 FROM <TABLE_NAME> [\u5176\u4ed6\u5b50\u53e5]\n    -- \u53ef\u6765\u81ea\u591a\u4e2a\u8868\u7684\u591a\u4e2a\u5b57\u6bb5\n    -- \u5176\u4ed6\u5b50\u53e5\u53ef\u4ee5\u4e0d\u4f7f\u7528\n    -- \u5b57\u6bb5\u5217\u8868\u53ef\u4ee5\u7528*\u4ee3\u66ff\uff0c\u8868\u793a\u6240\u6709\u5b57\u6bb5\n")),(0,s.kt)("h4",{id:"select"},"SELECT"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"/* SELECT */ ------------------\nSELECT [ALL|DISTINCT] select_expr FROM -> WHERE --\x3e GROUP BY [\u5408\u8ba1\u51fd\u6570] -> HAVING -> ORDER BY -> LIMIT\n\nselect_expr\n    -- \u53ef\u4ee5\u7528 * \u8868\u793a\u6240\u6709\u5b57\u6bb5\u3002\n        select * from tb;\n    -- \u53ef\u4ee5\u4f7f\u7528\u8868\u8fbe\u5f0f\uff08\u8ba1\u7b97\u516c\u5f0f\u3001\u51fd\u6570\u8c03\u7528\u3001\u5b57\u6bb5\u4e5f\u662f\u4e2a\u8868\u8fbe\u5f0f\uff09\n        select stu, 29+25, now() from tb;\n    -- \u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5217\u4f7f\u7528\u522b\u540d\u3002\u9002\u7528\u4e8e\u7b80\u5316\u5217\u6807\u8bc6\uff0c\u907f\u514d\u591a\u4e2a\u5217\u6807\u8bc6\u7b26\u91cd\u590d\u3002\n        - \u4f7f\u7528 as \u5173\u952e\u5b57\uff0c\u4e5f\u53ef\u7701\u7565 as.\n        select stu+10 as add10 from tb;\n\nFROM \u5b50\u53e5\n    \u7528\u4e8e\u6807\u8bc6\u67e5\u8be2\u6765\u6e90\u3002\n    -- \u53ef\u4ee5\u4e3a\u8868\u8d77\u522b\u540d\u3002\u4f7f\u7528as\u5173\u952e\u5b57\u3002\n        SELECT * FROM tb1 AS tt, tb2 AS bb;\n    -- from\u5b50\u53e5\u540e\uff0c\u53ef\u4ee5\u540c\u65f6\u51fa\u73b0\u591a\u4e2a\u8868\u3002\n        -- \u591a\u4e2a\u8868\u4f1a\u6a2a\u5411\u53e0\u52a0\u5230\u4e00\u8d77\uff0c\u800c\u6570\u636e\u4f1a\u5f62\u6210\u4e00\u4e2a\u7b1b\u5361\u5c14\u79ef\u3002\n        SELECT * FROM tb1, tb2;\n    -- \u5411\u4f18\u5316\u7b26\u63d0\u793a\u5982\u4f55\u9009\u62e9\u7d22\u5f15\n        USE INDEX\u3001IGNORE INDEX\u3001FORCE INDEX\n        SELECT * FROM table1 USE INDEX (key1,key2) WHERE key1=1 AND key2=2 AND key3=3;\n        SELECT * FROM table1 IGNORE INDEX (key3) WHERE key1=1 AND key2=2 AND key3=3;\n\nWHERE \u5b50\u53e5\n    -- \u4ecefrom\u83b7\u5f97\u7684\u6570\u636e\u6e90\u4e2d\u8fdb\u884c\u7b5b\u9009\u3002\n    -- \u6574\u578b1\u8868\u793a\u771f\uff0c0\u8868\u793a\u5047\u3002\n    -- \u8868\u8fbe\u5f0f\u7531\u8fd0\u7b97\u7b26\u548c\u8fd0\u7b97\u6570\u7ec4\u6210\u3002\n        -- \u8fd0\u7b97\u6570\uff1a\u53d8\u91cf\uff08\u5b57\u6bb5\uff09\u3001\u503c\u3001\u51fd\u6570\u8fd4\u56de\u503c\n        -- \u8fd0\u7b97\u7b26\uff1a\n            =, <=>, <>, !=, <=, <, >=, >, !, &&, ||,\n            in (not) null, (not) like, (not) in, (not) between and, is (not), and, or, not, xor\n            is/is not \u52a0\u4e0ature/false/unknown\uff0c\u68c0\u9a8c\u67d0\u4e2a\u503c\u7684\u771f\u5047\n            <=>\u4e0e<>\u529f\u80fd\u76f8\u540c\uff0c<=>\u53ef\u7528\u4e8enull\u6bd4\u8f83\n        -- in\n        SELECT * FROM <TBL_NAME> a WHERE (a.<COLUMN1>,A.<COLUMN2>) IN/= (SELECT ...)\n\nUNION \u5b50\u53e5\n        -- \u4ece\u591a\u4e2a\u8868\u4e2d\u67e5\u8be2\u51fa\u76f8\u4f3c\u7ed3\u6784\u7684\u6570\u636e\uff0c\u5e76\u4e14\u8fd4\u56de\u4e00\u4e2a\u7ed3\u679c\u96c6\n        -- \u4ece\u5355\u4e2a\u8868\u4e2d\u591a\u6b21SELECT\u67e5\u8be2\uff0c\u5c06\u7ed3\u679c\u5408\u5e76\u6210\u4e00\u4e2a\u7ed3\u679c\u96c6\u8fd4\u56de\u3002\n        \n        -- Union\u68c0\u7d22\u9047\u5230\u4e0d\u4e00\u81f4\u7684\u5b57\u6bb5\u540d\u79f0\u65f6\u5019\uff0c\u4f1a\u4f7f\u7528\u7b2c\u4e00\u6761SELECT\u7684\u67e5\u8be2\u5b57\u6bb5\u540d\u79f0\uff0c\u6216\u8005\u4f60\u4f7f\u7528\u522b\u540d\u6765\u6539\u53d8\u67e5\u8be2\u5b57\u6bb5\u540d\u79f0\u3002\n        \n        -- \u989d\u5916\u53c2\u6570\uff1a\n            -- ALL\uff1a\u53ef\u9009\uff0c\u8fd4\u56de\u6240\u6709\u7ed3\u679c\u96c6\uff0c\u5305\u542b\u91cd\u590d\u6570\u636e\n            -- DISTINCT\uff1a\u53ef\u9009\uff0c\u5220\u9664\u7ed3\u679c\u96c6\u4e2d\u7684\u91cd\u590d\u6570\u636e\uff0c\u4f46\u9ed8\u8ba4\u60c5\u51b5\u4e0bUNION\u64cd\u4f5c\u7b26\u4f1a\u81ea\u52a8\u5220\u9664\u91cd\u590d\u6570\u636e\uff0c\u6545\u6b64\u9879\u53c2\u6570\u52a0\u4e0d\u52a0\u6ca1\u4ec0\u4e48\u5f71\u54cd\n            -- 'str' AS TABLE_NAME\uff1a\u7528\u4e8e\u533a\u5206\u591a\u4e2a\u8054\u5408\u8868\u7684\u6807\u8bc6\u5b57\u6bb5\u5217\n                (SELECT *,'tbl1' AS TABLE_NAME  FROM <TBL_NAME> a WHERE ...) UNION [ALL|DISTINCT] (SELECT *,'tbl2' AS TABLE_NAME ...) ORDER BY id DESC\n\n\nGROUP BY \u5b50\u53e5, \u5206\u7ec4\u5b50\u53e5\n    GROUP BY \u5b57\u6bb5/\u522b\u540d [\u6392\u5e8f\u65b9\u5f0f]\n    \u5206\u7ec4\u540e\u4f1a\u8fdb\u884c\u6392\u5e8f\u3002\u6392\u5e8f\u89c4\u5219\uff0cASC\u5347\u5e8f\uff08`DEFAULT`\uff09\uff0cDESC\u964d\u5e8f\n    SELECT user_id \u7528\u6237id, count(id) \u6570\u91cf FROM tbl GROUP BY user_id;\n    \n    \u4ee5\u4e0b[\u5408\u8ba1\u51fd\u6570]\u9700\u914d\u5408 GROUP BY \u4f7f\u7528\uff1a\n    count \u8fd4\u56de\u4e0d\u540c\u7684\u975eNULL\u503c\u6570\u76ee  count(*)\u3001count(\u5b57\u6bb5)\n    sum \u6c42\u548c\n    max \u6c42\u6700\u5927\u503c\n    min \u6c42\u6700\u5c0f\u503c    \n    avg \u6c42\u5e73\u5747\u503c\n    group_concat \u8fd4\u56de\u5e26\u6709\u6765\u81ea\u4e00\u4e2a\u7ec4\u7684\u8fde\u63a5\u7684\u975eNULL\u503c\u7684\u5b57\u7b26\u4e32\u7ed3\u679c\u3002\u7ec4\u5185\u5b57\u7b26\u4e32\u8fde\u63a5\u3002\n\nHAVING \u5b50\u53e5\uff0c\u6761\u4ef6\u5b50\u53e5\n    `\u4e0e where \u529f\u80fd\u3001\u7528\u6cd5\u76f8\u540c\uff0c\u6267\u884c\u65f6\u673a\u4e0d\u540c\u3002\n    where \u5728\u5f00\u59cb\u65f6\u6267\u884c\u68c0\u6d4b\u6570\u636e\uff0c\u5bf9\u539f\u6570\u636e\u8fdb\u884c\u8fc7\u6ee4\u3002\n    having \u5bf9\u7b5b\u9009\u51fa\u7684\u7ed3\u679c\u518d\u6b21\u8fdb\u884c\u8fc7\u6ee4\u3002\n    having \u5b57\u6bb5\u5fc5\u987b\u662f\u67e5\u8be2\u51fa\u6765\u7684\uff0cwhere \u5b57\u6bb5\u5fc5\u987b\u662f\u6570\u636e\u8868\u5b58\u5728\u7684\u3002\n    where \u4e0d\u53ef\u4ee5\u4f7f\u7528\u5b57\u6bb5\u7684\u522b\u540d\uff0chaving \u53ef\u4ee5\u3002\u56e0\u4e3a\u6267\u884cWHERE\u4ee3\u7801\u65f6\uff0c\u53ef\u80fd\u5c1a\u672a\u786e\u5b9a\u5217\u503c\u3002\n    where \u4e0d\u53ef\u4ee5\u4f7f\u7528\u5408\u8ba1\u51fd\u6570\u3002\u4e00\u822c\u9700\u7528\u5408\u8ba1\u51fd\u6570\u624d\u4f1a\u7528 having`\n    SQL\u6807\u51c6\u8981\u6c42HAVING\u5fc5\u987b\u5f15\u7528GROUP BY\u5b50\u53e5\u4e2d\u7684\u5217\u6216\u7528\u4e8e\u5408\u8ba1\u51fd\u6570\u4e2d\u7684\u5217\u3002\n\nORDER BY \u5b50\u53e5\uff0c\u6392\u5e8f\u5b50\u53e5\n    order by \u6392\u5e8f\u5b57\u6bb5/\u522b\u540d \u6392\u5e8f\u65b9\u5f0f [,\u6392\u5e8f\u5b57\u6bb5/\u522b\u540d \u6392\u5e8f\u65b9\u5f0f]...\n    \u5347\u5e8f\uff1aASC\uff0c\u964d\u5e8f\uff1aDESC\n    \u652f\u6301\u591a\u4e2a\u5b57\u6bb5\u7684\u6392\u5e8f\u3002\n\nLIMIT \u5b50\u53e5\uff0c\u9650\u5236\u7ed3\u679c\u6570\u91cf\u5b50\u53e5\n    \u4ec5\u5bf9\u5904\u7406\u597d\u7684\u7ed3\u679c\u8fdb\u884c\u6570\u91cf\u9650\u5236\u3002\u5c06\u5904\u7406\u597d\u7684\u7ed3\u679c\u7684\u770b\u4f5c\u662f\u4e00\u4e2a\u96c6\u5408\uff0c\u6309\u7167\u8bb0\u5f55\u51fa\u73b0\u7684\u987a\u5e8f\uff0c\u7d22\u5f15\u4ece0\u5f00\u59cb\u3002\n    limit \u8d77\u59cb\u4f4d\u7f6e, \u83b7\u53d6\u6761\u6570\n    \u7701\u7565\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u8868\u793a\u4ece\u7d22\u5f150\u5f00\u59cb\u3002limit \u83b7\u53d6\u6761\u6570\n\nDISTINCT, ALL \u9009\u9879\n    distinct \u53bb\u9664\u91cd\u590d\u8bb0\u5f55\n    \u9ed8\u8ba4\u4e3a all, \u5168\u90e8\u8bb0\u5f55\n")),(0,s.kt)("h3",{id:"\u7528\u6237\u6743\u9650"},"\u7528\u6237\u6743\u9650"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER auditor@localhost IDENTIFIED BY 'newpasswd';\nGRANT ALL ON yiibaidb.* TO auditor@localhost;\nGRANT CREATE,EXECUTE,INSERT,DELETE,SELECT ON *.* TO usertest1@localhost;\nGRANT CREATE,EXECUTE,INSERT,DELETE,SELECT ON *.* TO usertest1@'%' IDENTIFIED BY 'newpasswd';\nSHOW GRANTS FOR usertest1@'%';\nGRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '1234' WITH GRANT OPTION;  \nflush privileges;  \n")),(0,s.kt)("p",null,"\u8be6\u60c5\u67e5\u770b",(0,s.kt)("a",{parentName:"p",href:"/docs/LinuxBasics/DataBases/MySQL/MySQL%20Auth%20CLI"},"MySQL Auth CLI.md")),(0,s.kt)("h3",{id:"\u5b57\u7b26\u96c6\u7f16\u7801"},"\u5b57\u7b26\u96c6\u7f16\u7801"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u67e5\u770b\u5b57\u7b26\u96c6\u7f16\u7801\nSHOW VARIABLES LIKE 'character_set%';\n-- \u521b\u5efa\u6570\u636e\u5e93\u65f6\u6307\u5b9a\u5b57\u7b26\u96c6\nCREATE DATABASE IF NOT EXISTS <DATABASE_NAME> CHARACTER SET <CHAR_SET>;\n-- \u4fee\u6539\u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6\nALTER DATABASE <DATABASE_NAME> CHARACTER SET <CHAR_SET>;\n\n-- \u6539\u5b57\u7b26\u96c6\nSET character_set_client = utf8;        -- \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u7aef\u53d1\u9001\u6570\u636e\u65f6\u4f7f\u7528\u7684\u7f16\u7801\nSET character_set_results = utf8;       -- \u670d\u52a1\u5668\u7aef\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u65f6\u6240\u4f7f\u7528\u7684\u7f16\u7801\nSET character_set_connection = utf8;        -- \u8fde\u63a5\u5c42\u6240\u4f7f\u7528\u7684\u7f16\u7801\nSET NAMES utf8;         -- \u8be5\u547d\u4ee4\u76f8\u5f53\u4e8e\u4e00\u6b21\u6267\u884c\u4e0a\u9762\u4e09\u6761\u547d\u4ee4 --\nSET character_set_database = utf8;      -- \u6570\u636e\u5e93\u4f7f\u7528\u7684\u7f16\u7801\nSET character_set_server = utf8;        -- \u670d\u52a1\u5668\u5b57\u7b26\u96c6\uff0c\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a\u8d27\u5efa\u5e93\u5efa\u8868\u6307\u5b9a\u3002\nSET character_set_system = utf8;        -- \u7cfb\u7edf\u5b57\u7b26\u96c6\ncharacter_set_filesystem        -- \u6587\u4ef6\u7cfb\u7edf\u6240\u4f7f\u7528\u7684\u5b57\u7b26\u96c6\n")),(0,s.kt)("h3",{id:"\u4fee\u6539\u5bc6\u7801"},"\u4fee\u6539\u5bc6\u7801"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER USER 'root'@'localhost' IDENTIFIED BY '\u65b0\u5bc6\u7801';\nupdate user set password=password(\"12345\") where user=\"root\";\n\n/* \u5fd8\u8bb0root\u5bc6\u7801\uff0c\u505c\u6570\u636e\u5e93 \u4f7f\u7528*/\nmysqld_safe --skip-grant-tables\n\nset password = password(\"newpasswd\");\n")),(0,s.kt)("p",null,"\u8be6\u60c5\u67e5\u770b",(0,s.kt)("a",{parentName:"p",href:"/docs/LinuxBasics/DataBases/MySQL/MySQL%20Auth%20CLI"},"MySQL Auth CLI.md")),(0,s.kt)("h3",{id:"\u89c6\u56fe"},"\u89c6\u56fe"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},'CREATE\n    [OR REPLACE]        -- \u66ff\u6362\u5df2\u6709\u89c6\u56fe\n    [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]       -- \u89c6\u56fe\u9009\u62e9\u7b97\u6cd5\uff0c\u9ed8\u8ba4\u4e3a\u4e3a\u5b9a\u4e49\u7684\uff0cmerge\u8868\u793a\u5408\u5e76\uff0ctemptable\u8868\u793a\u4e34\u65f6\u8868\n    [DEFINER = user]\n    [SQL SECURITY { DEFINER | INVOKER }]\n    VIEW view_name [(column_list)]\n    AS select_statement\n    [WITH [CASCADED | LOCAL] CHECK OPTION]      -- cascade\u662f\u9ed8\u8ba4\u503c\uff0c\u8868\u793a\u66f4\u65b0\u89c6\u56fe\u7684\u65f6\u5019\uff0c\u8981\u6ee1\u8db3\u89c6\u56fe\u548c\u8868\u7684\u76f8\u5173\u6761\u4ef6\uff0clocal\u8868\u793a\u66f4\u65b0\u89c6\u56fe\u7684\u65f6\u5019\uff0c\u8981\u6ee1\u8db3\u8be5\u89c6\u56fe\u5b9a\u4e49\u7684\u4e00\u4e2a\u6761\u4ef6\u5373\u53ef\uff0c\u63a8\u8350\u4f7f\u7528CHECK OPTION\n-- \u793a\u4f8b\nMariaDB root@win:test> create view v_test_data(\u5b8c\u6574\u540d\u5b57,\u90ae\u7bb1,IP\u5730\u5740) as\n                    -> select concat_ws(" ",first_name,last_name),email,ip_address from test_data\n                    -> where id<50\n                    -> with check option;       -- with check option\u7ea6\u675f\u9650\u5236\uff0c\u4fdd\u8bc1\u66f4\u65b0\u89c6\u56fe\u662f\u5728\u8be5\u89c6\u56fe\u7684\u6743\u9650\u8303\u56f4\u4e4b\u5185\u3002\n-- \u4fee\u6539\u89c6\u56fe\ncreate or replace view <view_name> as ...;\nalter view <view_name> as ...;\n')),(0,s.kt)("h3",{id:"\u7d22\u5f15"},"\u7d22\u5f15"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u521b\u5efa\u7d22\u5f15\ncreate [unique] index <\u7d22\u5f15\u540d\u79f0> on <\u8868\u540d>(\u5217\u540d[(length)]);     -- unique \u8868\u793a\u552f\u4e00\u7d22\u5f15\uff0c\u5982\u679c\u5b57\u6bb5\u662fchar\u3001varchar\u7c7b\u578b\uff0clength\u53ef\u4ee5\u5c0f\u4e8e\u5b57\u6bb5\u5b9e\u9645\u957f\u5ea6\uff0c\u5982\u679c\u662fblog\u3001text\u7b49\u957f\u6587\u672c\u7c7b\u578b\uff0c\u5fc5\u987b\u6307\u5b9alength\u3002\nalter <\u8868\u540d> add [unique] index <\u7d22\u5f15\u540d\u79f0> on (\u5217\u540d[(length)]);\n-- \u5220\u9664\u7d22\u5f15\ndrop index <\u7d22\u5f15\u540d\u79f0> on <\u8868\u540d>;\n-- \u67e5\u770b\u7d22\u5f15\nshow index from <\u8868\u540d>;\n-- \u4fee\u6539\u7d22\u5f15\uff0c\u5220\u9664\u7d22\u5f15\u540e\u91cd\u5efa\u7d22\u5f15\n")),(0,s.kt)("h3",{id:"\u53d8\u91cf"},"\u53d8\u91cf"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u8d4b\u503c\uff0c\u5e26@\u8868\u793a\u5168\u5c40\u53d8\u91cf\uff0c\u4e0d\u5e26\u8868\u793a\u5c40\u90e8\u53d8\u91cf\nset @\u53d8\u91cf\u540d='\u503c';\nset @\u53d8\u91cf\u540d:='\u503c';\nselect @\u53d8\u91cf\u540d:='\u503c';\nselect '\u503c' into @\u53d8\u91cf\u540d [from tbl];\n-- \u53d6\u503c\nselect @\u53d8\u91cf\u540d;\n")),(0,s.kt)("h3",{id:"\u884c\u6570"},"\u884c\u6570"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"USE information_schema;\n\nSELECT TABLE_NAME,table_rows FROM TABLES WHERE TABLE_SCHEMA = 'mysql' ORDER BY table_rows DESC;\n\n-- \u67e5\u770b\u5355\u8868\u884c\u6570\nSELECT TABLE_NAME,table_rows FROM information_schema.tables WHERE TABLE_NAME = 'history' ORDER BY table_rows;\n\nSELECT TABLE_NAME,table_rows FROM TABLES WHERE TABLE_NAME = 'orders' ORDER BY table_rows ;\n\nSELECT TABLE_NAME,table_rows\nFROM TABLES WHERE TABLE_NAME = 'books' ORDER BY table_rows ;\n\nSELECT TABLE_NAME,table_rows FROM TABLES WHERE TABLE_NAME = 'book_parts' ORDER BY table_rows ;\n")),(0,s.kt)("h3",{id:"\u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570"},"\u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"select `name` from mysql.proc where db = 'xx' and `type` = 'PROCEDURE' ;        #\u5b58\u50a8\u8fc7\u7a0b\nselect `name` from mysql.proc where db = 'xx' and `type` = 'FUNCTION'   ;       #\u51fd\u6570\nshow procedure status;                                                           #\u5b58\u50a8\u8fc7\u7a0b\nshow function status;                                                            #\u51fd\u6570\n-- \u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u6216\u51fd\u6570\u7684\u521b\u5efa\u4ee3\u7801\nshow create procedure proc_name;\nshow create function func_name;\n")),(0,s.kt)("h3",{id:"\u89e6\u53d1\u5668\u6570\u636e\u5e93\u5927\u5c0f"},"\u89e6\u53d1\u5668\uff0c\u6570\u636e\u5e93\u5927\u5c0f"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW TRIGGERS [FROM db_name] [LIKE expr]\nSELECT * FROM triggers T WHERE trigger_name=\u201dmytrigger\u201d \\G\n#\u67e5\u770b\u6570\u636e\u5e93\u5927\u5c0f\n1\u3001\u8fdb\u5165information_schema \u6570\u636e\u5e93\uff08\u5b58\u653e\u4e86\u5176\u4ed6\u7684\u6570\u636e\u5e93\u7684\u4fe1\u606f\uff09\nuse information_schema;\n2\u3001\u67e5\u8be2\u6240\u6709\u6570\u636e\u7684\u5927\u5c0f\uff1a\nselect concat(round(sum(data_length/1024/1024),2),'MB') as data from tables;\n3\u3001\u67e5\u770b\u6307\u5b9a\u6570\u636e\u5e93\u7684\u5927\u5c0f\uff1a\n\u6bd4\u5982\u67e5\u770b\u6570\u636e\u5e93home\u7684\u5927\u5c0f\nselect concat(round(sum(data_length/1024/1024),2),'MB') as data from information_schema.tables where table_schema='home';\n4\u3001\u67e5\u770b\u6307\u5b9a\u6570\u636e\u5e93\u7684\u67d0\u4e2a\u8868\u7684\u5927\u5c0f\n\u6bd4\u5982\u67e5\u770b\u6570\u636e\u5e93home\u4e2d members \u8868\u7684\u5927\u5c0f\nselect concat(round(sum(data_length/1024/1024),2),'MB') as data from information_schema.tables where table_schema='home' and table_name='members';\n5\uff0c\u770b\u6bcf\u4e2a\u8868\u5927\u5c0f\nSELECT TABLE_NAME,DATA_LENGTH+INDEX_LENGTH,TABLE_ROWS,concat(round((DATA_LENGTH+INDEX_LENGTH)/1024/1024,2), 'MB') as data FROM TABLES WHERE TABLE_SCHEMA='mysql';\n")),(0,s.kt)("h3",{id:"\u662f\u5426\u5f00\u542f\u4fdd\u62a4"},"\u662f\u5426\u5f00\u542f\u4fdd\u62a4"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW VARIABLES LIKE 'sql_safe_updates';\nselect @@sql_safe_updates;\n\u68c0\u67e5\u6570\u636e\u4e00\u81f4\u6027\npt-table-checksum --nocheck-replication-filters --no-check-binlog-format --create-replicate-table --databases=ifeng  --tables=  -u root -p eba41b786d57213b09b12ca38ed9fa63 -h 127.0.0.1\n\npt-table-checksum --nocheck-replication-filters --no-check-binlog-format \\\n--replicate=ifeng --create-replicate-table --databases=ifeng  --tables=book_parts -u chechdb -p 123comER -h 10.89.11.152\n\ngrant all on *.* to chechdb@'10.89.%.%' identified by '123comER';\n")),(0,s.kt)("h3",{id:"\u6b7b\u9501"},"\u6b7b\u9501"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"show  processlist;\n1\uff1a\u67e5\u770b\u5f53\u524d\u7684\u4e8b\u52a1\nSELECT * FROM INFORMATION_SCHEMA.INNODB_TRX;\n2\uff1a\u67e5\u770b\u5f53\u524d\u9501\u5b9a\u7684\u4e8b\u52a1\nSELECT * FROM INFORMATION_SCHEMA.INNODB_LOCKS;\n3\uff1a\u67e5\u770b\u5f53\u524d\u7b49\u9501\u7684\u4e8b\u52a1\nSELECT * FROM INFORMATION_SCHEMA.INNODB_LOCK_WAITS;\n")),(0,s.kt)("h3",{id:"sql"},"sql"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"\u540e10\u6761\u6570\u636e\nselect id,createTime from message_filesn order by id desc  limit 10;\n\nselect id,createTime from message_filesn where createTime < DATE_SUB(CURDATE(),INTERVAL 1 day) order by id asc limit 10;\n\nSELECT DATE_SUB(CURDATE(),INTERVAL 10 day)  2018-08-19\nSELECT DATE_SUB(CURDATE(),INTERVAL 1 year)  2017-08-29\nSELECT DATE_SUB(CURDATE(),INTERVAL 3 month) 2018-05-29\nSELECT DATE_SUB(CURDATE(),INTERVAL -1 month) 2018-09-29\n\u91ca\u653e\u8868\u7a7a\u95f4\noptimize table tables_name;\n\n\u6539\u8868\u540d\nalter table message_filesntest rename to message_filesn ;\n")),(0,s.kt)("h3",{id:"mysql\u5ef6\u8fdf\u590d\u5236"},"MySQL\u5ef6\u8fdf\u590d\u5236"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"MySQL 5.6 \u652f\u6301\u5ef6\u8fdf\u590d\u5236\uff0c\u53ef\u4ee5\u5728Slave\u670d\u52a1\u5668\u6307\u5b9a\u4e00\u4e2a\u5ef6\u8fdf\u7684\u503c\u3002\u9ed8\u8ba4\u503c\u4e3a0\u79d2\u3002\u4f7f\u7528MASTER_DELAY \u9009\u9879\u4e3aCHANGE MASTERTO \u8bbe\u7f6eN\u79d2\u5ef6\u8fdf\u3002\n \n1. \u4e0b\u9762\u6765\u5b9e\u9645\u6f14\u793a,\u6b63\u5e38\u8fd0\u884c\u7684\u4ece\u8282\u70b9\u6267\u884c\uff0c\u8bbe\u7f6e\u5ef6\u8fdf100\u79d2\nSTOP SLAVE;\nCHANGE MASTER TO MASTER_DELAY = 100;\nSTART SLAVE;\nSHOW SLAVE STATUS\\G;\n\n\u663e\u793a \nSQL_Delay: 100  --\u5ef6\u8fdf 100S \nSQL_Remaining_Delay: NULL\n2. \u8bbe\u7f6e\u53d6\u6d88\u5ef6\u8fdf\u590d\u5236\nSTOP SLAVE ;\nCHANGE MASTER TO MASTER_DELAY=0;\nSTART SLAVE;\nSHOW SLAVE STATUS\\G;\n\nSQL_Delay: 0  --\u53d6\u6d88\u5ef6\u8fdf \nSQL_Remaining_Delay: NULL\n")),(0,s.kt)("h2",{id:"\u4e3b\u4ece"},"\u4e3b\u4ece"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"grant replication slave,file on *.* to 'slavebak'@'1.1.1.1' identified by 'newpasswd';\nshow master status\\G;\n#\u5728\u4ece\u4e0a\u6267\u884c\u4ee5\u4e0b\n\nchange master to master_host='1.1.1.1', master_user='test', master_password='newpasswd', master_log_file='mysql-bin.000005', master_log_pos=340;\n\nchange master to master_host='1.1.1.1', master_user='slavebak', master_password='newpasswd',MASTER_AUTO_POSITION=1;\n")),(0,s.kt)("h2",{id:"xtrabackup\u65b9\u5f0f\u5907\u4efd"},"xtrabackup\u65b9\u5f0f\u5907\u4efd"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"\u5b98\u65b9\u53c2\u8003\nhttps://www.percona.com/doc/percona-xtrabackup/LATEST/installation/yum_repo.html\n\npercona-toolkit  //\u5dee\u5f02\n\nyum install -y http://www.percona.com/downloads/percona-release/redhat/0.1-6/percona-release-0.1-6.noarch.rpm\nyum install percona-xtrabackup-24 -y\n\n\n\ninnobackupex  --user=root --password=cXXX --defaults-file=/etc/my.cnf /data/backup   #\u5907\u4efd\ninnobackupex --apply-log /data/backup/                                             #\u65e5\u5fd7\u56de\u6eda                         \ninnobackupex --copy-back --defaults-file=/etc/my.cnf  /data/backup                #\u5907\u4efd\u6062\u590d\n\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\ndatadir=   /data/backup/\n\n\n\nmysql> stop slave;         #\u505c\u6b62\u540c\u6b65\nmysql> reset slave;        #\u6e05\u9664\u4ece\u8fde\u63a5\u4fe1\u606f\nmysql> show slave status\\G;   #\u518d\u67e5\u770b\u4ece\u72b6\u6001\uff0c\u53ef\u4ee5\u770b\u5230IO\u548cSQL\u7ebf\u7a0b\u90fd\u4e3aNO\nmysql> drop database weibo;   #\u5220\u9664weibo\u5e93\uff0cweibo\u4e3a\u6d4b\u8bd5\u6570\u636e\u5e93\n\u6b64\u65f6\uff0c\u4ece\u5e93\u73b0\u5728\u548c\u65b0\u88c5\u7684\u4e00\u6837\uff0c\u7ee7\u7eed\u524d\u8fdb\uff01\n\n\n\u6b63\u5f0f\u6b65\u9aa4\u5f00\u59cb\uff1a\n1. \u4e3b\u5e93\u4f7f\u7528xtrabackup\u5907\u4efd\ninnobackupex --user=root  --password=123 ./\n\u751f\u6210\u4e00\u4e2a\u4ee5\u65f6\u95f4\u4e3a\u547d\u540d\u7684\u5907\u4efd\u76ee\u5f55\uff1a2018-06-19_16-11-01\n\n2. \u628a\u5907\u4efd\u76ee\u5f55\u62f7\u8d1d\u5230\u4ece\u5e93\u4e0a\n\n3. \u4ece\u5e93\u4e0a\u628aMySQL\u670d\u52a1\u505c\u6389\uff0c\u5220\u9664datadir\u76ee\u5f55\uff0c\nsudo rm -rf/var/lib/mysql/\ninnobackupex --apply-log /data/backup/                                                                               #\u65e5\u5fd7\u56de\u6eda\ninnobackupex --copy-back --defaults-file=/etc/my.cnf  /data/backup                                    #\u5907\u4efd\u6062\u590d\nsudo chown mysql.mysql-R /var/lib/mysql\nsudo /etc/init.d/mysql  start\n#\u67e5\u770b\u5df2\u7ecf\u6b63\u5e38\u542f\u52a8\n\n4. \u5728\u4e3b\u5e93\u521b\u5efatest_tb2\u8868\uff0c\u6a21\u62df\u6570\u636e\u5e93\u65b0\u589e\u6570\u636e\nmysql> create tabletest_tb2(id int,name varchar(30));\n\n5. \u4ece\u5907\u4efd\u76ee\u5f55\u4e2dxtrabackup_info\u6587\u4ef6\u83b7\u53d6\u5230binlog\u548cpos\u4f4d\u7f6e\ncat/var/lib/mysql/xtrabackup_info\n\nbinlog_pos = filename'mysql-bin.000001', position 429    #\u8fd9\u4e2a\u4f4d\u7f6e\n\n6. \u4ece\u5e93\u8bbe\u7f6e\u4ece\u8fd9\u4e2a\u65e5\u5fd7\u70b9\u540c\u6b65\uff0c\u5e76\u542f\u52a8\n\nmysql> change masterto master_host='192.168.18.212',\n    -> master_user='sync',\n    -> master_password='sync',\n    -> master_log_file='mysql-bin.000001',\n    -> master_log_pos=429;\nmysql> start slave;\nmysql> show slavestatus\\G;\n***************************1. row ***************************\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n......\n\n7. \u4ece\u5e93\u67e5\u770bweibo\u5e93\u91cc\u9762\u7684\u8868\n\u53ef\u4ee5\u770b\u5230IO\u548cSQL\u7ebf\u7a0b\u5747\u4e3aYES\uff0c\u8bf4\u660e\u4e3b\u4ece\u914d\u7f6e\u6210\u529f\u3002\n\nmysql> show tables;\n+---------------------------+\n| Tables_in_weibo           |\n+---------------------------+\n| test_tb                   |\n| test_tb2                  |\n\u53d1\u73b0\u521a\u624d\u6a21\u62df\u521b\u5efa\u7684test_tb2\u8868\u5df2\u7ecf\u540c\u6b65\u8fc7\u6765\u3002\n\n\n\n#################\u7b80\u5316####################################################\ninnobackupex  --user=root --password=cXXX --defaults-file=/etc/my.cnf /data/backup   #\u5907\u4efd\ninnobackupex --apply-log /data/backup/                                                                               #\u65e5\u5fd7\u56de\u6eda\n\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\ndatadir= path\n\u6ce8\u610f\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684path \u548c/data/backup    \u4e0d\u80fd\u76f8\u540c\u3002\ninnobackupex --copy-back --defaults-file=/etc/my.cnf  /data/backup                                    #\u5907\u4efd\u6062\u590d\n\n\n\u4e3b\u4ece\u90fd\u5f00\u542f\u4e86gtid\uff0c\u5728\u8bbe\u7f6e\u4ece\u5e93\u7684\u65f6\u5019\u9047\u5230\u4e86\u95ee\u9898\nmysql> CHANGE MASTER TO MASTER_HOST=\u2018xxx\u2019,MASTER_USER='replicant',MASTER_PASSWORD=\u2018xxx\u2019, MASTER_LOG_FILE='bin.000050', MASTER_LOG_POS=191;ERROR 1776 (HY000): Parameters MASTER_LOG_FILE, MASTER_LOG_POS, RELAY_LOG_FILE and RELAY_LOG_POS cannot be set when MASTER_AUTO_POSITION is active.\n\n\u89e3\u51b3\u7684\u529e\u6cd5\nmysql> change master to master_auto_position=0;\nQuery OK, 0 rows affected (0.34 sec)\n\nmysql> CHANGE MASTER TO MASTER_HOST=\u2018xxx\u2019,MASTER_USER='replicant',MASTER_PASSWORD=\u2018xxx\u2019, MASTER_LOG_FILE='bin.000050', MASTER_LOG_POS=191;\nQuery OK, 0 rows affected, 2 warnings (0.51 sec)\n\nmysql> START SLAVE;\nQuery OK, 0 rows affected (0.08 sec)\n\nmysql> SHOW SLAVE STATUS \\G\n\nchange master to master_host='10.21.8.57',master_user='mysqlsync',master_password='12345678',MASTER_AUTO_POSITION=1;\n\n\n\u5907\u4efd\uff1a\n\n/data/bin/xtrabackup/bin/innobackupex  --user=root --password=cXXX --defaults-file=/etc/my.cnf /data/backup/full/\n\n\u6062\u590d\uff1a\n1\uff1a\u5e94\u7528\u65e5\u5fd7\n/data/bin/xtrabackup/bin/innobackupex --apply-log /data/backup/2014-01-24_11-36-53/\n2\uff1a\u6570\u636e\u6062\u590d\n/data/bin/xtrabackup/bin/innobackupex --copy-back --defaults-file=/etc/my.cnf  /data/backup/2014-01-24_11-36-53/\n3\uff1a\nchown -R mysql:mysql /data/mysqldata/\n4\uff1a\u542f\u52a8\n\n\ninnobackupex  --defaults-file=/etc/my.cnf --user=backup --password='bc.123456'  --socket=/var/lib/mysql/mysql.sock    --slave-info  --safe-slave-backup   --no-timestamp  /backup/full\n\u5907\u4efd\u6e90\u5e93\u4e0a\u6062\u590d\u65e5\u5fd7\n\u5907\u4efd\u5b8c\u6210\u540e\uff0c\u8fd8\u4e0d\u80fd\u7528\u4e8e\u6062\u590d\uff0c\u4e00\u4e9b\u672a\u63d0\u4ea4\u7684\u4e8b\u7269\u9700\u8981\u6062\u590d\uff0c\u9700\u8981\u6062\u590dredo logo\u7684\u6570\u636e\uff0c\u786e\u4fdd\u6570\u636e\u4e00\u81f4\n[root@dg backup]\\# innobackupex --apply-log /backup/full\n\u4f20\u8f93\u6570\u636e\u5230\u65b0\u7684\u5907\u5e93\n[root@dg backup]\\# scp  -r full/  dgt:/backup/\n")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"\u90e8\u5206\u5185\u5bb9\u6765\u6e90\u4e8e\u7f51\u7edc\u3002")))}m.isMDXComponent=!0}}]);