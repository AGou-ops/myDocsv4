"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[8972],{3905:(n,e,s)=>{s.d(e,{Zo:()=>p,kt:()=>u});var t=s(67294);function a(n,e,s){return e in n?Object.defineProperty(n,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[e]=s,n}function r(n,e){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.push.apply(s,t)}return s}function o(n){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?r(Object(s),!0).forEach((function(e){a(n,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(s,e))}))}return n}function l(n,e){if(null==n)return{};var s,t,a=function(n,e){if(null==n)return{};var s,t,a={},r=Object.keys(n);for(t=0;t<r.length;t++)s=r[t],e.indexOf(s)>=0||(a[s]=n[s]);return a}(n,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(t=0;t<r.length;t++)s=r[t],e.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(n,s)&&(a[s]=n[s])}return a}var c=t.createContext({}),i=function(n){var e=t.useContext(c),s=e;return n&&(s="function"==typeof n?n(e):o(o({},e),n)),s},p=function(n){var e=i(n.components);return t.createElement(c.Provider,{value:e},n.children)},d={inlineCode:"code",wrapper:function(n){var e=n.children;return t.createElement(t.Fragment,{},e)}},m=t.forwardRef((function(n,e){var s=n.components,a=n.mdxType,r=n.originalType,c=n.parentName,p=l(n,["components","mdxType","originalType","parentName"]),m=i(s),u=a,h=m["".concat(c,".").concat(u)]||m[u]||d[u]||r;return s?t.createElement(h,o(o({ref:e},p),{},{components:s})):t.createElement(h,o({ref:e},p))}));function u(n,e){var s=arguments,a=e&&e.mdxType;if("string"==typeof n||a){var r=s.length,o=new Array(r);o[0]=m;var l={};for(var c in e)hasOwnProperty.call(e,c)&&(l[c]=e[c]);l.originalType=n,l.mdxType="string"==typeof n?n:a,o[1]=l;for(var i=2;i<r;i++)o[i]=s[i];return t.createElement.apply(null,o)}return t.createElement.apply(null,s)}m.displayName="MDXCreateElement"},47806:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>i});var t=s(87462),a=(s(67294),s(3905));const r={},o=void 0,l={unversionedId:"LinuxBasics/\u81ea\u5efadns",id:"LinuxBasics/\u81ea\u5efadns",title:"\u81ea\u5efadns",description:"\u4f7f\u7528bind",source:"@site/docs/LinuxBasics/\u81ea\u5efadns.md",sourceDirName:"LinuxBasics",slug:"/LinuxBasics/\u81ea\u5efadns",permalink:"/docs/LinuxBasics/\u81ea\u5efadns",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/LinuxBasics/\u81ea\u5efadns.md",tags:[],version:"current",frontMatter:{},sidebar:"linuxBasics",previous:{title:"\u672a\u547d\u540d",permalink:"/docs/LinuxBasics/\u672a\u547d\u540d"},next:{title:"\u81ea\u5efa\u90ae\u7bb1\u670d\u52a1\u5668",permalink:"/docs/LinuxBasics/\u81ea\u5efa\u90ae\u7bb1\u670d\u52a1\u5668"}},c={},i=[{value:"\u4f7f\u7528bind",id:"\u4f7f\u7528bind",level:2},{value:"\u4f7f\u7528dnsmasq",id:"\u4f7f\u7528dnsmasq",level:2},{value:"\u670d\u52a1\u5b89\u88c5\u4e0e\u542f\u52a8",id:"\u670d\u52a1\u5b89\u88c5\u4e0e\u542f\u52a8",level:2},{value:"\u5feb\u901f\u914d\u7f6e\u81ea\u5b9a\u4e49\u57df\u540ddns\u89e3\u6790",id:"\u5feb\u901f\u914d\u7f6e\u81ea\u5b9a\u4e49\u57df\u540ddns\u89e3\u6790",level:3},{value:"\u5ba2\u6237\u7aef\u6d4b\u8bd5",id:"\u5ba2\u6237\u7aef\u6d4b\u8bd5",level:3},{value:"DNSMASQ GUI",id:"dnsmasq-gui",level:3},{value:"\u5e38\u7528\u914d\u7f6e\u9009\u9879",id:"\u5e38\u7528\u914d\u7f6e\u9009\u9879",level:3},{value:"dnsmasq in Docker",id:"dnsmasq-in-docker",level:3},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}],p={toc:i};function d(n){let{components:e,...s}=n;return(0,a.kt)("wrapper",(0,t.Z)({},p,s,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"\u4f7f\u7528bind"},"\u4f7f\u7528bind"),(0,a.kt)("p",null,"\u914d\u7f6e\u6709\u70b9\u7e41\u7410\uff0c\u4e0d\u7528\u4e86."),(0,a.kt)("p",null,"\u53c2\u8003\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://www.google.com/search?q=%E8%87%AA%E5%BB%BAdns%E6%9C%8D%E5%8A%A1%E5%99%A8"},"https://www.google.com/search?q=%E8%87%AA%E5%BB%BAdns%E6%9C%8D%E5%8A%A1%E5%99%A8")),(0,a.kt)("h2",{id:"\u4f7f\u7528dnsmasq"},"\u4f7f\u7528dnsmasq"),(0,a.kt)("p",null,"Linux\u4e2dDNS\u7684\u5904\u7406\u6d41\u7a0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"test.com -> /etc/hosts -> /etc/resolv.conf -> dnsmasq")),(0,a.kt)("p",null,"dnsmasq\u4e2d\u7684DNS \u5904\u7406\u6d41\u7a0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"dnsmasq -> hosts.dnsmasq -> /etc/dnsmasq.conf / dnsmasq.conf -> resolv.dnsmasq.conf")),(0,a.kt)("h2",{id:"\u670d\u52a1\u5b89\u88c5\u4e0e\u542f\u52a8"},"\u670d\u52a1\u5b89\u88c5\u4e0e\u542f\u52a8"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"apt install dnsmasq -y\n\nsystemctl start dnsmasq\n\n# \u547d\u4ee4\u884c\u5de5\u5177\n# \u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u8bed\u6cd5\u662f\u5426\u6b63\u786e\ndnsmasq -test\n")),(0,a.kt)("p",null,"\u914d\u7f6e\u6587\u4ef6",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/dnsmasq.conf"),"(\u6216\u8005",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/dnsmasq.d"),"\u6587\u4ef6\u5939)."),(0,a.kt)("h3",{id:"\u5feb\u901f\u914d\u7f6e\u81ea\u5b9a\u4e49\u57df\u540ddns\u89e3\u6790"},"\u5feb\u901f\u914d\u7f6e\u81ea\u5b9a\u4e49\u57df\u540ddns\u89e3\u6790"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'# \u590d\u5236\u539f\u6765\u7684hosts\u6587\u4ef6\u5e76\u91cd\u65b0\u547d\u540d\uff0c\u7528\u4e8e\u540e\u7eed\u914d\u7f6ednsmasq\u7684\u9759\u6001\u89e3\u6790\ncp /etc/hosts /etc/hosts.dnsmasq\n# \u590d\u5236dns\u89e3\u6790\u7528\u4e8ednsmasq\u89e3\u6790\ncp /etc/resolv.conf /etc/resolv.dnsmasq.conf\n\n# \u4fee\u6539`/etc/dnsmasq.conf`\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a\n$ cat /etc/dnsmasq.conf\nresolv-file=/etc/resolv.dnsmasq.conf\nstrict-order\naddn-hosts=/etc/hosts.dnsmasq\n\n# \u6307\u5b9a\u4e0a\u6e38\u7684dns\u89e3\u6790\u670d\u52a1\u5668\n$ cat /etc/resolv.dnsmasq.conf\nnameserver 10.211.55.7\nnameserver 114.114.114.114\nnameserver 8.8.8.8\n# \u81ea\u5b9a\u4e49hosts\uff0c\u6307\u5b9a\u9759\u6001\u7684dns\u89e3\u6790\necho "192.168.3.51 git.localmac.com" >> /etc/hosts.dnsmasq\n\n# \u6700\u540e\u91cd\u542fdnsmasq\u670d\u52a1\u5373\u53ef\u3002\nsystemctl restart dnsmasq\n')),(0,a.kt)("p",null,"\u2139\ufe0f\u4fee\u6539hosts\u76f8\u5173\u6587\u4ef6\u4e4b\u540e\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"dnsmasq"),"\u4e0d\u4f1a\u81ea\u52a8\u91cd\u8f7d\u914d\u7f6e\uff0c\u9700\u8981\u91cd\u65b0\u542f\u52a8\u624d\u80fd\u751f\u6548\uff0c\u5728\u8fd9\u91cc\u6211\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"inotify"),"\u7ed3\u5408bash\u547d\u4ee4\u6765\u81ea\u52a8\u91cd\u542f",(0,a.kt)("inlineCode",{parentName:"p"},"dnsmasq"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"apt install -y inotify-tools\n\n# \u521b\u5efa\u76d1\u542c\u811a\u672c\uff0crestart_dnsmasq.sh\n#!/usr/bin/env bash\ninotifywait -m -e CLOSE_WRITE /etc/hosts* |\nwhile read events;\ndo\n    echo $events;\n    systemctl restart dnsmasq\ndone\n")),(0,a.kt)("h3",{id:"\u5ba2\u6237\u7aef\u6d4b\u8bd5"},"\u5ba2\u6237\u7aef\u6d4b\u8bd5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# \u6d4b\u8bd5\u81ea\u5b9a\u4e49\u57df\u540d\u7684dns\u89e3\u6790\n\u276f dig git.localmac.com @10.211.55.7\n\n; <<>> DiG 9.10.6 <<>> git.localmac.com @10.211.55.7\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 42806\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;git.localmac.com.              IN      A\n\n;; ANSWER SECTION:\ngit.localmac.com.       0       IN      A       192.168.3.51\n\n;; Query time: 7 msec\n;; SERVER: 10.211.55.7#53(10.211.55.7)\n;; WHEN: Tue Apr 18 14:19:00 CST 2023\n;; MSG SIZE  rcvd: 61\n\n# \u6d4b\u8bd5dns\u4e0a\u6e38\n\u276f dig taobao.com @10.211.55.7\n\n; <<>> DiG 9.10.6 <<>> taobao.com @10.211.55.7\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 45049\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 512\n;; QUESTION SECTION:\n;taobao.com.                    IN      A\n\n;; ANSWER SECTION:\ntaobao.com.             219     IN      A       59.82.122.115\ntaobao.com.             219     IN      A       106.11.226.158\n\n;; Query time: 40 msec\n;; SERVER: 10.211.55.7#53(10.211.55.7)\n;; WHEN: Tue Apr 18 14:19:33 CST 2023\n;; MSG SIZE  rcvd: 71\n")),(0,a.kt)("h3",{id:"dnsmasq-gui"},"DNSMASQ GUI"),(0,a.kt)("p",null,"\u9879\u76ee\u5730\u5740\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/nzgamer41/dnsmasqgui"},"https://github.com/nzgamer41/dnsmasqgui")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"apt update -y\n\napt install nginx php-fpm -y\n\n# \u6dfb\u52a0\u7528\u6237\u548c\u7528\u6237\u7ec4\nsudo groupadd php_user\nsudo useradd -g php_user php_user\n\n$ cat /etc/php/8.2/fpm/pool.d/dnsmasq.conf\n[dnsmasq_gui]\nuser = php_user\ngroup = php_user\n; listen = 9000\nlisten = /var/run/php-fpm-dnsmasq.sock\nlisten.owner = root\nlisten.group = root\nphp_admin_value[disable_functions] = exec,passthru,shell_exec,system\nphp_admin_flag[allow_url_fopen] = off\n; Choose how the process manager will control the number of child processes. \npm = dynamic \npm.max_children = 75 \npm.start_servers = 10 \npm.min_spare_servers = 5 \npm.max_spare_servers = 20 \npm.process_idle_timeout = 10s\n\n# \u6ce8\u610f\u4e0a\u9762\u7684listen.owner\u548cgroup\u662fnginx\u8fd0\u884c\u7684\u7528\u6237\u540d\u548c\u7528\u6237\u7ec4\n\nnginx config:\n\nserver {\n         listen       80;\n         server_name  _;\n         root         /var/www/html/dnsmasq;\n\n         access_log /var/log/nginx/dnsmasq-access.log;\n         error_log  /var/log/nginx/dnsmasq-error.log error;\n         index index.html index.htm index.php;\n\n         location / {\n                      try_files $uri $uri/ /index.php$is_args$args;\n         }\n\n         location ~ \\.php$ {\n            fastcgi_split_path_info ^(.+\\.php)(/.+)$;\n            fastcgi_pass unix:/var/run/php-fpm-dnsmasq.sock;\n            fastcgi_index index.php;\n            include fastcgi.conf;\n    }\n}\n")),(0,a.kt)("p",null,"\u5982\u679c\u9047\u5230\u6ca1\u6709\u5199\u5165\u6743\u9650\uff0c\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"chmod g+w /etc/hosts"),"\u4e3a\u7528\u6237\u7ec4\u6dfb\u52a0\u5199\u5165\u6743\u9650\uff0c\u5e76\u4e14\u5c06\u7528\u6237",(0,a.kt)("inlineCode",{parentName:"p"},"php_user"),"\u52a0\u5165\u5bf9\u5e94\u7684\u7528\u6237\u7ec4",(0,a.kt)("inlineCode",{parentName:"p"},"usermod -aG root php_user")),(0,a.kt)("h3",{id:"\u5e38\u7528\u914d\u7f6e\u9009\u9879"},"\u5e38\u7528\u914d\u7f6e\u9009\u9879"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# \u76d1\u542c\u5730\u5740\uff1a\n# \u5982\u679c\u53ea\u5199 127.0.0.1 \u5219\u53ea\u5904\u7406\u672c\u673a\u7684 DNS \u89e3\u6790\uff0c\u4e0d\u5199\u8fd9\u53e5\u9ed8\u8ba4\u76d1\u542c\u6240\u6709\u7f51\u53e3\nlisten-address=127.0.0.1,192.168.8.132\n\n# \u6307\u5b9a\u81ea\u5b9a\u4e49 hosts \u6587\u4ef6\uff1a\naddn-hosts=/etc/hosts.dnsmasq\n\n# \u6307\u5b9a\u4e0a\u6e38 DNS \u670d\u52a1\u5217\u8868\u7684\u914d\u7f6e\u6587\u4ef6\nresolv-file=/etc/resolv.dnsmasq.conf\n\n# \u6309\u7167 DNS \u5217\u8868\u4e00\u4e2a\u4e2a\u67e5\u8be2\uff0c\u5426\u5219\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u6240\u6709 DNS \u670d\u52a1\u5668\nstrict-order\n\n# \u8868\u793a\u5bf9\u4e0b\u9762\u8bbe\u7f6e\u7684\u6240\u6709 server \u53d1\u8d77\u67e5\u8be2\u8bf7\u6c42\uff0c\u9009\u62e9\u54cd\u5e94\u6700\u5feb\u7684\u670d\u52a1\u5668\u7684\u7ed3\u679c\nall-servers\n\n# \u6307\u5b9a\u9ed8\u8ba4\u67e5\u8be2\u7684\u4e0a\u6e38\u670d\u52a1\u5668\nserver=8.8.8.8\nserver=114.114.114.114\n\n# \u6307\u5b9a .cn \u7684\u57df\u540d\u5168\u90e8\u901a\u8fc7 114.114.114.114 \u8fd9\u53f0\u56fd\u5185DNS\u670d\u52a1\u5668\u6765\u89e3\u6790\nserver=/cn/114.114.114.114\n\n# \u7ed9 *.apple.com \u548c taobao.com \u4f7f\u7528\u4e13\u7528\u7684 DNS\nserver=/taobao.com/223.5.5.5\nserver=/.apple.com/223.6.6.6\n\n# \u589e\u52a0\u4e00\u4e2a\u57df\u540d\uff0c\u5f3a\u5236\u89e3\u6790\u5230\u6240\u6307\u5b9a\u7684\u5730\u5740\u4e0a\uff0cdns \u6b3a\u9a97\naddress=/360.com/127.0.0.1\n\n# \u52a0\u8f7d\u5916\u90e8\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\uff1a\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684\u6269\u5c55\u540d\u4e3a conf \u7684\u6587\u4ef6\nconf-dir=/etc/config/dnsmasq, *.conf\n\n# \u8bbe\u7f6eDNS\u7f13\u5b58\u5927\u5c0f(\u5355\u4f4d\uff1aDNS\u89e3\u6790\u6761\u6570)\ncache-size=500\n\n# \u5b58\u50a8\u57df\u540d\u89e3\u6790\u7684 IP \u5730\u5740\u7ed3\u679c\u5b58\u50a8\u5230 saveresult \u7684 ipset \u7ed3\u679c\u4e2d\uff0c\u53ef\u4ee5\u4ea4\u7ed9iptables\u8bc6\u522b\u548c\u8f6c\u53d1\nipset=/test.com/saveresult\n")),(0,a.kt)("h3",{id:"dnsmasq-in-docker"},"dnsmasq in Docker"),(0,a.kt)("p",null,"docker \u955c\u50cf\u5730\u5740\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/4km3/dnsmasq"},"https://hub.docker.com/r/4km3/dnsmasq")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -p 53:53/tcp -p 53:53/udp --cap-add=NET_ADMIN 4km3/dnsmasq:2.85-r2 -S /consul/10.17.0.2\n")),(0,a.kt)("p",null,"\u8be5\u547d\u4ee4\u8fd0\u884c\u4e00\u4e2a",(0,a.kt)("inlineCode",{parentName:"p"},"dnsmasq"),"\u5bb9\u5668\uff0c\u5e76\u5c06",(0,a.kt)("inlineCode",{parentName:"p"},"consul"),"\u6620\u5c04\u5230",(0,a.kt)("inlineCode",{parentName:"p"},"10.17.0.2"),"\u3002"),(0,a.kt)("h2",{id:"\u53c2\u8003\u94fe\u63a5"},"\u53c2\u8003\u94fe\u63a5"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://blog.niekun.net/archives/1869.html"},"https://blog.niekun.net/archives/1869.html")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/LinuxBasics/dnsmasq"},"./dnsmasq"))))}d.isMDXComponent=!0}}]);