"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[4021],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,s=e.originalType,o=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),c=p(n),g=l,k=c["".concat(o,".").concat(g)]||c[g]||m[g]||s;return n?a.createElement(k,i(i({ref:t},u),{},{components:n})):a.createElement(k,i({ref:t},u))}));function g(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var s=n.length,i=new Array(s);i[0]=c;var r={};for(var o in t)hasOwnProperty.call(t,o)&&(r[o]=t[o]);r.originalType=e,r.mdxType="string"==typeof e?e:l,i[1]=r;for(var p=2;p<s;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},56969:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>r,toc:()=>p});var a=n(87462),l=(n(67294),n(3905));const s={},i="Logstash Basic & Plugins",r={unversionedId:"CloudNative/ELFK/Logstash Basic - Plugins",id:"CloudNative/ELFK/Logstash Basic - Plugins",title:"Logstash Basic & Plugins",description:"Logstash \u7b80\u4ecb",source:"@site/docs/CloudNative/ELFK/Logstash Basic - Plugins.md",sourceDirName:"CloudNative/ELFK",slug:"/CloudNative/ELFK/Logstash Basic - Plugins",permalink:"/docs/CloudNative/ELFK/Logstash Basic - Plugins",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CloudNative/ELFK/Logstash Basic - Plugins.md",tags:[],version:"current",frontMatter:{},sidebar:"cloudNative",previous:{title:"Kafka/Redis + ELFK\u5206\u5e03\u5f0f\u65e5\u5fd7\u6536\u96c6",permalink:"/docs/CloudNative/ELFK/Kafka-Redis-ELFK\u5206\u5e03\u5f0f\u65e5\u5fd7\u6536\u96c6"},next:{title:"Logstash \u65e5\u5fd7\u5206\u6d41",permalink:"/docs/CloudNative/ELFK/Logstash \u65e5\u5fd7\u5206\u6d41"}},o={},p=[{value:"Logstash \u7b80\u4ecb",id:"logstash-\u7b80\u4ecb",level:2},{value:"\u63d2\u4ef6\u79bb\u7ebf\u7ba1\u7406",id:"\u63d2\u4ef6\u79bb\u7ebf\u7ba1\u7406",level:2},{value:"\u63d2\u4ef6\u6253\u5305",id:"\u63d2\u4ef6\u6253\u5305",level:3},{value:"\u63d2\u4ef6\u5b89\u88c5",id:"\u63d2\u4ef6\u5b89\u88c5",level:3},{value:"\u63d2\u4ef6\u5347\u7ea7",id:"\u63d2\u4ef6\u5347\u7ea7",level:3},{value:"\u63d2\u4ef6\u79fb\u9664",id:"\u63d2\u4ef6\u79fb\u9664",level:3},{value:"Input Plugins",id:"input-plugins",level:2},{value:"Filter Plugins",id:"filter-plugins",level:2},{value:"Codec Plugins",id:"codec-plugins",level:2},{value:"Output Plugins",id:"output-plugins",level:2},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}],u={toc:p};function m(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"logstash-basic--plugins"},"Logstash Basic & Plugins"),(0,l.kt)("h2",{id:"logstash-\u7b80\u4ecb"},"Logstash \u7b80\u4ecb"),(0,l.kt)("p",null,"\u8f93\u5165\u3001\u8fc7\u6ee4\u5668\u548c\u8f93\u51fa\uff1a"),(0,l.kt)("p",null,"Logstash \u80fd\u591f\u52a8\u6001\u5730\u91c7\u96c6\u3001\u8f6c\u6362\u548c\u4f20\u8f93\u6570\u636e\uff0c\u4e0d\u53d7\u683c\u5f0f\u6216\u590d\u6742\u5ea6\u7684\u5f71\u54cd\u3002\u5229\u7528 Grok \u4ece\u975e\u7ed3\u6784\u5316\u6570\u636e\u4e2d\u6d3e\u751f\u51fa\u7ed3\u6784\uff0c\u4ece IP \u5730\u5740\u89e3\u7801\u51fa\u5730\u7406\u5750\u6807\uff0c\u533f\u540d\u5316\u6216\u6392\u9664\u654f\u611f\u5b57\u6bb5\uff0c\u5e76\u7b80\u5316\u6574\u4f53\u5904\u7406\u8fc7\u7a0b\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.elastic.co/guide/en/logstash/current/static/images/basic_logstash_pipeline.png",alt:null,title:"Logstash Arch"})),(0,l.kt)("p",null,"\u5b98\u65b9\u56fe\u6587\u5e76\u8302\u7b80\u4ecb\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://www.elastic.co/cn/logstash"},"https://www.elastic.co/cn/logstash")),(0,l.kt)("h2",{id:"\u63d2\u4ef6\u79bb\u7ebf\u7ba1\u7406"},"\u63d2\u4ef6\u79bb\u7ebf\u7ba1\u7406"),(0,l.kt)("h3",{id:"\u63d2\u4ef6\u6253\u5305"},"\u63d2\u4ef6\u6253\u5305"),(0,l.kt)("p",null,"\u786e\u4fdd\u8981\u6253\u5305\u7684\u6240\u6709\u63d2\u4ef6\u90fd\u5df2\u5b89\u88c5\u5728\u767b\u53f0\u670d\u52a1\u5668\u4e0a\uff0c\u5e76\u4e14\u8be5\u767b\u53f0\u670d\u52a1\u5668\u53ef\u4ee5\u8bbf\u95eeInternet\u3002"),(0,l.kt)("p",null,"\u8fd0\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"bin/logstash-plugin prepare-offline-pack"),"\u5b50\u547d\u4ee4\u6765\u6253\u5305\u63d2\u4ef6\u548c\u4f9d\u8d56\u9879\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# bin/logstash-plugin prepare-offline-pack --output OUTPUT --overwrite [PLUGINS]\n\n# \u6253\u5305Beats\u8f93\u5165\u63d2\u4ef6\u548c\u6240\u6709\u4f9d\u8d56\u9879\nbin/logstash-plugin prepare-offline-pack logstash-input-beats \n# \u4f7f\u7528\u901a\u914d\u7b26\u6253\u5305\u6240\u6709\u8fc7\u6ee4\u5668\u63d2\u4ef6\u548c\u6240\u6709\u4f9d\u8d56\u9879\nbin/logstash-plugin prepare-offline-pack logstash-filter-* \n# \u6253\u5305\u6240\u6709\u8fc7\u6ee4\u5668\u63d2\u4ef6\uff0cBeats\u8f93\u5165\u63d2\u4ef6\u4ee5\u53ca\u6240\u6709\u4f9d\u8d56\u9879\nbin/logstash-plugin prepare-offline-pack logstash-filter-* logstash-input-beats \n")),(0,l.kt)("h3",{id:"\u63d2\u4ef6\u5b89\u88c5"},"\u63d2\u4ef6\u5b89\u88c5"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Windows example:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"bin/logstash-plugin install file:///c:/path/to/logstash-offline-plugins-7.7.1.zip\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Linux example:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"bin/logstash-plugin install file:///path/to/logstash-offline-plugins-7.7.1.zip\n")),(0,l.kt)("h3",{id:"\u63d2\u4ef6\u5347\u7ea7"},"\u63d2\u4ef6\u5347\u7ea7"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"# \u5347\u7ea7\u6240\u6709\nbin/logstash-plugin update \nbin/logstash-plugin update logstash-output-kafka \n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u66f4\u591a\u53c2\u8003\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/logstash/current/offline-plugins.html#_updating_offline_plugins"},"https://www.elastic.co/guide/en/logstash/current/offline-plugins.html#_updating_offline_plugins"))),(0,l.kt)("h3",{id:"\u63d2\u4ef6\u79fb\u9664"},"\u63d2\u4ef6\u79fb\u9664"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"bin/logstash-plugin remove logstash-output-kafka\n")),(0,l.kt)("h2",{id:"input-plugins"},"Input Plugins"),(0,l.kt)("p",null,"\u8ba9 logstash \u53ef\u4ee5\u8bfb\u53d6\u7279\u5b9a\u7684\u4e8b\u4ef6\u6e90\uff0c \u4e8b\u4ef6\u6e90\u53ef\u4ee5\u662f\u4ece",(0,l.kt)("inlineCode",{parentName:"p"},"stdin"),"\u5c4f\u5e55\u8f93\u5165\u8bfb\u53d6\uff0c\u53ef\u4ee5\u4ece",(0,l.kt)("inlineCode",{parentName:"p"},"file"),"\u6307\u5b9a\u7684\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u4ece",(0,l.kt)("inlineCode",{parentName:"p"},"es"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"filebeat"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"kafka"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"redis"),"\u7b49\u8bfb\u53d6\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"stadin"),"\uff1a\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"file"),"\uff1a\u4ece\u6587\u4ef6\u8bfb\u53d6\u6570\u636e")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"file{\n    path => ['/var/log/nginx/access.log']  # \u8981\u8f93\u5165\u7684\u6587\u4ef6\u8def\u5f84\n    type => 'nginx_access_log'\n    start_position => \"beginning\"\n}\n# path  \u53ef\u4ee5\u7528/var/log/*.log,/var/log/**/*.log\uff0c\u5982\u679c\u662f/var/log\u5219\u662f/var/log/*.log\n# type \u901a\u7528\u9009\u9879. \u7528\u4e8e\u6fc0\u6d3b\u8fc7\u6ee4\u5668\n# start_position \u9009\u62e9logstash\u5f00\u59cb\u8bfb\u53d6\u6587\u4ef6\u7684\u4f4d\u7f6e\uff0cbegining\u6216\u8005end\u3002\n# \u8fd8\u6709\u4e00\u4e9b\u5e38\u7528\u7684\u4f8b\u5982\uff1adiscover_interval\uff0cexclude\uff0csincedb_path,sincedb_write_interval\u7b49\u53ef\u4ee5\u53c2\u8003\u5b98\u7f51\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"syslog"),"\uff1a \u901a\u8fc7\u7f51\u7edc\u5c06\u7cfb\u7edf\u65e5\u5fd7\u6d88\u606f\u8bfb\u53d6\u4e3a\u4e8b\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'syslog{\n    port =>"514" \n    type => "syslog"\n}\n# port \u6307\u5b9a\u76d1\u542c\u7aef\u53e3(\u540c\u65f6\u5efa\u7acbTCP/UDP\u7684514\u7aef\u53e3\u7684\u76d1\u542c)\n \n#\u4ecesyslogs\u8bfb\u53d6\u9700\u8981\u5b9e\u73b0\u914d\u7f6ersyslog\uff1a\n# cat /etc/rsyslog.conf   \u52a0\u5165\u4e00\u884c\n# ------------------------------\n*.* @172.17.128.200:514\u3000  #\u6307\u5b9a\u65e5\u5fd7\u8f93\u5165\u5230\u8fd9\u4e2a\u7aef\u53e3\uff0c\u7136\u540elogstash\u76d1\u542c\u8fd9\u4e2a\u7aef\u53e3\uff0c\u5982\u679c\u6709\u65b0\u65e5\u5fd7\u8f93\u5165\u5219\u8bfb\u53d6\n# service rsyslog restart   #\u91cd\u542f\u65e5\u5fd7\u670d\u52a1\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"beats"),"\uff1a\u4ece ",(0,l.kt)("strong",{parentName:"li"},(0,l.kt)("em",{parentName:"strong"},"Elastic beats"))," \u83b7\u53d6\u4e8b\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'beats {\n    port => 5044   #\u8981\u76d1\u542c\u7684\u7aef\u53e3\n    client_inactivity_timeout => 600\n    ssl => true\n    ssl_certificate_authorities => ["/home/work/certificate/chain-ca.pem"]\n    ssl_certificate => "/home/work/certificate/server.crt.pem"\n    ssl_key => "/home/work/certificate/server.key.pem"\n    ssl_verify_mode => "force_peer"\n}\n# \u8fd8\u6709host\u7b49\u9009\u9879\n \n# \u4ecebeat\u8bfb\u53d6\u9700\u8981\u5148\u914d\u7f6ebeat\u7aef\uff0c\u4ecebeat\u8f93\u51fa\u5230logstash\u3002\n# vim /etc/filebeat/filebeat.yml \n# ------------------------\noutput.logstash:\nhosts: ["localhost:5044"]\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Kafka"),"\uff1a\u5c06 ",(0,l.kt)("strong",{parentName:"li"},(0,l.kt)("em",{parentName:"strong"},"kafka topic"))," \u4e2d\u7684\u6570\u636e\u8bfb\u53d6\u4e3a\u4e8b\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'kafka{\n    bootstrap_servers=> "kafka01:9092,kafka02:9092,kafka03:9092"\n    topics => ["access_log"]\n    group_id => "logstash-file"\n    codec => "json"\n}\n \nkafka{\n    bootstrap_servers=> "kafka01:9092,kafka02:9092,kafka03:9092"\n    topics => ["weixin_log","user_log"]  \n    codec => "json"\n}\n \n# bootstrap_servers \u7528\u4e8e\u5efa\u7acb\u7fa4\u96c6\u521d\u59cb\u8fde\u63a5\u7684Kafka\u5b9e\u4f8b\u7684URL\u5217\u8868\u3002\n# topics  \u8981\u8ba2\u9605\u7684\u4e3b\u9898\u5217\u8868\uff0ckafka topics\n# group_id \u6d88\u8d39\u8005\u6240\u5c5e\u7ec4\u7684\u6807\u8bc6\u7b26\uff0c\u9ed8\u8ba4\u4e3alogstash\u3002kafka\u4e2d\u4e00\u4e2a\u4e3b\u9898\u7684\u6d88\u606f\u5c06\u901a\u8fc7\u76f8\u540c\u7684\u65b9\u5f0f\u5206\u53d1\u5230Logstash\u7684group_id\n# codec \u901a\u7528\u9009\u9879\uff0c\u7528\u4e8e\u8f93\u5165\u6570\u636e\u7684\u7f16\u89e3\u7801\u5668\u3002\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u66f4\u591a\u63d2\u4ef6\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/logstash/current/input-plugins.html"},"https://www.elastic.co/guide/en/logstash/current/input-plugins.html"))),(0,l.kt)("h2",{id:"filter-plugins"},"Filter Plugins"),(0,l.kt)("p",null,"\u6570\u636e\u4ece\u6e90\u4f20\u8f93\u5230\u5b58\u50a8\u5e93\u7684\u8fc7\u7a0b\u4e2d\uff0cLogstash \u8fc7\u6ee4\u5668\u80fd\u591f\u89e3\u6790\u5404\u4e2a\u4e8b\u4ef6\uff0c\u8bc6\u522b\u5df2\u547d\u540d\u7684\u5b57\u6bb5\u4ee5\u6784\u5efa\u7ed3\u6784\uff0c\u5e76\u5c06\u5b83\u4eec\u8f6c\u6362\u6210\u901a\u7528\u683c\u5f0f\uff0c\u4ee5\u4fbf\u8fdb\u884c\u66f4\u5f3a\u5927\u7684\u5206\u6790\u548c\u5b9e\u73b0\u5546\u4e1a\u4ef7\u503c\u3002"),(0,l.kt)("p",null,"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5bf9\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"filter.conf"),"\u914d\u7f6e\u662f\u53ef\u4ee5\u70ed\u52a0\u8f7d\u7684\uff0c\u5982\u679c\u65f6\u95f4\u683c\u5f0f\u914d\u7f6e\u9519\u8bef\uff0c\u4f1a\u5bfc\u81f4logstash\u8fdb\u7a0b\u6302\u6389\uff0c\u5bf9\u4e8e\u95ee\u9898\u7684\u6392\u67e5\uff0c\u53ef\u4ee5\u81ea\u884c\u67e5\u8be2logstash\u7684\u65e5\u5fd7\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"grok"),"\uff1a\u89e3\u6790\u6587\u672c\u5e76\u6784\u9020 \uff0c\u628a\u975e\u7ed3\u6784\u5316\u65e5\u5fd7\u6570\u636e\u901a\u8fc7\u6b63\u5219\u89e3\u6790\u6210\u7ed3\u6784\u5316\u548c\u53ef\u67e5\u8be2\u5316 ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'grok {\n            match => {"message"=>"^%{IPORHOST:clientip} %{USER:ident} %{USER:auth} \\[%{HTTPDATE:timestamp}\\]" %{WORD:verb} %{DATA:request} HTTP/%{NUMBER:httpversion} "%{NUMBER:response:int} (?:-|%{NUMBER:bytes:int}) %{QS:referrer} %{QS:agent}$"}\n        }\n# \u5339\u914dnginx\u65e5\u5fd7\n# 203.202.254.16 - - [22/Jun/2018:16:12:54 +0800] "GET / HTTP/1.1" 200 3700 "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/601.7.7 (KHTML, like Gecko) Version/9.1.2 Safari/601.7.7"\n#220.181.18.96 - - [13/Jun/2015:21:14:28 +0000] "GET /blog/geekery/xvfb-firefox.html HTTP/1.1" 200 10975 "-" "Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)"\n \n# \u6ce8\u610f\u8fd9\u91ccgrok \u53ef\u4ee5\u6709\u591a\u4e2amatch\u5339\u914d\u89c4\u5219\uff0c\u5982\u679c\u524d\u9762\u7684\u5339\u914d\u5931\u8d25\u53ef\u4ee5\u4f7f\u7528\u540e\u9762\u7684\u7ee7\u7eed\u5339\u914d\u3002\u4f8b\u5982\ngrok {\n            match => ["message", "%{IP:clientip} - %{USER:user} \\[%{HTTPDATE:raw_datetime}\\] \\"(?:%{WORD:verb} %{URIPATHPARAM:request} HTTP/%{NUMBER:httpversion})\\" (?:\\"%{DATA:body}\\" )?(?:\\"%{DATA:cookie}\\" )?%{NUMBER:response} (?:%{NUMBER:bytes:int}|-) \\"%{DATA:referrer}\\" \\"%{DATA:agent}\\" (?:(%{IP:proxy},? ?)*|-|unknown) (?:%{DATA:upstream_addr} |)%{NUMBER:request_time:float} (?:%{NUMBER:upstream_time:float}|-)"]\n            match => ["message", "%{IP:clientip} - %{USER:user} \\[%{HTTPDATE:raw_datetime}\\] \\"(?:%{WORD:verb} %{URI:request} HTTP/%{NUMBER:httpversion})\\" (?:\\"%{DATA:body}\\" )?(?:\\"%{DATA:cookie}\\" )?%{NUMBER:response} (?:%{NUMBER:bytes:int}|-) \\"%{DATA:referrer}\\" \\"%{DATA:agent}\\" (?:(%{IP:proxy},? ?)*|-|unknown) (?:%{DATA:upstream_addr} |)%{NUMBER:request_time:float} (?:%{NUMBER:upstream_time:float}|-)"]       \n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"date"),"\uff1a\u65e5\u671f\u89e3\u6790  \u89e3\u6790\u5b57\u6bb5\u4e2d\u7684\u65e5\u671f\uff0c\u7136\u540e\u8f6c\u5b58\u5230",(0,l.kt)("strong",{parentName:"li"},(0,l.kt)("em",{parentName:"strong"},"@timestamp")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'grok{\n      match => {"message"=>"%{DATA:raw_datetime}"}\n}\ndate{\n       match => ["raw_datetime","YYYY-MM-dd HH:mm:ss,SSS"]\n       remove_field =>["raw_datetime"]\n}\n \n#\u5c06raw_datetime\u5b58\u5230@timestamp \u7136\u540e\u5220\u9664raw_datetime\n \n#24/Jul/2018:18:15:05 +0800\ndate {\n      match => ["timestamp","dd/MMM/YYYY:HH:mm:ss Z]\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mutate"),"  \uff1a\u5bf9\u5b57\u6bb5\u505a\u5904\u7406 \u91cd\u547d\u540d\u3001\u5220\u9664\u3001\u66ff\u6362\u548c\u4fee\u6539\u5b57\u6bb5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'filter {\n    mutate {\n        split => ["hostname", "."]\n        add_field => { "shortHostname" => "%{hostname[0]}" }\n    }\n\n    mutate {\n        rename => ["shortHostname", "hostname" ]\n    }\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mutate.covert"),"\uff1a\u7c7b\u578b\u8f6c\u6362\u7c7b\u578b\u5305\u62ec\uff1a",(0,l.kt)("strong",{parentName:"li"},(0,l.kt)("em",{parentName:"strong"},"integer\uff0cfloat\uff0cinteger_eu\uff0cfloat_eu\uff0cstring\u548cboolean")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'filter{\n    mutate{\n#     covert => ["response","integer","bytes","float"]  #\u6570\u7ec4\u7684\u7c7b\u578b\u8f6c\u6362\n        convert => {"message"=>"integer"}\n    }\n}\n#\u6d4b\u8bd5-------\x3e\n{\n          "host" => "localhost",\n       "message" => 123,    #\u6ca1\u5e26\u201c\u201d,int\u7c7b\u578b\n    "@timestamp" => 2018-06-26T02:51:08.651Z,\n      "@version" => "1"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mutate.split"),"\uff1a\u4f7f\u7528\u5206\u9694\u7b26\u628a\u5b57\u7b26\u4e32\u5206\u5272\u6210\u6570\u7ec4")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'mutate{\n    split => {"message"=>","}\n}\n#----------\x3e\naaa,bbb\n{\n    "@timestamp" => 2018-06-26T02:40:19.678Z,\n      "@version" => "1",\n          "host" => "localhost",\n       "message" => [\n        [0] "aaa",\n        [1] "bbb"\n    ]}\n192,128,1,100\n{\n        "host" => "localhost",\n     "message" => [\n      [0] "192",\n      [1] "128",\n      [2] "1",\n      [3] "100"\n ],\n  "@timestamp" => 2018-06-26T02:45:17.877Z,\n    "@version" => "1"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mutate.merge"),"\uff1a \u5408\u5e76\u5b57\u6bb5  \u3002\u6570\u7ec4\u548c\u5b57\u7b26\u4e32 \uff0c\u5b57\u7b26\u4e32\u548c\u5b57\u7b26\u4e32")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'filter{\n    mutate{\n        add_field => {"field1"=>"value1"}\n    }\n    mutate{ \n          split => {"message"=>"."}   #\u628amessage\u5b57\u6bb5\u6309\u7167.\u5206\u5272\n    }\n    mutate{\n        merge => {"message"=>"field1"}   #\u5c06filed1\u5b57\u6bb5\u52a0\u5165\u5230message\u5b57\u6bb5\n    }\n}\n#---------------\x3e\nabc\n{\n       "message" => [\n        [0] "abc,"\n        [1] "value1"\n    ],\n    "@timestamp" => 2018-06-26T03:38:57.114Z,\n        "field1" => "value1",\n      "@version" => "1",\n          "host" => "localhost"\n}\n \nabc,.123\n{\n       "message" => [\n        [0] "abc,",\n        [1] "123",\n        [2] "value1"\n    ],\n    "@timestamp" => 2018-06-26T03:38:57.114Z,\n        "field1" => "value1",\n      "@version" => "1",\n          "host" => "localhost"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mutate.rename"),"\uff1a  \u5bf9\u5b57\u6bb5\u91cd\u547d\u540d")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'filter{\n    mutate{\n        rename => {"message"=>"info"}\n    }\n}\n#--------\x3e\n{\n    "@timestamp" => 2018-06-26T02:56:00.189Z,\n          "info" => "123",\n      "@version" => "1",\n          "host" => "localhost"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"remove_field"),"\uff1a\u79fb\u9664\u5b57\u6bb5"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"join"),"\uff1a\u7528\u5206\u9694\u7b26\u8fde\u63a5\u6570\u7ec4\uff0c\u5982\u679c\u4e0d\u662f\u6570\u7ec4\u5219\u4e0d\u505a\u5904\u7406")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'mutate{\n        split => {"message"=>":"}\n}\nmutate{\n        join => {"message"=>","}\n}\n------\x3e\nabc:123\n{\n    "@timestamp" => 2018-06-26T03:55:41.426Z,\n       "message" => "abc,123",\n          "host" => "localhost",\n      "@version" => "1"\n}\naa:cc\n{\n    "@timestamp" => 2018-06-26T03:55:47.501Z,\n       "message" => "aa,cc",\n          "host" => "localhost",\n      "@version" => "1"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"gsub"),"\uff1a\u7528\u6b63\u5219\u6216\u8005\u5b57\u7b26\u4e32\u66ff\u6362\u5b57\u6bb5\u503c\u3002\u4ec5\u5bf9\u5b57\u7b26\u4e32\u6709\u6548\u3000")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'mutate{\n        gsub => ["message","/","_"]   #\u7528_\u66ff\u6362/\n    }\n \n------\x3e\na/b/c/\n{\n      "@version" => "1",\n       "message" => "a_b_c_",\n          "host" => "localhost",\n    "@timestamp" => 2018-06-26T06:20:10.811Z\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"update"),"\uff1a\u66f4\u65b0\u5b57\u6bb5\u3002\u5982\u679c\u5b57\u6bb5\u4e0d\u5b58\u5728\uff0c\u5219\u4e0d\u505a\u5904\u7406")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'mutate{\n        add_field => {"field1"=>"value1"}\n    }\n    mutate{\n        update => {"field1"=>"v1"}\n        update => {"field2"=>"v2"}    #field2\u4e0d\u5b58\u5728 \u4e0d\u505a\u5904\u7406\n    }\n----------------\x3e\n{\n    "@timestamp" => 2018-06-26T06:26:28.870Z,\n        "field1" => "v1",\n          "host" => "localhost",\n      "@version" => "1",\n       "message" => "a"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"replace"),"\uff1a\u66f4\u65b0\u5b57\u6bb5\u3002\u5982\u679c\u5b57\u6bb5\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'mutate{\n        add_field => {"field1"=>"value1"}\n    }\n    mutate{\n        replace => {"field1"=>"v1"}\n        replace => {"field2"=>"v2"}\n    }\n----------------------\x3e\n{\n       "message" => "1",\n          "host" => "localhost",\n    "@timestamp" => 2018-06-26T06:28:09.915Z,\n        "field2" => "v2",        #field2\u4e0d\u5b58\u5728\uff0c\u5219\u65b0\u5efa\n      "@version" => "1",\n        "field1" => "v1"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"geoip"),"\uff1a\u6839\u636e\u6765\u81eaMaxmind GeoLite2\u6570\u636e\u5e93\u7684\u6570\u636e\u6dfb\u52a0\u6709\u5173IP\u5730\u5740\u7684\u5730\u7406\u4f4d\u7f6e\u7684\u4fe1\u606f")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'geoip {\n            source => "clientip"\n            database =>"/tmp/GeoLiteCity.dat"\n        }\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"ruby"),"\uff1aruby\u63d2\u4ef6\u53ef\u4ee5\u6267\u884c\u4efb\u610fRuby\u4ee3\u7801")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"urldecode"),"\uff1a\u7528\u4e8e\u89e3\u7801\u88ab\u7f16\u7801\u7684\u5b57\u6bb5,\u53ef\u4ee5\u89e3\u51b3URL\u4e2d \u4e2d\u6587\u4e71\u7801\u7684\u95ee\u9898")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},' \n    urldecode{\n        field => "message"\n    }\n \n# field :\u6307\u5b9aurldecode\u8fc7\u6ee4\u5668\u8981\u8f6c\u7801\u7684\u5b57\u6bb5,\u9ed8\u8ba4\u503c\u662f"message"\n# charset(\u7f3a\u7701): \u6307\u5b9a\u8fc7\u6ee4\u5668\u4f7f\u7528\u7684\u7f16\u7801.\u9ed8\u8ba4UTF-8\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"kv"),"\uff1a\u901a\u8fc7\u6307\u5b9a\u5206\u9694\u7b26\u5c06\u5b57\u7b26\u4e32\u5206\u5272\u6210key/value")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'kv{\n        prefix => "url_"   #\u7ed9\u5206\u5272\u540e\u7684key\u52a0\u524d\u7f00\n        target => "url_ags"    #\u5c06\u5206\u5272\u540e\u7684key-value\u653e\u5165\u6307\u5b9a\u5b57\u6bb5\n        source => "message"   #\u8981\u5206\u5272\u7684\u5b57\u6bb5\n        field_split => "&"    #\u6307\u5b9a\u5206\u9694\u7b26\n        remove_field => "message"\n    }\n--------------------------\x3e\na=1&b=2&c=3\n{\n            "host" => "localhost",\n       "url_ags" => {\n          "url_c" => "3",\n          "url_a" => "1",\n          "url_b" => "2"\n    },\n      "@version" => "1",\n    "@timestamp" => 2018-06-26T07:07:24.557Z\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"useragent"),"\uff1a\u6dfb\u52a0\u6709\u5173\u7528\u6237\u4ee3\u7406(\u5982\u7cfb\u5217,\u64cd\u4f5c\u7cfb\u7edf,\u7248\u672c\u548c\u8bbe\u5907)\u7684\u4fe1\u606f")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'if [agent] != "-" {\n  useragent {\n    source => "agent"\n    target => "ua"\n    remove_field => "agent"\n  }\n}\n# if\u8bed\u53e5\uff0c\u53ea\u6709\u5728agent\u5b57\u6bb5\u4e0d\u4e3a\u7a7a\u65f6\u624d\u4f1a\u4f7f\u7528\u8be5\u63d2\u4ef6\n#source \u4e3a\u5fc5\u586b\u8bbe\u7f6e,\u76ee\u6807\u5b57\u6bb5\n#target \u5c06useragent\u4fe1\u606f\u914d\u7f6e\u5230ua\u5b57\u6bb5\u4e2d\u3002\u5982\u679c\u4e0d\u6307\u5b9a\u5c06\u5b58\u50a8\u5728\u6839\u76ee\u5f55\u4e2d\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u66f4\u591a\u63d2\u4ef6\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/logstash/current/filter-plugins.html"},"https://www.elastic.co/guide/en/logstash/current/filter-plugins.html"))),(0,l.kt)("h2",{id:"codec-plugins"},"Codec Plugins"),(0,l.kt)("p",null,"codec \u672c\u8d28\u4e0a\u662f\u6d41\u8fc7\u6ee4\u5668\uff0c\u53ef\u4ee5\u4f5c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"input "),"\u6216",(0,l.kt)("inlineCode",{parentName:"p"},"output "),"\u63d2\u4ef6\u7684\u4e00\u90e8\u5206\u8fd0\u884c\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"multiline codec plugin"),"\uff1a\u591a\u884c\u5408\u5e76, \u5904\u7406\u5806\u6808\u65e5\u5fd7\u6216\u8005\u5176\u4ed6\u5e26\u6709\u6362\u884c\u7b26\u65e5\u5fd7\u9700\u8981\u7528\u5230")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'input {\n  stdin {\n    codec => multiline {\n      pattern => "pattern, a regexp"    #\u6b63\u5219\u5339\u914d\u89c4\u5219\uff0c\u5339\u914d\u5230\u7684\u5185\u5bb9\u6309\u7167\u4e0b\u9762\u4e24\u4e2a\u53c2\u6570\u5904\u7406\n      negate => "true" or "false"     # \u9ed8\u8ba4\u4e3afalse\u3002\u5904\u7406\u5339\u914d\u7b26\u5408\u6b63\u5219\u89c4\u5219\u7684\u884c\u3002\u5982\u679c\u4e3atrue\uff0c\u5904\u7406\u4e0d\u5339\u914d\u7b26\u5408\u6b63\u5219\u89c4\u5219\u7684\u884c\u3002\n      what => "previous" or "next"    #\u6307\u5b9a\u4e0a\u4e0b\u6587\u3002\u5c06\u6307\u5b9a\u7684\u884c\u662f\u5408\u5e76\u5230\u4e0a\u4e00\u884c\u6216\u8005\u4e0b\u4e00\u884c\u3002\n    }\n  }\n}\ncodec => multiline {\n    pattern => "^\\s"  \n    what => "previous"  \n}\n# \u4ee5\u7a7a\u683c\u5f00\u5934\u7684\u884c\u90fd\u5408\u5e76\u5230\u4e0a\u4e00\u884c\n \ncodec => multiline {\n    # Grok pattern names are valid! :)\n    pattern => "^%{TIMESTAMP_ISO8601} "\n    negate => true\n    what => "previous"\n}\n# \u4efb\u4f55\u4e0d\u4ee5\u8fd9\u4e2a\u65f6\u95f4\u6233\u683c\u5f0f\u5f00\u5934\u7684\u884c\u90fd\u4e0e\u4e0a\u4e00\u884c\u5408\u5e76\n \ncodec => multiline {\n   pattern => "\\\\$"\n   what => "next"\n}\n# \u4ee5\u53cd\u659c\u6760\u7ed3\u5c3e\u7684\u884c\u90fd\u4e0e\u4e0b\u4e00\u884c\u5408\u5e76\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u66f4\u591a\u63d2\u4ef6\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/logstash/current/codec-plugins.html"},"https://www.elastic.co/guide/en/logstash/current/codec-plugins.html"))),(0,l.kt)("h2",{id:"output-plugins"},"Output Plugins"),(0,l.kt)("p",null,"\u5c06\u4e8b\u4ef6\u53d1\u9001\u5230\u7279\u5b9a\u76ee\u6807\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"stdout")," \uff1a\u6807\u51c6\u8f93\u51fa\u3002\u5c06\u4e8b\u4ef6\u8f93\u51fa\u5230\u5c4f\u5e55\u4e0a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'output{\n    stdout{\n        codec => "rubydebug"\n    }\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"file"),"\uff1a\u5c06\u4e8b\u4ef6\u5199\u5165\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},' file {\n       path => "/data/logstash/%{host}/{application}\n       codec => line { format => "%{message}"} }\n    }\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"kafka"),"\uff1a\u5c06\u4e8b\u4ef6\u53d1\u9001\u5230kafka")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},' kafka{\n        bootstrap_servers => "localhost:9092"\n        topic_id => "test_topic"  #\u5fc5\u9700\u7684\u8bbe\u7f6e\u3002\u751f\u6210\u6d88\u606f\u7684\u4e3b\u9898\n    }\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"elasticseach"),"\uff1a\u5728es\u4e2d\u5b58\u50a8\u65e5\u5fd7")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'  elasticsearch {\n        hosts => "localhost:9200"\n        index => "nginx-access-log-%{+YYYY.MM.dd}"  \n    }\n#index \u4e8b\u4ef6\u5199\u5165\u7684\u7d22\u5f15\u3002\u53ef\u4ee5\u6309\u7167\u65e5\u5fd7\u6765\u521b\u5efa\u7d22\u5f15\uff0c\u4ee5\u4fbf\u4e8e\u5220\u65e7\u6570\u636e\u548c\u6309\u65f6\u95f4\u6765\u641c\u7d22\u65e5\u5fd7\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"email"),"\uff1a\u8f93\u51fa\u5230\u90ae\u7bb1")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"output {\n  if \"shouldmail\" in [tags] {\n    email {\n      to => 'technical@example.com'\n      from => 'monitor@example.com'\n      subject => 'Alert - %{title}'\n      body => \"Tags: %{tags}\\\\n\\\\Content:\\\\n%{message}\"\n      template_file => \"/tmp/email_template.mustache\"\n      domain => 'mail.example.com'\n      port => 25\n    }\n  }\n}\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u66f4\u591a\u63d2\u4ef6\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/logstash/current/output-plugins.html"},"https://www.elastic.co/guide/en/logstash/current/output-plugins.html"))),(0,l.kt)("h2",{id:"\u53c2\u8003\u94fe\u63a5"},"\u53c2\u8003\u94fe\u63a5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Offline Plugin Management: ",(0,l.kt)("a",{parentName:"li",href:"https://elastic.co/guide/en/logstash/current/offline-plugins.html#offline-plugins"},"https://elastic.co/guide/en/logstash/current/offline-plugins.html#offline-plugins")),(0,l.kt)("li",{parentName:"ul"},"\u5b98\u65b9 grok \u6b63\u5219\u793a\u4f8b\uff1a",(0,l.kt)("a",{parentName:"li",href:"https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns"},"https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://grokdebug.herokuapp.com/"},"https://grokdebug.herokuapp.com/"))))}m.isMDXComponent=!0}}]);