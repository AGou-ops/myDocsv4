"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[8865],{3905:(e,t,a)=>{a.d(t,{Zo:()=>k,kt:()=>m});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var i=n.createContext({}),c=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},k=function(e){var t=c(e.components);return n.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,k=l(e,["components","mdxType","originalType","parentName"]),d=c(a),m=o,g=d["".concat(i,".").concat(m)]||d[m]||p[m]||r;return a?n.createElement(g,s(s({ref:t},k),{},{components:a})):n.createElement(g,s({ref:t},k))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,s=new Array(r);s[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:o,s[1]=l;for(var c=2;c<r;c++)s[c]=a[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},98313:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var n=a(87462),o=(a(67294),a(3905));const r={},s=void 0,l={unversionedId:"CloudNative/ELFK/\u90e8\u7f72ELK-Kafka-Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf",id:"CloudNative/ELFK/\u90e8\u7f72ELK-Kafka-Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf",title:"\u90e8\u7f72ELK-Kafka-Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf",description:"1.\u73af\u5883\u89c4\u5212",source:"@site/docs/CloudNative/ELFK/\u90e8\u7f72ELK-Kafka-Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf.md",sourceDirName:"CloudNative/ELFK",slug:"/CloudNative/ELFK/\u90e8\u7f72ELK-Kafka-Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf",permalink:"/docs/CloudNative/ELFK/\u90e8\u7f72ELK-Kafka-Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CloudNative/ELFK/\u90e8\u7f72ELK-Kafka-Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf.md",tags:[],version:"current",frontMatter:{},sidebar:"cloudNative",previous:{title:"\u6536\u96c6Java\u3001Tomcat\u65e5\u5fd7",permalink:"/docs/CloudNative/ELFK/\u6536\u96c6Java\u3001Tomcat\u65e5\u5fd7"},next:{title:"Prometheus",permalink:"/docs/category/prometheus"}},i={},c=[{value:"1.\u73af\u5883\u89c4\u5212",id:"1\u73af\u5883\u89c4\u5212",level:2},{value:"2.\u90e8\u7f72elasticsearch\u96c6\u7fa4",id:"2\u90e8\u7f72elasticsearch\u96c6\u7fa4",level:2},{value:"2.1.\u914d\u7f6ees-1\u8282\u70b9",id:"21\u914d\u7f6ees-1\u8282\u70b9",level:3},{value:"2.2.\u914d\u7f6ees-2\u8282\u70b9",id:"22\u914d\u7f6ees-2\u8282\u70b9",level:3},{value:"2.3.\u914d\u7f6ees-3\u8282\u70b9",id:"23\u914d\u7f6ees-3\u8282\u70b9",level:3},{value:"2.4.\u4f7f\u7528es-head\u63d2\u4ef6\u67e5\u770b\u96c6\u7fa4\u72b6\u6001",id:"24\u4f7f\u7528es-head\u63d2\u4ef6\u67e5\u770b\u96c6\u7fa4\u72b6\u6001",level:3},{value:"3.\u90e8\u7f72kibana",id:"3\u90e8\u7f72kibana",level:2},{value:"4.\u90e8\u7f72zookeeper",id:"4\u90e8\u7f72zookeeper",level:2},{value:"4.1.\u914d\u7f6ezookeeper-1\u8282\u70b9",id:"41\u914d\u7f6ezookeeper-1\u8282\u70b9",level:3},{value:"4.2.\u914d\u7f6ezookeeper-2\u8282\u70b9",id:"42\u914d\u7f6ezookeeper-2\u8282\u70b9",level:3},{value:"4.3.\u914d\u7f6ezookeeper-3\u8282\u70b9",id:"43\u914d\u7f6ezookeeper-3\u8282\u70b9",level:3},{value:"4.4.\u542f\u52a8\u6240\u6709\u8282\u70b9",id:"44\u542f\u52a8\u6240\u6709\u8282\u70b9",level:3},{value:"5.2.\u914d\u7f6ekafka-2\u8282\u70b9",id:"52\u914d\u7f6ekafka-2\u8282\u70b9",level:3},{value:"5.3.\u914d\u7f6ekafka-3\u8282\u70b9",id:"53\u914d\u7f6ekafka-3\u8282\u70b9",level:3},{value:"5.4.\u542f\u52a8kafka",id:"54\u542f\u52a8kafka",level:3},{value:"6.\u6d4b\u8bd5kafka\u4e0ezookeeper\u8fde\u63a5",id:"6\u6d4b\u8bd5kafka\u4e0ezookeeper\u8fde\u63a5",level:2},{value:"7.\u914d\u7f6efilebeat\u6536\u96c6nginx\u3001tomcat\u65e5\u5fd7\u5e76\u5b58\u50a8\u5230kafka\u4e2d",id:"7\u914d\u7f6efilebeat\u6536\u96c6nginxtomcat\u65e5\u5fd7\u5e76\u5b58\u50a8\u5230kafka\u4e2d",level:2},{value:"7.1.\u5b89\u88c5\u5e76\u914d\u7f6enginx\u670d\u52a1",id:"71\u5b89\u88c5\u5e76\u914d\u7f6enginx\u670d\u52a1",level:3},{value:"7.2.\u5b89\u88c5tomcat\u670d\u52a1",id:"72\u5b89\u88c5tomcat\u670d\u52a1",level:3},{value:"7.3.\u5b89\u88c5filebeat\u670d\u52a1",id:"73\u5b89\u88c5filebeat\u670d\u52a1",level:3},{value:"7.5.\u4ea7\u751f\u7a0b\u5e8f\u65e5\u5fd7\u6570\u636e\u89c2\u5bdf\u6570\u636e\u662f\u5426\u5b58\u50a8kafka",id:"75\u4ea7\u751f\u7a0b\u5e8f\u65e5\u5fd7\u6570\u636e\u89c2\u5bdf\u6570\u636e\u662f\u5426\u5b58\u50a8kafka",level:3},{value:"8.\u914d\u7f6elogstash\u4ecekafka\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u5b58\u50a8\u5230es\u96c6\u7fa4",id:"8\u914d\u7f6elogstash\u4ecekafka\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u5b58\u50a8\u5230es\u96c6\u7fa4",level:2},{value:"8.1.\u90e8\u7f72logstash\u670d\u52a1",id:"81\u90e8\u7f72logstash\u670d\u52a1",level:3},{value:"8.2.\u914d\u7f6elogstash\u4ecekafka\u8bfb\u53d6\u6570\u636e\u5b58\u50a8\u5230es\u96c6\u7fa4",id:"82\u914d\u7f6elogstash\u4ecekafka\u8bfb\u53d6\u6570\u636e\u5b58\u50a8\u5230es\u96c6\u7fa4",level:3},{value:"8.3.\u542f\u52a8logstash\u5e76\u89c2\u5bdf\u65e5\u5fd7",id:"83\u542f\u52a8logstash\u5e76\u89c2\u5bdf\u65e5\u5fd7",level:3},{value:"8.4.\u67e5\u770belasticsearch\u96c6\u7fa4\u662f\u5426\u589e\u52a0\u4e86\u5bf9\u5e94\u7684\u7d22\u5f15\u5e93",id:"84\u67e5\u770belasticsearch\u96c6\u7fa4\u662f\u5426\u589e\u52a0\u4e86\u5bf9\u5e94\u7684\u7d22\u5f15\u5e93",level:3},{value:"9.\u5728kibana\u4e0a\u5173\u8054elasticsearch\u7d22\u5f15\u5e93\u6d4f\u89c8\u65e5\u5fd7\u6570\u636e",id:"9\u5728kibana\u4e0a\u5173\u8054elasticsearch\u7d22\u5f15\u5e93\u6d4f\u89c8\u65e5\u5fd7\u6570\u636e",level:2},{value:"9.1.\u5728kibana\u4e0a\u6dfb\u52a0nginx-access\u7d22\u5f15\u6a21\u5f0f",id:"91\u5728kibana\u4e0a\u6dfb\u52a0nginx-access\u7d22\u5f15\u6a21\u5f0f",level:3},{value:"9.2.\u540c\u6837\u65b9\u6cd5\u6dfb\u52a0tomcat-cata\u7d22\u5f15\u6a21\u5f0f",id:"92\u540c\u6837\u65b9\u6cd5\u6dfb\u52a0tomcat-cata\u7d22\u5f15\u6a21\u5f0f",level:3},{value:"9.3.\u67e5\u8be2nginx-access\u7d22\u5f15\u65e5\u5fd7\u6570\u636e",id:"93\u67e5\u8be2nginx-access\u7d22\u5f15\u65e5\u5fd7\u6570\u636e",level:3},{value:"9.4.\u67e5\u770btomcat-cata\u7d22\u5f15\u65e5\u5fd7\u6570\u636e",id:"94\u67e5\u770btomcat-cata\u7d22\u5f15\u65e5\u5fd7\u6570\u636e",level:3},{value:"10.\u62a5\u9519\u5408\u96c6",id:"10\u62a5\u9519\u5408\u96c6",level:2},{value:"10.1.es\u542f\u52a8\u65f6\u62a5\u9519\u65e0\u6cd5\u6307\u5b9a\u88ab\u8bf7\u6c42\u7684\u5730\u5740",id:"101es\u542f\u52a8\u65f6\u62a5\u9519\u65e0\u6cd5\u6307\u5b9a\u88ab\u8bf7\u6c42\u7684\u5730\u5740",level:3},{value:"10.2.filebeat\u5199\u5165\u6570\u636e\u5230kafka api\u7248\u672c\u62a5\u9519",id:"102filebeat\u5199\u5165\u6570\u636e\u5230kafka-api\u7248\u672c\u62a5\u9519",level:3}],k={toc:c};function p(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},k,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"1\u73af\u5883\u89c4\u5212"},"1.\u73af\u5883\u89c4\u5212"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"IP\u5730\u5740"),(0,o.kt)("th",{parentName:"tr",align:null},"\u90e8\u7f72\u7684\u670d\u52a1"),(0,o.kt)("th",{parentName:"tr",align:null},"\u4e3b\u673a\u540d"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"192.168.81.210"),(0,o.kt)("td",{parentName:"tr",align:null},"es+kafka+zookeeper+kibana+logstash"),(0,o.kt)("td",{parentName:"tr",align:null},"elk-1")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"192.168.81.220"),(0,o.kt)("td",{parentName:"tr",align:null},"es+kafka+zookeeper"),(0,o.kt)("td",{parentName:"tr",align:null},"elk-2")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"192.168.81.230"),(0,o.kt)("td",{parentName:"tr",align:null},"es+kafka+zookeeper+nginx+filebeat"),(0,o.kt)("td",{parentName:"tr",align:null},"elk-3")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u65e5\u5fd7\u7cfb\u7edf\u67b6\u6784\u56fe")),(0,o.kt)("p",null,"nginx\u2014>filebeat\u2014>kafka\u2014>logstash\u2014>elasticsearch\u2014>kibana"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161541_6192172dd80c687461.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_zookeeper"})),(0,o.kt)("h2",{id:"2\u90e8\u7f72elasticsearch\u96c6\u7fa4"},"2.\u90e8\u7f72elasticsearch\u96c6\u7fa4"),(0,o.kt)("h3",{id:"21\u914d\u7f6ees-1\u8282\u70b9"},"2.1.\u914d\u7f6ees-1\u8282\u70b9"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u4e0b\u8f7delasticsearch7.6\n[root@elk-1 ~]\\# wget https://mirrors.huaweicloud.com/elasticsearch/7.6.0/elasticsearch-7.6.0-x86_64.rpm\n[root@elk-1 ~/soft]\\# rpm -ivh elasticsearch-7.6.0-x86_64.rpm \n\n2.\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u914d\u7f6e\u96c6\u7fa4\u6a21\u5f0f\n[root@elk-1 ~]\\#  vim /etc/elasticsearch/elasticsearch.yml\ncluster.name: elk-application\nnode.name: elk-1\npath.data: /data/elasticsearch\npath.logs: /var/log/elasticsearch\nbootstrap.memory_lock: true\nnetwork.host: 192.168.81.210,127.0.0.1\nhttp.port: 9200\ncluster.initial_master_nodes: ["elk-1"]\ndiscovery.zen.ping.unicast.hosts: ["192.168.81.210","192.168.81.220","192.168.81.230"]\ndiscovery.zen.fd.ping_timeout: 120s\ndiscovery.zen.fd.ping_retries: 6\ndiscovery.zen.fd.ping_interval: 30s\nhttp.cors.enabled: true\nhttp.cors.allow-origin: "*"\n\n3.\u521b\u5efa\u6570\u636e\u76ee\u5f55\n[root@elk-1 ~]\\# mkdir /data/elasticsearch/ -p\n[root@elk-1 ~]\\# chown -R elasticsearch.elasticsearch /data/elasticsearch/\n\n4.\u914d\u7f6e\u5185\u5b58\u9501\u5b9a\n[root@elk-1 ~]\\# mkdir /etc/systemd/system/elasticsearch.service.d/\n[root@elk-1 ~]\\# vim /etc/systemd/system/elasticsearch.service.d/override.conf\n[Service]\nLimitMEMLOCK=infinity\n\n5.\u542f\u52a8elasticsearch\n[root@elk-1 ~]\\# systemctl daemon-reload \n[root@elk-1 ~]\\# systemctl start elasticsearch\n[root@elk-1 ~]\\# systemctl enable elasticsearch\n')),(0,o.kt)("h3",{id:"22\u914d\u7f6ees-2\u8282\u70b9"},"2.2.\u914d\u7f6ees-2\u8282\u70b9"),(0,o.kt)("p",null,"\u53ea\u662f\u914d\u7f6e\u6587\u4ef6\u4e2dnode.name\u548cnetwork.host\u4e0d\u540c\uff0c\u5176\u4ed6\u64cd\u4f5c\u65b9\u5f0f\u4e00\u81f4"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'[root@elk-2 ~]\\#  vim /etc/elasticsearch/elasticsearch.yml\ncluster.name: elk-application\nnode.name: elk-2\npath.data: /data/elasticsearch\npath.logs: /var/log/elasticsearch\nbootstrap.memory_lock: true\nnetwork.host: 192.168.81.220,127.0.0.1\nhttp.port: 9200\ncluster.initial_master_nodes: ["elk-1"]\ndiscovery.zen.ping.unicast.hosts: ["192.168.81.210","192.168.81.220","192.168.81.230"]\ndiscovery.zen.fd.ping_timeout: 120s\ndiscovery.zen.fd.ping_retries: 6\ndiscovery.zen.fd.ping_interval: 30s\nhttp.cors.enabled: true\nhttp.cors.allow-origin: "*"\n')),(0,o.kt)("h3",{id:"23\u914d\u7f6ees-3\u8282\u70b9"},"2.3.\u914d\u7f6ees-3\u8282\u70b9"),(0,o.kt)("p",null,"\u53ea\u662f\u914d\u7f6e\u6587\u4ef6\u4e2dnode.name\u548cnetwork.host\u4e0d\u540c\uff0c\u5176\u4ed6\u64cd\u4f5c\u65b9\u5f0f\u4e00\u81f4"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'[root@elk-2 ~]\\#  vim /etc/elasticsearch/elasticsearch.yml\ncluster.name: elk-application\nnode.name: elk-3\npath.data: /data/elasticsearch\npath.logs: /var/log/elasticsearch\nbootstrap.memory_lock: true\nnetwork.host: 192.168.81.230,127.0.0.1\nhttp.port: 9200\ncluster.initial_master_nodes: ["elk-1"]\ndiscovery.zen.ping.unicast.hosts: ["192.168.81.210","192.168.81.220","192.168.81.230"]\ndiscovery.zen.fd.ping_timeout: 120s\ndiscovery.zen.fd.ping_retries: 6\ndiscovery.zen.fd.ping_interval: 30s\nhttp.cors.enabled: true\nhttp.cors.allow-origin: "*"\n')),(0,o.kt)("h3",{id:"24\u4f7f\u7528es-head\u63d2\u4ef6\u67e5\u770b\u96c6\u7fa4\u72b6\u6001"},"2.4.\u4f7f\u7528es-head\u63d2\u4ef6\u67e5\u770b\u96c6\u7fa4\u72b6\u6001"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161542_6192172e2208446472.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_elasticsearch_02"})),(0,o.kt)("h2",{id:"3\u90e8\u7f72kibana"},"3.\u90e8\u7f72kibana"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u4e0b\u8f7dkibana rpm\u5305\n[root@elk-1 ~]\\#  rpm -ivh kibana-7.6.0-x86_64.rpm \n\n2.\u914d\u7f6ekibana\n[root@elk-1 ~]\\# vim /etc/kibana/kibana.yml\nserver.port: 5601                                   \nserver.host: "192.168.81.210"                               \nserver.name: "elk-application"                                              \nelasticsearch.hosts: ["http://192.168.81.210:9200"]             \ni18n.locale: "zh-CN"\n\n[root@elk-1 ~]\\# systemctl restart kibana\n[root@elk-1 ~]\\#  systemctl enable elasticsearch\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"kibana\u90e8\u7f72\u6210\u529f")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161542_6192172e5cf4662193.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_tomcat_03"})),(0,o.kt)("h2",{id:"4\u90e8\u7f72zookeeper"},"4.\u90e8\u7f72zookeeper"),(0,o.kt)("h3",{id:"41\u914d\u7f6ezookeeper-1\u8282\u70b9"},"4.1.\u914d\u7f6ezookeeper-1\u8282\u70b9"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"1.\u4e0b\u8f7d\u8f6f\u4ef6\n[root@elk-1 ~]\\# wget http://archive.apache.org/dist/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz\n\n2.\u89e3\u538b\u5e76\u79fb\u52a8zookeeper\n[root@elk-1 ~]\\# tar xf soft/zookeeper-3.4.13.tar.gz -C /data/\n[root@elk-1 ~]\\# mv /data/zookeeper-3.4.13/ /data/zookeeper\n\n3.\u521b\u5efa\u6570\u636e\u76ee\u5f55\u548c\u65e5\u5fd7\u76ee\u5f55\n[root@elk-1 ~]\\# mkdir /data/zookeeper/{data,logs}\n\n4.\u51c6\u5907\u914d\u7f6e\u6587\u4ef6\n[root@elk-1 ~]\\# cd /data/zookeeper/conf\n[root@elk-1 /data/zookeeper/conf]\\# cp zoo_sample.cfg zoo.cfg\n[root@elk-1 /data/zookeeper/conf]\\# vim zoo.cfg \ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/data/zookeeper/data\nDataLogDir=/data/zookeeper/logs\nclientPort=2181\n\nserver.1=192.168.81.210:2888:3888\nserver.2=192.168.81.220:2888:3888\nserver.3=192.168.81.230:2888:3888\n\n5.\u751f\u6210\u8282\u70b9id\u6587\u4ef6\n#\u8282\u70b9id\u53ea\u80fd\u4fdd\u62a4\u6570\u5b57\n[root@elk-1 /data/zookeeper]\\# echo 1 > /data/zookeeper/data/myid\n")),(0,o.kt)("h3",{id:"42\u914d\u7f6ezookeeper-2\u8282\u70b9"},"4.2.\u914d\u7f6ezookeeper-2\u8282\u70b9"),(0,o.kt)("p",null,"\u4e0ezookeeper-1\u8282\u70b9\u53ea\u6709\u914d\u7f6e\u6587\u4ef6\u548c\u8282\u70b9id\u6587\u4ef6\u6709\u70b9\u4e0d\u540c\uff0c\u5176\u4f59\u5168\u4e00\u6837"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"[root@elk-2 /data/zookeeper/conf]\\# cat zoo.cfg \ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/data/zookeeper/data\nDataLogDir=/data/zookeeper/logs\nclientPort=2181\n\nserver.1=192.168.81.210:2888:3888\nserver.2=192.168.81.220:2888:3888\nserver.3=192.168.81.230:2888:3888\n\n[root@elk-2 /data/zookeeper/conf]\\# echo 2 > /data/zookeeper/data/myid\n")),(0,o.kt)("h3",{id:"43\u914d\u7f6ezookeeper-3\u8282\u70b9"},"4.3.\u914d\u7f6ezookeeper-3\u8282\u70b9"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"[root@elk-3 /data/zookeeper/conf]\\# cat zoo.cfg \ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/data/zookeeper/data\nDataLogDir=/data/zookeeper/logs\nclientPort=2181\n\nserver.1=192.168.81.210:2888:3888\nserver.2=192.168.81.220:2888:3888\nserver.3=192.168.81.230:2888:3888\n\n[root@elk-3 /data/zookeeper/conf]\\# echo 3 > /data/zookeeper/data/myid\n")),(0,o.kt)("h3",{id:"44\u542f\u52a8\u6240\u6709\u8282\u70b9"},"4.4.\u542f\u52a8\u6240\u6709\u8282\u70b9"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"zookeeper\u96c6\u7fa4\u5fc5\u987b\u4fdd\u8bc1\u6709\u4e24\u4e2a\u8282\u70b9\u5b58\u6d3b\uff0c\u4e5f\u5c31\u662f\u8bf4\u5fc5\u987b\u540c\u65f6\u8981\u542f\u52a8\u4e24\u4e2a\u8282\u70b9\uff0c\u5426\u5219\u96c6\u7fa4\u5c06\u542f\u52a8\u4e0d\u6210\u529f\uff0c\u56e0\u6b64\u8981\u90fd\u4fee\u6539\u597d\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u518d\u7edf\u4e00\u542f\u52a8"),(0,o.kt)("pre",{parentName:"blockquote"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"[root@elk-1 /data/zookeeper]\\# ./bin/zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /data/zookeeper/bin/../conf/zoo.cfg\nMode: follower\n"))),(0,o.kt)("p",null,"[root@elk-2 /data/zookeeper]","#"," ./bin/zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /data/zookeeper/bin/../conf/zoo.cfg\nMode: follower"),(0,o.kt)("p",null,"[root@elk-3 /data/zookeeper]","#"," ./bin/zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /data/zookeeper/bin/../conf/zoo.cfg\nMode: leader"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\n## 5.\u90e8\u7f72kafka\n\n**\u6ce8\u610f\uff1a**`\u4e0d\u8981\u4f7f\u7528kafka2.11\u7248\u672c\uff0c\u6709\u4e25\u91cd\u7684bug\uff0cfilebeat\u65e0\u6cd5\u5199\u5165\u6570\u636e\u5230kafka\u96c6\u7fa4\uff0c\u5199\u5165\u7684\u534f\u8bae\u7248\u672c\u4e0d\u540c\uff0c\u5b58\u5728\u95ee\u9898`\n\n### 5.1.\u914d\u7f6ekafka-1\u8282\u70b9\n```sh\n1.\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u5305\n[root@elk-1 ~]\\# wget https://archive.apache.org/dist/kafka/2.0.0/kafka_2.11-2.0.0.tgz\n\n2.\u5b89\u88c5kafka\n[root@elk-1 ~/soft]\\# tar xf kafka_2.13-2.4.0.tgz -C /data/\n[root@elk-1 ~]\\# mv /data/kafka_2.13-2.4.0 /data/kafka\n\n3.\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\n[root@elk-1 ~]\\# cd /data/kafka\n[root@elk-1 /data/kafka]\\# vim config/server.properties \nbroker.id=1\nlisteners=PLAINTEXT://192.168.81.210:9092\nhost.name=192.168.81.210\nadvertised.listeners=PLAINTEXT://192.168.81.210:9092\nadvertised.host.name=192.168.81.210\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/data/kafka/data\nnum.partitions=3\ndelete.topic.enable=true\nauto.create.topics.enable=true \nreplica.fetch.max.bytes=5242880\nnum.recovery.threads.per.data.dir=1\noffsets.topic.replication.factor=3\ntransaction.state.log.replication.factor=3\ntransaction.state.log.min.isr=3\nmessage.max.byte=5242880\nlog.cleaner.enable=true\nlog.retention.hours=48\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=15000\nzookeeper.connect=192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181\nzookeeper.connection.timeout.ms=60000\ngroup.initial.rebalance.delay.ms=0\n\n4.\u521b\u5efa\u6570\u636e\u76ee\u5f55\n[root@elk-3 ~]\\# mkdir /data/kafka/data\n")),(0,o.kt)("h3",{id:"52\u914d\u7f6ekafka-2\u8282\u70b9"},"5.2.\u914d\u7f6ekafka-2\u8282\u70b9"),(0,o.kt)("p",null,"\u53ea\u662f\u914d\u7f6e\u6587\u4ef6\u4e0d\u540c\uff0c\u5176\u4f59\u4e0ekafka-1\u8282\u70b9\u64cd\u4f5c\u4e00\u81f4"),(0,o.kt)("p",null,"\u914d\u7f6e\u6587\u4ef6\u9700\u8981\u6539\u7684\u5730\u65b9\uff1abroker.id\u6539\u62102\uff0c\u8868\u793a\u7b2c\u4e8c\u4e2a\u8282\u70b9 listeners host.name advertised.listeners advertised.host.name\u6539\u6210\u672c\u673aip\u5730\u5740"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"[root@elk-2 /data/kafka]\\# cat config/server.properties \nbroker.id=2\nlisteners=PLAINTEXT://192.168.81.220:9092\nhost.name=192.168.81.220\nadvertised.listeners=PLAINTEXT://192.168.81.220:9092\nadvertised.host.name=192.168.81.220\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/data/kafka/data\nnum.partitions=3\ndelete.topic.enable=true\nauto.create.topics.enable=true \nreplica.fetch.max.bytes=5242880\nnum.recovery.threads.per.data.dir=1\noffsets.topic.replication.factor=3\ntransaction.state.log.replication.factor=3\ntransaction.state.log.min.isr=3\nmessage.max.byte=5242880\nlog.cleaner.enable=true\nlog.retention.hours=48\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=15000\nzookeeper.connect=192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181\nzookeeper.connection.timeout.ms=60000\ngroup.initial.rebalance.delay.ms=0\n")),(0,o.kt)("h3",{id:"53\u914d\u7f6ekafka-3\u8282\u70b9"},"5.3.\u914d\u7f6ekafka-3\u8282\u70b9"),(0,o.kt)("p",null,"\u53ea\u662f\u914d\u7f6e\u6587\u4ef6\u4e0d\u540c\uff0c\u5176\u4f59\u4e0ekafka-1\u8282\u70b9\u64cd\u4f5c\u4e00\u81f4"),(0,o.kt)("p",null,"\u914d\u7f6e\u6587\u4ef6\u9700\u8981\u6539\u7684\u5730\u65b9\uff1abroker.id\u6539\u62103\uff0c\u8868\u793a\u7b2c\u4e09\u4e2a\u8282\u70b9 listeners host.name advertised.listeners advertised.host.name\u6539\u6210\u672c\u673aip\u5730\u5740"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"[root@elk-3 /data/kafka]\\# cat config/server.properties \nbroker.id=3\nlisteners=PLAINTEXT://192.168.81.230:9092\nhost.name=192.168.81.230\nadvertised.listeners=PLAINTEXT://192.168.81.230:9092\nadvertised.host.name=192.168.81.230\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/data/kafka/data\nnum.partitions=3\ndelete.topic.enable=true\nauto.create.topics.enable=true \nreplica.fetch.max.bytes=5242880\nnum.recovery.threads.per.data.dir=1\noffsets.topic.replication.factor=3\ntransaction.state.log.replication.factor=3\ntransaction.state.log.min.isr=3\nmessage.max.byte=5242880\nlog.cleaner.enable=true\nlog.retention.hours=48\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=15000\nzookeeper.connect=192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181\nzookeeper.connection.timeout.ms=60000\ngroup.initial.rebalance.delay.ms=0\n")),(0,o.kt)("h3",{id:"54\u542f\u52a8kafka"},"5.4.\u542f\u52a8kafka"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"[root@elk-1 ~]\\# /data/kafka/bin/kafka-server-start -daemon /data/kafka/config/server.properties\n[root@elk-2 ~]\\# /data/kafka/bin/kafka-server-start -daemon /data/kafka/config/server.properties\n[root@elk-3 ~]\\# /data/kafka/bin/kafka-server-start -daemon /data/kafka/config/server.properties\n")),(0,o.kt)("h2",{id:"6\u6d4b\u8bd5kafka\u4e0ezookeeper\u8fde\u63a5"},"6.\u6d4b\u8bd5kafka\u4e0ezookeeper\u8fde\u63a5"),(0,o.kt)("p",null,"kafka\u80fd\u591f\u4ea7\u751f\u6570\u636e\u5e76\u6d88\u8d39\uff0c\u6574\u4e2a\u96c6\u7fa4\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u521b\u5efa\u4e00\u4e2atopic\n[root@elk-1 /data/kafka]\\# ./bin/kafka-topics.sh --create --zookeeper 192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181 --replication-factor 1 --partitions 1 --topic testpic\nCreated topic "testpic".\n\n2.\u67e5\u770btopic\n[root@elk-1 /data/kafka]\\# ./bin/kafka-topics.sh --list --zookeeper 192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181\ntestpic\n\n3.\u67e5\u770btopic\u7684\u63cf\u8ff0\u4fe1\u606f\n[root@elk-1 /data/kafka]\\# ./bin/kafka-topics.sh --describe --zookeeper 192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181 --topic testpic\n\n4.\u4f7f\u7528kafka-console-producer\u63a7\u5236\u53f0\u751f\u4ea7\u6570\u636e\n[root@elk-1 /data/kafka]\\# ./bin/kafka-console-producer.sh --broker-list 192.168.81.210:9092,192.168.81.220:9092,192.168.81.230:9092 --topic testpic\n>test1\n>test2\n>test3\n>test4\n>test5\n>test6\n>test7\n>test8\n>test9\n>test10\n\n\n5.\u4f7f\u7528kafka-console-consumer\u63a7\u5236\u53f0\u6d88\u8d39\u6570\u636e\n[root@elk-1 /data/kafka]\\# ./bin/kafka-console-consumer.sh --bootstrap-server 192.168.81.210:9092,192.168.81.220:9092,192.168.81.230:9092 --topic testpic --from-beginning\ntest1\ntest2\ntest3\ntest4\ntest5\ntest6\ntest7\ntest8\ntest9\ntest10\n\n\n#\u5220\u9664\u4e00\u4e2atopic\n[root@elk-1 /data/kafka]\\# ./bin/kafka-topics.sh --delete --zookeeper 192.168.81.210:2181  --topic testpic\n')),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161542_6192172e99f3c64443.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_elasticsearch_04"})),(0,o.kt)("h2",{id:"7\u914d\u7f6efilebeat\u6536\u96c6nginxtomcat\u65e5\u5fd7\u5e76\u5b58\u50a8\u5230kafka\u4e2d"},"7.\u914d\u7f6efilebeat\u6536\u96c6nginx\u3001tomcat\u65e5\u5fd7\u5e76\u5b58\u50a8\u5230kafka\u4e2d"),(0,o.kt)("h3",{id:"71\u5b89\u88c5\u5e76\u914d\u7f6enginx\u670d\u52a1"},"7.1.\u5b89\u88c5\u5e76\u914d\u7f6enginx\u670d\u52a1"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'1.\u5b89\u88c5nginx\n[root@elk-3 ~]\\# yum -y install nginx\n\n2.\u914d\u7f6enginx\u65e5\u5fd7\u683c\u5f0f\n[root@elk-3 ~]\\# vim /etc/nginx/nginx.conf\nhttp {\n\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\n    log_format  main \'{"\u65f6\u95f4":"$time_iso8601",\'\n                       \'"\u5ba2\u6237\u7aef\u5916\u7f51\u5730\u5740":"$http_x_forwarded_for",\'\n                       \'"\u5ba2\u6237\u7aef\u5185\u7f51\u5730\u5740":"$remote_addr",\'\n                       \'"\u72b6\u6001\u7801":$status,\'\n                       \'"\u4f20\u8f93\u6d41\u91cf":$body_bytes_sent,\'\n                       \'"\u8df3\u8f6c\u6765\u6e90":"$http_referer",\'\n                       \'"URL":"$request",\'\n                       \'"\u6d4f\u89c8\u5668":"$http_user_agent",\'\n                       \'"\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4":$request_time,\'\n                       \'"\u540e\u7aef\u5730\u5740":"$upstream_addr"}\';\n\n    access_log  /var/log/nginx/access.log  main;\n\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\n}\n\n2.\u542f\u52a8nginx\n[root@elk-3 ~]\\# systemctl start nginx\n[root@elk-3 ~]\\# systemctl enable nginx\n\n4.\u8bbf\u95ee\u4ea7\u751f\u65e5\u5fd7\u67e5\u770b\u6548\u679c\n[root@elk-3 ~]\\# curl 127.0.0.1\n[root@elk-3 ~]\\# tail /var/log/nginx/access.log \n{"\u65f6\u95f4":"2021-07-12T11:29:33+08:00","\u5ba2\u6237\u7aef\u5916\u7f51\u5730\u5740":"-","\u5ba2\u6237\u7aef\u5185\u7f51\u5730\u5740":"127.0.0.1","\u72b6\u6001\u7801":200,"\u4f20\u8f93\u6d41\u91cf":4833,"\u8df3\u8f6c\u6765\u6e90":"-","URL":"GET / HTTP/1.1","\u6d4f\u89c8\u5668":"curl/7.29.0","\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4":0.000,"\u540e\u7aef\u5730\u5740":"-"}\n')),(0,o.kt)("h3",{id:"72\u5b89\u88c5tomcat\u670d\u52a1"},"7.2.\u5b89\u88c5tomcat\u670d\u52a1"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"[root@elk-3 ~]\\# tar xf apache-tomcat-8.5.12.tar.gz -C /data/\n[root@elk-3 ~]\\# mv /data/apache-tomcat-8.5.12/ /data/tomcat\n[root@elk-3 ~]\\# /data/tomcat/bin/startup.sh \nUsing CATALINA_BASE:   /data/tomcat\nUsing CATALINA_HOME:   /data/tomcat\nUsing CATALINA_TMPDIR: /data/tomcat/temp\nUsing JRE_HOME:        /usr\nUsing CLASSPATH:       /data/tomcat/bin/bootstrap.jar:/data/tomcat/bin/tomcat-juli.jar\nTomcat started.\n")),(0,o.kt)("h3",{id:"73\u5b89\u88c5filebeat\u670d\u52a1"},"7.3.\u5b89\u88c5filebeat\u670d\u52a1"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"[root@elk-3 ~]\\# rpm -ivh filebeat-7.6.0-x86_64.rpm ")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'\n### 7.4.\u914d\u7f6efilebeat\u6536\u96c6\u5e94\u7528\u65e5\u5fd7\u5e76\u5b58\u50a8\u5230kafka\n```sh\n1.\u914d\u7f6efilebeat\n[root@elk-3 ~]\\# vim /etc/filebeat/filebeat.yml \nfilebeat.inputs:\n- type: log                                      #\u7c7b\u578b\u4e3alog\n  enabled: true\n  paths:                                        #\u6307\u5b9a\u65e5\u5fd7\u6240\u5728\u7684\u8def\u5f84\n    - /var/log/nginx/access.log\n  json.keys_under_root: true                    #\u652f\u6301json\u683c\u5f0f\u7684\u65e5\u5fd7\u8f93\u51fa\n  json.overwriite_keys: true\n  fields:                                       #\u5728\u65e5\u5fd7\u4e2d\u589e\u52a0\u4e00\u4e2a\u5b57\u6bb5\uff0c\u5b57\u6bb5\u4e3alog_topic\uff0c\u503c\u4e3anginx_access\uff0clogstash\u6839\u636e\u5e26\u6709\u8fd9\u4e2a\u5b57\u6bb5\u7684\u65e5\u5fd7\u5b58\u50a8\u5230\u6307\u5b9a\u7684es\u7d22\u5f15\u5e93\n    log_topic: nginx-access\n  tail_files: true                              #\u5f00\u542f\u65e5\u5fd7\u76d1\u63a7\uff0c\u4ece\u65e5\u5fd7\u7684\u6700\u540e\u4e00\u884c\u5f00\u59cb\u6536\u96c6\n\n- type: log\n  enabled: true\n  paths:\n    - /data/tomcat/logs/catalina.out\n  multiline.pattern: \'^20\'                      #\u6536\u96c6tomcat\u9519\u8bef\u65e5\u5fd7\uff0c\u4ece\u7b2c\u4e00\u4e2a20\u5230\u4e0b\u4e00\u4e2a20\u4e4b\u95f4\u7684\u65e5\u5fd7\u6574\u5408\u5728\u4e00\u884c\u4e2d\u663e\u793a\n  multiline.negate: true\n  multiline.match: after\n  fields:\n    log_topic: tomcat-cata\n  tail_files: true\n\noutput.kafka:                                   #\u8f93\u51fa\u5230kafka\u7cfb\u7edf\n  enabled: true\n  hosts: ["192.168.81.210:9092","192.168.81.220:9092","192.168.81.230:9092"]                           #kafka\u7684\u5730\u5740\n  topic: \'%{[fields][log_topic]}\'               #\u6307\u5b9a\u5c06\u65e5\u5fd7\u5b58\u50a8\u5230kafka\u96c6\u7fa4\u7684\u54ea\u4e2atopic\u4e2d\uff0c\u8fd9\u91cc\u7684topic\u503c\u662f\u5f15\u7528\u5728inputs\u4e2d\u5b9a\u4e49\u7684fields\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5c06\u4e0d\u540c\u8def\u5f84\u7684\u65e5\u5fd7\u5206\u522b\u5b58\u50a8\u5230\u4e0d\u540c\u7684topic\u4e2d\n  partition.round_robin:\n    reachable_only: false\n  required_acks: 1\n  compression: gzip\n  max_message_bytes: 1000000\n\n2.\u542f\u52a8filebeat\n[root@elk-3 ~]\\# systemctl start filebeat\n[root@elk-3 ~]\\# systemctl enable filebeat\n')),(0,o.kt)("h3",{id:"75\u4ea7\u751f\u7a0b\u5e8f\u65e5\u5fd7\u6570\u636e\u89c2\u5bdf\u6570\u636e\u662f\u5426\u5b58\u50a8kafka"},"7.5.\u4ea7\u751f\u7a0b\u5e8f\u65e5\u5fd7\u6570\u636e\u89c2\u5bdf\u6570\u636e\u662f\u5426\u5b58\u50a8kafka"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"1.\u4ea7\u751f\u7a0b\u5e8f\u65e5\u5fd7")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"1.\u4ea7\u751fnginx\u65e5\u5fd7\n[root@elk-3 ~]\\# ab -n 1000 -c 100 http://127.0.0.1/index.html\n\n2.\u4ea7\u751ftomcat\u65e5\u5fd7\n[root@elk-3 ~]\\# /data/tomcat/bin/shutdown.sh\n[root@elk-3 ~]\\# /data/tomcat/bin/startup.sh \n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"2.\u89c2\u5bdfkafka\u4e2d\u662f\u5426\u521b\u5efa\u5bf9\u5e94\u7684topic")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"[root@elk-1 /data/kafka]\\# ./bin/kafka-topics.sh --list --zookeeper 192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181\n__consumer_offsets\nnginx-access\ntestpic\ntomcat-cata\n\n#nginx-access\u4ee5\u53catomcat-cata\u7684topic\u5df2\u7ecf\u521b\u5efa\u6210\u529f\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"3.\u89c2\u5bdfkafka\u65e5\u5fd7\u7684\u8f93\u51fa")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"[root@elk-1 /data/kafka]\\# tail -f logs/kafkaServer.out\n")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161542_6192172ed66b168251.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_zookeeper_05"})),(0,o.kt)("h2",{id:"8\u914d\u7f6elogstash\u4ecekafka\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u5b58\u50a8\u5230es\u96c6\u7fa4"},"8.\u914d\u7f6elogstash\u4ecekafka\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u5b58\u50a8\u5230es\u96c6\u7fa4"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u90e8\u7f72logstash\uff0c\u914d\u7f6elogstash\u4ecekafka\u4e2d\u8bfb\u53d6topic\u6570\u636e\u5e76\u5b58\u50a8\u5230es\u96c6\u7fa4")),(0,o.kt)("h3",{id:"81\u90e8\u7f72logstash\u670d\u52a1"},"8.1.\u90e8\u7f72logstash\u670d\u52a1"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"1.\u5b89\u88c5logstash\n[root@elk-3 ~]\\# rpm -ivh logstash-7.6.0.rpm\n")),(0,o.kt)("h3",{id:"82\u914d\u7f6elogstash\u4ecekafka\u8bfb\u53d6\u6570\u636e\u5b58\u50a8\u5230es\u96c6\u7fa4"},"8.2.\u914d\u7f6elogstash\u4ecekafka\u8bfb\u53d6\u6570\u636e\u5b58\u50a8\u5230es\u96c6\u7fa4"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'[root@elk-3 ~]\\# cat /etc/logstash/conf.d/in_kafka_to_es.conf \n#\u4ecekafka\u4e2d\u8bfb\u53d6\u65e5\u5fd7\u6570\u636e\ninput {             #\u6570\u636e\u6e90\u7aef\n    kafka {             #\u7c7b\u578b\u4e3akafka\n        bootstrap_servers => ["192.168.81.210:9092,192.168.81.220:9092,192.168.81.230:9092"]            #kafka\u96c6\u7fa4\u5730\u5740\n        topics => ["nginx-access","tomcat-cata"]            #\u8981\u8bfb\u53d6\u90a3\u4e9bkafka topics\n        codec => "json"                                     #\u5904\u7406json\u683c\u5f0f\u7684\u6570\u636e\n        auto_offset_reset => "latest"                       #\u53ea\u6d88\u8d39\u6700\u65b0\u7684kafka\u6570\u636e\n    }\n}\n\n#\u5904\u7406\u6570\u636e\uff0c\u53bb\u6389\u6ca1\u7528\u7684\u5b57\u6bb5\nfilter {\n    if[fields][log_topic] == "nginx-access" {           #\u5982\u679clog_topic\u5b57\u6bb5\u4e3anginx-access\u5219\u8fdb\u884c\u4ee5\u4e0b\u6570\u636e\u5904\u7406\n        json {                  #json\u683c\u5f0f\u6570\u636e\u5904\u7406\n             source => "message"            #source\u7b49\u4e8emessage\u7684\n             remove_field => ["@version","path","beat","input","log","offset","prospector","source","tags"]         #\u5220\u9664\u6307\u5b9a\u7684\u5b57\u6bb5\n        }\n        mutate {            #\u4fee\u6539\u6570\u636e\n             remove_field => ["_index","_id","_type","_version","_score","referer","agent"]         #\u5220\u9664\u6ca1\u7528\u7684\u5b57\u6bb5\n        }\n    }\n    \n    if[fields][log_topic] == "tomcat-cata" {        #\u5982\u679clog_topic\u5b57\u6bb5\u4e3atomcat-cata\n        grok {              #\u89e3\u6790\u683c\u5f0f\n         match => {\n              "message" => "(?<\u65f6\u95f4>20[0-9]{2}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}) \\[(?<\u7ebf\u7a0b\u540d\u79f0>[^\\s]{0,})\\] (?<\u65e5\u5fd7\u7b49\u7ea7>\\w+) (?<\u7c7b\u540d\u79f0>[^\\s]{0,}) (?<\u65e5\u5fd7\u8be6\u60c5>[\\W\\w]+)"          #\u5c06message\u7684\u503c\u589e\u52a0\u4e0a\u4e00\u4e9b\u683c\u5f0f\n         }\n        }\n        mutate {            #\u4fee\u6539\u6570\u636e\n                 remove_field => ["_index","_id","_type","_version","_score","referer","agent"]         #\u5220\u9664\u6ca1\u7528\u7684\u5b57\u6bb5\n            }  \n    }\n}\n\n#\u6570\u636e\u5904\u7406\u540e\u5b58\u50a8es\u96c6\u7fa4\noutput {                #\u76ee\u6807\u7aef\n    if[fields][log_topic] == "nginx-access" {           #\u5982\u679clog_topic\u7684\u5b57\u6bb5\u503c\u4e3anginx-access\u5c31\u5b58\u5230\u4e0b\u9762\u7684es\u96c6\u7fa4\u91cc\n        elasticsearch {                     \n        action => "index"           #\u7c7b\u578b\u4e3a\u7d22\u5f15\n        hosts => ["192.168.81.210:9200","192.168.81.220:9200","192.168.81.230:9200"]        #es\u96c6\u7fa4\u5730\u5740\n        index => "nginx-access-%{+YYYY.MM.dd}"          #\u5b58\u50a8\u5230es\u96c6\u7fa4\u7684\u54ea\u4e2a\u7d22\u5f15\u91cc\n        codec => "json"                     #\u5904\u7406json\u683c\u5f0f\u7684\u89e3\u6790\n        } \n    }\n    \n    if[fields][log_topic] == "tomcat-cata" {                #\u5982\u679clog_topic\u7684\u5b57\u6bb5\u503c\u4e3atomcat-cata\u5c31\u5b58\u5230\u4e0b\u9762\u7684es\u96c6\u7fa4\u91cc\n        elasticsearch {\n        action => "index"               #\u7c7b\u578b\u4e3a\u7d22\u5f15\n        hosts => ["192.168.81.210:9200","192.168.81.220:9200","192.168.81.230:9200"]            #es\u96c6\u7fa4\u5730\u5740\n        index => "tomcat-cata-%{+YYYY.MM.dd}"           #\u5b58\u50a8\u5230es\u96c6\u7fa4\u7684\u54ea\u4e2a\u7d22\u5f15\u91cc\n        codec => "json"                     #\u5904\u7406json\u683c\u5f0f\u7684\u89e3\u6790\n        } \n    }       \n}\n')),(0,o.kt)("h3",{id:"83\u542f\u52a8logstash\u5e76\u89c2\u5bdf\u65e5\u5fd7"},"8.3.\u542f\u52a8logstash\u5e76\u89c2\u5bdf\u65e5\u5fd7"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"[root@elk-3 ~]\\# nphup /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/in_kafka_to_es.conf &\n")),(0,o.kt)("p",null,"\u89c2\u5bdf\u65e5\u5fd7\u7684\u8f93\u51fa\uff0c\u5df2\u7ecf\u4ecenginx-access\u3001tomcat-cata topic\u4e2d\u8bfb\u53d6\u4e86\u6570\u636e\u5e76\u5b58\u5230\u4e86es\u96c6\u7fa4\u4e2d\n",(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161543_6192172f20d8487918.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_tomcat_06"})),(0,o.kt)("h3",{id:"84\u67e5\u770belasticsearch\u96c6\u7fa4\u662f\u5426\u589e\u52a0\u4e86\u5bf9\u5e94\u7684\u7d22\u5f15\u5e93"},"8.4.\u67e5\u770belasticsearch\u96c6\u7fa4\u662f\u5426\u589e\u52a0\u4e86\u5bf9\u5e94\u7684\u7d22\u5f15\u5e93"),(0,o.kt)("p",null,"es\u96c6\u7fa4\u5df2\u7ecf\u751f\u6210\u4e86tomcat-cata\u4ee5\u53canginx-access\u7d22\u5f15\u5e93"),(0,o.kt)("p",null,"\u5230\u6b64\u4e3a\u6b62logstash\u5df2\u7ecf\u6210\u529f\u4ecekafka\u96c6\u7fa4\u8bfb\u53d6\u5230\u65e5\u5fd7\u6570\u636e\uff0c\u7136\u540e\u4f20\u5165\u5230elasticsearch\u96c6\u7fa4\u4e0d\u540c\u7684\u7d22\u5f15\u5e93"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161543_6192172f6b5b67224.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_1024\u7a0b\u5e8f\u5458\u8282_07"})),(0,o.kt)("h2",{id:"9\u5728kibana\u4e0a\u5173\u8054elasticsearch\u7d22\u5f15\u5e93\u6d4f\u89c8\u65e5\u5fd7\u6570\u636e"},"9.\u5728kibana\u4e0a\u5173\u8054elasticsearch\u7d22\u5f15\u5e93\u6d4f\u89c8\u65e5\u5fd7\u6570\u636e"),(0,o.kt)("h3",{id:"91\u5728kibana\u4e0a\u6dfb\u52a0nginx-access\u7d22\u5f15\u6a21\u5f0f"},"9.1.\u5728kibana\u4e0a\u6dfb\u52a0nginx-access\u7d22\u5f15\u6a21\u5f0f"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"1\uff09\u70b9\u51fb\u521b\u5efa\u7d22\u5f15"),"\n",(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161543_6192172fa3ee935312.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_kafka_08"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"2\uff09\u586b\u5199\u7d22\u5f15\u540d")),(0,o.kt)("p",null,"\u91c7\u7528\u901a\u914d\u7b26\u7684\u65b9\u5f0f\uff0c\u586b\u5199\u5b8c\u70b9\u51fb\u4e0b\u4e00\u6b65\u5b8c\u6210\u521b\u5efa\u5373\u53ef"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161543_6192172fe813235099.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_zookeeper_09"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"3\uff09\u6dfb\u52a0\u4e00\u4e2a\u65f6\u95f4\u7b5b\u9009\u5b57\u6bb5"),"\n",(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161544_619217301599772249.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_zookeeper_10"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"4\uff09\u521b\u5efa\u6210\u529f")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161544_61921730520fc89749.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_kafka_11"})),(0,o.kt)("h3",{id:"92\u540c\u6837\u65b9\u6cd5\u6dfb\u52a0tomcat-cata\u7d22\u5f15\u6a21\u5f0f"},"9.2.\u540c\u6837\u65b9\u6cd5\u6dfb\u52a0tomcat-cata\u7d22\u5f15\u6a21\u5f0f"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161544_619217308f43698189.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_elasticsearch_12"})),(0,o.kt)("h3",{id:"93\u67e5\u8be2nginx-access\u7d22\u5f15\u65e5\u5fd7\u6570\u636e"},"9.3.\u67e5\u8be2nginx-access\u7d22\u5f15\u65e5\u5fd7\u6570\u636e"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161544_61921730bfbdb30760.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_tomcat_13"})),(0,o.kt)("h3",{id:"94\u67e5\u770btomcat-cata\u7d22\u5f15\u65e5\u5fd7\u6570\u636e"},"9.4.\u67e5\u770btomcat-cata\u7d22\u5f15\u65e5\u5fd7\u6570\u636e"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161545_619217310054824479.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_elasticsearch_14"})),(0,o.kt)("h2",{id:"10\u62a5\u9519\u5408\u96c6"},"10.\u62a5\u9519\u5408\u96c6"),(0,o.kt)("h3",{id:"101es\u542f\u52a8\u65f6\u62a5\u9519\u65e0\u6cd5\u6307\u5b9a\u88ab\u8bf7\u6c42\u7684\u5730\u5740"},"10.1.es\u542f\u52a8\u65f6\u62a5\u9519\u65e0\u6cd5\u6307\u5b9a\u88ab\u8bf7\u6c42\u7684\u5730\u5740"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u62a5\u9519\u5185\u5bb9\u5982\u4e0b"),(0,o.kt)("p",{parentName:"blockquote"},"\u89e3\u51b3\u65b9\u6cd5\uff1a\u4ed4\u7ec6\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\uff0c\u80af\u5b9a\u662f\u67d0\u4e2a\u5730\u5740\u914d\u7f6e\u9519\u4e86\uff0c\u6211\u7684\u5c31\u662f\u76d1\u542c\u5730\u5740\u7684ip\u5199\u9519\u4e86\n",(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161545_619217314c98b91590.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_zookeeper_15"}))),(0,o.kt)("h3",{id:"102filebeat\u5199\u5165\u6570\u636e\u5230kafka-api\u7248\u672c\u62a5\u9519"},"10.2.filebeat\u5199\u5165\u6570\u636e\u5230kafka api\u7248\u672c\u62a5\u9519"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u62a5\u9519\u5982\u4e0b\uff1a"),(0,o.kt)("p",{parentName:"blockquote"},"\u5206\u6790\u89e3\u51b3\u601d\u8def\uff1a\u521d\u6b65\u5224\u5b9a\u4e3akafka2.11\u7248\u672c\u95ee\u9898\u5bfc\u81f4\u7684\uff0c\u6362\u62102.13\u95ee\u9898\u89e3\u51b3")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/15161545_61921731a26b641259.png",alt:"\u90e8\u7f72ELK+Kafka+Filebeat\u65e5\u5fd7\u6536\u96c6\u5206\u6790\u7cfb\u7edf_1024\u7a0b\u5e8f\u5458\u8282_16"})),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u6765\u81ea\uff1a",(0,o.kt)("a",{parentName:"p",href:"https://blog.51cto.com/jiangxl/4597031"},"https://blog.51cto.com/jiangxl/4597031")),(0,o.kt)("p",{parentName:"blockquote"},"\u4ec5\u505a\u4e2a\u4eba\u5907\u4efd\u5b66\u4e60\u4f7f\u7528\u3002")))}p.isMDXComponent=!0}}]);