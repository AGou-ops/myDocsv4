"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[3883],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>d});var a=t(67294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var i=a.createContext({}),p=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},m=function(e){var n=p(e.components);return a.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,i=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),c=p(t),d=l,k=c["".concat(i,".").concat(d)]||c[d]||u[d]||r;return t?a.createElement(k,s(s({ref:n},m),{},{components:t})):a.createElement(k,s({ref:n},m))}));function d(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,s=new Array(r);s[0]=c;var o={};for(var i in n)hasOwnProperty.call(n,i)&&(o[i]=n[i]);o.originalType=e,o.mdxType="string"==typeof e?e:l,s[1]=o;for(var p=2;p<r;p++)s[p]=t[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},36408:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var a=t(87462),l=(t(67294),t(3905));const r={},s="Ansible Modules",o={unversionedId:"LinuxBasics/Ansible/Ansible modules",id:"LinuxBasics/Ansible/Ansible modules",title:"Ansible Modules",description:"- fileglob: \u663e\u793a\u6587\u4ef6\u5939\u4e2d\u7684\u6307\u5b9a\u6587\u4ef6",source:"@site/docs/LinuxBasics/Ansible/Ansible modules.md",sourceDirName:"LinuxBasics/Ansible",slug:"/LinuxBasics/Ansible/Ansible modules",permalink:"/docs/LinuxBasics/Ansible/Ansible modules",draft:!1,editUrl:"https://github.com/AGou-ops/myDocsv4/edit/main/docs/LinuxBasics/Ansible/Ansible modules.md",tags:[],version:"current",frontMatter:{},sidebar:"linuxBasics",previous:{title:"Ansible \u6e05\u5355\u7ba1\u7406",permalink:"/docs/LinuxBasics/Ansible/Ansible inventory"},next:{title:"Cache",permalink:"/docs/category/cache"}},i={},p=[],m={toc:p};function u(e){let{components:n,...t}=e;return(0,l.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"ansible-modules"},"Ansible Modules"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"fileglob"),": \u663e\u793a\u6587\u4ef6\u5939\u4e2d\u7684\u6307\u5b9a\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'    - name: show all test* file in /home/suofeiya/tmp floder\n      debug: msg="\u3010\u3010lookup(\'fileglob\',\'/home/suofeiya/tmp/test*\')\u3011\u3011"\n# \u5229\u7528fileglob\u7b5b\u9009\u51fa\u6765\u7684\u6587\u4ef6\n    - name: copy /home/suofeiya/tmp all files to /tmp\n      copy:\n        src: "\u3010\u3010item\u3011\u3011"\n        dest: "/tmp"\n        owner: suofeiya\n        mode: 600\n      with_fileglob: \n        - "/home/suofeiya/tmp/test*"\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mysql_user"),": \u589e\u5220\u7528\u6237\u53ca\u6388\u6743mysql\u6570\u636e\u5e93")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"  - name: connect to mySQL and add User for mySQL\n    mysql_user:\n      login_host: 192.168.43.37\n      login_port: 3306\n      login_user: root\n      login_password: 123\n      name: \"\u3010\u3010 item[0] \u3011\u3011\"\n      priv: \"\u3010\u3010 item[1] \u3011\u3011.*:ALL\"\n      append_privs: yes\n      password: \"123\"\n      state: absent\n    with_nested:\n      - [ 'user1', 'user2' ]\n      - [ 'test', 'test1' ]\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u904d\u5386",(0,l.kt)("inlineCode",{parentName:"li"},"vars"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"  - name: Show value of 'variablename'\n    debug: msg=\"\u3010\u3010 lookup('vars', item) \u3011\u3011 -- sub-variable is \u3010\u3010lookup('vars','test2').sub_test2\u3011\u3011\"\n    ignore_errors: True\n    vars:\n      test1: hello vars.test1\n      test2:\n        sub_test2: hello vars.test2.sub_test2\n    loop:\n    - test1\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"apt"),"&",(0,l.kt)("inlineCode",{parentName:"li"},"apt_key"),"&",(0,l.kt)("inlineCode",{parentName:"li"},"apt_repository"),"\u76f8\u5173")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: Install a list of packages\n  apt:\n    pkg:\n    - foo\n    - foo-tools\n- name: Update all packages to their latest version\n  apt:\n    name: "*"\n    state: latest\n- name: Upgrade the OS (apt-get dist-upgrade)\n  apt:\n    upgrade: dist\n- name: Install a .deb package\n  apt:\n    deb: /tmp/mypackage.deb\n    # install a deb package form internet\n    # deb: https://example.com/python-ppq_0.1-1_all.deb\n\n# apt_key\n- name: Add an Apt signing key, uses whichever key is at the URL\n  apt_key:\n    url: https://ftp-master.debian.org/keys/archive-key-6.0.asc\n    state: present\n\n# apt_repository\n- name: Add specified repository into sources list\n  apt_repository:\n    repo: deb http://archive.canonical.com/ubuntu hardy partner\n    state: present\n- name: Add nginx stable repository from PPA and install its signing key on Ubuntu target\n  apt_repository:\n    repo: ppa:nginx/stable\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"assemble"),"\u7ec4\u5408\u591a\u4e2a\u6587\u4ef6\u5185\u5bb9\u5230\u4e00\u4e2a\u6587\u4ef6, \u5e76\u4f7f\u7528\u9a8c\u8bc1\u547d\u4ee4\u8fdb\u884c\u9a8c\u8bc1")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: Assemble a new "sshd_config" file into place, after passing validation with sshd\n  assemble:\n    src: /etc/ssh/conf.d/\n    dest: /etc/ssh/sshd_config\n    validate: /usr/sbin/sshd -t -f %s\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u4f7f\u7528\u8be5\u547d\u4ee4\u65f6, \u76ee\u6807\u6587\u4ef6\u5c06\u88ab\u6e05\u7a7a\u5e76\u66ff\u6362\u4e3a\u7ec4\u5408\u6587\u4ef6\u7684\u5185\u5bb9.")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"blockinfile"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'  - name: Insert/Update "Match User" configuration block in /etc/ssh/sshd_config\n    blockinfile:\n      path: /home/suofeiya/ansible_workspace/index.html\n      marker: "\x3c!-- {mark} ANSIBLE MANAGED BLOCK --\x3e"\n      insertafter: "<body>"\n      block: |\n        <h1>Welcome to \u3010\u3010 ansible_hostname \u3011\u3011</h1>\n        <p>Last updated on \u3010\u3010 ansible_date_time.iso8601 \u3011\u3011</p>\n      \n      # block: "\u3010\u3010 lookup(\'file\', \'./local/sshd_config\') \u3011\u3011"\n      # validate: /usr/sbin/sshd -T -f %s\n      \n      # clear block\n      marker: "\x3c!-- {mark} ANSIBLE MANAGED BLOCK --\x3e"\n      block: ""\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"expect"),"\u81ea\u52a8\u56de\u590d\u4ea4\u4e92\u5f0f\u547d\u4ee4(Ubuntu\u4e0b\u6d4b\u8bd5\u65e0\u6548)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: Case insensitive password string match\n  expect:\n    command: passwd username\n    responses:\n      (?i)password: "MySekretPa$$word"\n  # you don\'t want to show passwords in your logs\n  no_log: true\n# \u56de\u590d\u591a\u4e2a\n    responses:\n      Question:\n        - response1\n        - response2\n        - response3\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"fail"),":\u81ea\u5b9a\u4e49\u9519\u8bef\u4fe1\u606f")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'  - name: Using fail message.\n    # you don\'t want to show passwords in your logs\n    fail:\n      msg: "you are not the one we are lookin for..."\n    when: name != "agou"\n    vars:\n      name: agou-ops\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"fetch"),": \u4ece\u8fdc\u7a0b\u4e3b\u673a\u83b7\u53d6\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: Specifying a destination path\n  fetch:\n    src: /tmp/uniquefile\n    dest: /tmp/special/\n    flat: yes       # \u533a\u5206\u8def\u5f84\u6700\u540e\u7684\u90a3\u4e2a`/`\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"get_url"),": \u4ecehttp,https,ftp\u83b7\u53d6\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: Download file with check (sha256)\n  get_url:\n    url: http://example.com/path/file.conf\n    dest: /etc/foo.conf\n    mode: '0440'\n    checksum: sha256:b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"git"),": \u514b\u9686\u4ed3\u5e93")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: Create git archive from repo\n  git:\n    repo: https://github.com/ansible/ansible-examples.git\n    dest: /src/ansible-examples\n    version: release-0.22\n    archive: /tmp/ansible-examples.zip\n    # separate_git_dir: /src/ansible-examples.git\n\n    \n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"random_choice"),": \u968f\u673a\u9009\u62e9")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'  - name: return a random list choice\n    debug: msg="your random choice is:\u3010\u3010item\u3011\u3011"\n    with_random_choice:\n    - "go through the door"\n    - "drink from the goblet"\n    - "press the red button"\n    - "do nothing"\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"block"),": \u66f4\u597d\u7684\u7ec4\u7ec7playbook, \u5904\u7406\u4efb\u52a1\u8fc7\u7a0b\u4e4b\u4e2d\u7684\u5f02\u5e38\u548c\u9519\u8bef")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: Attempt and graceful roll back demo\n  block:\n    - name: Print a message\n      debug:\n        msg: 'I execute normally'\n\n    - name: Force a failure\n      command: /bin/false\n\n    - name: Never print this\n      debug:\n  msg: 'I never execute, due to the above task failing, :-('\n  when: ansible_facts['distribution'] == 'CentOS'\n  become: true\n  become_user: root\n  ignore_errors: yes\n  rescue:\n    - name: Print when errors\n      meta: flush_handlers      # \u5373\u4f7f\u5f53\u9519\u8bef\u51fa\u73b0\uff0c\u4e5f\u8981\u7ee7\u7eed\u8fd0\u884c\n      debug:\n        msg: 'I caught an error'\n  always:\n    - name: Always do this\n      debug:\n        msg: \"This always executes\"\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"uri"),": \u670d\u52a1\u72b6\u6001\u68c0\u67e5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"  - name: check service status\n    uri:\n      url: http://127.0.0.1\n      return_content: yes\n    register: result\n    until: '\"???\" in result.content'\n    retries: 10\n    delay: 1\n")))}u.isMDXComponent=!0}}]);