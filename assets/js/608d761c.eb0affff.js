"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[5471],{3905:(n,e,t)=>{t.d(e,{Zo:()=>c,kt:()=>u});var o=t(67294);function i(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function a(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,o)}return t}function r(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?a(Object(t),!0).forEach((function(e){i(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function s(n,e){if(null==n)return{};var t,o,i=function(n,e){if(null==n)return{};var t,o,i={},a=Object.keys(n);for(o=0;o<a.length;o++)t=a[o],e.indexOf(t)>=0||(i[t]=n[t]);return i}(n,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(o=0;o<a.length;o++)t=a[o],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}var m=o.createContext({}),l=function(n){var e=o.useContext(m),t=e;return n&&(t="function"==typeof n?n(e):r(r({},e),n)),t},c=function(n){var e=l(n.components);return o.createElement(m.Provider,{value:e},n.children)},p={inlineCode:"code",wrapper:function(n){var e=n.children;return o.createElement(o.Fragment,{},e)}},d=o.forwardRef((function(n,e){var t=n.components,i=n.mdxType,a=n.originalType,m=n.parentName,c=s(n,["components","mdxType","originalType","parentName"]),d=l(t),u=i,k=d["".concat(m,".").concat(u)]||d[u]||p[u]||a;return t?o.createElement(k,r(r({ref:e},c),{},{components:t})):o.createElement(k,r({ref:e},c))}));function u(n,e){var t=arguments,i=e&&e.mdxType;if("string"==typeof n||i){var a=t.length,r=new Array(a);r[0]=d;var s={};for(var m in e)hasOwnProperty.call(e,m)&&(s[m]=e[m]);s.originalType=n,s.mdxType="string"==typeof n?n:i,r[1]=s;for(var l=2;l<a;l++)r[l]=t[l];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},18366:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>m,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var o=t(87462),i=(t(67294),t(3905));const a={},r="\u5355\u8282\u70b9\u90e8\u7f72",s={unversionedId:"CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/k8s\u5b89\u88c5MinIO\u5bf9\u8c61\u5b58\u50a8",id:"CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/k8s\u5b89\u88c5MinIO\u5bf9\u8c61\u5b58\u50a8",title:"\u5355\u8282\u70b9\u90e8\u7f72",description:"\u53c2\u8003\u6587\u6863",source:"@site/docs/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/k8s\u5b89\u88c5MinIO\u5bf9\u8c61\u5b58\u50a8.md",sourceDirName:"CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b",slug:"/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/k8s\u5b89\u88c5MinIO\u5bf9\u8c61\u5b58\u50a8",permalink:"/docs/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/k8s\u5b89\u88c5MinIO\u5bf9\u8c61\u5b58\u50a8",draft:!1,editUrl:"https://github.com/AGou-ops/myDocsv4/edit/main/docs/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/k8s\u5b89\u88c5MinIO\u5bf9\u8c61\u5b58\u50a8.md",tags:[],version:"current",frontMatter:{},sidebar:"cloudNative",previous:{title:"k8s\u5b89\u88c5Apollo\u914d\u7f6e\u4e2d\u5fc3",permalink:"/docs/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/k8s\u5b89\u88c5Apollo\u914d\u7f6e\u4e2d\u5fc3"},next:{title:"\u4f7f\u7528CSR API\u521b\u5efa\u7528\u6237",permalink:"/docs/CloudNative/k8s/\u5b9e\u6218\u6848\u4f8b/\u4f7f\u7528CSR API\u521b\u5efa\u7528\u6237"}},m={},l=[{value:"\u53c2\u8003\u6587\u6863",id:"\u53c2\u8003\u6587\u6863",level:2},{value:"\u90e8\u7f72minIO",id:"\u90e8\u7f72minio",level:2},{value:"\u96c6\u7fa4\u89d2\u8272\u89c4\u5212",id:"\u96c6\u7fa4\u89d2\u8272\u89c4\u5212",level:2},{value:"\u4e0b\u8f7dhelm\u5305",id:"\u4e0b\u8f7dhelm\u5305",level:2},{value:"\u4fee\u6539\u914d\u7f6e",id:"\u4fee\u6539\u914d\u7f6e",level:2},{value:"\u90e8\u7f72minIO",id:"\u90e8\u7f72minio-1",level:2},{value:"\u67e5\u770b\u8d44\u6e90\u4fe1\u606f",id:"\u67e5\u770b\u8d44\u6e90\u4fe1\u606f",level:2},{value:"\u521b\u5efaingress\u8d44\u6e90",id:"\u521b\u5efaingress\u8d44\u6e90",level:2},{value:"\u8bbf\u95ee\u6d4b\u8bd5",id:"\u8bbf\u95ee\u6d4b\u8bd5",level:2},{value:"\u8bbf\u95eeweb\u7ba1\u7406\u9875",id:"\u8bbf\u95eeweb\u7ba1\u7406\u9875",level:2},{value:"\u521b\u5efabucket",id:"\u521b\u5efabucket",level:2},{value:"\u521b\u5efaAccess Keys",id:"\u521b\u5efaaccess-keys",level:2},{value:"\u521b\u5efa\u8bbf\u95ee\u63a7\u5236\u6743\u9650",id:"\u521b\u5efa\u8bbf\u95ee\u63a7\u5236\u6743\u9650",level:2},{value:"\u5b89\u88c5mc\u5ba2\u6237\u7aef\uff08Linux\u4e8c\u8fdb\u5236\u6587\u4ef6\uff09",id:"\u5b89\u88c5mc\u5ba2\u6237\u7aeflinux\u4e8c\u8fdb\u5236\u6587\u4ef6",level:2},{value:"\u5b89\u88c5mc\u5ba2\u6237\u7aef\uff08docker\uff09",id:"\u5b89\u88c5mc\u5ba2\u6237\u7aefdocker",level:2},{value:"mc\u5ba2\u6237\u7aef\u5e38\u7528\u547d\u4ee4",id:"mc\u5ba2\u6237\u7aef\u5e38\u7528\u547d\u4ee4",level:2},{value:"mc\u8fde\u63a5minIO\u670d\u52a1",id:"mc\u8fde\u63a5minio\u670d\u52a1",level:2},{value:"bucket\u64cd\u4f5c",id:"bucket\u64cd\u4f5c",level:2},{value:"\u4e0a\u4f20\u4e0b\u8f7d\u64cd\u4f5c",id:"\u4e0a\u4f20\u4e0b\u8f7d\u64cd\u4f5c",level:2},{value:"\u6587\u4ef6\u64cd\u4f5c",id:"\u6587\u4ef6\u64cd\u4f5c",level:2},{value:"\u4e0a\u4f20\u6587\u4ef6",id:"\u4e0a\u4f20\u6587\u4ef6",level:2},{value:"\u4e0b\u8f7d\u6587\u4ef6",id:"\u4e0b\u8f7d\u6587\u4ef6",level:2}],c={toc:l};function p(n){let{components:e,...t}=n;return(0,i.kt)("wrapper",(0,o.Z)({},c,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u5355\u8282\u70b9\u90e8\u7f72"},"\u5355\u8282\u70b9\u90e8\u7f72"),(0,i.kt)("h2",{id:"\u53c2\u8003\u6587\u6863"},"\u53c2\u8003\u6587\u6863"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"http://www.minio.org.cn/docs/minio/kubernetes/upstream/#quickstart-minio-for-kubernetes"},"http://www.minio.org.cn/docs/minio/kubernetes/upstream/#quickstart-minio-for-kubernetes")),(0,i.kt)("h2",{id:"\u90e8\u7f72minio"},"\u90e8\u7f72minIO"),(0,i.kt)("p",null,"\u521b\u5efa\u8d44\u6e90"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[root@k8s-master minio]# cat > minio.yaml << EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: minio\n  name: minio\n  namespace: minio\nspec:\n  selector:\n    matchLabels:\n      app: minio\n  template:\n    metadata:\n      labels:\n        app: minio\n    spec:\n      containers:\n      - name: minio\n        image: quay.io/minio/minio:latest\n        command:\n        - /bin/bash\n        - -c\n        args: \n        - minio server /data --console-address :9090\n        volumeMounts:\n        - mountPath: /data\n          name: localvolume\n        ports:\n        - containerPort: 9090\n          name: console\n        - containerPort: 9000\n          name: api\n      nodeSelector:\n        kubernetes.io/hostname: k8s-master\n      volumes:\n      - name: localvolume\n        hostPath:\n          path: /data/minio\n          type: DirectoryOrCreate\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: minio-service\n  namespace: minio\nspec:\n    type: NodePort \n    selector:     \n      app: minio\n    ports:\n    - name: console\n      port: 9090\n      protocol: TCP\n      targetPort: 9090\n      nodePort: 30300\n    - name: api\n      port: 9000\n      protocol: TCP\n      targetPort: 9000\n      nodePort: 30200\nEOF\n[root@k8s-master minio]# kubectl apply -f minio.yaml \ndeployment.apps/minio created\nservice/minio-service created\n")),(0,i.kt)("p",null,"\u4f7f\u7528NodePort\u65b9\u5f0f\u8bbf\u95eeweb\u9875\u9762"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[root@k8s-master minio]# kubectl get pod -n minio \nNAME                     READY   STATUS    RESTARTS   AGE\nminio-86577f8755-l65mf   1/1     Running   0          11m\n[root@k8s-master minio]# kubectl get svc -n minio \nNAME            TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)                         AGE\nminio-service   NodePort   10.102.223.132   <none>        9090:30300/TCP,9000:30200/TCP   10m\n")),(0,i.kt)("p",null,"\u8bbf\u95eek8s\u8282\u70b9ip:30300\uff0c\u9ed8\u8ba4\u7528\u6237\u540d\u5bc6\u7801\u90fd\u662f",(0,i.kt)("strong",{parentName:"p"},"minioadmin"),"\n",(0,i.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/1681288151994-3eb8a828-d5d8-430b-a505-4beee56f8c3b.png",alt:"image.png"}),"\n\u4f7f\u7528ingress\u65b9\u5f0f\u8bbf\u95ee"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[root@k8s-master minio]# cat minio-ingress.yaml\napiVersion: traefik.containo.us/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: minio-console\n  namespace: minio\nspec:\n  entryPoints:\n  - web\n  routes:\n  - match: Host(`minio.test.com`) # \u57df\u540d\n    kind: Rule\n    services:\n      - name: minio-service  # \u4e0esvc\u7684name\u4e00\u81f4\n        port: 9090           # \u4e0esvc\u7684port\u4e00\u81f4\n---\napiVersion: traefik.containo.us/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: minio-api\n  namespace: minio\nspec:\n  entryPoints:\n  - web\n  routes:\n  - match: Host(`minio-api.test.com`) # \u57df\u540d\n    kind: Rule\n    services:\n      - name: minio-service  # \u4e0esvc\u7684name\u4e00\u81f4\n        port: 9000           # \u4e0esvc\u7684port\u4e00\u81f4\n[root@k8s-master minio]# kubectl apply -f minio-ingress.yaml \ningressroute.traefik.containo.us/minio-console created\ningressroute.traefik.containo.us/minio-api created\n")),(0,i.kt)("p",null,"\u6dfb\u52a0hosts\u8bb0\u5f55",(0,i.kt)("inlineCode",{parentName:"p"},"192.168.10.10 minio.test.com"),"\u8bbf\u95ee\u57df\u540d\u5373\u53ef"),(0,i.kt)("h1",{id:"\u90e8\u7f72minio\u96c6\u7fa4"},"\u90e8\u7f72minIO\u96c6\u7fa4"),(0,i.kt)("p",null,"minIO\u96c6\u7fa4\u65b9\u5f0f\u90e8\u7f72\u4f7f\u7528operator\u6216\u8005helm\u5747\u53ef\u3002helm\u90e8\u7f72minIO\u53c2\u8003\u6587\u6863\uff1a",(0,i.kt)("a",{parentName:"p",href:"https://artifacthub.io/packages/helm/bitnami/minio%E3%80%82operator%E9%83%A8%E7%BD%B2minIO%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3%EF%BC%9Ahttps://operator.min.io/%EF%BC%8C%E6%AD%A4%E5%A4%84%E4%BD%BF%E7%94%A8helm%E6%96%B9%E5%BC%8F%E9%83%A8%E7%BD%B2"},"https://artifacthub.io/packages/helm/bitnami/minio\u3002operator\u90e8\u7f72minIO\u53c2\u8003\u6587\u6863\uff1ahttps://operator.min.io/\uff0c\u6b64\u5904\u4f7f\u7528helm\u65b9\u5f0f\u90e8\u7f72")),(0,i.kt)("h2",{id:"\u96c6\u7fa4\u89d2\u8272\u89c4\u5212"},"\u96c6\u7fa4\u89d2\u8272\u89c4\u5212"),(0,i.kt)("p",null,"\u4f7f\u7528\u5206\u5e03\u5f0f\u65b9\u5f0f\u90e8\u7f72\u9ad8\u53ef\u7528\u7684minIO\u96c6\u7fa4\u65f6\uff0c\u9a71\u52a8\u5668\u603b\u6570\u81f3\u5c11\u662f4 \u4e2a\uff0c\u4ee5\u4fdd\u8bc1\u7ea0\u5220\u7801\u3002\u6211\u4eec\u53ef\u4ee5\u5728k8s-work1\u548ck8s-work2\u4e0a\u7684data1\u548cdata2\u8def\u5f84\u5b58\u653eminIO\u6570\u636e\uff0c\u4f7f\u7528local pv\u65b9\u5f0f\u6301\u4e45\u5316\u6570\u636e\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# \u521b\u5efa\u6570\u636e\u5b58\u653e\u8def\u5f84\n[root@k8s-work1 ~]# mkdir -p /data1/minio\n[root@k8s-work1 ~]# mkdir -p /data2/minio\n[root@k8s-work2 ~]# mkdir -p /data1/minio\n[root@k8s-work2 ~]# mkdir -p /data2/minio\n")),(0,i.kt)("h2",{id:"\u4e0b\u8f7dhelm\u5305"},"\u4e0b\u8f7dhelm\u5305"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[root@k8s-master ~]# helm repo add bitnami https://charts.bitnami.com/bitnami\n[root@k8s-master ~]# helm pull bitnami/minio --untar \n[root@k8s-master ~]# cd minio\n[root@k8s-master minio]# ls\nChart.lock  charts  Chart.yaml  README.md  templates  values.yaml\n")),(0,i.kt)("h2",{id:"\u4fee\u6539\u914d\u7f6e"},"\u4fee\u6539\u914d\u7f6e"),(0,i.kt)("p",null,"\u6dfb\u52a0storage-class\u6a21\u677f\u914d\u7f6e\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[root@k8s-master minio]# cat > templates/storage-class.yaml << EOF\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: minio-local-storage\nprovisioner: kubernetes.io/no-provisioner\nvolumeBindingMode: WaitForFirstConsumer\nEOF\n")),(0,i.kt)("p",null,"\u6dfb\u52a0 pv\u6a21\u677f\u914d\u7f6e"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[root@k8s-master minio]# cat templates/pv.yaml\n{{- $size := .Values.persistence.size -}}\n{{- $accessModes := .Values.persistence.accessModes -}}\n{{- $storageClass := .Values.persistence.storageClass -}}\n{{- range .Values.persistence.local }}\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: {{ .name }}\nspec:\n  capacity:\n    storage: {{ $size }}\n  volumeMode: Filesystem\n  accessModes: {{ $accessModes }}\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: {{ $storageClass }}\n  local:\n    path: {{ .path }}\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - {{ .host }}\n--- \n{{- end }}\n")),(0,i.kt)("p",null,"\u4fee\u6539\u914d\u7f6evalues.yaml"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'91  mode: distributed # \u96c6\u7fa4\u6a21\u5f0f\uff0c\u5355\u8282\u70b9\u4e3astandalone\uff0c\u5206\u5e03\u5f0f\u96c6\u7fa4\u4e3adistributed\n\n185 statefulset:\n203   replicaCount: 2 # \u8282\u70b9\u6570\n206   zones: 1 # \u533a\u57df\u6570\uff0c1\u4e2a\u5373\u53ef\n209   drivesPerNode: 2 # \u6bcf\u4e2a\u8282\u70b9\u6570\u636e\u76ee\u5f55\u6570.2\u8282\u70b9\xd72\u76ee\u5f55\u7ec4\u62104\u8282\u70b9\u7684mimio\u96c6\u7fa4\n\n594 service:\n597   type: NodePort # \u4fee\u6539server\u7c7b\u578b\u4e3aNodePort\n608   nodePorts: # \u6307\u5b9aNodePort\u7aef\u53e3\u53f7\n609     api: "30900"\n610     console: "30901"\n\n886 persistence:\n889   enabled: true\n897   storageClass: "minio-local-storage"\n900   mountPath: /data\n903   accessModes:\n904     - ReadWriteOnce\n907   size: 10Gi\n910   annotations: {}\n913   existingClaim: ""\n914   local:\n915     - name: minio-pv-0\n916       path: /data1/minio\n917       host: k8s-work1\n918     - name: minio-pv-1\n919       path: /data2/minio\n920       host: k8s-work1\n921     - name: minio-pv-2\n922       path: /data1/minio\n923       host: k8s-work2\n924     - name: minio-pv-3\n925       path: /data2/minio\n926       host: k8s-work2\n')),(0,i.kt)("h2",{id:"\u90e8\u7f72minio-1"},"\u90e8\u7f72minIO"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'[root@k8s-master minio]# kubectl create ns minio\n[root@k8s-master minio]# helm install minio . -f values.yaml -n minio\nNAME: minio\nLAST DEPLOYED: Thu Apr 13 13:52:22 2023\nNAMESPACE: minio\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nCHART NAME: minio\nCHART VERSION: 12.2.4\nAPP VERSION: 2023.3.24\n\n** Please be patient while the chart is being deployed **\n\nMinIO&reg; can be accessed via port  on the following DNS name from within your cluster:\n\n   minio.minio.svc.cluster.local\n\nTo get your credentials run:\n\n   export ROOT_USER=$(kubectl get secret --namespace minio minio -o jsonpath="{.data.root-user}" | base64 -d)\n   export ROOT_PASSWORD=$(kubectl get secret --namespace minio minio -o jsonpath="{.data.root-password}" | base64 -d)\n\nTo connect to your MinIO&reg; server using a client:\n\n- Run a MinIO&reg; Client pod and append the desired command (e.g. \'admin info\'):\n\n   kubectl run --namespace minio minio-client \\\n     --rm --tty -i --restart=\'Never\' \\\n     --env MINIO_SERVER_ROOT_USER=$ROOT_USER \\\n     --env MINIO_SERVER_ROOT_PASSWORD=$ROOT_PASSWORD \\\n     --env MINIO_SERVER_HOST=minio \\\n     --image docker.io/bitnami/minio-client:2023.3.23-debian-11-r0 -- admin info minio\n\nTo access the MinIO&reg; web UI:\n\n- Get the MinIO&reg; URL:\n\n   export NODE_PORT=$(kubectl get --namespace minio -o jsonpath="{.spec.ports[0].nodePort}" services minio)\n   export NODE_IP=$(kubectl get nodes --namespace minio -o jsonpath="{.items[0].status.addresses[0].address}")\n   echo "MinIO&reg; web URL: http://$NODE_IP:$NODE_PORT/minio"\n')),(0,i.kt)("h2",{id:"\u67e5\u770b\u8d44\u6e90\u4fe1\u606f"},"\u67e5\u770b\u8d44\u6e90\u4fe1\u606f"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[root@k8s-master minio]# kubectl get pod -n minio\nNAME      READY   STATUS    RESTARTS   AGE\nminio-0   1/1     Running   0          24m\nminio-1   1/1     Running   0          24m\n[root@k8s-master minio]# kubectl get all -n minio \nNAME          READY   STATUS    RESTARTS   AGE\npod/minio-0   1/1     Running   0          25m\npod/minio-1   1/1     Running   0          25m\n\nNAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                         AGE\nservice/minio            NodePort    10.100.230.196   <none>        9000:30900/TCP,9001:30901/TCP   25m\nservice/minio-headless   ClusterIP   None             <none>        9000/TCP,9001/TCP               25m\n\nNAME                     READY   AGE\nstatefulset.apps/minio   2/2     25m\n[root@k8s-master minio]# kubectl get pvc -n minio \nNAME             STATUS   VOLUME       CAPACITY   ACCESS MODES   STORAGECLASS          AGE\ndata-0-minio-0   Bound    minio-pv-3   10Gi       RWO            minio-local-storage   25m\ndata-0-minio-1   Bound    minio-pv-0   10Gi       RWO            minio-local-storage   25m\ndata-1-minio-0   Bound    minio-pv-2   10Gi       RWO            minio-local-storage   25m\ndata-1-minio-1   Bound    minio-pv-1   10Gi       RWO            minio-local-storage   25m\n[root@k8s-master minio]# kubectl get pv -n minio \nNAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                               STORAGECLASS          REASON   AGE\nminio-pv-0                                 10Gi       RWO            Delete           Bound    minio/data-0-minio-1                minio-local-storage            25m\nminio-pv-1                                 10Gi       RWO            Delete           Bound    minio/data-1-minio-1                minio-local-storage            25m\nminio-pv-2                                 10Gi       RWO            Delete           Bound    minio/data-1-minio-0                minio-local-storage            25m\nminio-pv-3                                 10Gi       RWO            Delete           Bound    minio/data-0-minio-0                minio-local-storage            25m\n")),(0,i.kt)("h2",{id:"\u521b\u5efaingress\u8d44\u6e90"},"\u521b\u5efaingress\u8d44\u6e90"),(0,i.kt)("p",null,"\u4ee5ingrss-nginx\u4e3a\u4f8b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# cat > ingress.yaml << EOF\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: minio-ingreess\n  namespace: minio\n  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /\nspec:\n  ingressClassName: nginx\n  rules:\n  - host: minio.local.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: minio\n            port:\n              number: 9001\nEOF\n")),(0,i.kt)("p",null,"\u4ee5traefik\u4e3a\u4f8b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[root@k8s-master minio]# cat ingress.yaml \napiVersion: traefik.containo.us/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: minio-console\n  namespace: minio\nspec:\n  entryPoints:\n  - web\n  routes:\n  - match: Host(`minio.local.com`) # \u57df\u540d\n    kind: Rule\n    services:\n      - name: minio  # \u4e0esvc\u7684name\u4e00\u81f4\n        port: 9001      # \u4e0esvc\u7684port\u4e00\u81f4\n---\napiVersion: traefik.containo.us/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: minio-api\n  namespace: minio\nspec:\n  entryPoints:\n  - web\n  routes:\n  - match: Host(`minio-api.local.com`) # \u57df\u540d\n    kind: Rule\n    services:\n      - name: minio  # \u4e0esvc\u7684name\u4e00\u81f4\n        port: 9000      # \u4e0esvc\u7684port\u4e00\u81f4\n[root@k8s-master minio]# kubectl apply -f ingress.yaml \ningressroute.traefik.containo.us/minio-console created\ningressroute.traefik.containo.us/minio-api created\n")),(0,i.kt)("h2",{id:"\u8bbf\u95ee\u6d4b\u8bd5"},"\u8bbf\u95ee\u6d4b\u8bd5"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'# \u83b7\u53d6\u7528\u6237\u540d\u548c\u5bc6\u7801\n[root@k8s-master minio]# kubectl get secret --namespace minio minio -o jsonpath="{.data.root-user}" | base64 -d\nadmin[root@k8s-master minio]# \n[root@k8s-master minio]# kubectl get secret --namespace minio minio -o jsonpath="{.data.root-password}" | base64 -d\nWtAbQDQITX[root@k8s-master minio]# \n')),(0,i.kt)("h2",{id:"\u8bbf\u95eeweb\u7ba1\u7406\u9875"},"\u8bbf\u95eeweb\u7ba1\u7406\u9875"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/1692006006827-dc9b1c7c-7eb9-48eb-824a-3f2037923024.png",alt:"image.png"})),(0,i.kt)("h1",{id:"minio\u4f7f\u7528"},"minIO\u4f7f\u7528"),(0,i.kt)("h2",{id:"\u521b\u5efabucket"},"\u521b\u5efabucket"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/1681288250619-9e71b807-95a6-428d-84bd-c2ee3ba7e451.png",alt:"image.png"}),"\n",(0,i.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/1681288331888-6b91729a-67c0-4675-a628-5bcd6260f7ad.png",alt:"image.png"}),"\n",(0,i.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/1681288347417-c7c79085-cd11-48f4-97f1-34ba97cb8e78.png",alt:"image.png"})),(0,i.kt)("h2",{id:"\u521b\u5efaaccess-keys"},"\u521b\u5efaAccess Keys"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/1681288392924-8647ad8a-64c2-4e23-b609-dfdb6333f403.png",alt:"image.png"})),(0,i.kt)("h2",{id:"\u521b\u5efa\u8bbf\u95ee\u63a7\u5236\u6743\u9650"},"\u521b\u5efa\u8bbf\u95ee\u63a7\u5236\u6743\u9650"),(0,i.kt)("p",null,"Minio \u7684\u5b58\u50a8\u6876\u9ed8\u8ba4\u662f\u4e0d\u8ddf\u4efb\u4f55 Acess Key \u5173\u8054\u7684\uff0c\u4e0d\u8fc7\u7531\u4e8e Minio \u652f\u6301\u6807\u51c6\u7684 S3 \u534f\u8bae\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed9 Access Key \u6388\u4e88\u67d0\u4e2a Bucket \u5b58\u50a8\u6876\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u5b9e\u73b0 Key \u548c Bucket \u7684\u7ed1\u5b9a\u3002\n\u521b\u5efapolicy\n",(0,i.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/1689994620680-5022ac1d-e950-40f5-98ba-0512c9e40f9a.png",alt:"image.png"})),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Action": [\n                "s3:ListAllMyBuckets",\n                "s3:ListBucket",\n                "s3:GetBucketLocation",\n                "s3:GetObject",\n                "s3:PutObject",\n                "s3:DeleteObject"\n            ],\n            "Resource": [\n                "arn:aws:s3:::es-backup/*"\n            ]\n        }\n    ]\n}\n')),(0,i.kt)("p",null,"\u521b\u5efauser\n\u8fd9\u91cc Access Key \u662f\u7528\u6237\u540d\uff0cAccess Secret \u662f\u5bf9\u5e94\u7684\u53e3\u4ee4\u3002\u8bbe\u7f6e\u65f6\u5173\u8054\u4e0a\u521a\u624d\u521b\u5efa\u7684 Policy \u5373\u53ef\u3002\n",(0,i.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/1689994774057-67d85be0-91d3-4e67-a42c-e0f12d09c89c.png",alt:"image.png"}),"\n\u6211\u4eec\u5c31\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684\u5b58\u50a8\u6876\uff0c\u5e76\u4e14\u7ed9\u8fd9\u4e2a\u5b58\u50a8\u6876\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u7528\u6237\uff0c\u540c\u65f6\u6388\u6743\u4e86\u7528\u6237\u5bf9\u5b58\u50a8\u6876\u7684\u8bbf\u95ee\uff0c\u5305\u62ec\u5217\u8868\u3001\u4e0a\u4f20\u3001\u4e0b\u8f7d\u8fd9\u51e0\u4e2a\u57fa\u672c\u6743\u9650\u3002"),(0,i.kt)("h1",{id:"mc\u5ba2\u6237\u7aef\u4f7f\u7528"},"mc\u5ba2\u6237\u7aef\u4f7f\u7528"),(0,i.kt)("p",null,"MinIO Client (mc)\u4e3als\uff0ccat\uff0ccp\uff0cmirror\uff0cdiff\uff0cfind\u7b49UNIX\u547d\u4ee4\u63d0\u4f9b\u4e86\u4e00\u79cd\u66ff\u4ee3\u65b9\u6848\u3002\u5b83\u652f\u6301\u6587\u4ef6\u7cfb\u7edf\u548c\u517c\u5bb9Amazon S3\u7684\u4e91\u5b58\u50a8\u670d\u52a1\uff08AWS Signature v2\u548cv4\uff09\u3002"),(0,i.kt)("h2",{id:"\u5b89\u88c5mc\u5ba2\u6237\u7aeflinux\u4e8c\u8fdb\u5236\u6587\u4ef6"},"\u5b89\u88c5mc\u5ba2\u6237\u7aef\uff08Linux\u4e8c\u8fdb\u5236\u6587\u4ef6\uff09"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'[root@k8s-master minio]# curl https://dl.min.io/client/mc/release/linux-amd64/mc --create-dirs -o /usr/local/minio-binaries/mc\n[root@k8s-master local]# cd /usr/local/minio-binaries\n[root@k8s-master minio-binaries]# ls\nmc\n[root@k8s-master minio-binaries]# chmod +x mc \n[root@k8s-master minio-binaries]# ./mc --help\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 (q)uit/esc\nNAME:                                                                              \n  mc - MinIO Client for object storage and filesystems.                            \n\nUSAGE:                                                                             \n  mc [FLAGS] COMMAND [COMMAND FLAGS | -h] [ARGUMENTS...]\n# \u6dfb\u52a0\u73af\u5883\u53d8\u91cf\n[root@k8s-master minio-binaries]# cat /etc/profile\nexport PATH="$PATH:/usr/local/minio-binaries"\n[root@k8s-master minio-binaries]# source /etc/profile\n[root@k8s-master minio-binaries]# mc --help\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 (q)uit/esc\n  mc [FLAGS] COMMAND [COMMAND FLAGS | -h] [ARGUMENTS...]\n')),(0,i.kt)("h2",{id:"\u5b89\u88c5mc\u5ba2\u6237\u7aefdocker"},"\u5b89\u88c5mc\u5ba2\u6237\u7aef\uff08docker\uff09"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[root@tiaoban ~]# docker run -it --rm minio/mc ls play\nmc: Configuration written to `/root/.mc/config.json`. Please update your access credentials.\nmc: Successfully created `/root/.mc/share`.\nmc: Initialized share uploads `/root/.mc/share/uploads.json` file.\nmc: Initialized share downloads `/root/.mc/share/downloads.json` file.\n[2023-04-13 01:39:27 UTC]     0B 64375d4bed2b146c15d5383f-files/\n[2023-03-15 11:55:17 UTC]     0B abc/\n[2023-03-31 18:46:54 UTC]     0B awdkenny/\n")),(0,i.kt)("h2",{id:"mc\u5ba2\u6237\u7aef\u5e38\u7528\u547d\u4ee4"},"mc\u5ba2\u6237\u7aef\u5e38\u7528\u547d\u4ee4"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"\u547d\u4ee4"),(0,i.kt)("th",{parentName:"tr",align:null},"\u529f\u80fd"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ls"),(0,i.kt)("td",{parentName:"tr",align:null},"\u5217\u51fa\u6587\u4ef6\u548c\u6587\u4ef6\u5939\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"mb"),(0,i.kt)("td",{parentName:"tr",align:null},"\u521b\u5efa\u4e00\u4e2a\u5b58\u50a8\u6876\u6216\u4e00\u4e2a\u6587\u4ef6\u5939\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"cat"),(0,i.kt)("td",{parentName:"tr",align:null},"\u663e\u793a\u6587\u4ef6\u548c\u5bf9\u8c61\u5185\u5bb9\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"pipe"),(0,i.kt)("td",{parentName:"tr",align:null},"\u5c06\u4e00\u4e2aSTDIN\u91cd\u5b9a\u5411\u5230\u4e00\u4e2a\u5bf9\u8c61\u6216\u8005\u6587\u4ef6\u6216\u8005STDOUT\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"share"),(0,i.kt)("td",{parentName:"tr",align:null},"\u751f\u6210\u7528\u4e8e\u5171\u4eab\u7684URL\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"cp"),(0,i.kt)("td",{parentName:"tr",align:null},"\u62f7\u8d1d\u6587\u4ef6\u548c\u5bf9\u8c61\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"mirror"),(0,i.kt)("td",{parentName:"tr",align:null},"\u7ed9\u5b58\u50a8\u6876\u548c\u6587\u4ef6\u5939\u505a\u955c\u50cf\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"find"),(0,i.kt)("td",{parentName:"tr",align:null},"\u57fa\u4e8e\u53c2\u6570\u67e5\u627e\u6587\u4ef6\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"diff"),(0,i.kt)("td",{parentName:"tr",align:null},"\u5bf9\u4e24\u4e2a\u6587\u4ef6\u5939\u6216\u8005\u5b58\u50a8\u6876\u6bd4\u8f83\u5dee\u5f02\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"rm"),(0,i.kt)("td",{parentName:"tr",align:null},"\u5220\u9664\u6587\u4ef6\u548c\u5bf9\u8c61\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"events"),(0,i.kt)("td",{parentName:"tr",align:null},"\u7ba1\u7406\u5bf9\u8c61\u901a\u77e5\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"watch"),(0,i.kt)("td",{parentName:"tr",align:null},"\u76d1\u89c6\u6587\u4ef6\u548c\u5bf9\u8c61\u7684\u4e8b\u4ef6\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"policy"),(0,i.kt)("td",{parentName:"tr",align:null},"\u7ba1\u7406\u8bbf\u95ee\u7b56\u7565\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"config"),(0,i.kt)("td",{parentName:"tr",align:null},"\u7ba1\u7406mc\u914d\u7f6e\u6587\u4ef6\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"update"),(0,i.kt)("td",{parentName:"tr",align:null},"\u68c0\u67e5\u8f6f\u4ef6\u66f4\u65b0\u3002")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"version"),(0,i.kt)("td",{parentName:"tr",align:null},"\u8f93\u51fa\u7248\u672c\u4fe1\u606f\u3002")))),(0,i.kt)("h2",{id:"mc\u8fde\u63a5minio\u670d\u52a1"},"mc\u8fde\u63a5minIO\u670d\u52a1"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# \u6dfb\u52a0\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1\n[root@k8s-master minio-binaries]# mc alias set k8s-minio http://10.102.223.132:9000 minioadmin minioadmin\nAdded `k8s-minio` successfully.\n[root@k8s-master minio-binaries]# mc admin info k8s-minio\n\u25cf  10.102.223.132:9000\n   Uptime: 41 minutes \n   Version: 2023-04-07T05:28:58Z\n   Network: 1/1 OK \n   Drives: 1/1 OK \n   Pool: 1\n\nPools:\n   1st, Erasure sets: 1, Drives per erasure set: 1\n\n12 MiB Used, 1 Bucket, 2 Objects\n1 drive online, 0 drives offline\n")),(0,i.kt)("h2",{id:"bucket\u64cd\u4f5c"},"bucket\u64cd\u4f5c"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# \u521b\u5efabucket\n[root@k8s-master ~]# mc mb k8s-minio/test\nBucket created successfully `k8s-minio/test`.\n# \u67e5\u770bbucket\n[root@k8s-master ~]# mc ls k8s-minio\n[2023-04-13 10:02:02 CST]     0B test/\n\n# \u5220\u9664\u6ca1\u6709\u6587\u4ef6\u7684bucket\n[root@k8s-master ~]# mc rb k8s-minio/demo\n# \u5220\u9664\u6709\u6587\u4ef6\u7684bucket\n[root@k8s-master ~]# mc rb k8s-minio/test --force\n")),(0,i.kt)("h2",{id:"\u4e0a\u4f20\u4e0b\u8f7d\u64cd\u4f5c"},"\u4e0a\u4f20\u4e0b\u8f7d\u64cd\u4f5c"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# \u4e0a\u4f20\u6587\u4ef6\u5230bucket\n[root@k8s-master ~]# mc cp /etc/hosts k8s-minio/test\n/etc/hosts:                   2.09 KiB / 2.09 KiB \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 60.07 KiB/s 0s[root@k8s-master ~]# mc cp /etc/yum.repos.d k8s-minio/test\n# \u4e0a\u4f20\u76ee\u5f55\u5230bucket\n[root@k8s-master ~]# mc cp /etc/yum.repos.d k8s-minio/test --recursive\n...m.repos.d/kubernetes.repo: 19.46 KiB / 19.46 KiB \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 121.99 KiB/s 0s\n\n# \u4e0b\u8f7dbucket\u6587\u4ef6\u5230\u672c\u5730\n[root@k8s-master ~]# mkdir /tmp/download\n[root@k8s-master ~]# mc cp k8s-minio/test/hosts /tmp/download/\n...2.223.132:9000/test/hosts: 2.09 KiB / 2.09 KiB \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 66.18 KiB/s 0s[root@k8s-master ~]# ls /tmp/download/\nhosts\n[root@k8s-master ~]# cat /tmp/download/hosts \n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n# \u4e0b\u8f7dbucket\u76ee\u5f55\u5230\u672c\u5730\n[root@k8s-master ~]# mc cp k8s-minio/test/yum.repos.d /tmp/download/ --recursive\n...m.repos.d/kubernetes.repo: 19.46 KiB / 19.46 KiB \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 87.10 KiB/s 0s[root@k8s-master ~]# ls /tmp/download/yum.repos.d/\ndocker-ce.repo     epel-testing-modular.repo  Rocky-AppStream.repo\n")),(0,i.kt)("h2",{id:"\u6587\u4ef6\u64cd\u4f5c"},"\u6587\u4ef6\u64cd\u4f5c"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# \u67e5\u770bbucket\u6587\u4ef6\u5217\u8868\n[root@k8s-master ~]# mc ls k8s-minio/test\n[2023-04-13 10:04:59 CST] 2.1KiB STANDARD hosts\n[2023-04-13 10:10:42 CST]     0B yum.repos.d/\n# \u67e5\u770bbucket\u76ee\u5f55\u5185\u5bb9\n[root@k8s-master ~]# mc ls k8s-minio/test/yum.repos.d\n[2023-04-13 10:05:34 CST]   710B STANDARD Rocky-AppStream.repo\n[2023-04-13 10:05:34 CST]   695B STANDARD Rocky-BaseOS.repo\n[2023-04-13 10:05:34 CST] 1.7KiB STANDARD Rocky-Debuginfo.repo\n[2023-04-13 10:05:34 CST]   360B STANDARD Rocky-Devel.repo\n# \u67e5\u770bbucket\u6587\u4ef6\u5185\u5bb9\n[root@k8s-master ~]# mc cat k8s-minio/test/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n# \u5220\u9664\u6587\u4ef6\n[root@k8s-master ~]# mc rm k8s-minio/test/hosts\nRemoved `k8s-minio/test/hosts`.\n# \u5220\u9664\u76ee\u5f55\n[root@k8s-master ~]# mc rm k8s-minio/test/yum.repos.d --recursive --force\nRemoved `k8s-minio/test/yum.repos.d/Rocky-AppStream.repo`.\nRemoved `k8s-minio/test/yum.repos.d/Rocky-BaseOS.repo`.\nRemoved `k8s-minio/test/yum.repos.d/Rocky-Debuginfo.repo`.\nRemoved `k8s-minio/test/yum.repos.d/Rocky-Devel.repo`.\n")),(0,i.kt)("h1",{id:"curl\u5ba2\u6237\u7aef\u4f7f\u7528"},"curl\u5ba2\u6237\u7aef\u4f7f\u7528"),(0,i.kt)("h2",{id:"\u4e0a\u4f20\u6587\u4ef6"},"\u4e0a\u4f20\u6587\u4ef6"),(0,i.kt)("p",null,"\u4e0a\u4f20\u6587\u4ef6\u811a\u672c\uff0c\u6309\u5b9e\u9645\u60c5\u51b5\u4fee\u6539host\u3001s3_key\u3001s3_secret\u548c-x"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'[root@tiaoban ~]# cat push.sh \n#!/bin/bash\nexport PATH=$PATH:/bin:/usr/bin:/usr/local/bin\nif [ $# != 2 ] ; then \necho "Usage: `basename $0` my-bucket my-file.zip" >&2\nexit 1\nfi\nbucket=$1\nfile=$2\nhost=minio-api.test.com\ns3_key=GfuHooI5byVpGf2RGwl3\ns3_secret=YpYqXKKhI4bNUmWWULa3qf5n5WPq3TDedb1uzREc\nresource="/${bucket}/${file}"\ncontent_type="application/zstd"\ndate=`date -R`\n_signature="PUT\\n\\n${content_type}\\n${date}\\n${resource}"\nsignature=`echo -en ${_signature} | openssl sha1 -hmac ${s3_secret} -binary | base64`\n\ncurl -v -X PUT -T "${file}" \\\n          -H "Host: ${host}" \\\n          -x "192.168.10.10:80" \\\n          -H "Date: ${date}" \\\n          -H "Content-Type: ${content_type}" \\\n          -H "Authorization: AWS ${s3_key}:${signature}" \\\n          http://${host}${resource}\n')),(0,i.kt)("p",null,"\u4e0a\u4f20\u6587\u4ef6"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'[root@tiaoban ~]# ls\nanaconda-ks.cfg  cfssl  defaults.ini  es  go  push.sh\n[root@tiaoban ~]# ./push.sh test defaults.ini \n*   Trying 192.168.10.10...\n* TCP_NODELAY set\n* Connected to 192.168.10.10 (192.168.10.10) port 80 (#0)\n> PUT http://minio-api.test.com/test/defaults.ini HTTP/1.1\n> Host: minio-api.test.com\n> User-Agent: curl/7.61.1\n> Accept: */*\n> Proxy-Connection: Keep-Alive\n> Date: Sat, 06 May 2023 10:10:07 +0800\n> Content-Type: application/zstd\n> Authorization: AWS bhUsp7nwc6XNPzoI:w2ddmcsQWOijC2BZJSGE4u7DgFc=\n> Content-Length: 55875\n> Expect: 100-continue\n> \n< HTTP/1.1 100 Continue\n* We are completely uploaded and fine\n< HTTP/1.1 200 OK\n< Accept-Ranges: bytes\n< Content-Length: 0\n< Content-Security-Policy: block-all-mixed-content\n< Date: Sat, 06 May 2023 02:10:07 GMT\n< Etag: "1b0bdd8f4c5f31ef5661380efcaefce5"\n< Server: MinIO\n< Strict-Transport-Security: max-age=31536000; includeSubDomains\n< Vary: Origin\n< Vary: Accept-Encoding\n< X-Amz-Id-2: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\n< X-Amz-Request-Id: 175C6BE8ACF79B53\n< X-Content-Type-Options: nosniff\n< X-Xss-Protection: 1; mode=block\n< \n* Connection #0 to host 192.168.10.10 left intact\n')),(0,i.kt)("p",null,"\u67e5\u770bbucket\u6587\u4ef6\n",(0,i.kt)("img",{parentName:"p",src:"https://cdn.agou-ops.cn/others/1683339253090-6b00229f-cf94-4f0f-a62f-9d52bf38cc6d.png",alt:"image.png"})),(0,i.kt)("h2",{id:"\u4e0b\u8f7d\u6587\u4ef6"},"\u4e0b\u8f7d\u6587\u4ef6"),(0,i.kt)("p",null,"\u4e0b\u8f7d\u6587\u4ef6\u811a\u672c"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#!/usr/bin/env sh\nif [ $# != 3 ] ; then \necho "Usage: `basename $0` my-bucket minio-filename localfile" >&2\necho "Usage: `basename $0` test-bucket 1.log /tmp/1.log" >&2\nexit 1\nfi\n# User Minio Vars\nhost=minio-api.test.com\ns3_key=bhUsp7nwc6XNPzoI\ns3_secret=w3KBPxMZ5Nw4apRGZY3uAHON7bkkKprP\nBUCKET=$1\nMINIO_PATH="/${BUCKET}/$2"\nOUT_FILE=$3\n# Static Vars\nDATE=$(date -R)\nCONTENT_TYPE=\'application/zstd\'\nSIG_STRING="GET\\n\\n${CONTENT_TYPE}\\n${DATE}\\n${MINIO_PATH}"\nSIGNATURE=`echo -en ${SIG_STRING} | openssl sha1 -hmac ${s3_secret} -binary | base64`\n\ncurl -v -o "${OUT_FILE}" \\\n    -x "192.168.10.10:80" \\\n    -H "Host: $host" \\\n    -H "Date: ${DATE}" \\\n    -H "Content-Type: ${CONTENT_TYPE}" \\\n    -H "Authorization: AWS ${s3_key}:${SIGNATURE}" \\\n    http://$URL${MINIO_PATH}\n')),(0,i.kt)("p",null,"\u4e0b\u8f7d\u6587\u4ef6"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'[root@tiaoban ~]# ./pull.sh test defaults.ini /tmp/defaults.ini\n*   Trying 192.168.10.10...\n* TCP_NODELAY set\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* Connected to 192.168.10.10 (192.168.10.10) port 80 (#0)\n> GET http://minio-api.test.com/test/defaults.ini HTTP/1.1\n> Host: minio-api.test.com\n> User-Agent: curl/7.61.1\n> Accept: */*\n> Proxy-Connection: Keep-Alive\n> Date: Sat, 06 May 2023 10:17:18 +0800\n> Content-Type: application/zstd\n> Authorization: AWS bhUsp7nwc6XNPzoI:sl8feCFiJC4MpaKSKrGU9HlDMLw=\n> \n< HTTP/1.1 200 OK\n< Accept-Ranges: bytes\n< Content-Length: 55875\n< Content-Security-Policy: block-all-mixed-content\n< Content-Type: application/zstd\n< Date: Sat, 06 May 2023 02:17:18 GMT\n< Etag: "1b0bdd8f4c5f31ef5661380efcaefce5"\n< Last-Modified: Sat, 06 May 2023 02:10:07 GMT\n< Server: MinIO\n< Strict-Transport-Security: max-age=31536000; includeSubDomains\n< Vary: Origin\n< Vary: Accept-Encoding\n< X-Amz-Id-2: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\n< X-Amz-Request-Id: 175C6C4CF3EB56C4\n< X-Content-Type-Options: nosniff\n< X-Xss-Protection: 1; mode=block\n< \n{ [3529 bytes data]\n100 55875  100 55875    0     0  1474k      0 --:--:-- --:--:-- --:--:-- 1515k\n* Connection #0 to host 192.168.10.10 left intact\n[root@tiaoban ~]# ls -lh /tmp/defaults.ini \n-rw-r--r-- 1 root root 55K 5\u6708   6 10:17 /tmp/defaults.ini\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u8be5\u6587\u7ae0\u6765\u6e90\u4e8e\u7f51\u7edc\uff0c\u4ec5\u505a\u4e2a\u4eba\u5907\u4efd.")))}p.isMDXComponent=!0}}]);