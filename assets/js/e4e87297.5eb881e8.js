"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[4971],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>m});var a=t(67294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,s=function(e,n){if(null==e)return{};var t,a,s={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var o=a.createContext({}),c=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(o.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,s=e.mdxType,l=e.originalType,o=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(t),m=s,b=u["".concat(o,".").concat(m)]||u[m]||d[m]||l;return t?a.createElement(b,r(r({ref:n},p),{},{components:t})):a.createElement(b,r({ref:n},p))}));function m(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var l=t.length,r=new Array(l);r[0]=u;var i={};for(var o in n)hasOwnProperty.call(n,o)&&(i[o]=n[o]);i.originalType=e,i.mdxType="string"==typeof e?e:s,r[1]=i;for(var c=2;c<l;c++)r[c]=t[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},56635:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var a=t(87462),s=(t(67294),t(3905));const l={},r="Ansible \u7b80\u5355\u4f7f\u7528\u4e0e\u5e38\u7528\u6a21\u5757",i={unversionedId:"LinuxBasics/Ansible/Ansible Ad-hoc Basic",id:"LinuxBasics/Ansible/Ansible Ad-hoc Basic",title:"Ansible \u7b80\u5355\u4f7f\u7528\u4e0e\u5e38\u7528\u6a21\u5757",description:"Ansible \u7b80\u5355\u4f7f\u7528",source:"@site/docs/LinuxBasics/Ansible/Ansible Ad-hoc Basic.md",sourceDirName:"LinuxBasics/Ansible",slug:"/LinuxBasics/Ansible/Ansible Ad-hoc Basic",permalink:"/docs/LinuxBasics/Ansible/Ansible Ad-hoc Basic",draft:!1,editUrl:"https://github.com/AGou-ops/myDocsv4/edit/main/docs/LinuxBasics/Ansible/Ansible Ad-hoc Basic.md",tags:[],version:"current",frontMatter:{},sidebar:"linuxBasics",previous:{title:"Ansible",permalink:"/docs/category/ansible"},next:{title:"Ansible Basic",permalink:"/docs/LinuxBasics/Ansible/Ansible Basic"}},o={},c=[{value:"Ansible \u7b80\u5355\u4f7f\u7528",id:"ansible-\u7b80\u5355\u4f7f\u7528",level:2},{value:"\u5e38\u7528\u6a21\u5757",id:"\u5e38\u7528\u6a21\u5757",level:2},{value:"group",id:"group",level:4},{value:"user",id:"user",level:4},{value:"copy",id:"copy",level:4},{value:"fetch",id:"fetch",level:4},{value:"file(Manage files and file properties)",id:"filemanage-files-and-file-properties",level:4},{value:"cron",id:"cron",level:4},{value:"command",id:"command",level:4},{value:"shell",id:"shell",level:4},{value:"yum",id:"yum",level:4},{value:"service",id:"service",level:4},{value:"script( Runs a local script on a remote node after transferring it)",id:"script-runs-a-local-script-on-a-remote-node-after-transferring-it",level:4},{value:"mount",id:"mount",level:4},{value:"unarchive/archive",id:"unarchivearchive",level:3},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}],p={toc:c};function d(e){let{components:n,...t}=e;return(0,s.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"ansible-\u7b80\u5355\u4f7f\u7528\u4e0e\u5e38\u7528\u6a21\u5757"},"Ansible \u7b80\u5355\u4f7f\u7528\u4e0e\u5e38\u7528\u6a21\u5757"),(0,s.kt)("h2",{id:"ansible-\u7b80\u5355\u4f7f\u7528"},"Ansible \u7b80\u5355\u4f7f\u7528"),(0,s.kt)("p",null,"\u7f16\u8f91",(0,s.kt)("inlineCode",{parentName:"p"},"/etc/ansible/hosts"),"\u6587\u4ef6,\u6dfb\u52a0\u8981\u7ba1\u63a7\u7684\u4e3b\u673a:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ini"},"...\n[testserver]\nnode01\nnode02\n...\n")),(0,s.kt)("p",null,"\u4e3a ",(0,s.kt)("inlineCode",{parentName:"p"},"node01")," \u548c ",(0,s.kt)("inlineCode",{parentName:"p"},"node02")," \u6dfb\u52a0 SSH \u514d\u5bc6\u8ba4\u8bc1:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ssh-keygen -t rsa -P ""     # \u4e00\u8defENTER\u5373\u53ef\nssh-copy-id -i ~/.ssh/id_rsa.pub root@node01\nssh-copy-id -i ~/.ssh/id_rsa.pub root@node02\n')),(0,s.kt)("p",null,"\u5217\u51fa\u5f53\u524d\u6240\u6709\u88ab\u7ba1\u63a7\u7684\u4e3b\u673a:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"[root@master ~]\\# ansible all --list-hosts\n  hosts (2):\n    node01\n    node02\n")),(0,s.kt)("p",null,"\u4f7f\u7528\u5185\u7f6e",(0,s.kt)("inlineCode",{parentName:"p"},"ping"),"\u6a21\u5757\u68c0\u67e5\u8fde\u901a\u6027:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'[root@master ~]\\# ansible all -m ping -C            # -C(--check)\u9884\u6d4b\u53d8\u5316,\u5e76\u975e\u771f\u6b63\u6267\u884c\nnode02 | SUCCESS => {\n    "ansible_facts": {\n        "discovered_interpreter_python": "/usr/bin/python"\n    },\n    "changed": false,\n    "ping": "pong"\n}\nnode01 | SUCCESS => {\n    "ansible_facts": {\n        "discovered_interpreter_python": "/usr/bin/python"\n    },\n    "changed": false,\n    "ping": "pong"\n}\n')),(0,s.kt)("h2",{id:"\u5e38\u7528\u6a21\u5757"},"\u5e38\u7528\u6a21\u5757"),(0,s.kt)("h4",{id:"group"},"group"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible all -m group -a "gid=1080 name=test_grp state=present system=no"\n* \u53c2\u6570\u8bf4\u660e:\n`state`:  (Choices: absent, present)[Default: present]\n`system`: \u662f\u5426\u4e3a\u7cfb\u7edf\u7528\u6237\u7ec4,\u9ed8\u8ba4\u4e3ano\n')),(0,s.kt)("h4",{id:"user"},"user"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible all -m user -a "uid=5000 name=test_user state=present groups=test_grp shell=/usr/bin/sh"\n* \u53c2\u6570\u8bf4\u660e:\n`groups`: \u6307\u5b9a\u9644\u52a0\u7ec4, \u6307\u5b9a\u7ec4\u4f7f\u7528`group`\n')),(0,s.kt)("h4",{id:"copy"},"copy"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible all -m copy -a "src=/root/testfile dest=/tmp/testfile_ansible mode=600"\nansible all -m copy -a "src=/root/testdir dest=/tmp/"\n* \u590d\u5236\u76ee\u5f55\u65f6\u9700\u8981\u6ce8\u610f\u7684\u4e00\u70b9:\n`/root/testdir` \u4e0e `/root/testdir/` \u4e0d\u540c,\u524d\u8005\u4f1a\u9012\u5f52\u590d\u5236\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u53ca\u6587\u4ef6\u5939\u672c\u8eab,\u540e\u8005\u53ea\u4f1a\u590d\u5236\u6587\u4ef6\u5939\u91cc\u9762\u7684\u5185\u5bb9,\u4e0d\u5305\u542b\u76ee\u5f55\u672c\u8eab\n\n# \u590d\u5236\u81ea\u5b9a\u4e49\u5185\u5bb9\u6587\u4ef6,\u5185\u5bb9\u7531\u547d\u4ee4\u884c\u7ed9\u51fa\nansible all -m copy -a "content=\'Hello Ansible! \\n\' dest=/tmp/hello.txt owner=test_user group=test_grp force=yes"\n')),(0,s.kt)("h4",{id:"fetch"},"fetch"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible all -m fetch -a "src=/tmp/hello.txt dest=/root/ fail_on_missing=yes"\n* \u53c2\u6570\u8bf4\u660e:\n`fail_on_missing`: \u4e3ayes\u65f6,\u5f53\u8fdc\u7a0b\u4e3b\u673a\u6ca1\u6709\u8be5\u6587\u4ef6\u65f6,\u6b63\u5e38\u9000\u51fa.\n\n* \u6ce8\u610ffetch\u5230\u672c\u5730\u7684\u76ee\u5f55\u7ed3\u6784\u6bd4\u8f83\u7279\u6b8a\n[root@master ~]\\# tree node01\nnode01\n\u2514\u2500\u2500 tmp\n    \u2514\u2500\u2500 hello.txt\n\n1 directory, 1 file\n')),(0,s.kt)("h4",{id:"filemanage-files-and-file-properties"},"file(Manage files and file properties)"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible all -m file -a "path=/tmp/testdir state=directory"\n* \u53c2\u6570\u8bf4\u660e:\n`state`: \n    absent: \u5220\u9664\u6587\u4ef6\u5939,\u6587\u4ef6\u548c\u94fe\u63a5\u4e5f\u90fd\u4f1a\u88ab\u5220\u9664\n    file: \u5982\u679c\u6587\u4ef6\u5b58\u5728\u5219\u8f93\u51fa\u7c7b\u4f3c\u4e8e`stat`\u547d\u4ee4\u7684\u4fe1\u606f,\u5982\u679c\u4e0d\u5b58\u5728\u60f3\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6,\u53ef\u4ee5\u4f7f\u7528touch\u6216\u8005copy\u548ctemplate\u6a21\u5757\n    touch: \u521b\u5efa\u7a7a\u6587\u4ef6\n    link: \u94fe\u63a5\u6587\u4ef6\n    \n# \u521b\u5efa\u94fe\u63a5\u6587\u4ef6\nansible all -m file -a "src=/tmp/testfile2 path=/tmp/testfile2_link state=link"\n')),(0,s.kt)("h4",{id:"cron"},"cron"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible all -m cron -a "user=root name=\u66f4\u65b0\u65f6\u95f4 minute=*/5 job=\'/usr/sbin/ntpdate 192.168.8.1 &> /dev/null\'"\n# \u53d6\u6d88\u8be5cron\nansible all -m cron -a "name=\u66f4\u65b0\u65f6\u95f4 state=absent"\n')),(0,s.kt)("h4",{id:"command"},"command"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible all -m command -a "chdir=/tmp touch testfile2"\n# \u67e5\u770b\u6587\u4ef6\u5b58\u5728\u6027,\u5982\u679c\u5b58\u5728\u547d\u4ee4\u4e0d\u4f1a\u6267\u884c,\u53cd\u4e4b\u4ea6\u7136\n[root@master ~]\\# ansible all -m command -a "creates=/tmp/testfile2 echo testfile2"\nnode01 | SUCCESS | rc=0 >>\nskipped, since /tmp/testfile2 exists\nnode02 | CHANGED | rc=0 >>      # node02\u6587\u4ef6\u5df2\u624b\u52a8\u5220\u9664\ntestfile2\n\n* \u53c2\u6570\u8bf4\u660e:\n`chdir`: \u5207\u6362\u5de5\u4f5c\u76ee\u5f55\n`creates`: \u6587\u4ef6\u5b58\u5728\u6027\n\n* \u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u662fcommand\u6a21\u5757\u7684\u89e3\u91ca\u5668\u5e76\u4e0d\u662fshell,\u6240\u4ee5\u6709\u7684\u547d\u4ee4command\u4f1a\u89e3\u6790\u5931\u8d25,\u5982\u4e0b\u9762\u7684\u8fd9\u4e2a\u7ba1\u9053\u7b26\nansible all -m command -a "ss -tnulp | grep 80"     # \u6267\u884c\u65f6\u4f1a\u62a5\u9519,\u9700\u8981\u4f7f\u7528\u4e0b\u9762\u7684shell\u6a21\u5757\n')),(0,s.kt)("h4",{id:"shell"},"shell"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'# \u4f7f\u7528shell\u89e3\u91ca\u5668\u5219\u6b63\u5e38\u8fd0\u884c\nansible all -m shell -a "executable=/bin/bash ss -tnulp | grep 80"\n* \u53c2\u6570\u8bf4\u660e:\n`executable`: \u6307\u660e\u4f7f\u7528\u54ea\u4e2ashell\n')),(0,s.kt)("h4",{id:"yum"},"yum"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible all -m yum -a "name=varnish state=installed"\n* \u53c2\u6570\u8bf4\u660e:\n`state`:\n    present/installed: \u5b89\u88c5\n    lastest: \u5b89\u88c5\u6700\u65b0\u7248\u672c\n    absent/removed: \u5378\u8f7d\n')),(0,s.kt)("h4",{id:"service"},"service"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible all -m service -a "name=varnish state=started"      # \u505c\u6b62`state=stopped`\n* \u53c2\u6570\u8bf4\u660e:\n`enabled`: \u662f\u5426\u5f00\u673a\u81ea\u542f\n`state`: stopped,restarted,reloaded\n`sleep`: \u5982\u679c\u72b6\u6001\u88ab\u8bbe\u7f6e\u4e3a`restarted`,\u90a3\u4e48\u5728\u505c\u6b62\u670d\u52a1\u4e0e\u542f\u52a8\u670d\u52a1\u4e4b\u95f4\u7761\u7720\u51e0\u79d2\u949f\n')),(0,s.kt)("h4",{id:"script-runs-a-local-script-on-a-remote-node-after-transferring-it"},"script( Runs a local script on a remote node after transferring it)"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible all -m script -a "/tmp/test.sh"\n* \u540c\u6837\u4e5f\u6709`executable`,`chdir`,`creates`\u7b49\n')),(0,s.kt)("h4",{id:"mount"},"mount"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible node01 -m mount -a "src=/dev/sr0  path=/mnt/dvd fstype=iso9660 state=present"\n* \u53c2\u6570\u8bf4\u660e:\n`opts`: \u6302\u8f7d\u9009\u9879ro,noauto,\u5177\u4f53\u53c2\u8003fstab\u7684\u6302\u8f7d\u9009\u9879\n`state`:\n    present: \u53ea\u662f\u5728`/etc/fstab`\u4e2d\u6dfb\u52a0\u914d\u7f6e\u4fe1\u606f,\u5e76\u4e0d\u4f1a\u771f\u6b63\u6302\u8f7d,\u540c`mount -a`\u547d\u4ee4\n    mounted/unmounted: \u6302\u8f7d,\u53d6\u6d88\u6302\u8f7d\n')),(0,s.kt)("h3",{id:"unarchivearchive"},"unarchive/archive"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'ansible node01 -m unarchive -a "src=foo.tgz dest=/tmp/foo remote_src=yes"\n* \u53c2\u6570\u8bf4\u660e:\n`src`: \u538b\u7f29\u5305\u8def\u5f84,\u53ef\u4ee5\u662f\u7f51\u7edcURL\u4e0b\u8f7d\u94fe\u63a5\n`remote_src`: \u89e3\u538b\u7f29\u8fdc\u7aef\u5df2\u5b58\u5728\u7684\u538b\u7f29\u5305,\u5f53`src`\u4e3aURL\u65f6,\u9700\u8981\u8bbe\u7f6e\u4e3ayes\n\nansible node01 -m archive -a "path=/tmp/foo dest=/tmp/foo.tgz remove=yes"\n* \u53c2\u6570\u8bf4\u660e:\n`remove`: \u538b\u7f29\u5b8c\u4e4b\u540e\u662f\u5426\u5220\u9664\u539f\u6765\u7684\u76ee\u5f55\u6216\u6587\u4ef6\n`format`: \u538b\u7f29\u6587\u4ef6\u683c\u5f0f,\u5982zip,bz2,gz\u7b49\n`exclude_path`: \u6307\u5b9a\u6392\u9664\u76ee\u5f55\n\n:info: \u5728YAML\u6587\u4ef6\u4e2d\u5982\u679c\u60f3\u538b\u7f29\u591a\u4e2a\u76ee\u5f55,\u9700\u8981\u4f7f\u7528\u591a\u4e2a`-`, \u4f7f\u7528\u901a\u914d\u7b26,\u5982`/tmp/foo*`\u65f6\u4e5f\u9700\u8981\u4f7f\u7528`-`\n')),(0,s.kt)("h2",{id:"\u53c2\u8003\u94fe\u63a5"},"\u53c2\u8003\u94fe\u63a5"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Ansible modules : ",(0,s.kt)("a",{parentName:"li",href:"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html"},"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html"))))}d.isMDXComponent=!0}}]);