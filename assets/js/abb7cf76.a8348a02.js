"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[3086],{3905:(e,t,n)=>{n.d(t,{Zo:()=>i,kt:()=>k});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var o=a.createContext({}),u=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},i=function(e){var t=u(e.components);return a.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,o=e.parentName,i=p(e,["components","mdxType","originalType","parentName"]),m=u(n),k=l,d=m["".concat(o,".").concat(k)]||m[k]||c[k]||r;return n?a.createElement(d,s(s({ref:t},i),{},{components:n})):a.createElement(d,s({ref:t},i))}));function k(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,s=new Array(r);s[0]=m;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p.mdxType="string"==typeof e?e:l,s[1]=p;for(var u=2;u<r;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},92916:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>p,toc:()=>u});var a=n(87462),l=(n(67294),n(3905));const r={},s="\u4f7f\u7528 Kubespray \u90e8\u7f72",p={unversionedId:"CloudNative/k8s/Installation/\u4f7f\u7528 Kubespray \u90e8\u7f72",id:"CloudNative/k8s/Installation/\u4f7f\u7528 Kubespray \u90e8\u7f72",title:"\u4f7f\u7528 Kubespray \u90e8\u7f72",description:"Kubespray \u7b80\u4ecb",source:"@site/docs/CloudNative/k8s/Installation/\u4f7f\u7528 Kubespray \u90e8\u7f72.md",sourceDirName:"CloudNative/k8s/Installation",slug:"/CloudNative/k8s/Installation/\u4f7f\u7528 Kubespray \u90e8\u7f72",permalink:"/docs/CloudNative/k8s/Installation/\u4f7f\u7528 Kubespray \u90e8\u7f72",draft:!1,editUrl:"https://github.com/AGou-ops/myDocsv4/edit/main/docs/CloudNative/k8s/Installation/\u4f7f\u7528 Kubespray \u90e8\u7f72.md",tags:[],version:"current",frontMatter:{},sidebar:"cloudNative",previous:{title:"\u4f7f\u7528 Kubeadm \u90e8\u7f72(\u5355master)",permalink:"/docs/CloudNative/k8s/Installation/\u4f7f\u7528 Kubeadm \u90e8\u7f72\uff08\u5355master\uff09"},next:{title:"\u4f7f\u7528\u56fd\u5185\u6e90\u53ca\u76f8\u5173\u5c0f\u5de5\u5177",permalink:"/docs/CloudNative/k8s/Installation/\u4f7f\u7528\u56fd\u5185\u6e90\u53ca\u76f8\u5173\u5c0f\u5de5\u5177"}},o={},u=[{value:"Kubespray \u7b80\u4ecb",id:"kubespray-\u7b80\u4ecb",level:2},{value:"\u521d\u59cb\u5316\u73af\u5883",id:"\u521d\u59cb\u5316\u73af\u5883",level:2},{value:"\u5b89\u88c5 Kubespray",id:"\u5b89\u88c5-kubespray",level:2},{value:"\u767b\u5f55 Dashboard",id:"\u767b\u5f55-dashboard",level:2},{value:"\u9a8c\u8bc1 K8s \u96c6\u7fa4",id:"\u9a8c\u8bc1-k8s-\u96c6\u7fa4",level:2},{value:"\u5176\u4ed6",id:"\u5176\u4ed6",level:2},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}],i={toc:u};function c(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"\u4f7f\u7528-kubespray-\u90e8\u7f72"},"\u4f7f\u7528 Kubespray \u90e8\u7f72"),(0,l.kt)("h2",{id:"kubespray-\u7b80\u4ecb"},"Kubespray \u7b80\u4ecb"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/kubernetes-incubator/kubespray"},"Kubespray")," \u662f Kubernetes incubator \u4e2d\u7684\u9879\u76ee\uff0c\u76ee\u6807\u662f\u63d0\u4f9b Production Ready Kubernetes \u90e8\u7f72\u65b9\u6848\uff0c\u8be5\u9879\u76ee\u57fa\u7840\u662f\u901a\u8fc7 Ansible Playbook \u6765\u5b9a\u4e49\u7cfb\u7edf\u4e0e Kubernetes \u96c6\u7fa4\u90e8\u7f72\u7684\u4efb\u52a1\uff0c\u5177\u6709\u4ee5\u4e0b\u51e0\u4e2a\u7279\u70b9\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u90e8\u7f72\u5728 AWS, GCE, Azure, OpenStack \u4ee5\u53ca\u88f8\u673a\u4e0a."),(0,l.kt)("li",{parentName:"ul"},"\u90e8\u7f72 High Available Kubernetes \u96c6\u7fa4."),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u7ec4\u5408\u6027 (Composable)\uff0c\u53ef\u81ea\u884c\u9009\u62e9 Network Plugin (flannel, calico, canal, weave) \u6765\u90e8\u7f72."),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301\u591a\u79cd Linux distributions(CoreOS, Debian Jessie, Ubuntu 16.04, CentOS/RHEL7).")),(0,l.kt)("p",null,"Kubespray \u7531\u4e00\u7cfb\u5217\u7684 ",(0,l.kt)("a",{parentName:"p",href:"http://docs.ansible.com/"},"Ansible")," playbook\u3001\u751f\u6210 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kubernetes-incubator/kubespray/blob/master/docs/ansible.md"},"inventory")," \u7684\u547d\u4ee4\u884c\u5de5\u5177\u4ee5\u53ca\u751f\u6210 OS/Kubernetes \u96c6\u7fa4\u914d\u7f6e\u7ba1\u7406\u4efb\u52a1\u7684\u4e13\u4e1a\u77e5\u8bc6\u6784\u6210\u3002"),(0,l.kt)("h2",{id:"\u521d\u59cb\u5316\u73af\u5883"},"\u521d\u59cb\u5316\u73af\u5883"),(0,l.kt)("p",null,"\u4e3b\u673a\u73af\u5883\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u89d2\u8272"),(0,l.kt)("th",{parentName:"tr",align:null},"IP"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"master"),(0,l.kt)("td",{parentName:"tr",align:null},"172.16.1.128")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"node01"),(0,l.kt)("td",{parentName:"tr",align:null},"172.16.1.129")))),(0,l.kt)("p",null,"\u7f16\u8f91",(0,l.kt)("inlineCode",{parentName:"p"},"/etc/hosts"),"\u6587\u4ef6\uff0c\u4f7f\u5404\u4e3b\u673a\u4e4b\u95f4\u53ef\u4ee5\u901a\u8fc7\u4e3b\u673a\u540d\u4e92\u76f8\u901a\u4fe1\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# \u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\n172.16.1.128 master master.agou-ops.com\n172.16.1.129 node01 node01.agou-ops.com\n")),(0,l.kt)("p",null,"\u5173\u95ed SELinux \u548c\u9632\u706b\u5899\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sed -i 's/SELINUX=*/SELINUX=disabled/' /etc/selinux/config\nsystemctl disable firewalld && systemctl stop firewalld\n")),(0,l.kt)("p",null,"Kubernetes 1.8 \u5f00\u59cb\u8981\u6c42\u5173\u95ed\u7cfb\u7edf\u7684 Swap \u4ea4\u6362\u5206\u533a\uff0c\u65b9\u6cd5\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'swapoff -a && echo "vm.swappiness=0" >> /etc/sysctl.conf && sysctl -p && free \u2013h\n')),(0,l.kt)("p",null,"Docker \u4ece 1.13 \u7248\u672c\u5f00\u59cb\u8c03\u6574\u4e86\u9ed8\u8ba4\u7684\u9632\u706b\u5899\u89c4\u5219\uff0c\u7981\u7528\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"iptables filter "),"\u8868\u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"FOWARD"),"\u94fe\uff0c\u8fd9\u6837\u4f1a\u5f15\u8d77 Kubernetes \u96c6\u7fa4\u4e2d\u8de8 Node \u7684 Pod \u65e0\u6cd5\u901a\u4fe1\uff0c\u5728\u5404\u4e2a Docker \u8282\u70b9\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -P FORWARD ACCEPT\n")),(0,l.kt)("p",null,"\u914d\u7f6e SSH Key \u8ba4\u8bc1\u3002\u786e\u4fdd\u672c\u673a\u4e5f\u53ef\u4ee5 SSH \u8fde\u63a5\uff0c\u5426\u5219\u4e0b\u9762\u90e8\u7f72\u5931\u8d25\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'ssh-keygen -t rsa -N ""\ncat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys\n')),(0,l.kt)("p",null,"\u66f4\u65b0\u7cfb\u7edf\u5185\u6838\u4e3a 4.4.x , CentOS \u9ed8\u8ba4\u4e3a 3.10.x \u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\nrpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm\nyum --enablerepo=elrepo-kernel install -y kernel-lt kernel-lt-devel \ngrub2-set-default 0\n")),(0,l.kt)("p",null,"\u91cd\u542f\u7cfb\u7edf\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"reboot")),(0,l.kt)("p",null,"\u589e\u52a0\u5185\u6838\u914d\u7f6e\uff0c\u7f16\u8f91",(0,l.kt)("inlineCode",{parentName:"p"},"/etc/sysctl.conf"),"\u6587\u4ef6\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# \u589e\u52a0\u4ee5\u4e0b\u5185\u5bb9\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\n")),(0,l.kt)("p",null,"\u4f7f\u5176\u5185\u6838\u914d\u7f6e\u751f\u6548\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sysctl -p\n")),(0,l.kt)("h2",{id:"\u5b89\u88c5-kubespray"},"\u5b89\u88c5 Kubespray"),(0,l.kt)("p",null,"\u5b89\u88c5 Centos \u7684 EPEL \u6e90\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"}," yum -y install epel-release\n")),(0,l.kt)("p",null,"\u66f4\u65b0\u7f13\u5b58\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"}," yum clean all && yum makecache\n")),(0,l.kt)("p",null,"\u5b89\u88c5\u76f8\u5173\u8f6f\u4ef6\uff08Ansible \u7248\u672c\u5fc5\u987b >= 2.7\uff09\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"}," yum install -y python-pip python3 python-netaddr python3-pip ansible git\n")),(0,l.kt)("p",null,"\u4e0b\u8f7d\u6e90\u7801\uff0c\u5f53\u524d Kubespray \u9879\u76ee\u7684 Master \u5206\u652f\u9ed8\u8ba4\u5b89\u88c5 K8s 1.13.1 \u7248\u672c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/kubernetes-sigs/kubespray.git\n")),(0,l.kt)("p",null,"\u5b89\u88c5 Kubespray \u4f9d\u8d56\uff0c\u82e5\u65e0\u7279\u6b8a\u8bf4\u660e\uff0c\u540e\u7eed\u64cd\u4f5c\u5747\u5728 ~/kubespray `\u76ee\u5f55\u4e0b\u6267\u884c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"}," cd kubespray \n pip3 install -r requirements.txt\n")),(0,l.kt)("p",null,"\u914d\u7f6e Kubespray\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"}," cp -rfp inventory/sample inventory/mycluster\n \n # Update Ansible inventory file with inventory builder\ndeclare -a IPS=(10.10.1.3 10.10.1.4 10.10.1.5)\nCONFIG_FILE=inventory/mycluster/hosts.yaml python3 contrib/inventory_builder/inventory.py ${IPS[@]}\n")),(0,l.kt)("p",null,"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 ",(0,l.kt)("inlineCode",{parentName:"p"},"inventory/mycluster/hosts.ini "),"\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},"[all]\nmaster ansible_host=master ip=172.16.1.128\n\n[kube-master]\nmaster\n\n[etcd]\nmaster\n\n[kube-node]\nnode01\n\n[k8s-cluster:children]\nkube-master\nkube-node\n\n[calico-rr]\n")),(0,l.kt)("p",null,"\u2139\ufe0f\u6b64\u5904\u4e5f\u53ef\u4ee5\u7528\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"kubespray prepare --masters master1 --etcds master1 --nodes node1 node2 node3"),"\u6765\u81ea\u52a8\u751f\u6210",(0,l.kt)("inlineCode",{parentName:"p"},"inventory"),"\u6587\u4ef6"),(0,l.kt)("p",null,"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6",(0,l.kt)("inlineCode",{parentName:"p"}," inventory/mycluster/group_vars/all/all.yml"),"\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"# \u4fee\u6539\u5982\u4e0b\u914d\u7f6e:\nloadbalancer_apiserver_localhost: true \n# \u52a0\u8f7d\u5185\u6838\u6a21\u5757\uff0c\u5426\u5219 ceph, gfs \u7b49\u65e0\u6cd5\u6302\u8f7d\u5ba2\u6237\u7aef\nkubelet_load_modules: true\n")),(0,l.kt)("p",null,"\u4fee\u6539\u955c\u50cf\u9ed8\u8ba4\u7684 Repo \u5730\u5740\uff0c\u4f7f\u7528 Calico \u4e09\u5c42\u7f51\u7edc\uff0c\u540c\u65f6\u53ef\u4ee5\u6307\u5b9a\u5b89\u88c5\u7684 K8s\u7248\u672c\uff0c\u53c2\u6570\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"}," kube_version"),"\u3002\u7f16\u8f91\u6587\u4ef6",(0,l.kt)("inlineCode",{parentName:"p"},"inventory/mycluster/group_vars/k8s-cluster/k8s-cluster.yml"),"(\u5728\u8fd9\u91cc\u6211\u80fd\u591f\u79d1\u5b66\u4e0a\u7f51\u5c31\u4e0d\u505a\u4fee\u6539\u4e86)\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'kube_image_repo: "gcr.io/google-containers"\n')),(0,l.kt)("p",null,"\u5982\u9700\u8bbe\u7f6e\u4ee3\u7406\uff0c\u5728",(0,l.kt)("inlineCode",{parentName:"p"}," cluster.yml"),"\u4e2d\u7f16\u8f91 default \u503c\u5373\u53ef\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"...\nproxy_env:\n          http_proxy: \"\u3010\u3010 http_proxy | default ('192.168.43.37:8888') \u3011\u3011\"\n          HTTP_PROXY: \"\u3010\u3010 http_proxy | default ('192.168.43.37:8888') \u3011\u3011\"\n          https_proxy: \"\u3010\u3010 https_proxy | default ('192.168.43.37:8888') \u3011\u3011\"\n          HTTPS_PROXY: \"\u3010\u3010 https_proxy | default ('192.168.43.37:8888') \u3011\u3011\"\n          no_proxy: \"\u3010\u3010 no_proxy | default ('') \u3011\u3011\"\n          NO_PROXY: \"\u3010\u3010 no_proxy | default ('') \u3011\u3011\"\n      no_log: true\n...\n")),(0,l.kt)("p",null,"\u5982\u9700\u8bbe\u7f6e",(0,l.kt)("inlineCode",{parentName:"p"},"docker pull")," \u4ee3\u7406\uff0c\u65b0\u5efa",(0,l.kt)("inlineCode",{parentName:"p"},"/etc/systemd/system/docker.service.d/http-proxy.conf"),"\u6587\u4ef6\uff0c\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'[Service]\nEnvironment="http_proxy=192.168.43.37:8888"\nEnvironment="https_proxy=192.168.43.37:8888"\nEnvironment="NO_PROXY= hostname.example.com,172.10.10.10"\n# \u6700\u540e\u91cd\u542fdocker\nsystemctl daemon-reload\nsystemctl restart docker\n')),(0,l.kt)("p",null,"\u4fee\u6539",(0,l.kt)("inlineCode",{parentName:"p"},"./roles/kubernetes-apps/ansible/templates/dashboard.yml.j2"),"\u6587\u4ef6\uff0c\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"NodePort")," \u65b9\u5f0f\u8bbf\u95ee Dashboard\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"# ------------------- Dashboard Service ------------------- #\u2026\u2026\u2026\u2026      \ntargetPort: 8443  \ntype: NodePort    //\u6dfb\u52a0\u8fd9\u4e00\u884c      \nselector:\nk8s-app: kubernetes-dashboard\n")),(0,l.kt)("p",null,"\u26a0\ufe0f \u6ce8\u610f\uff1a\u5982\u679c\u662f\u5355\u8282\u70b9\u90e8\u7f72 K8s\uff0cKubespray \u9ed8\u8ba4\u4f1a\u521b\u5efa 2 \u4e2a coredns Pod\uff0c\u4f46 Deployment \u4e2d\u53c8\u7528\u5230\u4e86 podAntiAffinity\uff0c\u56e0\u6b64\u4f1a\u5bfc\u81f4\u5176\u4e2d\u4e00\u4e2a coredns pod pending\uff0c\u6240\u4ee5\u9700\u8981\u4fee\u6539",(0,l.kt)("inlineCode",{parentName:"p"},"./roles/kubernetes-apps/ansible/templates/coredns-deployment.yml.j2"),"\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"# \u6ce8\u91ca\u6389\u4ee5\u4e0b\u51e0\u884c\u4ee3\u7801\n      affinity:\n        #podAntiAffinity:\n        #  requiredDuringSchedulingIgnoredDuringExecution:\n        #  - topologyKey: \"kubernetes.io/hostname\"\n        #    labelSelector:\n        #      matchLabels:\n        #        k8s-app: coredns\u3010\u3010 coredns_ordinal_suffix | default('') \u3011\u3011\n\n# \u6216\u8005\u5728spec\u4e00\u884c\u6dfb\u52a0\u4ee3\u7801\uff1a\nspec:\n  replicas: 1   //\u6307\u5b9apod\u4e3a1\u4e2a\u526f\u672c\n")),(0,l.kt)("p",null,"\u6700\u540e\u6267\u884c\u90e8\u7f72\u547d\u4ee4\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ansible-playbook -i inventory/mycluster/hosts.ini  --become --become-user=root cluster.yml -b -v\n")),(0,l.kt)("h2",{id:"\u767b\u5f55-dashboard"},"\u767b\u5f55 Dashboard"),(0,l.kt)("p",null,"\u767b\u9646 Dashboard \u652f\u6301 kubeconfig \u548c token \u4e24\u79cd\u8ba4\u8bc1\u65b9\u5f0f\uff0ckubeconfig \u4e5f\u4f9d\u8d56 token \u5b57\u6bb5\uff0c\u6240\u4ee5\u751f\u6210 token \u8fd9\u4e00\u6b65\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002\u6b64\u5904\uff0c\u6211\u4eec\u83b7\u53d6\u96c6\u7fa4\u7ba1\u7406\u5458\uff08\u62e5\u6709\u6240\u6709\u547d\u540d\u7a7a\u95f4\u7684 admin \u6743\u9650\uff09\u7684 token\u3002"),(0,l.kt)("p",null,"\u67e5\u770b kubernetes-dashboard \u66b4\u9732\u7684\u7aef\u53e3\uff0c\u5982\u4e0b\u6240\u793a\uff0c\u8fd9\u91cc\u662f31777\u7aef\u53e3\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[root@master kubespray]\\#  kubectl get svc --all-namespaces | grep kubernetes-dashboard\nkube-system   kubernetes-dashboard        NodePort    10.233.41.202   <none>        443:30548/TCP            8m16s\n")),(0,l.kt)("p",null,"\u83b7\u53d6 admin \u7684 token"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[root@master kubespray]\\#  kubectl -n kube-system describe $(kubectl -n kube-system get secret -n kube-system -o name | grep namespace) | grep token\nName:         namespace-controller-token-ksdvp\nType:  kubernetes.io/service-account-token\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6IkV0N0pLMXVqMzNxS2xCNXRlTkxpRTlOYnNMVzRiajNrLU9kdi1qRW5jTDQifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJuYW1lc3BhY2UtY29udHJvbGxlci10b2tlbi1rc2R2cCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJuYW1lc3BhY2UtY29udHJvbGxlciIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImZiM2NkMDBhLTE4ZjAtNGI4OC1hZGNiLWYwNGVjZWNlZTUzNiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTpuYW1lc3BhY2UtY29udHJvbGxlciJ9.bYWcoopcYFC6EYNMNPkoiZeUQqfidC9NwlrMzzkZD3T9e-PbDd37pmTeWAcU_E4DCDzeVc9CXfWPhWCfr3syZKWiIXPNtDrNrIgnGs34Id2evsh7evVTgOjQtWkRoqX9UFdjWZdQPxvJChLZacRqbUp718umCzhR9evuE0zq8JeruBCTrcilQDDYobavfYs72HrwZ5xlIj2GMb66FeS7mYZacP-2-M3oVsziIWLs_kfBIaN_OkpImUPpvJxF-8xMmVP2BCKWyHWaLPIUdVsF8FkiLWH7bIS8f0cm8D4wEcMZ4IYkVe2FMcmMaiFJx5HEXrwA4YT7bMVy4PJhR71Thg\n")),(0,l.kt)("p",null,"\u5728 dashboard \u767b\u5f55\u9875\u9762\u4e0a\u4f7f\u7528\u4e0a\u9762\u8f93\u51fa\u4e2d\u7684\u90a3\u4e2a\u975e\u5e38\u957f\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a token \u767b\u5f55\uff0c\u5373\u53ef\u4ee5\u62e5\u6709\u7ba1\u7406\u5458\u6743\u9650\u64cd\u4f5c\u6574\u4e2a kubernetes \u96c6\u7fa4\u4e2d\u7684\u5bf9\u8c61\u3002\u5f53\u7136\u60a8\u4e5f\u53ef\u4ee5\u5c06\u8fd9\u4e32 token \u52a0\u5230 admin \u7528\u6237\u7684 kubeconfig \u6587\u4ef6\u4e2d\uff0c\u7ee7\u7eed\u4f7f\u7528 kubeconfig \u767b\u5f55\uff0c\u4e24\u79cd\u8ba4\u8bc1\u65b9\u5f0f\u4efb\u60a8\u9009\u62e9\u3002"),(0,l.kt)("p",null,"\u767b\u5f55 dashboard\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://172.16.1.128:30548"},"https://172.16.1.128:30548")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\uff1a\u7531\u4e8e\u8fd9\u91cc\u4f7f\u7528\u7684 HTTPS\uff0c\u5e76\u672a\u4f7f\u7528\u8bc1\u4e66\uff0c\u56e0\u6b64\u4f7f\u7528 Google \u7b49\u6d4f\u89c8\u5668\u4f1a\u7ec8\u6b62\u8bbf\u95ee\u3002")),(0,l.kt)("h2",{id:"\u9a8c\u8bc1-k8s-\u96c6\u7fa4"},"\u9a8c\u8bc1 K8s \u96c6\u7fa4"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u67e5\u770b\u96c6\u7fa4\u7248\u672c")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[root@master ~]\\# kubelet --version\nKubernetes v1.18.2\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u67e5\u770b\u96c6\u7fa4\u72b6\u6001")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"}," kubectl get nodes\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u67e5\u770b\u96c6\u7fa4 Pod ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"}," kubectl get pods --all-namespaces\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u67e5\u770b IPVS")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"}," ipvsadm -L -n\n")),(0,l.kt)("h2",{id:"\u5176\u4ed6"},"\u5176\u4ed6"),(0,l.kt)("p",null,"\u589e\u52a0 node \u8282\u70b9\uff08\u63d0\u524d\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"hosts.ini"),"\u6587\u4ef6\u4e2d\u589e\u52a0\u4e3b\u673a\u8282\u70b9\uff09\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ansible-playbook -i inventory/mycluster/hosts.ini scale.yml -b -v -k\n")),(0,l.kt)("p",null,"\u5c06",(0,l.kt)("inlineCode",{parentName:"p"}," hosts.ini")," \u6587\u4ef6\u4e2d\u7684 master \u548c etcd \u7684\u673a\u5668\u589e\u52a0\u5230\u591a\u53f0\uff0c\u6267\u884c\u90e8\u7f72\u547d\u4ee4\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ansible-playbook -i inventory/mycluster/hosts.ini cluster.yml -b -vvv\n")),(0,l.kt)("p",null,"\u522a\u9664\u8282\u70b9\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u8282\u70b9\u5c31\u662f\u522a\u9664\u6574\u4e2a\u96c6\u7fa4\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ansible-playbook -i inventory/mycluster/hosts.ini remove-node.yml -b -v\n")),(0,l.kt)("p",null,"\u5982\u679c\u9700\u8981\u5378\u8f7d\uff0c\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ansible-playbook -i inventory/mycluster/hosts.ini reset.yml -b \u2013vvv\n")),(0,l.kt)("p",null,"\u5347\u7ea7 K8s \u96c6\u7fa4\uff0c\u9009\u62e9\u5bf9\u5e94\u7684 K8s \u7248\u672c\u4fe1\u606f\uff0c\u6267\u884c\u5347\u7ea7\u547d\u4ee4\u3002\u6d89\u53ca\u6587\u4ef6\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"upgrade-cluster.yml"),"\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ansible-playbook upgrade-cluster.yml -b -i inventory/mycluster/hosts.ini -e kube_version=vX.XX.XX -vvv\n")),(0,l.kt)("h2",{id:"\u53c2\u8003\u94fe\u63a5"},"\u53c2\u8003\u94fe\u63a5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"kubespray GetStarted\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kubernetes-sigs/kubespray/blob/master/docs/getting-started.md"},"https://github.com/kubernetes-sigs/kubespray/blob/master/docs/getting-started.md"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\u7528 Kubespray \u5728\u57fa\u7840\u8bbe\u65bd\u6216\u4e91\u5e73\u53f0\u4e0a\u5b89\u88c5 Kubernetes\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://k8smeetup.github.io/docs/getting-started-guides/kubespray/"},"https://k8smeetup.github.io/docs/getting-started-guides/kubespray/")))))}c.isMDXComponent=!0}}]);