"use strict";(self.webpackChunkmy_docsv_4=self.webpackChunkmy_docsv_4||[]).push([[6959],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>y});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=r.createContext({}),c=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(p.Provider,{value:n},e.children)},i={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(t),y=a,d=m["".concat(p,".").concat(y)]||m[y]||i[y]||l;return t?r.createElement(d,o(o({ref:n},u),{},{components:t})):r.createElement(d,o({ref:n},u))}));function y(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,o=new Array(l);o[0]=m;var s={};for(var p in n)hasOwnProperty.call(n,p)&&(s[p]=n[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<l;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},42766:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>i,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var r=t(87462),a=(t(67294),t(3905));const l={},o="MySQL\u6e38\u6807",s={unversionedId:"LinuxBasics/DataBases/MySQL/MySQL Cursor",id:"LinuxBasics/DataBases/MySQL/MySQL Cursor",title:"MySQL\u6e38\u6807",description:"\u6e38\u6807\uff08Cursor\uff09\u662f\u5904\u7406\u6570\u636e\u7684\u4e00\u79cd\u65b9\u6cd5\uff0c\u4e3a\u4e86\u67e5\u770b\u6216\u8005\u5904\u7406\u7ed3\u679c\u96c6\u4e2d\u7684\u6570\u636e\uff0c\u6e38\u6807\u63d0\u4f9b\u4e86\u5728\u7ed3\u679c\u96c6\u4e2d\u4e00\u6b21\u4e00\u884c\u904d\u5386\u6570\u636e\u7684\u80fd\u529b\u3002\u6e38\u6807\u53ea\u80fd\u5728\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\u4e2d\u4f7f\u7528\u3002",source:"@site/docs/LinuxBasics/DataBases/MySQL/MySQL Cursor.md",sourceDirName:"LinuxBasics/DataBases/MySQL",slug:"/LinuxBasics/DataBases/MySQL/MySQL Cursor",permalink:"/docs/LinuxBasics/DataBases/MySQL/MySQL Cursor",draft:!1,editUrl:"https://github.com/AGou-ops/myDocsv4/edit/main/docs/LinuxBasics/DataBases/MySQL/MySQL Cursor.md",tags:[],version:"current",frontMatter:{},sidebar:"linuxBasics",previous:{title:"MySQL \u914d\u7f6e\u6587\u4ef6my.cnf",permalink:"/docs/LinuxBasics/DataBases/MySQL/MySQL Configuration"},next:{title:"MySQL\u6570\u636e\u7c7b\u578b",permalink:"/docs/LinuxBasics/DataBases/MySQL/MySQL Data_Type"}},p={},c=[{value:"\u6e38\u6807\u8bed\u6cd5",id:"\u6e38\u6807\u8bed\u6cd5",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2}],u={toc:c};function i(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"mysql\u6e38\u6807"},"MySQL\u6e38\u6807"),(0,a.kt)("p",null,"\u6e38\u6807\uff08Cursor\uff09\u662f\u5904\u7406\u6570\u636e\u7684\u4e00\u79cd\u65b9\u6cd5\uff0c\u4e3a\u4e86\u67e5\u770b\u6216\u8005\u5904\u7406\u7ed3\u679c\u96c6\u4e2d\u7684\u6570\u636e\uff0c\u6e38\u6807\u63d0\u4f9b\u4e86\u5728\u7ed3\u679c\u96c6\u4e2d\u4e00\u6b21\u4e00\u884c\u904d\u5386\u6570\u636e\u7684\u80fd\u529b\u3002\u26a0\ufe0f",(0,a.kt)("strong",{parentName:"p"},"\u6e38\u6807\u53ea\u80fd\u5728\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\u4e2d\u4f7f\u7528\u3002")),(0,a.kt)("p",null,"\u6e38\u6807\u7684\u5904\u7406\u8fc7\u7a0b\uff1a4\u6b65"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u58f0\u660e\u6e38\u6807",(0,a.kt)("inlineCode",{parentName:"p"},"declare"),"\uff1a\u6ca1\u6709\u68c0\u7d22\u6570\u636e\uff0c\u53ea\u662f\u5b9a\u4e49\u8981\u4f7f\u7528\u7684select\u8bed\u53e5")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u6253\u5f00\u6e38\u6807",(0,a.kt)("inlineCode",{parentName:"p"},"open"),"\uff1a\u6253\u5f00\u6e38\u6807\u4ee5\u4f9b\u4f7f\u7528\uff0c\u7528\u4e0a\u4e00\u6b65\u5b9a\u4e49\u7684select\u8bed\u53e5\u628a\u6570\u636e\u5b9e\u9645\u68c0\u7d22\u51fa\u6765")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u68c0\u7d22\u6e38\u6807",(0,a.kt)("inlineCode",{parentName:"p"},"fetch"),"\uff1a\u5bf9\u4e8e\u586b\u6709\u6570\u636e\u7684\u6e38\u6807\uff0c\u6839\u636e\u9700\u8981\u53d6\u51fa(\u68c0\u7d22)\u5404\u884c")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u5173\u95ed\u6e38\u6807",(0,a.kt)("inlineCode",{parentName:"p"},"close"),"\uff1a\u5728\u7ed3\u675f\u6e38\u6807\u4f7f\u7528\u65f6\uff0c\u5fc5\u987b\u5173\u95ed\u6e38\u6807"))),(0,a.kt)("h2",{id:"\u6e38\u6807\u8bed\u6cd5"},"\u6e38\u6807\u8bed\u6cd5"),(0,a.kt)("p",null,"\u58f0\u660e\u6e38\u6807\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"DECLARE <\u6e38\u6807\u540d\u79f0> CURSOR FOR <\u67e5\u8be2\u8bed\u53e5>;\n")),(0,a.kt)("p",null,"\u6253\u5f00\u6e38\u6807\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"OPEN <\u6e38\u6807\u540d\u79f0>;\n")),(0,a.kt)("p",null,"\u904d\u5386\u6e38\u6807\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"FETCH <\u6e38\u6807\u540d\u79f0> INTO <\u53d8\u91cf\u5217\u8868>;\n")),(0,a.kt)("p",null,"\u5173\u95ed\u6e38\u6807\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"CLOSE <\u6e38\u6807\u540d\u79f0>;\n")),(0,a.kt)("h2",{id:"\u793a\u4f8b"},"\u793a\u4f8b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"/*\u5220\u9664\u51fd\u6570*/\nDROP FUNCTION IF EXISTS fun1;\n/*\u58f0\u660e\u7ed3\u675f\u7b26\u4e3a$*/\nDELIMITER $\n/*\u521b\u5efa\u51fd\u6570*/\nCREATE FUNCTION fun1(v_max_a int)\n  RETURNS int\n  BEGIN\n    /*\u7528\u4e8e\u4fdd\u5b58\u7ed3\u679c*/\n    DECLARE v_total int DEFAULT 0;\n    /*\u521b\u5efa\u4e00\u4e2a\u53d8\u91cf\uff0c\u7528\u6765\u4fdd\u5b58\u5f53\u524d\u884c\u4e2da\u7684\u503c*/\n    DECLARE v_a int DEFAULT 0;\n    /*\u521b\u5efa\u4e00\u4e2a\u53d8\u91cf\uff0c\u7528\u6765\u4fdd\u5b58\u5f53\u524d\u884c\u4e2db\u7684\u503c*/\n    DECLARE v_b int DEFAULT 0;\n    /*\u521b\u5efa\u6e38\u6807\u7ed3\u675f\u6807\u5fd7\u53d8\u91cf*/\n    DECLARE v_done int DEFAULT FALSE;\n    /*\u521b\u5efa\u6e38\u6807*/\n    DECLARE cur_test1 CURSOR FOR SELECT a,b from test1 where a<=v_max_a;\n    /*\u8bbe\u7f6e\u6e38\u6807\u7ed3\u675f\u65f6v_done\u7684\u503c\u4e3atrue\uff0c\u53ef\u4ee5v_done\u6765\u5224\u65ad\u6e38\u6807\u662f\u5426\u7ed3\u675f\u4e86*/\n    DECLARE CONTINUE HANDLER FOR NOT FOUND SET v_done=TRUE;\n    /*\u8bbe\u7f6ev_total\u521d\u59cb\u503c*/\n    SET v_total = 0;\n    /*\u6253\u5f00\u6e38\u6807*/\n    OPEN cur_test1;\n    /*\u4f7f\u7528Loop\u5faa\u73af\u904d\u5386\u6e38\u6807*/\n    a:LOOP\n      /*\u5148\u83b7\u53d6\u5f53\u524d\u884c\u7684\u6570\u636e\uff0c\u7136\u540e\u5c06\u5f53\u524d\u884c\u7684\u6570\u636e\u653e\u5165v_a,v_b\u4e2d\uff0c\u5982\u679c\u5f53\u524d\u884c\u65e0\u6570\u636e\uff0cv_done\u4f1a\u88ab\u7f6e\u4e3atrue*/\n      FETCH cur_test1 INTO v_a, v_b;\n      /*\u901a\u8fc7v_done\u6765\u5224\u65ad\u6e38\u6807\u662f\u5426\u7ed3\u675f\u4e86\uff0c\u9000\u51fa\u5faa\u73af*/\n      if v_done THEN\n        LEAVE a;\n      END IF;\n      /*\u5bf9v_total\u503c\u7d2f\u52a0\u5904\u7406*/\n      SET v_total = v_total + v_a + v_b;\n    END LOOP;\n    /*\u5173\u95ed\u6e38\u6807*/\n    CLOSE cur_test1;\n    /*\u8fd4\u56de\u7ed3\u679c*/\n    RETURN v_total;\n  END $\n/*\u7ed3\u675f\u7b26\u7f6e\u4e3a;*/\nDELIMITER ;\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> delimiter $$\nmysql> create procedure number_of_players(\n    -> \u3000\u3000out pnumber int)\n    -> begin\n    -> \u3000\u3000declare a_playerno int;  \n    -> \u3000\u3000declare found bool default true;\u3000\u3000\u5faa\u73af\u63a7\u5236\u53d8\u91cf\uff0c\u5176\u503c\u4e3afalse\u65f6\u5faa\u73af\u7ed3\u675f   \n    ->\n    -> \u3000\u3000declare c_players cursor for\n    -> \u3000\u3000\u3000\u3000select playerno from PLAYERS;  \u2460\u58f0\u660e\u6e38\u6807\n    ->\n    -> \u3000\u3000declare continue handler for not found\n    -> \u3000\u3000\u3000\u3000set found=false;  \u58f0\u660e\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\n    ->\n    -> \u3000\u3000set pnumber=0;\n    ->\n    -> \u3000\u3000open c_players;  \u2461\u6253\u5f00\u6e38\u6807\n    ->\n    -> \u3000\u3000fetch c_players into a_playerno;  \u2462\u68c0\u7d22\u6e38\u6807(\u68c0\u7d22\u7b2c\u4e00\u884c)\n    -> \u3000\u3000while found do\n    -> \u3000\u3000\u3000\u3000set pnumber=pnumber+1;\n    -> \u3000\u3000\u3000\u3000fetch c_players into a_playerno;\n    -> \u3000\u3000end while;  \u5faa\u73af\u68c0\u7d22\u5176\u4f59\u884c\n    ->\n    -> \u3000\u3000close c_players;  \u2463\u5173\u95ed\u6e38\u6807\n    -> end$$\nmysql> delimiter ;\nmysql> call number_of_players(@pnumber);\nmysql> select @pnumber;\n+----------+\n| @pnumber |\n+----------+\n|       14 |\n+----------+\nmysql> select count(*) from PLAYERS;\n+----------+\n| count(*) |\n+----------+\n|       14 |\n+----------+\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> delimiter $$\nmysql> create procedure number_penalties(\n    -> \u3000\u3000in p_playerno int,\n    -> \u3000\u3000out pnumber int)\n    -> begin\n    -> \u3000\u3000declare a_playerno int;\n    -> \u3000\u3000declare found bool default true;  \u5faa\u73af\u63a7\u5236\u53d8\u91cf\n    -> \n    -> \u3000\u3000declare c_players cursor for  \u58f0\u660e\u6e38\u6807\n    -> \u3000\u3000\u3000\u3000select playerno\n    -> \u3000\u3000\u3000\u3000from PENALTIES\n    -> \u3000\u3000\u3000\u3000where playerno = p_playerno;  \u5305\u542b\u53d8\u91cfp_playerno\n    -> \n    -> \u3000\u3000declare continue handler for not found\n    -> \u3000\u3000\u3000\u3000set found=false;  \u58f0\u660e\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\n    -> \n    -> \u3000\u3000set pnumber=0;\n    ->  \n    -> \u3000\u3000open c_players;  \u6253\u5f00\u6e38\u6807\n    -> \n    -> \u3000\u3000fetch c_players into a_playerno;\n    -> \u3000\u3000while found do    \u5faa\u73af\u68c0\u7d22\u6e38\u6807\u6bcf\u4e00\u884c\n    -> \u3000\u3000\u3000\u3000set pnumber=pnumber+1;\n    -> \u3000\u3000\u3000\u3000fetch c_players into a_playerno;\n    -> \u3000\u3000end while;\n    ->\n    -> \u3000\u3000close c_players;  \u5173\u95ed\u6e38\u6807\n    -> end$$\nmysql> delimiter ;\nmysql> call number_penalties(44,@pnumber);\nmysql> select @pnumber;\n+----------+\n| @pnumber |\n+----------+\n|        3 |\n+----------+\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u793a\u4f8b\u5747\u6765\u6e90\u4e8e\u7f51\u7edc\u3002")))}i.isMDXComponent=!0}}]);